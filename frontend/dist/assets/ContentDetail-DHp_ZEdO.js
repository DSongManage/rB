import{j as e}from"./web3auth-BCRZXB2Y.js";import{r as t,L as i,e as r,a as n,u as o}from"./router-zDWjfnwa.js";import{A as a,P as s}from"./PreviewModal-BW80frFW.js";import{C as l}from"./CopyrightNotice-Dgi_K9Ee.js";import{c as d,C as c,a as g,u,m as f,A as p,l as h}from"./index-BkAHuTng.js";import{R as x,S as b}from"./RatingForm-07VyEmuW.js";import{d as m,e as y,h as j}from"./socialApi-t1_JO7iC.js";import{S as v}from"./star-D1pMvDh1.js";import{S}from"./sparkles-CVRpRXgC.js";import{A as k}from"./arrow-left-C7ipI-6J.js";import"./vendor-Cfs_Iq82.js";import"./regionCalculator-D3m0QDUE.js";import"./thumbs-up-DDAlpw32.js";import"./pen-CTvkgNl-.js";import"./trash-2-DMc5Wn_h.js";import"./send-UihDEvTc.js";import"./check-v-ZG10ZY.js";import"./circle-alert-2JOQTtGj.js";import"./ComicPageRenderer-D97J15kO.js";import"./message-circle-Bm9GANKq.js";
/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const w=d("play",[["path",{d:"M5 5a2 2 0 0 1 3.008-1.728l11.997 6.998a2 2 0 0 1 .003 3.458l-12 7A2 2 0 0 1 5 19z",key:"10ikf1"}]]);function z({rating:t}){return e.jsx("div",{style:{padding:"16px 0",borderBottom:"1px solid #1e293b"},children:e.jsxs("div",{style:{display:"flex",gap:12},children:[t.user_avatar?e.jsx("img",{src:t.user_avatar,alt:t.username,style:{width:40,height:40,borderRadius:"50%",objectFit:"cover",flexShrink:0}}):e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:16,fontWeight:600,flexShrink:0},children:t.username.charAt(0).toUpperCase()}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:4,flexWrap:"wrap"},children:[e.jsxs(i,{to:`/profile/${t.username}`,style:{fontWeight:600,color:"#f1f5f9",textDecoration:"none",fontSize:14},children:["@",t.username]}),e.jsx(b,{rating:t.rating,size:"sm",readonly:!0}),e.jsx("span",{style:{fontSize:12,color:"#64748b"},children:(e=>{const t=new Date,i=new Date(e),r=Math.floor((t.getTime()-i.getTime())/1e3);return r<60?"just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<2592e3?`${Math.floor(r/86400)}d ago`:i.toLocaleDateString()})(t.created_at)})]}),t.review_text&&e.jsx("p",{style:{color:"#cbd5e1",fontSize:14,lineHeight:1.6,margin:0},children:t.review_text})]})]})})}function R({contentId:i,initialAverageRating:r,initialRatingCount:n=0,isAuthenticated:o=!0,onAuthRequired:a,autoOpen:s=!1}){const[l,d]=t.useState(!1),[u,f]=t.useState(!1),{ratings:p,myRating:h,isLoading:k,isSubmitting:w,error:R,averageRating:_,totalCount:C,submitMyRating:B}=function(e,i={}){const[r,n]=t.useState([]),[o,a]=t.useState(null),[s,l]=t.useState(!1),[d,c]=t.useState(!1),[g,u]=t.useState(null),[f,p]=t.useState(1),[h,x]=t.useState(!1),[b,v]=t.useState(i.initialRatingCount??0),[S,k]=t.useState(i.initialAverageRating??null),w=t.useRef(!1),z=t.useRef(!1),R=t.useRef(!1),_=t.useCallback(async(t,i=!1)=>{if(!w.current){w.current=!0,l(!0),u(null);try{const r=await m(e,t);n(e=>{const t=i?[...e,...r.results]:r.results;if(t.length>0){const e=t.reduce((e,t)=>e+t.rating,0)/t.length;k(Math.round(10*e)/10)}return t}),x(null!==r.next),v(r.count),p(t)}catch(r){const e=r instanceof Error?r.message:"Failed to load ratings";e.includes("throttle")||u(e)}finally{l(!1),w.current=!1}}},[e]),C=t.useCallback(async()=>{if(!z.current){z.current=!0;try{const t=await y(e);a(t)}catch(t){}finally{z.current=!1}}},[e]),B=t.useCallback(async()=>{await Promise.all([_(1,!1),C()])},[_,C]),I=t.useCallback(async()=>{s||!h||w.current||await _(f+1,!0)},[_,s,h,f]),W=t.useCallback(async(t,i)=>{c(!0),u(null);try{const r=await j(e,t,i);a(r),n(e=>e.findIndex(e=>e.id===r.id)>=0?e.map(e=>e.id===r.id?r:e):[r,...e])}catch(r){throw u(r instanceof Error?r.message:"Failed to submit rating"),r}finally{c(!1)}},[e]);return t.useEffect(()=>{R.current||(R.current=!0,_(1,!1),C())},[e]),t.useEffect(()=>()=>{R.current=!1},[e]),t.useEffect(()=>{void 0!==i.initialAverageRating&&null===S&&k(i.initialAverageRating),void 0!==i.initialRatingCount&&0===b&&v(i.initialRatingCount)},[i.initialAverageRating,i.initialRatingCount]),{ratings:r,myRating:o,isLoading:s,isSubmitting:d,error:g,hasMore:h,totalCount:b,averageRating:S,loadMore:I,refresh:B,submitMyRating:W}}(i,{initialAverageRating:r,initialRatingCount:n});t.useEffect(()=>{s&&!h&&o&&!k&&d(!0)},[s,h,o,k]);const I=u?p:p.slice(0,3);return e.jsxs("div",{style:{background:"#0f172a",borderRadius:16,border:"1px solid #1e293b",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[e.jsx(v,{size:20,fill:"#fbbf24",color:"#fbbf24"}),e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:700,color:"#f1f5f9"},children:"Ratings & Reviews"})]}),null!==_&&_>0&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,background:"rgba(251, 191, 36, 0.1)",padding:"8px 14px",borderRadius:10,border:"1px solid rgba(251, 191, 36, 0.2)"},children:[e.jsx(v,{size:18,fill:"#fbbf24",color:"#fbbf24"}),e.jsx("span",{style:{fontSize:18,fontWeight:700,color:"#fbbf24"},children:_.toFixed(1)}),e.jsxs("span",{style:{color:"#64748b",fontSize:13},children:["(",C,")"]})]})]}),e.jsxs("div",{style:{padding:"20px 24px"},children:[o&&!h&&e.jsx("div",{style:{marginBottom:24},children:l?e.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:20},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx(S,{size:18,color:"#fbbf24"}),e.jsx("h4",{style:{margin:0,fontSize:16,fontWeight:600,color:"#f1f5f9"},children:"Write a Review"})]}),e.jsx("button",{onClick:()=>d(!1),style:{background:"transparent",border:"none",color:"#64748b",fontSize:13,cursor:"pointer"},children:"Cancel"})]}),e.jsx(x,{onSubmit:async(e,t)=>{o?(await B(e,t),d(!1)):null==a||a()},isSubmitting:w})]}):e.jsxs("button",{onClick:()=>d(!0),style:{width:"100%",padding:"14px 20px",background:"transparent",border:"2px dashed #334155",borderRadius:12,color:"#94a3b8",fontSize:14,fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8,transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.borderColor="#8b5cf6",e.currentTarget.style.color="#a78bfa"},onMouseLeave:e=>{e.currentTarget.style.borderColor="#334155",e.currentTarget.style.color="#94a3b8"},children:[e.jsx(v,{size:18}),"Rate this content"]})}),h&&e.jsxs("div",{style:{marginBottom:24,background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.2)",borderRadius:12,padding:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:h.review_text?8:0},children:[e.jsx("span",{style:{fontSize:13,color:"#a78bfa",fontWeight:500},children:"Your rating:"}),e.jsx(b,{rating:h.rating,size:"sm",readonly:!0})]}),h.review_text&&e.jsx("p",{style:{margin:0,fontSize:14,color:"#c4b5fd",lineHeight:1.5},children:h.review_text})]}),R&&e.jsx("p",{style:{fontSize:13,color:"#ef4444",marginBottom:16,padding:"10px 14px",background:"rgba(239, 68, 68, 0.1)",borderRadius:8},children:R}),k&&0===p.length?e.jsx("div",{style:{textAlign:"center",padding:"32px 0",color:"#64748b",fontSize:14},children:"Loading ratings..."}):0===p.length?e.jsx("div",{style:{textAlign:"center",padding:"32px 0",color:"#64748b",fontSize:14},children:"No ratings yet. Be the first to rate!"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:I.map((t,i)=>e.jsx("div",{style:{borderBottom:i===I.length-1?"none":void 0},children:e.jsx(z,{rating:t})},t.id))}),p.length>3&&e.jsx("button",{onClick:()=>f(!u),style:{width:"100%",marginTop:16,padding:"12px",background:"transparent",border:"none",color:"#8b5cf6",fontSize:14,fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:6},children:u?e.jsxs(e.Fragment,{children:["Show Less ",e.jsx(c,{size:18})]}):e.jsxs(e.Fragment,{children:["Show All (",p.length,") ",e.jsx(g,{size:18})]})})]})]})]})}function _(){var d,x,b,m;const{id:y}=r(),j=n(),v=o(),{isMobile:S,isPhone:z}=u(),{displayBalance:_,syncStatus:C,isBalanceSufficient:B}=f(),[I,W]=t.useState(null),[A,T]=t.useState(!1),[F,$]=t.useState(!1),[M,L]=t.useState(!1),P=t.useRef(null),E="true"===new URLSearchParams(v.search).get("completed");t.useEffect(()=>{if(!y)return;const e=new AbortController;return Promise.all([fetch(`${p}/api/content/${y}/preview/`,{credentials:"include",signal:e.signal}).then(e=>e.ok?e.json():null),fetch(`${p}/api/auth/status/`,{credentials:"include",signal:e.signal}).then(e=>e.ok?e.json():null)]).then(([e,t])=>{W(e),$(!!(null==t?void 0:t.username))}).catch(e=>{e.name}),fetch(`${p}/api/content/${y}/view/`,{method:"POST",credentials:"include"}).catch(()=>{}),()=>e.abort()},[y]),t.useEffect(()=>{E&&I&&setTimeout(()=>{var e;null==(e=P.current)||e.scrollIntoView({behavior:"smooth",block:"center"})},500)},[E,I]);const D=()=>{T(!0)};if(!y)return null;if(!I)return e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:400,color:"#94a3b8",fontSize:16},children:"Loading..."});const U="book"===(null==I?void 0:I.content_type)?`${p}/api/content/${y}/teaser/`:null==I?void 0:I.teaser_link,H=(null==(d=null==I?void 0:I.collaborators)?void 0:d.map(e=>({username:e.username,role:e.role,revenuePercentage:e.revenue_percentage})))||[],N="string"==typeof(null==I?void 0:I.price_usd)?parseFloat(I.price_usd):null==I?void 0:I.price_usd,O=N&&N>0?`$${N.toFixed(2)}`:"Free",Y=null==I?void 0:I.editions,q=Y&&Y>0?`${Y} edition${Y>1?"s":""} available`:"Sold out";return e.jsxs("div",{style:{maxWidth:900,margin:"0 auto",padding:S?"16px 12px":"24px 16px"},children:[e.jsxs("button",{onClick:()=>j(-1),style:{display:"flex",alignItems:"center",gap:8,background:"transparent",border:"none",color:"#94a3b8",cursor:"pointer",marginBottom:S?16:20,padding:0,fontSize:14},children:[e.jsx(k,{size:18}),"Back"]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:z?"1fr":"300px 1fr",gap:S?16:24,marginBottom:S?24:32},children:[e.jsxs("div",{style:{position:"relative"},children:[e.jsxs("div",{style:{width:"100%",aspectRatio:"3/4",borderRadius:12,overflow:"hidden",background:"#1e293b",cursor:"pointer",position:"relative"},onClick:D,children:[(null==I?void 0:I.teaser_link)?e.jsx("img",{src:I.teaser_link,alt:I.title,style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{e.currentTarget.style.display="none"}}):e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",color:"#fff",fontSize:48,fontWeight:700},children:(null==(x=null==I?void 0:I.title)?void 0:x.charAt(0))||"?"}),e.jsx("div",{style:{position:"absolute",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",opacity:0,transition:"opacity 0.2s"},onMouseEnter:e=>e.currentTarget.style.opacity="1",onMouseLeave:e=>e.currentTarget.style.opacity="0",children:e.jsx("div",{style:{background:"rgba(255,255,255,0.9)",borderRadius:"50%",width:64,height:64,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(w,{size:32,fill:"#1e293b",color:"#1e293b"})})})]}),e.jsxs("button",{onClick:D,style:{width:"100%",marginTop:12,padding:"12px 20px",background:"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)",color:"#fff",border:"none",borderRadius:8,fontWeight:600,fontSize:14,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[e.jsx(w,{size:18}),"View Preview"]}),F&&Y>0&&N>0&&e.jsx("div",{style:{marginTop:12,width:"100%"},children:e.jsx(a,{contentId:parseInt(y),price:N.toFixed(2),alreadyOwned:null==(b=null==I?void 0:I.preview)?void 0:b.owned})})]}),e.jsxs("div",{children:[e.jsx("h1",{style:{color:"#f1f5f9",fontSize:28,fontWeight:700,margin:0,marginBottom:16},children:null==I?void 0:I.title}),(null==I?void 0:I.creator_username)&&e.jsxs(i,{to:`/profile/${I.creator_username}`,style:{display:"flex",alignItems:"center",gap:12,marginBottom:16,textDecoration:"none"},children:[e.jsx("div",{style:{width:48,height:48,borderRadius:"50%",overflow:"hidden",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:I.creator_avatar?e.jsx("img",{src:I.creator_avatar,alt:I.creator_username,style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(h,{size:24,color:"#fff"})}),e.jsxs("div",{children:[e.jsxs("div",{style:{color:"#60a5fa",fontSize:15,fontWeight:600},children:["@",I.creator_username]}),I.created_at&&e.jsxs("div",{style:{color:"#64748b",fontSize:12},children:["Published ",(G=I.created_at,new Date(G).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"}))]})]})]}),(null==I?void 0:I.is_collaborative)&&H.length>0&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsxs("button",{onClick:()=>L(!M),style:{display:"flex",alignItems:"center",gap:8,background:"#1e293b",border:"1px solid #334155",borderRadius:8,padding:"8px 12px",color:"#94a3b8",fontSize:13,cursor:"pointer",width:"fit-content"},children:[e.jsxs("span",{children:["By"," ",e.jsxs("span",{style:{color:"#60a5fa"},children:["@",null==(m=H[0])?void 0:m.username]}),H.length>1&&e.jsxs("span",{children:[" & ",H.length-1," other",H.length>2?"s":""]})]}),H.length>1&&(M?e.jsx(c,{size:16}):e.jsx(g,{size:16}))]}),M&&e.jsx("div",{style:{display:"flex",flexWrap:"wrap",gap:8,marginTop:8,paddingLeft:8},children:H.map(t=>e.jsxs(i,{to:`/profile/${t.username}`,style:{background:"#0f172a",border:"1px solid #334155",borderRadius:6,padding:"6px 12px",fontSize:12,color:"#60a5fa",textDecoration:"none"},children:["@",t.username,e.jsxs("span",{style:{color:"#64748b",marginLeft:4},children:["(",t.role,")"]}),e.jsxs("span",{style:{color:"#10b981",marginLeft:4},children:[t.revenuePercentage,"%"]})]},t.username))})]}),e.jsxs("div",{style:{display:"flex",gap:16,marginBottom:20},children:[e.jsxs("div",{style:{background:N>0?"rgba(16,185,129,0.15)":"rgba(148,163,184,0.15)",border:N>0?"1px solid rgba(16,185,129,0.3)":"1px solid rgba(148,163,184,0.3)",padding:"8px 16px",borderRadius:8},children:[e.jsx("div",{style:{color:"#64748b",fontSize:11,textTransform:"uppercase",marginBottom:2},children:"Price"}),e.jsx("div",{style:{color:N>0?"#10b981":"#94a3b8",fontSize:18,fontWeight:700},children:O})]}),e.jsxs("div",{style:{background:Y>0?"rgba(59,130,246,0.15)":"rgba(239,68,68,0.15)",border:Y>0?"1px solid rgba(59,130,246,0.3)":"1px solid rgba(239,68,68,0.3)",padding:"8px 16px",borderRadius:8},children:[e.jsx("div",{style:{color:"#64748b",fontSize:11,textTransform:"uppercase",marginBottom:2},children:"Availability"}),e.jsx("div",{style:{color:Y>0?"#60a5fa":"#ef4444",fontSize:14,fontWeight:600},children:q})]})]}),F&&N>0&&"no_wallet"!==C&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:16,padding:"10px 16px",background:B(N)?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid "+(B(N)?"rgba(16, 185, 129, 0.3)":"rgba(239, 68, 68, 0.3)"),borderRadius:8},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:2},children:"Your Balance"}),e.jsx("div",{style:{fontSize:16,fontWeight:600,color:B(N)?"#10b981":"#ef4444"},children:_||"$0.00"})]}),e.jsx("div",{style:{fontSize:12,fontWeight:500,color:B(N)?"#10b981":"#f87171",padding:"4px 8px",background:B(N)?"rgba(16, 185, 129, 0.2)":"rgba(239, 68, 68, 0.2)",borderRadius:4},children:B(N)?"Sufficient":"Insufficient"})]}),e.jsxs("div",{style:{display:"flex",gap:8,flexWrap:"wrap",marginBottom:16},children:[e.jsx("div",{style:{display:"inline-block",background:"rgba(139,92,246,0.15)",border:"1px solid rgba(139,92,246,0.3)",color:"#a78bfa",padding:"4px 12px",borderRadius:6,fontSize:12,fontWeight:600,textTransform:"capitalize"},children:null==I?void 0:I.content_type}),(null==I?void 0:I.genre)&&"other"!==I.genre&&e.jsx("div",{style:{display:"inline-block",background:"rgba(59,130,246,0.15)",border:"1px solid rgba(59,130,246,0.3)",color:"#60a5fa",padding:"4px 12px",borderRadius:6,fontSize:12,fontWeight:600},children:(V=I.genre,{fantasy:"Fantasy",scifi:"Sci-Fi",nonfiction:"Non-Fiction",drama:"Drama",comedy:"Comedy",other:"Other"}[V]||V)})]}),"book"===(null==I?void 0:I.content_type)&&(null==I?void 0:I.description)&&e.jsxs("div",{style:{background:"rgba(59, 130, 246, 0.08)",border:"1px solid rgba(59, 130, 246, 0.2)",borderRadius:12,padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#60a5fa",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:8},children:"Synopsis"}),e.jsx("p",{style:{color:"#e2e8f0",fontSize:14,lineHeight:1.7,margin:0},children:I.description})]}),(null==I?void 0:I.series_info)&&e.jsxs("div",{style:{background:"rgba(139, 92, 246, 0.08)",border:"1px solid rgba(139, 92, 246, 0.2)",borderRadius:12,padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#a78bfa",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:8},children:"Part of Series"}),e.jsx("div",{style:{color:"#e2e8f0",fontSize:15,fontWeight:600},children:I.series_info.title}),I.series_info.book_count>1&&e.jsxs("div",{style:{color:"#94a3b8",fontSize:12,marginTop:4},children:[I.series_info.book_count," books in this series"]})]}),(null==I?void 0:I.authors_note)&&e.jsxs("div",{style:{background:"rgba(30, 41, 59, 0.5)",border:"1px solid #334155",borderRadius:12,padding:16,marginBottom:16},children:[e.jsx("div",{style:{fontSize:12,fontWeight:600,color:"#94a3b8",textTransform:"uppercase",letterSpacing:"0.05em",marginBottom:8},children:"From the Author"}),e.jsxs("p",{style:{color:"#e2e8f0",fontSize:14,lineHeight:1.6,margin:0,fontStyle:"italic"},children:['"',I.authors_note,'"']})]}),e.jsx(l,{authorName:(null==I?void 0:I.copyright_holder)||(null==I?void 0:I.creator_username)||"Unknown",year:(null==I?void 0:I.copyright_year)||(new Date).getFullYear()})]})]}),e.jsx(s,{open:A,onClose:()=>{T(!1)},teaserUrl:U,contentType:null==I?void 0:I.content_type,contentId:parseInt(y),price:null==I?void 0:I.price_usd,editions:null==I?void 0:I.editions,isCollaborative:null==I?void 0:I.is_collaborative,collaborators:H,creatorUsername:null==I?void 0:I.creator_username,creatorAvatar:null==I?void 0:I.creator_avatar,title:null==I?void 0:I.title,likeCount:(null==I?void 0:I.like_count)||0,userHasLiked:(null==I?void 0:I.user_has_liked)||!1,commentCount:(null==I?void 0:I.comment_count)||0}),e.jsx("div",{ref:P,children:e.jsx(R,{contentId:parseInt(y),isAuthenticated:F,onAuthRequired:()=>{j("/auth")},autoOpen:E})})]});var V,G}export{_ as default};
