{"version":3,"file":"SearchPage-DwJYg33V.js","sources":["../../src/pages/SearchPage.tsx"],"sourcesContent":["import React, { useCallback, useEffect, useState } from 'react';\nimport { useLocation, useSearchParams } from 'react-router-dom';\nimport { VideoCard } from '../components/VideoCard';\nimport { API_URL } from '../config';\n\n// Filter options\nconst TYPE_FILTERS = [\n  { label: 'All', value: 'all' },\n  { label: 'Books', value: 'book' },\n  { label: 'Art', value: 'art' },\n  { label: 'Film', value: 'film' },\n  { label: 'Music', value: 'music' },\n];\n\nconst GENRE_FILTERS = [\n  { label: 'All Genres', value: 'all' },\n  { label: 'Fantasy', value: 'fantasy' },\n  { label: 'Sci-Fi', value: 'scifi' },\n  { label: 'Non-Fiction', value: 'nonfiction' },\n  { label: 'Drama', value: 'drama' },\n  { label: 'Comedy', value: 'comedy' },\n  { label: 'Other', value: 'other' },\n];\n\ntype SearchResult = {\n  id: number;\n  title: string;\n  teaser_link?: string;\n  creator?: number;\n  creator_username?: string;\n  created_at?: string;\n  content_type?: string;\n  like_count?: number;\n  average_rating?: number | null;\n  rating_count?: number;\n  price_usd?: number;\n  editions?: number;\n  owned?: boolean;\n};\n\n\nexport default function SearchPage() {\n  const location = useLocation();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  // Get values from URL params\n  const query = searchParams.get('q') || '';\n  const [type, setType] = useState(searchParams.get('type') || 'all');\n  const [genre, setGenre] = useState(searchParams.get('genre') || 'all');\n  const [results, setResults] = useState<SearchResult[]>([]);\n  const [loading, setLoading] = useState(false);\n\n  // Update URL when filters change\n  const updateFilters = (newType: string, newGenre: string) => {\n    const params = new URLSearchParams(searchParams);\n    if (newType !== 'all') {\n      params.set('type', newType);\n    } else {\n      params.delete('type');\n    }\n    if (newGenre !== 'all') {\n      params.set('genre', newGenre);\n    } else {\n      params.delete('genre');\n    }\n    setSearchParams(params);\n  };\n\n  const handleTypeChange = (newType: string) => {\n    setType(newType);\n    updateFilters(newType, genre);\n  };\n\n  const handleGenreChange = (newGenre: string) => {\n    setGenre(newGenre);\n    updateFilters(type, newGenre);\n  };\n\n  const fetchResults = useCallback(() => {\n    setLoading(true);\n    const params = new URLSearchParams();\n    if (query) params.set('q', query);\n    if (type !== 'all') params.set('type', type);\n    if (genre !== 'all') params.set('genre', genre);\n\n    fetch(`${API_URL}/api/search/?${params.toString()}`, { credentials: 'include' })\n      .then(r => r.json())\n      .then(data => {\n        if (Array.isArray(data)) {\n          setResults(data);\n        } else {\n          setResults([]);\n        }\n      })\n      .catch(() => setResults([]))\n      .finally(() => setLoading(false));\n  }, [query, type, genre]);\n\n  // Fetch results when query or filters change\n  useEffect(() => {\n    fetchResults();\n  }, [fetchResults]);\n\n  // Sync local state with URL params when they change\n  useEffect(() => {\n    setType(searchParams.get('type') || 'all');\n    setGenre(searchParams.get('genre') || 'all');\n  }, [searchParams]);\n\n  // Format time ago\n  const getTimeAgo = (dateString?: string) => {\n    if (!dateString) return 'Recently';\n    const date = new Date(dateString);\n    const now = new Date();\n    const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n    if (seconds < 60) return 'Just now';\n    if (seconds < 3600) return `${Math.floor(seconds / 60)} minutes ago`;\n    if (seconds < 86400) return `${Math.floor(seconds / 3600)} hours ago`;\n    if (seconds < 604800) return `${Math.floor(seconds / 86400)} days ago`;\n    return `${Math.floor(seconds / 604800)} weeks ago`;\n  };\n\n  return (\n    <div className=\"page\" style={{ background: 'transparent', border: 'none', boxShadow: 'none' }}>\n      {/* Search query display */}\n      {query && (\n        <div style={{ marginBottom: 16 }}>\n          <h2 style={{ margin: 0, fontSize: 20, color: '#f1f5f9' }}>\n            Results for \"{query}\"\n          </h2>\n          <p style={{ margin: '4px 0 0', fontSize: 14, color: '#94a3b8' }}>\n            {results.length} result{results.length !== 1 ? 's' : ''} found\n          </p>\n        </div>\n      )}\n\n      {/* Filter chips */}\n      <div style={{ marginBottom: 16 }}>\n        <div className=\"chips\" style={{ marginBottom: 8 }}>\n          {TYPE_FILTERS.map(f => (\n            <button\n              key={f.value}\n              className={`chip ${type === f.value ? 'active' : ''}`}\n              onClick={() => handleTypeChange(f.value)}\n            >\n              {f.label}\n            </button>\n          ))}\n        </div>\n        <div className=\"chips\">\n          {GENRE_FILTERS.map(f => (\n            <button\n              key={f.value}\n              className={`chip ${genre === f.value ? 'active' : ''}`}\n              onClick={() => handleGenreChange(f.value)}\n            >\n              {f.label}\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/* Results grid */}\n      {loading ? (\n        <div style={{ textAlign: 'center', padding: 40, color: '#94a3b8' }}>\n          Searching...\n        </div>\n      ) : results.length === 0 ? (\n        <div style={{ textAlign: 'center', padding: 40, color: '#94a3b8' }}>\n          {query ? `No results found for \"${query}\"` : 'Browse content using the filters above'}\n        </div>\n      ) : (\n        <div className=\"yt-grid\">\n          {results.map((it) => (\n            <VideoCard\n              key={it.id}\n              id={it.id}\n              title={it.title}\n              author={it.creator_username || `Creator #${it.creator ?? 0}`}\n              likeCount={it.like_count}\n              averageRating={it.average_rating}\n              ratingCount={it.rating_count}\n              timeText={getTimeAgo(it.created_at)}\n              thumbnailUrl={it.teaser_link || ''}\n              teaser_link={it.teaser_link}\n              price={it.price_usd}\n              editions={it.editions}\n              owned={it.owned}\n            />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"names":["TYPE_FILTERS","label","value","GENRE_FILTERS","SearchPage","useLocation","searchParams","setSearchParams","useSearchParams","query","get","type","setType","useState","genre","setGenre","results","setResults","loading","setLoading","updateFilters","newType","newGenre","params","URLSearchParams","set","delete","fetchResults","useCallback","fetch","API_URL","toString","credentials","then","r","json","data","Array","isArray","catch","finally","useEffect","getTimeAgo","dateString","date","Date","now","seconds","Math","floor","getTime","jsxs","className","style","background","border","boxShadow","children","marginBottom","margin","fontSize","color","length","jsx","map","f","onClick","handleTypeChange","handleGenreChange","textAlign","padding","it","VideoCard","id","title","author","creator_username","creator","likeCount","like_count","averageRating","average_rating","ratingCount","rating_count","timeText","created_at","thumbnailUrl","teaser_link","price","price_usd","editions","owned"],"mappings":"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"}