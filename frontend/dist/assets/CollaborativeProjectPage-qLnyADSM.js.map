{"version":3,"file":"CollaborativeProjectPage-qLnyADSM.js","sources":["../../node_modules/lucide-react/dist/esm/icons/activity.js","../../node_modules/lucide-react/dist/esm/icons/circle-dot.js","../../node_modules/lucide-react/dist/esm/icons/clipboard-list.js","../../node_modules/lucide-react/dist/esm/icons/coins.js","../../node_modules/lucide-react/dist/esm/icons/layout-dashboard.js","../../node_modules/lucide-react/dist/esm/icons/list-todo.js","../../node_modules/lucide-react/dist/esm/icons/user-minus.js","../../src/components/collaboration/tabs/TabNavigation.tsx","../../src/components/collaboration/RevenueSplitChart.tsx","../../src/components/collaboration/tabs/OverviewTab.tsx","../../src/components/collaboration/TeamOverview.tsx","../../src/components/collaboration/TaskTracker.tsx","../../src/components/collaboration/tabs/TeamTab.tsx","../../src/services/activityService.ts","../../src/hooks/useActivity.ts","../../src/utils/timelineUtils.ts","../../src/components/collaboration/timeline/TaskTimelineItem.tsx","../../src/components/collaboration/timeline/ActivityTimelineItem.tsx","../../src/components/collaboration/timeline/UnifiedTimeline.tsx","../../src/components/collaboration/tabs/ActivityTab.tsx","../../src/components/collaboration/tabs/PublishTab.tsx","../../src/hooks/useComments.ts","../../src/components/collaboration/OnlineStatus.tsx","../../src/components/collaboration/EditingIndicator.tsx","../../src/components/collaboration/ActivityFeed.tsx","../../src/components/collaboration/CommentComposer.tsx","../../src/components/collaboration/CommentReactions.tsx","../../src/components/collaboration/CommentThread.tsx","../../src/components/collaboration/ApprovalRequestModal.tsx","../../src/components/collaboration/IndividualApprovalView.tsx","../../src/components/collaboration/MintingProgressModal.tsx","../../src/components/collaboration/MintingWorkflow.tsx","../../src/components/collaboration/CollaborativeEditor.tsx","../../src/components/collaboration/CollaborativeBookEditor.tsx","../../src/components/collaboration/CollaborativeArtEditor.tsx","../../src/components/collaboration/CollaborativeMusicEditor.tsx","../../src/components/collaboration/CollaborativeVideoEditor.tsx","../../src/components/collaboration/ReviewerInterface.tsx","../../src/components/collaboration/CommentsPanel.tsx","../../src/components/collaboration/tabs/ContentTab.tsx","../../src/pages/CollaborativeProjectPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2\",\n      key: \"169zse\"\n    }\n  ]\n];\nconst Activity = createLucideIcon(\"activity\", __iconNode);\n\nexport { __iconNode, Activity as default };\n//# sourceMappingURL=activity.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"1\", key: \"41hilf\" }]\n];\nconst CircleDot = createLucideIcon(\"circle-dot\", __iconNode);\n\nexport { __iconNode, CircleDot as default };\n//# sourceMappingURL=circle-dot.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"8\", height: \"4\", x: \"8\", y: \"2\", rx: \"1\", ry: \"1\", key: \"tgr4d6\" }],\n  [\n    \"path\",\n    {\n      d: \"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2\",\n      key: \"116196\"\n    }\n  ],\n  [\"path\", { d: \"M12 11h4\", key: \"1jrz19\" }],\n  [\"path\", { d: \"M12 16h4\", key: \"n85exb\" }],\n  [\"path\", { d: \"M8 11h.01\", key: \"1dfujw\" }],\n  [\"path\", { d: \"M8 16h.01\", key: \"18s6g9\" }]\n];\nconst ClipboardList = createLucideIcon(\"clipboard-list\", __iconNode);\n\nexport { __iconNode, ClipboardList as default };\n//# sourceMappingURL=clipboard-list.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"8\", cy: \"8\", r: \"6\", key: \"3yglwk\" }],\n  [\"path\", { d: \"M18.09 10.37A6 6 0 1 1 10.34 18\", key: \"t5s6rm\" }],\n  [\"path\", { d: \"M7 6h1v4\", key: \"1obek4\" }],\n  [\"path\", { d: \"m16.71 13.88.7.71-2.82 2.82\", key: \"1rbuyh\" }]\n];\nconst Coins = createLucideIcon(\"coins\", __iconNode);\n\nexport { __iconNode, Coins as default };\n//# sourceMappingURL=coins.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"7\", height: \"9\", x: \"3\", y: \"3\", rx: \"1\", key: \"10lvy0\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"14\", y: \"3\", rx: \"1\", key: \"16une8\" }],\n  [\"rect\", { width: \"7\", height: \"9\", x: \"14\", y: \"12\", rx: \"1\", key: \"1hutg5\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"3\", y: \"16\", rx: \"1\", key: \"ldoo1y\" }]\n];\nconst LayoutDashboard = createLucideIcon(\"layout-dashboard\", __iconNode);\n\nexport { __iconNode, LayoutDashboard as default };\n//# sourceMappingURL=layout-dashboard.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M13 5h8\", key: \"a7qcls\" }],\n  [\"path\", { d: \"M13 12h8\", key: \"h98zly\" }],\n  [\"path\", { d: \"M13 19h8\", key: \"c3s6r1\" }],\n  [\"path\", { d: \"m3 17 2 2 4-4\", key: \"1jhpwq\" }],\n  [\"rect\", { x: \"3\", y: \"4\", width: \"6\", height: \"6\", rx: \"1\", key: \"cif1o7\" }]\n];\nconst ListTodo = createLucideIcon(\"list-todo\", __iconNode);\n\nexport { __iconNode, ListTodo as default };\n//# sourceMappingURL=list-todo.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }],\n  [\"line\", { x1: \"22\", x2: \"16\", y1: \"11\", y2: \"11\", key: \"1shjgl\" }]\n];\nconst UserMinus = createLucideIcon(\"user-minus\", __iconNode);\n\nexport { __iconNode, UserMinus as default };\n//# sourceMappingURL=user-minus.js.map\n","import React from 'react';\nimport { LayoutDashboard, FileText, Users, MessageSquare, Rocket } from 'lucide-react';\n\nexport type TabId = 'overview' | 'content' | 'team' | 'activity' | 'publish';\n\ninterface Tab {\n  id: TabId;\n  label: string;\n  icon: React.ReactNode;\n  badge?: number;\n}\n\ninterface TabNavigationProps {\n  activeTab: TabId;\n  onTabChange: (tab: TabId) => void;\n  badges?: {\n    activity?: number;\n    team?: number;\n  };\n  isFullyApproved?: boolean;\n}\n\nconst tabs: Tab[] = [\n  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={18} /> },\n  { id: 'content', label: 'Content', icon: <FileText size={18} /> },\n  { id: 'team', label: 'Team', icon: <Users size={18} /> },\n  { id: 'activity', label: 'Activity', icon: <MessageSquare size={18} /> },\n  { id: 'publish', label: 'Publish', icon: <Rocket size={18} /> },\n];\n\nexport default function TabNavigation({\n  activeTab,\n  onTabChange,\n  badges = {},\n  isFullyApproved = false,\n}: TabNavigationProps) {\n  return (\n    <div style={{\n      display: 'flex',\n      gap: 4,\n      background: 'var(--panel)',\n      padding: 4,\n      borderRadius: 12,\n      border: '1px solid var(--panel-border)',\n    }}>\n      {tabs.map((tab) => {\n        const isActive = activeTab === tab.id;\n        const badge = tab.id === 'activity' ? badges.activity :\n                     tab.id === 'team' ? badges.team : undefined;\n\n        // Highlight publish tab when ready\n        const isPublishReady = tab.id === 'publish' && isFullyApproved;\n\n        return (\n          <button\n            key={tab.id}\n            onClick={() => onTabChange(tab.id)}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              padding: '10px 16px',\n              background: isActive\n                ? 'var(--bg)'\n                : isPublishReady\n                  ? 'rgba(16, 185, 129, 0.1)'\n                  : 'transparent',\n              border: isActive\n                ? '1px solid var(--panel-border)'\n                : isPublishReady\n                  ? '1px solid rgba(16, 185, 129, 0.3)'\n                  : '1px solid transparent',\n              borderRadius: 8,\n              color: isActive\n                ? 'var(--text)'\n                : isPublishReady\n                  ? '#10b981'\n                  : '#94a3b8',\n              cursor: 'pointer',\n              fontSize: 14,\n              fontWeight: isActive ? 600 : 500,\n              transition: 'all 0.2s ease',\n              position: 'relative',\n            }}\n          >\n            <span style={{ display: 'flex', alignItems: 'center' }}>{tab.icon}</span>\n            <span>{tab.label}</span>\n            {badge !== undefined && badge > 0 && (\n              <span style={{\n                background: '#ef4444',\n                color: '#fff',\n                fontSize: 10,\n                fontWeight: 700,\n                padding: '2px 6px',\n                borderRadius: 10,\n                minWidth: 18,\n                textAlign: 'center',\n              }}>\n                {badge > 99 ? '99+' : badge}\n              </span>\n            )}\n          </button>\n        );\n      })}\n    </div>\n  );\n}\n","import React from 'react';\n\ninterface Collaborator {\n  id: number;\n  username: string;\n  role: string;\n  revenue_percentage: number;\n}\n\ninterface RevenueSplitChartProps {\n  collaborators: Collaborator[];\n  size?: number;\n}\n\n// Color palette for collaborators\nconst COLORS = [\n  '#8b5cf6', // Purple\n  '#f59e0b', // Amber\n  '#10b981', // Green\n  '#3b82f6', // Blue\n  '#ef4444', // Red\n  '#ec4899', // Pink\n  '#06b6d4', // Cyan\n  '#f97316', // Orange\n];\n\nexport default function RevenueSplitChart({\n  collaborators,\n  size = 200,\n}: RevenueSplitChartProps) {\n  const centerX = size / 2;\n  const centerY = size / 2;\n  const radius = size / 2 - 10;\n  const innerRadius = radius * 0.6; // Donut hole\n\n  // Calculate pie slices\n  let currentAngle = -90; // Start at top\n  const slices = collaborators.map((collab, index) => {\n    const percentage = Number(collab.revenue_percentage);\n    const angle = (percentage / 100) * 360;\n    const startAngle = currentAngle;\n    const endAngle = currentAngle + angle;\n    currentAngle = endAngle;\n\n    return {\n      ...collab,\n      color: COLORS[index % COLORS.length],\n      startAngle,\n      endAngle,\n      percentage,\n    };\n  });\n\n  // Convert polar to cartesian coordinates\n  const polarToCartesian = (cx: number, cy: number, r: number, angle: number) => {\n    const radians = (angle * Math.PI) / 180;\n    return {\n      x: cx + r * Math.cos(radians),\n      y: cy + r * Math.sin(radians),\n    };\n  };\n\n  // Create arc path\n  const createArc = (startAngle: number, endAngle: number, outerR: number, innerR: number) => {\n    const start = polarToCartesian(centerX, centerY, outerR, startAngle);\n    const end = polarToCartesian(centerX, centerY, outerR, endAngle);\n    const startInner = polarToCartesian(centerX, centerY, innerR, endAngle);\n    const endInner = polarToCartesian(centerX, centerY, innerR, startAngle);\n\n    const largeArc = endAngle - startAngle > 180 ? 1 : 0;\n\n    return `\n      M ${start.x} ${start.y}\n      A ${outerR} ${outerR} 0 ${largeArc} 1 ${end.x} ${end.y}\n      L ${startInner.x} ${startInner.y}\n      A ${innerR} ${innerR} 0 ${largeArc} 0 ${endInner.x} ${endInner.y}\n      Z\n    `;\n  };\n\n  return (\n    <div style={{ display: 'flex', alignItems: 'center', gap: 24 }}>\n      {/* Donut Chart */}\n      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n        {slices.map((slice, index) => (\n          <path\n            key={slice.id}\n            d={createArc(slice.startAngle, slice.endAngle, radius, innerRadius)}\n            fill={slice.color}\n            stroke=\"var(--panel)\"\n            strokeWidth={2}\n            style={{ transition: 'opacity 0.2s', cursor: 'pointer' }}\n            onMouseEnter={(e) => {\n              (e.target as SVGPathElement).style.opacity = '0.8';\n            }}\n            onMouseLeave={(e) => {\n              (e.target as SVGPathElement).style.opacity = '1';\n            }}\n          >\n            <title>{slice.username}: {slice.percentage}%</title>\n          </path>\n        ))}\n        {/* Center text */}\n        <text\n          x={centerX}\n          y={centerY - 8}\n          textAnchor=\"middle\"\n          fill=\"var(--text)\"\n          fontSize={24}\n          fontWeight={700}\n        >\n          {collaborators.length}\n        </text>\n        <text\n          x={centerX}\n          y={centerY + 14}\n          textAnchor=\"middle\"\n          fill=\"#94a3b8\"\n          fontSize={11}\n        >\n          {collaborators.length === 1 ? 'Creator' : 'Creators'}\n        </text>\n      </svg>\n\n      {/* Legend */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n        {slices.map((slice) => (\n          <div\n            key={slice.id}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 10,\n            }}\n          >\n            <div\n              style={{\n                width: 12,\n                height: 12,\n                borderRadius: 3,\n                background: slice.color,\n                flexShrink: 0,\n              }}\n            />\n            <div style={{ flex: 1 }}>\n              <div style={{\n                fontSize: 13,\n                fontWeight: 600,\n                color: 'var(--text)',\n              }}>\n                @{slice.username}\n              </div>\n              <div style={{\n                fontSize: 11,\n                color: '#94a3b8',\n              }}>\n                {slice.role}\n              </div>\n            </div>\n            <div style={{\n              fontSize: 14,\n              fontWeight: 700,\n              color: slice.color,\n            }}>\n              {Number(slice.percentage).toFixed(2)}%\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { CollaborativeProject, CollaboratorRole } from '../../../services/collaborationApi';\nimport RevenueSplitChart from '../RevenueSplitChart';\nimport { FileText, MessageSquare, Users, Rocket } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface OverviewTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nexport default function OverviewTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: OverviewTabProps) {\n  const [isEditingDescription, setIsEditingDescription] = useState(false);\n  const [description, setDescription] = useState(project.description || '');\n\n  const isProjectLead = project.created_by === currentUser.id;\n  const acceptedCollaborators = project.collaborators?.filter(c => c.status === 'accepted') || [];\n  const totalApproved = acceptedCollaborators.filter(\n    c => c.approved_current_version && c.approved_revenue_split\n  ).length;\n\n  return (\n    <div style={{\n      display: 'grid',\n      gridTemplateColumns: 'repeat(12, 1fr)',\n      gap: 20,\n    }}>\n      {/* Proposal Summary - Full width */}\n      <div style={{\n        gridColumn: 'span 12',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'flex-start',\n          marginBottom: 16,\n        }}>\n          <h3 style={{ margin: 0, color: 'var(--text)', fontSize: 18, fontWeight: 600 }}>\n            Project Proposal\n          </h3>\n          {isProjectLead && !isEditingDescription && (\n            <button\n              onClick={() => setIsEditingDescription(true)}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#94a3b8',\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              Edit\n            </button>\n          )}\n        </div>\n\n        {isEditingDescription ? (\n          <div>\n            <textarea\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"Describe your project proposal, goals, and expectations...\"\n              style={{\n                width: '100%',\n                minHeight: 120,\n                padding: 12,\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                lineHeight: 1.6,\n                resize: 'vertical',\n              }}\n            />\n            <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>\n              <button\n                onClick={() => {\n                  // TODO: Save description via API\n                  setIsEditingDescription(false);\n                }}\n                style={{\n                  background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '8px 16px',\n                  color: '#fff',\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  fontSize: 13,\n                }}\n              >\n                Save\n              </button>\n              <button\n                onClick={() => {\n                  setDescription(project.description || '');\n                  setIsEditingDescription(false);\n                }}\n                style={{\n                  background: 'transparent',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 6,\n                  padding: '8px 16px',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                  fontSize: 13,\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <p style={{\n            color: project.description ? '#94a3b8' : '#64748b',\n            fontSize: 14,\n            margin: 0,\n            lineHeight: 1.7,\n            fontStyle: project.description ? 'normal' : 'italic',\n          }}>\n            {project.description || 'No description provided. Click Edit to add one.'}\n          </p>\n        )}\n\n        <div style={{\n          display: 'flex',\n          gap: 24,\n          marginTop: 20,\n          paddingTop: 16,\n          borderTop: '1px solid var(--panel-border)',\n        }}>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Created by</div>\n            <div style={{ fontSize: 13, color: 'var(--text)', fontWeight: 600 }}>\n              @{project.created_by_username}\n            </div>\n          </div>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Created on</div>\n            <div style={{ fontSize: 13, color: 'var(--text)' }}>\n              {new Date(project.created_at).toLocaleDateString('en-US', {\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric',\n              })}\n            </div>\n          </div>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Content Type</div>\n            <div style={{ fontSize: 13, color: 'var(--text)' }}>\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Revenue Split Chart - Left side */}\n      <div style={{\n        gridColumn: 'span 6',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 16, fontWeight: 600 }}>\n          Revenue Split\n        </h3>\n        {project.collaborators && project.collaborators.length > 0 ? (\n          <RevenueSplitChart\n            collaborators={project.collaborators.map(c => ({\n              id: c.id,\n              username: c.username,\n              role: c.role,\n              revenue_percentage: c.revenue_percentage,\n            }))}\n            size={180}\n          />\n        ) : (\n          <div style={{ color: '#64748b', fontSize: 14 }}>\n            No collaborators yet.\n          </div>\n        )}\n\n        {/* Total check */}\n        {project.collaborators && (\n          <div style={{\n            marginTop: 20,\n            padding: 12,\n            background: 'var(--bg)',\n            borderRadius: 8,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}>\n            <span style={{ fontSize: 13, color: '#94a3b8' }}>Total</span>\n            <span style={{\n              fontSize: 16,\n              fontWeight: 700,\n              color: project.collaborators.reduce((sum, c) => sum + Number(c.revenue_percentage), 0) === 100\n                ? '#10b981'\n                : '#ef4444',\n            }}>\n              {project.collaborators.reduce((sum, c) => sum + Number(c.revenue_percentage), 0).toFixed(2)}%\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Approval Progress - Right side */}\n      <div style={{\n        gridColumn: 'span 6',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 16, fontWeight: 600 }}>\n          Approval Progress\n        </h3>\n\n        {/* Progress bar */}\n        <div style={{ marginBottom: 20 }}>\n          <div style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            marginBottom: 8,\n          }}>\n            <span style={{ fontSize: 13, color: '#94a3b8' }}>\n              {totalApproved} of {acceptedCollaborators.length} approved\n            </span>\n            <span style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n            }}>\n              {acceptedCollaborators.length > 0\n                ? Math.round((totalApproved / acceptedCollaborators.length) * 100)\n                : 0}%\n            </span>\n          </div>\n          <div style={{\n            height: 8,\n            background: 'var(--bg)',\n            borderRadius: 4,\n            overflow: 'hidden',\n          }}>\n            <div style={{\n              height: '100%',\n              width: acceptedCollaborators.length > 0\n                ? `${(totalApproved / acceptedCollaborators.length) * 100}%`\n                : '0%',\n              background: project.is_fully_approved\n                ? 'linear-gradient(90deg, #10b981 0%, #059669 100%)'\n                : 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)',\n              borderRadius: 4,\n              transition: 'width 0.3s ease',\n            }} />\n          </div>\n        </div>\n\n        {/* Collaborator approval status */}\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {acceptedCollaborators.map(collab => {\n            const hasApproved = collab.approved_current_version && collab.approved_revenue_split;\n            return (\n              <div\n                key={collab.id}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between',\n                  padding: '10px 12px',\n                  background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg)',\n                  border: `1px solid ${hasApproved ? 'rgba(16, 185, 129, 0.2)' : 'var(--panel-border)'}`,\n                  borderRadius: 8,\n                }}\n              >\n                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                  <div style={{\n                    width: 28,\n                    height: 28,\n                    borderRadius: '50%',\n                    background: hasApproved\n                      ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n                      : 'linear-gradient(135deg, #64748b 0%, #475569 100%)',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 12,\n                    fontWeight: 600,\n                  }}>\n                    {hasApproved ? 'âœ“' : collab.username.charAt(0).toUpperCase()}\n                  </div>\n                  <div>\n                    <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                      @{collab.username}\n                      {collab.user === currentUser.id && (\n                        <span style={{ color: '#94a3b8', fontWeight: 400 }}> (you)</span>\n                      )}\n                    </div>\n                    <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                      {collab.role}\n                    </div>\n                  </div>\n                </div>\n                <div style={{\n                  fontSize: 11,\n                  fontWeight: 600,\n                  color: hasApproved ? '#10b981' : '#f59e0b',\n                  background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'rgba(245, 158, 11, 0.1)',\n                  padding: '4px 8px',\n                  borderRadius: 4,\n                }}>\n                  {hasApproved ? 'Approved' : 'Pending'}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Full approval badge */}\n        {project.is_fully_approved && (\n          <div style={{\n            marginTop: 16,\n            padding: 12,\n            background: 'rgba(16, 185, 129, 0.1)',\n            border: '1px solid #10b981',\n            borderRadius: 8,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            gap: 8,\n          }}>\n            <span style={{ fontSize: 18 }}>&#10003;</span>\n            <span style={{ fontSize: 14, fontWeight: 600, color: '#10b981' }}>\n              Fully Approved - Ready to Mint!\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Quick Stats - Full width */}\n      <div style={{\n        gridColumn: 'span 12',\n        display: 'grid',\n        gridTemplateColumns: 'repeat(4, 1fr)',\n        gap: 16,\n      }}>\n        <StatCard\n          label=\"Sections\"\n          value={project.sections?.length || 0}\n          icon={<FileText size={20} />}\n        />\n        <StatCard\n          label=\"Comments\"\n          value={project.recent_comments?.length || 0}\n          icon={<MessageSquare size={20} />}\n        />\n        <StatCard\n          label=\"Team Members\"\n          value={project.collaborators?.length || 0}\n          icon={<Users size={20} />}\n        />\n        <StatCard\n          label=\"Progress\"\n          value={`${project.progress_percentage || 0}%`}\n          icon={<Rocket size={20} />}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction StatCard({ label, value, icon }: { label: string; value: string | number; icon: React.ReactNode }) {\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 16,\n      display: 'flex',\n      alignItems: 'center',\n      gap: 12,\n    }}>\n      <div style={{\n        width: 40,\n        height: 40,\n        borderRadius: 8,\n        background: 'var(--bg)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        color: '#94a3b8',\n      }}>\n        {icon}\n      </div>\n      <div>\n        <div style={{ fontSize: 20, fontWeight: 700, color: 'var(--text)' }}>\n          {value}\n        </div>\n        <div style={{ fontSize: 12, color: '#94a3b8' }}>\n          {label}\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * TeamOverview Component\n *\n * Dashboard-style view showing all collaborators' status,\n * deadlines, and progress on a collaborative project.\n */\n\nimport React from 'react';\nimport { CollaboratorRole, ProjectSection } from '../../services/collaborationApi';\nimport { Users, XCircle, CheckCircle, AlertTriangle, Clock, FileText, DollarSign, Check } from 'lucide-react';\n\ninterface TeamOverviewProps {\n  collaborators: CollaboratorRole[];\n  sections: ProjectSection[];\n  projectCreatorId: number;\n}\n\nexport function TeamOverview({\n  collaborators,\n  sections,\n  projectCreatorId,\n}: TeamOverviewProps) {\n  // Calculate section completion for each collaborator\n  const getCollaboratorProgress = (collaborator: CollaboratorRole) => {\n    const assignedSections = sections.filter(\n      (s) => s.owner === collaborator.user\n    );\n    const completedSections = assignedSections.filter(\n      (s) => s.content_html && s.content_html.trim().length > 0\n    );\n    return {\n      assigned: assignedSections.length,\n      completed: completedSections.length,\n    };\n  };\n\n  // Check deadline status\n  const getDeadlineStatus = (collaborator: CollaboratorRole) => {\n    if (!collaborator.delivery_deadline) return null;\n\n    const deadline = new Date(collaborator.delivery_deadline);\n    const now = new Date();\n    const daysRemaining = Math.ceil(\n      (deadline.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)\n    );\n\n    if (daysRemaining < 0) {\n      return { status: 'overdue', days: Math.abs(daysRemaining), color: '#ef4444' };\n    } else if (daysRemaining <= 3) {\n      return { status: 'soon', days: daysRemaining, color: '#f59e0b' };\n    } else {\n      return { status: 'ok', days: daysRemaining, color: '#10b981' };\n    }\n  };\n\n  // Get collaborator status badge\n  const getStatusBadge = (collaborator: CollaboratorRole): {\n    icon: React.ReactNode;\n    text: string;\n    color: string;\n    bg: string;\n  } => {\n    const progress = getCollaboratorProgress(collaborator);\n    const deadline = getDeadlineStatus(collaborator);\n\n    // Overdue\n    if (deadline?.status === 'overdue') {\n      return {\n        icon: <XCircle size={14} />,\n        text: `${deadline.days}d overdue`,\n        color: '#ef4444',\n        bg: '#ef444420',\n      };\n    }\n\n    // All sections complete\n    if (progress.assigned > 0 && progress.completed === progress.assigned) {\n      return {\n        icon: <CheckCircle size={14} />,\n        text: `${progress.completed}/${progress.assigned} complete`,\n        color: '#10b981',\n        bg: '#10b98120',\n      };\n    }\n\n    // Has pending sections\n    if (progress.assigned > 0) {\n      const remaining = progress.assigned - progress.completed;\n      if (deadline?.status === 'soon') {\n        return {\n          icon: <AlertTriangle size={14} />,\n          text: `${remaining} section${remaining > 1 ? 's' : ''} due in ${deadline.days}d`,\n          color: '#f59e0b',\n          bg: '#f59e0b20',\n        };\n      }\n      return {\n        icon: <Clock size={14} />,\n        text: `${progress.completed}/${progress.assigned} sections`,\n        color: '#3b82f6',\n        bg: '#3b82f620',\n      };\n    }\n\n    // No sections assigned\n    return {\n      icon: <FileText size={14} />,\n      text: 'No sections assigned',\n      color: '#64748b',\n      bg: '#64748b20',\n    };\n  };\n\n  return (\n    <div\n      style={{\n        background: '#0f172a',\n        border: '1px solid #1e293b',\n        borderRadius: 12,\n        padding: 20,\n      }}\n    >\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 20,\n        }}\n      >\n        <Users size={20} style={{ color: '#8b5cf6' }} />\n        <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 16, fontWeight: 600 }}>\n          Team Overview\n        </h3>\n        <span\n          style={{\n            background: '#334155',\n            color: '#94a3b8',\n            padding: '2px 10px',\n            borderRadius: 12,\n            fontSize: 12,\n            fontWeight: 500,\n          }}\n        >\n          {collaborators.filter((c) => c.status === 'accepted').length} active\n        </span>\n      </div>\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {collaborators\n          .filter((c) => c.status === 'accepted')\n          .map((collaborator) => {\n            const progress = getCollaboratorProgress(collaborator);\n            const statusBadge = getStatusBadge(collaborator);\n            const isOwner = collaborator.user === projectCreatorId;\n            const isLead = collaborator.is_lead;\n\n            return (\n              <div\n                key={collaborator.id}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 12,\n                  padding: 12,\n                  background: '#1e293b',\n                  borderRadius: 10,\n                  borderLeft: `3px solid ${statusBadge.color}`,\n                }}\n              >\n                {/* Avatar placeholder */}\n                <div\n                  style={{\n                    width: 40,\n                    height: 40,\n                    borderRadius: '50%',\n                    background: `linear-gradient(135deg, ${\n                      isOwner ? '#f59e0b' : '#3b82f6'\n                    } 0%, ${isOwner ? '#d97706' : '#2563eb'} 100%)`,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontWeight: 700,\n                    fontSize: 14,\n                    flexShrink: 0,\n                  }}\n                >\n                  {collaborator.username.charAt(0).toUpperCase()}\n                </div>\n\n                {/* Info */}\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                    <span\n                      style={{\n                        color: '#f8fafc',\n                        fontWeight: 600,\n                        fontSize: 14,\n                      }}\n                    >\n                      @{collaborator.username}\n                    </span>\n                    {isOwner && (\n                      <span\n                        style={{\n                          background: '#f59e0b',\n                          color: '#000',\n                          padding: '2px 8px',\n                          borderRadius: 4,\n                          fontSize: 10,\n                          fontWeight: 700,\n                        }}\n                      >\n                        OWNER\n                      </span>\n                    )}\n                    {isLead && !isOwner && (\n                      <span\n                        style={{\n                          background: '#8b5cf6',\n                          color: '#fff',\n                          padding: '2px 8px',\n                          borderRadius: 4,\n                          fontSize: 10,\n                          fontWeight: 700,\n                        }}\n                      >\n                        LEAD\n                      </span>\n                    )}\n                  </div>\n                  <div\n                    style={{\n                      color: '#94a3b8',\n                      fontSize: 12,\n                      marginTop: 2,\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: 8,\n                    }}\n                  >\n                    <span>{collaborator.role}</span>\n                    <span style={{ color: '#64748b' }}>â€¢</span>\n                    <span style={{ color: '#10b981' }}>\n                      {collaborator.revenue_percentage}%\n                    </span>\n                  </div>\n                </div>\n\n                {/* Progress bar for sections */}\n                {progress.assigned > 0 && (\n                  <div style={{ width: 80 }}>\n                    <div\n                      style={{\n                        height: 6,\n                        background: '#334155',\n                        borderRadius: 3,\n                        overflow: 'hidden',\n                      }}\n                    >\n                      <div\n                        style={{\n                          width: `${(progress.completed / progress.assigned) * 100}%`,\n                          height: '100%',\n                          background:\n                            progress.completed === progress.assigned\n                              ? '#10b981'\n                              : '#3b82f6',\n                          transition: 'width 0.3s ease',\n                        }}\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {/* Status badge */}\n                <div\n                  style={{\n                    background: statusBadge.bg,\n                    color: statusBadge.color,\n                    padding: '6px 12px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 500,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 6,\n                    whiteSpace: 'nowrap',\n                  }}\n                >\n                  <span>{statusBadge.icon}</span>\n                  {statusBadge.text}\n                </div>\n\n                {/* Approval status */}\n                <div\n                  style={{\n                    display: 'flex',\n                    gap: 4,\n                    flexShrink: 0,\n                  }}\n                  title={`Content: ${\n                    collaborator.approved_current_version ? 'Approved' : 'Pending'\n                  }, Revenue: ${collaborator.approved_revenue_split ? 'Approved' : 'Pending'}`}\n                >\n                  <div\n                    style={{\n                      width: 24,\n                      height: 24,\n                      borderRadius: 4,\n                      background: collaborator.approved_current_version\n                        ? '#10b98120'\n                        : '#64748b20',\n                      color: collaborator.approved_current_version\n                        ? '#10b981'\n                        : '#64748b',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      fontSize: 12,\n                    }}\n                  >\n                    {collaborator.approved_current_version ? <Check size={12} /> : 'â—‹'}\n                  </div>\n                  <div\n                    style={{\n                      width: 24,\n                      height: 24,\n                      borderRadius: 4,\n                      background: collaborator.approved_revenue_split\n                        ? '#10b98120'\n                        : '#64748b20',\n                      color: collaborator.approved_revenue_split\n                        ? '#10b981'\n                        : '#64748b',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      fontSize: 12,\n                    }}\n                  >\n                    {collaborator.approved_revenue_split ? <DollarSign size={12} /> : 'â—‹'}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n        {/* Pending invites */}\n        {collaborators.filter((c) => c.status === 'invited').length > 0 && (\n          <>\n            <div\n              style={{\n                borderTop: '1px solid #334155',\n                margin: '8px 0',\n                paddingTop: 12,\n              }}\n            >\n              <span style={{ color: '#64748b', fontSize: 12, fontWeight: 600 }}>\n                PENDING INVITES\n              </span>\n            </div>\n            {collaborators\n              .filter((c) => c.status === 'invited')\n              .map((collaborator) => (\n                <div\n                  key={collaborator.id}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 12,\n                    padding: 12,\n                    background: '#1e293b',\n                    borderRadius: 10,\n                    borderLeft: '3px solid #f59e0b',\n                    opacity: 0.7,\n                  }}\n                >\n                  <div\n                    style={{\n                      width: 40,\n                      height: 40,\n                      borderRadius: '50%',\n                      background: '#334155',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      color: '#94a3b8',\n                      fontWeight: 700,\n                      fontSize: 14,\n                      flexShrink: 0,\n                    }}\n                  >\n                    {collaborator.username.charAt(0).toUpperCase()}\n                  </div>\n                  <div style={{ flex: 1 }}>\n                    <div style={{ color: '#94a3b8', fontWeight: 500, fontSize: 14 }}>\n                      @{collaborator.username}\n                    </div>\n                    <div style={{ color: '#64748b', fontSize: 12 }}>\n                      {collaborator.role} â€¢ {collaborator.revenue_percentage}%\n                    </div>\n                  </div>\n                  <span\n                    style={{\n                      background: '#f59e0b20',\n                      color: '#f59e0b',\n                      padding: '6px 12px',\n                      borderRadius: 6,\n                      fontSize: 12,\n                      fontWeight: 500,\n                    }}\n                  >\n                    Awaiting response\n                  </span>\n                </div>\n              ))}\n          </>\n        )}\n      </div>\n\n      {/* Summary footer */}\n      <div\n        style={{\n          marginTop: 16,\n          paddingTop: 16,\n          borderTop: '1px solid #334155',\n          display: 'flex',\n          gap: 16,\n          flexWrap: 'wrap',\n        }}\n      >\n        <div style={{ fontSize: 12, color: '#64748b', display: 'flex', alignItems: 'center', gap: 4 }}>\n          <Check size={14} style={{ color: '#10b981' }} /> Content Approved\n        </div>\n        <div style={{ fontSize: 12, color: '#64748b', display: 'flex', alignItems: 'center', gap: 4 }}>\n          <DollarSign size={14} style={{ color: '#10b981' }} /> Revenue Approved\n        </div>\n        <div style={{ fontSize: 12, color: '#64748b', display: 'flex', alignItems: 'center', gap: 4 }}>\n          <span>â—‹</span> Pending\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TeamOverview;\n","/**\n * TaskTracker Component\n *\n * Displays and manages contract tasks for a collaborator.\n * - Collaborators can mark tasks as complete\n * - Owners can sign off or reject completed tasks\n * - Shows task status, deadlines, and overdue warnings\n */\n\nimport React, { useState } from 'react';\nimport { API_URL } from '../../config';\n\n// Task status type\ntype TaskStatus = 'pending' | 'in_progress' | 'complete' | 'signed_off' | 'cancelled';\n\n// Contract task interface\ninterface ContractTask {\n  id: number;\n  title: string;\n  description: string;\n  deadline: string;\n  status: TaskStatus;\n  order: number;\n  marked_complete_at?: string;\n  marked_complete_by_username?: string;\n  completion_notes?: string;\n  signed_off_at?: string;\n  signed_off_by_username?: string;\n  signoff_notes?: string;\n  rejection_notes?: string;\n  rejected_at?: string;\n  is_overdue: boolean;\n  days_until_deadline?: number;\n}\n\n// Collaborator role interface (partial)\ninterface CollaboratorRole {\n  id: number;\n  user: number;\n  username: string;\n  display_name?: string;\n  role: string;\n  revenue_percentage: number;\n  tasks_total: number;\n  tasks_signed_off: number;\n  all_tasks_complete: boolean;\n  has_active_breach: boolean;\n  cancellation_eligible: boolean;\n  contract_tasks: ContractTask[];\n}\n\ninterface TaskTrackerProps {\n  collaboratorRole: CollaboratorRole;\n  currentUserId: number;\n  isProjectOwner: boolean;\n  projectId: number;\n  onTaskUpdate: () => void;\n}\n\n// Status badge component\nfunction StatusBadge({ status, isOverdue }: { status: TaskStatus; isOverdue: boolean }) {\n  const statusConfig: Record<TaskStatus, { bg: string; color: string; label: string }> = {\n    pending: { bg: '#64748b20', color: '#94a3b8', label: 'Pending' },\n    in_progress: { bg: '#3b82f620', color: '#60a5fa', label: 'In Progress' },\n    complete: { bg: '#f59e0b20', color: '#fbbf24', label: 'Awaiting Sign-off' },\n    signed_off: { bg: '#10b98120', color: '#34d399', label: 'Signed Off' },\n    cancelled: { bg: '#ef444420', color: '#f87171', label: 'Cancelled' },\n  };\n\n  if (isOverdue && status !== 'signed_off' && status !== 'cancelled') {\n    return (\n      <span\n        style={{\n          background: '#ef444430',\n          color: '#f87171',\n          padding: '4px 10px',\n          borderRadius: 6,\n          fontSize: 11,\n          fontWeight: 600,\n          display: 'flex',\n          alignItems: 'center',\n          gap: 4,\n        }}\n      >\n        <span>ðŸš¨</span> Overdue\n      </span>\n    );\n  }\n\n  const config = statusConfig[status];\n  return (\n    <span\n      style={{\n        background: config.bg,\n        color: config.color,\n        padding: '4px 10px',\n        borderRadius: 6,\n        fontSize: 11,\n        fontWeight: 600,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// Helper to fetch CSRF token\nasync function fetchCsrf(): Promise<string> {\n  try {\n    const res = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n    const data = await res.json();\n    return data?.csrfToken || '';\n  } catch {\n    return '';\n  }\n}\n\nexport function TaskTracker({\n  collaboratorRole,\n  currentUserId,\n  isProjectOwner,\n  projectId,\n  onTaskUpdate,\n}: TaskTrackerProps) {\n  const [expandedTasks, setExpandedTasks] = useState<Set<number>>(new Set());\n  const [loading, setLoading] = useState<number | null>(null);\n  const [error, setError] = useState<string>('');\n  const [completionNotes, setCompletionNotes] = useState<Record<number, string>>({});\n  const [signoffNotes, setSignoffNotes] = useState<Record<number, string>>({});\n  const [rejectionReason, setRejectionReason] = useState<Record<number, string>>({});\n\n  const isOwnTasks = collaboratorRole.user === currentUserId;\n  const tasks = collaboratorRole.contract_tasks || [];\n\n  const toggleExpand = (taskId: number) => {\n    setExpandedTasks((prev) => {\n      const next = new Set(prev);\n      if (next.has(taskId)) {\n        next.delete(taskId);\n      } else {\n        next.add(taskId);\n      }\n      return next;\n    });\n  };\n\n  // Mark task as complete\n  const handleMarkComplete = async (taskId: number) => {\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/mark-complete/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            completion_notes: completionNotes[taskId] || '',\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to mark task complete');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to mark task complete');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  // Sign off on task\n  const handleSignOff = async (taskId: number) => {\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/sign-off/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            signoff_notes: signoffNotes[taskId] || '',\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to sign off on task');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to sign off on task');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  // Reject completion\n  const handleReject = async (taskId: number) => {\n    if (!rejectionReason[taskId]?.trim()) {\n      setError('Please provide a reason for rejection');\n      return;\n    }\n\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/reject-completion/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            rejection_reason: rejectionReason[taskId],\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n        setRejectionReason((prev) => ({ ...prev, [taskId]: '' }));\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to reject task');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to reject task');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  if (tasks.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 20,\n          background: '#1e293b',\n          borderRadius: 12,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 13,\n        }}\n      >\n        No contract tasks defined for this collaborator.\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: 16,\n        }}\n      >\n        <div>\n          <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n            <span style={{ fontSize: 20 }}>ðŸ“‹</span>\n            <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 16, fontWeight: 600 }}>\n              Contract Tasks for @{collaboratorRole.username}\n            </h3>\n          </div>\n          <div style={{ marginTop: 6, color: '#94a3b8', fontSize: 12 }}>\n            {collaboratorRole.role} â€¢ {collaboratorRole.revenue_percentage}% revenue share\n          </div>\n        </div>\n\n        {/* Progress */}\n        <div style={{ textAlign: 'right' }}>\n          <div\n            style={{\n              color: collaboratorRole.all_tasks_complete ? '#10b981' : '#f59e0b',\n              fontSize: 18,\n              fontWeight: 700,\n            }}\n          >\n            {collaboratorRole.tasks_signed_off}/{collaboratorRole.tasks_total}\n          </div>\n          <div style={{ color: '#64748b', fontSize: 11 }}>signed off</div>\n        </div>\n      </div>\n\n      {/* Progress bar */}\n      <div\n        style={{\n          height: 6,\n          background: '#0f172a',\n          borderRadius: 3,\n          marginBottom: 20,\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          style={{\n            height: '100%',\n            width: `${(collaboratorRole.tasks_signed_off / collaboratorRole.tasks_total) * 100}%`,\n            background: collaboratorRole.all_tasks_complete\n              ? '#10b981'\n              : 'linear-gradient(90deg, #f59e0b, #fbbf24)',\n            borderRadius: 3,\n            transition: 'width 0.3s ease',\n          }}\n        />\n      </div>\n\n      {/* Breach warning */}\n      {collaboratorRole.has_active_breach && (\n        <div\n          style={{\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            borderRadius: 8,\n            padding: 12,\n            marginBottom: 16,\n            display: 'flex',\n            alignItems: 'center',\n            gap: 10,\n          }}\n        >\n          <span style={{ fontSize: 18 }}>ðŸš¨</span>\n          <div style={{ color: '#f87171', fontSize: 13 }}>\n            <strong>Deadline Breach:</strong> One or more tasks are past their deadline.\n            {isProjectOwner && ' You may cancel, extend deadlines, or waive the breach.'}\n          </div>\n        </div>\n      )}\n\n      {/* Error message */}\n      {error && (\n        <div\n          style={{\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            color: '#f87171',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}\n        >\n          {error}\n        </div>\n      )}\n\n      {/* Task list */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {tasks.map((task) => {\n          const isExpanded = expandedTasks.has(task.id);\n          const canMarkComplete = isOwnTasks && task.status === 'in_progress';\n          const canSignOff = isProjectOwner && task.status === 'complete';\n          const canReject = isProjectOwner && task.status === 'complete';\n          const isLoadingThis = loading === task.id;\n\n          return (\n            <div\n              key={task.id}\n              style={{\n                background: '#0f172a',\n                border: `1px solid ${task.is_overdue ? '#ef4444' : '#334155'}`,\n                borderRadius: 10,\n                overflow: 'hidden',\n              }}\n            >\n              {/* Task header */}\n              <div\n                onClick={() => toggleExpand(task.id)}\n                style={{\n                  padding: 16,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'flex-start',\n                  gap: 12,\n                }}\n              >\n                <div style={{ flex: 1 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 6 }}>\n                    <StatusBadge status={task.status} isOverdue={task.is_overdue} />\n                    <span\n                      style={{\n                        color: '#f8fafc',\n                        fontSize: 14,\n                        fontWeight: 600,\n                      }}\n                    >\n                      {task.title}\n                    </span>\n                  </div>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 12, color: '#64748b', fontSize: 12 }}>\n                    <span>\n                      Due: {new Date(task.deadline).toLocaleDateString('en-US', {\n                        month: 'short',\n                        day: 'numeric',\n                        year: 'numeric',\n                      })}\n                    </span>\n                    {task.days_until_deadline !== undefined && task.status !== 'signed_off' && (\n                      <span\n                        style={{\n                          color: task.days_until_deadline < 0 ? '#f87171' : task.days_until_deadline < 3 ? '#fbbf24' : '#64748b',\n                        }}\n                      >\n                        {task.days_until_deadline < 0\n                          ? `${Math.abs(task.days_until_deadline)} days overdue`\n                          : task.days_until_deadline === 0\n                          ? 'Due today'\n                          : `${task.days_until_deadline} days left`}\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <span style={{ color: '#64748b', fontSize: 18 }}>{isExpanded ? 'â–¼' : 'â–¶'}</span>\n              </div>\n\n              {/* Expanded details */}\n              {isExpanded && (\n                <div style={{ padding: '0 16px 16px', borderTop: '1px solid #334155' }}>\n                  {/* Description */}\n                  {task.description && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#94a3b8', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Description\n                      </div>\n                      <div style={{ color: '#cbd5e1', fontSize: 13, lineHeight: 1.6 }}>\n                        {task.description}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Completion notes */}\n                  {task.completion_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#94a3b8', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Completion Notes from @{task.marked_complete_by_username}\n                      </div>\n                      <div\n                        style={{\n                          color: '#cbd5e1',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#1e293b',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.completion_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Sign-off notes */}\n                  {task.signoff_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#10b981', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Signed Off by @{task.signed_off_by_username}\n                      </div>\n                      <div\n                        style={{\n                          color: '#34d399',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#10b98120',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.signoff_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Rejection notes */}\n                  {task.rejection_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#f87171', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Revision Requested\n                      </div>\n                      <div\n                        style={{\n                          color: '#fca5a5',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#ef444420',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.rejection_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Actions for collaborator */}\n                  {canMarkComplete && (\n                    <div style={{ marginTop: 16 }}>\n                      <textarea\n                        placeholder=\"Add notes about what you completed (optional)...\"\n                        value={completionNotes[task.id] || ''}\n                        onChange={(e) => setCompletionNotes((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #334155',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 60,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <button\n                        onClick={() => handleMarkComplete(task.id)}\n                        disabled={isLoadingThis}\n                        style={{\n                          width: '100%',\n                          padding: '12px 20px',\n                          borderRadius: 8,\n                          border: 'none',\n                          background: '#10b981',\n                          color: '#fff',\n                          fontSize: 14,\n                          fontWeight: 600,\n                          cursor: isLoadingThis ? 'not-allowed' : 'pointer',\n                          opacity: isLoadingThis ? 0.6 : 1,\n                        }}\n                      >\n                        {isLoadingThis ? 'Submitting...' : 'Mark as Complete'}\n                      </button>\n                    </div>\n                  )}\n\n                  {/* Actions for owner */}\n                  {canSignOff && (\n                    <div style={{ marginTop: 16 }}>\n                      <textarea\n                        placeholder=\"Add feedback or approval notes (optional)...\"\n                        value={signoffNotes[task.id] || ''}\n                        onChange={(e) => setSignoffNotes((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #334155',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 60,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <div style={{ display: 'flex', gap: 10 }}>\n                        <button\n                          onClick={() => handleSignOff(task.id)}\n                          disabled={isLoadingThis}\n                          style={{\n                            flex: 2,\n                            padding: '12px 20px',\n                            borderRadius: 8,\n                            border: 'none',\n                            background: '#10b981',\n                            color: '#fff',\n                            fontSize: 14,\n                            fontWeight: 600,\n                            cursor: isLoadingThis ? 'not-allowed' : 'pointer',\n                            opacity: isLoadingThis ? 0.6 : 1,\n                          }}\n                        >\n                          {isLoadingThis ? 'Processing...' : 'Sign Off'}\n                        </button>\n                        <button\n                          onClick={() => toggleExpand(task.id)}\n                          style={{\n                            flex: 1,\n                            padding: '12px 20px',\n                            borderRadius: 8,\n                            border: '1px solid #ef4444',\n                            background: 'transparent',\n                            color: '#ef4444',\n                            fontSize: 14,\n                            fontWeight: 600,\n                            cursor: 'pointer',\n                          }}\n                        >\n                          Request Changes\n                        </button>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Rejection form (shown when Request Changes clicked) */}\n                  {canReject && rejectionReason[task.id] !== undefined && (\n                    <div style={{ marginTop: 12 }}>\n                      <textarea\n                        placeholder=\"Explain what needs to be revised...\"\n                        value={rejectionReason[task.id] || ''}\n                        onChange={(e) => setRejectionReason((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #ef4444',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 80,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <button\n                        onClick={() => handleReject(task.id)}\n                        disabled={isLoadingThis || !rejectionReason[task.id]?.trim()}\n                        style={{\n                          width: '100%',\n                          padding: '12px 20px',\n                          borderRadius: 8,\n                          border: 'none',\n                          background: '#ef4444',\n                          color: '#fff',\n                          fontSize: 14,\n                          fontWeight: 600,\n                          cursor: isLoadingThis || !rejectionReason[task.id]?.trim() ? 'not-allowed' : 'pointer',\n                          opacity: isLoadingThis || !rejectionReason[task.id]?.trim() ? 0.6 : 1,\n                        }}\n                      >\n                        {isLoadingThis ? 'Sending...' : 'Request Changes'}\n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nexport default TaskTracker;\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  CollaboratorRole,\n  collaborationApi,\n} from '../../../services/collaborationApi';\nimport { TeamOverview } from '../TeamOverview';\nimport { TaskTracker } from '../TaskTracker';\nimport { API_URL } from '../../../config';\nimport { ClipboardList, AlertTriangle, Search, X, User as UserIcon, Check, XCircle, Loader2 } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface TeamTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface SearchResult {\n  id: number;\n  username: string;\n  display_name?: string;\n  avatar_url?: string;\n}\n\nexport default function TeamTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: TeamTabProps) {\n  const [showInviteForm, setShowInviteForm] = useState(false);\n  const [inviteRole, setInviteRole] = useState('');\n  const [invitePercentage, setInvitePercentage] = useState(10);\n  const [inviteError, setInviteError] = useState('');\n  const [inviting, setInviting] = useState(false);\n\n  // Counter-proposal response state\n  const [respondingToCounterProposal, setRespondingToCounterProposal] = useState<number | null>(null);\n  const [counterProposalError, setCounterProposalError] = useState('');\n  const [declineMessageFor, setDeclineMessageFor] = useState<number | null>(null);\n  const [declineMessage, setDeclineMessage] = useState('');\n\n  // User search state\n  const [searchQuery, setSearchQuery] = useState('');\n  const [searchResults, setSearchResults] = useState<SearchResult[]>([]);\n  const [searchLoading, setSearchLoading] = useState(false);\n  const [selectedUser, setSelectedUser] = useState<SearchResult | null>(null);\n  const [showDropdown, setShowDropdown] = useState(false);\n  const searchDebounceRef = useRef<ReturnType<typeof setTimeout> | null>(null);\n  const dropdownRef = useRef<HTMLDivElement>(null);\n\n  const isProjectLead = project.created_by === currentUser.id;\n  const sections = project.sections || [];\n  const collaborators = project.collaborators || [];\n\n  // Find project lead's current revenue percentage\n  const leadCollaborator = collaborators.find(c => c.user === project.created_by);\n  const leadPercentage = leadCollaborator?.revenue_percentage || 100;\n\n  // Calculate max percentage the lead can give away (their current share)\n  const maxInvitePercentage = Math.max(0, leadPercentage - 1); // Keep at least 1% for lead\n\n  // Debounced user search\n  useEffect(() => {\n    if (!searchQuery.trim() || searchQuery.length < 2) {\n      setSearchResults([]);\n      setShowDropdown(false);\n      return;\n    }\n\n    if (searchDebounceRef.current) clearTimeout(searchDebounceRef.current);\n\n    searchDebounceRef.current = setTimeout(async () => {\n      setSearchLoading(true);\n      try {\n        const params = new URLSearchParams({ q: searchQuery, page_size: '8' });\n        const res = await fetch(`${API_URL}/api/users/search/?${params.toString()}`, {\n          credentials: 'include'\n        });\n        if (res.ok) {\n          const data = await res.json();\n          // Filter out current user and existing collaborators\n          const existingUserIds = new Set([\n            currentUser.id,\n            ...collaborators.map(c => c.user)\n          ]);\n          const filtered = (data.results || []).filter(\n            (u: SearchResult) => !existingUserIds.has(u.id)\n          );\n          setSearchResults(filtered);\n          setShowDropdown(filtered.length > 0);\n        }\n      } catch (err) {\n        console.error('User search failed:', err);\n      } finally {\n        setSearchLoading(false);\n      }\n    }, 300);\n\n    return () => {\n      if (searchDebounceRef.current) clearTimeout(searchDebounceRef.current);\n    };\n  }, [searchQuery, currentUser.id, collaborators]);\n\n  // Close dropdown when clicking outside\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (dropdownRef.current && !dropdownRef.current.contains(e.target as Node)) {\n        setShowDropdown(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  const handleSelectUser = (user: SearchResult) => {\n    setSelectedUser(user);\n    setSearchQuery('');\n    setShowDropdown(false);\n    setSearchResults([]);\n  };\n\n  const handleClearSelectedUser = () => {\n    setSelectedUser(null);\n    setSearchQuery('');\n  };\n\n  const handleInvite = async () => {\n    if (!selectedUser) {\n      setInviteError('Please select a user to invite');\n      return;\n    }\n    if (!inviteRole.trim()) {\n      setInviteError('Please enter a role');\n      return;\n    }\n    if (invitePercentage <= 0 || invitePercentage > maxInvitePercentage) {\n      setInviteError(`Percentage must be between 1 and ${maxInvitePercentage}%`);\n      return;\n    }\n\n    setInviting(true);\n    setInviteError('');\n\n    try {\n      await collaborationApi.inviteCollaborator(project.id, {\n        user_id: selectedUser.id,\n        role: inviteRole.trim(),\n        revenue_percentage: invitePercentage,\n        can_edit_text: true,\n        can_edit_images: true,\n        can_edit_audio: true,\n        can_edit_video: true,\n      });\n\n      // Refresh project data\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n      setShowInviteForm(false);\n      setSelectedUser(null);\n      setSearchQuery('');\n      setInviteRole('');\n      setInvitePercentage(10);\n    } catch (err: any) {\n      setInviteError(err.message || 'Failed to invite collaborator');\n    } finally {\n      setInviting(false);\n    }\n  };\n\n  // Handle counter-proposal response (accept or decline)\n  const handleCounterProposalResponse = async (collaboratorId: number, action: 'accept' | 'decline', message?: string) => {\n    setRespondingToCounterProposal(collaboratorId);\n    setCounterProposalError('');\n\n    try {\n      const result = await collaborationApi.respondToCounterProposal(project.id, {\n        collaborator_id: collaboratorId,\n        action,\n        message,\n      });\n\n      // Refresh project data to reflect the changes\n      if (result.project) {\n        onProjectUpdate?.(result.project);\n      } else {\n        const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n        onProjectUpdate?.(updatedProject);\n      }\n\n      // Clear decline message state after successful decline\n      if (action === 'decline') {\n        setDeclineMessageFor(null);\n        setDeclineMessage('');\n      }\n    } catch (err: any) {\n      setCounterProposalError(err.message || `Failed to ${action} counter-proposal`);\n    } finally {\n      setRespondingToCounterProposal(null);\n    }\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Header with Invite Button */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n      }}>\n        <h2 style={{ margin: 0, color: 'var(--text)', fontSize: 20 }}>\n          Team Members\n        </h2>\n        {isProjectLead && (\n          <button\n            onClick={() => setShowInviteForm(!showInviteForm)}\n            style={{\n              background: showInviteForm\n                ? 'transparent'\n                : 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',\n              border: showInviteForm ? '1px solid var(--panel-border)' : 'none',\n              borderRadius: 8,\n              padding: '10px 20px',\n              color: showInviteForm ? '#94a3b8' : '#fff',\n              fontWeight: 600,\n              cursor: 'pointer',\n              fontSize: 14,\n            }}\n          >\n            {showInviteForm ? 'Cancel' : '+ Invite Collaborator'}\n          </button>\n        )}\n      </div>\n\n      {/* Invite Form */}\n      {showInviteForm && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n          overflow: 'hidden',\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Invite New Collaborator\n          </h3>\n\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>\n            {/* User Search Input */}\n            <div ref={dropdownRef} style={{ position: 'relative' }}>\n              <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n                Find Collaborator\n              </label>\n              {selectedUser ? (\n                <div style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 10,\n                  padding: '8px 12px',\n                  background: 'var(--bg)',\n                  border: '1px solid #8b5cf6',\n                  borderRadius: 8,\n                  boxSizing: 'border-box',\n                }}>\n                  <div style={{\n                    width: 32,\n                    height: 32,\n                    borderRadius: '50%',\n                    background: selectedUser.avatar_url\n                      ? `url(${selectedUser.avatar_url}) center/cover`\n                      : 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    fontSize: 14,\n                    fontWeight: 600,\n                    color: '#fff',\n                  }}>\n                    {!selectedUser.avatar_url && selectedUser.username.slice(0, 1).toUpperCase()}\n                  </div>\n                  <div style={{ flex: 1 }}>\n                    <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)' }}>\n                      @{selectedUser.username}\n                    </div>\n                    {selectedUser.display_name && (\n                      <div style={{ fontSize: 12, color: '#94a3b8' }}>\n                        {selectedUser.display_name}\n                      </div>\n                    )}\n                  </div>\n                  <button\n                    onClick={handleClearSelectedUser}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      padding: 4,\n                      cursor: 'pointer',\n                      color: '#94a3b8',\n                      display: 'flex',\n                      alignItems: 'center',\n                    }}\n                  >\n                    <X size={18} />\n                  </button>\n                </div>\n              ) : (\n                <>\n                  <div style={{ position: 'relative' }}>\n                    <Search size={16} style={{\n                      position: 'absolute',\n                      left: 12,\n                      top: '50%',\n                      transform: 'translateY(-50%)',\n                      color: '#64748b',\n                    }} />\n                    <input\n                      type=\"text\"\n                      value={searchQuery}\n                      onChange={(e) => setSearchQuery(e.target.value)}\n                      onFocus={() => searchResults.length > 0 && setShowDropdown(true)}\n                      placeholder=\"Search by @username or name...\"\n                      style={{\n                        width: '100%',\n                        boxSizing: 'border-box',\n                        padding: '10px 12px 10px 38px',\n                        background: 'var(--bg)',\n                        border: '1px solid var(--panel-border)',\n                        borderRadius: 8,\n                        color: 'var(--text)',\n                        fontSize: 14,\n                      }}\n                    />\n                    {searchLoading && (\n                      <div style={{\n                        position: 'absolute',\n                        right: 12,\n                        top: '50%',\n                        transform: 'translateY(-50%)',\n                        color: '#64748b',\n                        fontSize: 12,\n                      }}>\n                        ...\n                      </div>\n                    )}\n                  </div>\n                  {/* Search Results Dropdown */}\n                  {showDropdown && searchResults.length > 0 && (\n                    <div style={{\n                      position: 'absolute',\n                      top: '100%',\n                      left: 0,\n                      right: 0,\n                      marginTop: 4,\n                      background: 'var(--panel)',\n                      border: '1px solid var(--panel-border)',\n                      borderRadius: 8,\n                      boxShadow: '0 10px 40px rgba(0,0,0,0.3)',\n                      zIndex: 100,\n                      maxHeight: 300,\n                      overflowY: 'auto',\n                    }}>\n                      {searchResults.map((user) => (\n                        <div\n                          key={user.id}\n                          onClick={() => handleSelectUser(user)}\n                          style={{\n                            display: 'flex',\n                            alignItems: 'center',\n                            gap: 10,\n                            padding: '10px 12px',\n                            cursor: 'pointer',\n                            borderBottom: '1px solid var(--panel-border)',\n                            transition: 'background 0.15s',\n                          }}\n                          onMouseEnter={(e) => e.currentTarget.style.background = 'rgba(139, 92, 246, 0.1)'}\n                          onMouseLeave={(e) => e.currentTarget.style.background = 'transparent'}\n                        >\n                          <div style={{\n                            width: 36,\n                            height: 36,\n                            borderRadius: '50%',\n                            background: user.avatar_url\n                              ? `url(${user.avatar_url}) center/cover`\n                              : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n                            display: 'flex',\n                            alignItems: 'center',\n                            justifyContent: 'center',\n                            fontSize: 14,\n                            fontWeight: 600,\n                            color: '#fff',\n                          }}>\n                            {!user.avatar_url && user.username.slice(0, 1).toUpperCase()}\n                          </div>\n                          <div>\n                            <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)' }}>\n                              @{user.username}\n                            </div>\n                            {user.display_name && (\n                              <div style={{ fontSize: 12, color: '#94a3b8' }}>\n                                {user.display_name}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n                  )}\n                </>\n              )}\n            </div>\n            <div>\n              <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n                Role\n              </label>\n              <input\n                type=\"text\"\n                value={inviteRole}\n                onChange={(e) => setInviteRole(e.target.value)}\n                placeholder=\"e.g. Illustrator, Editor, Co-Author\"\n                style={{\n                  width: '100%',\n                  boxSizing: 'border-box',\n                  padding: '10px 12px',\n                  background: 'var(--bg)',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 8,\n                  color: 'var(--text)',\n                  fontSize: 14,\n                }}\n              />\n            </div>\n          </div>\n\n          {/* Revenue Split with Equity Warning */}\n          <div style={{ marginTop: 20 }}>\n            <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n              Revenue Split: {invitePercentage}%\n            </label>\n            <input\n              type=\"range\"\n              min={1}\n              max={maxInvitePercentage > 0 ? maxInvitePercentage : 1}\n              value={Math.min(invitePercentage, maxInvitePercentage || 1)}\n              onChange={(e) => setInvitePercentage(Number(e.target.value))}\n              disabled={maxInvitePercentage <= 0}\n              style={{\n                width: '100%',\n                boxSizing: 'border-box',\n                accentColor: '#f59e0b',\n              }}\n            />\n\n            {/* Equity Dilution Warning */}\n            <div style={{\n              marginTop: 12,\n              padding: 12,\n              background: 'rgba(245, 158, 11, 0.1)',\n              border: '1px solid rgba(245, 158, 11, 0.3)',\n              borderRadius: 8,\n            }}>\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                marginBottom: 8,\n                color: '#f59e0b',\n                fontWeight: 600,\n                fontSize: 13,\n              }}>\n                <AlertTriangle size={16} />\n                Impact on your share\n              </div>\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                fontSize: 14,\n              }}>\n                <span style={{ color: '#94a3b8' }}>Your current share:</span>\n                <span style={{ color: 'var(--text)', fontWeight: 600 }}>{leadPercentage}%</span>\n                <span style={{ color: '#64748b' }}>â†’</span>\n                <span style={{ color: '#10b981', fontWeight: 700 }}>\n                  {leadPercentage - invitePercentage}%\n                </span>\n                <span style={{ color: '#ef4444', fontSize: 12 }}>\n                  (-{invitePercentage}%)\n                </span>\n              </div>\n              <div style={{ fontSize: 11, color: '#64748b', marginTop: 6 }}>\n                This percentage comes from your share only and does not affect other collaborators.\n              </div>\n            </div>\n          </div>\n\n          {inviteError && (\n            <div style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              color: '#ef4444',\n              fontSize: 13,\n            }}>\n              {inviteError}\n            </div>\n          )}\n\n          <div style={{ marginTop: 20, display: 'flex', gap: 12 }}>\n            <button\n              onClick={handleInvite}\n              disabled={inviting || !selectedUser}\n              style={{\n                background: selectedUser\n                  ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n                  : '#374151',\n                border: 'none',\n                borderRadius: 8,\n                padding: '10px 24px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: inviting || !selectedUser ? 'not-allowed' : 'pointer',\n                fontSize: 14,\n                opacity: inviting ? 0.7 : 1,\n              }}\n            >\n              {inviting ? 'Inviting...' : 'Send Invitation'}\n            </button>\n            <button\n              onClick={() => {\n                setShowInviteForm(false);\n                setSelectedUser(null);\n                setSearchQuery('');\n                setInviteError('');\n              }}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                padding: '10px 24px',\n                color: '#94a3b8',\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Team Overview Component */}\n      <TeamOverview\n        collaborators={collaborators}\n        sections={sections}\n        projectCreatorId={project.created_by}\n      />\n\n      {/* Contract Tasks Section */}\n      {collaborators.filter(c => c.status === 'accepted' && c.tasks_total > 0).length > 0 && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18, display: 'flex', alignItems: 'center', gap: 10 }}>\n            <ClipboardList size={20} style={{ color: '#8b5cf6' }} /> Contract Tasks\n          </h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n            {collaborators\n              .filter(c => c.status === 'accepted' && c.tasks_total > 0)\n              .map((collab) => (\n                <TaskTracker\n                  key={collab.id}\n                  collaboratorRole={collab}\n                  currentUserId={currentUser.id}\n                  isProjectOwner={isProjectLead}\n                  projectId={project.id}\n                  onTaskUpdate={async () => {\n                    const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n                    onProjectUpdate?.(updatedProject);\n                  }}\n                />\n              ))}\n          </div>\n        </div>\n      )}\n\n      {/* Counter-proposals (only show when there's an actual difference) */}\n      {collaborators.some(c =>\n        c.proposed_percentage != null &&\n        !isNaN(Number(c.proposed_percentage)) &&\n        Math.abs(Number(c.proposed_percentage) - Number(c.revenue_percentage)) > 0.001\n      ) && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Counter-Proposals\n          </h3>\n\n          {/* Error message */}\n          {counterProposalError && (\n            <div style={{\n              marginBottom: 16,\n              padding: 12,\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              color: '#ef4444',\n              fontSize: 13,\n            }}>\n              {counterProposalError}\n            </div>\n          )}\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {collaborators\n              .filter(c =>\n                c.proposed_percentage != null &&\n                !isNaN(Number(c.proposed_percentage)) &&\n                Math.abs(Number(c.proposed_percentage) - Number(c.revenue_percentage)) > 0.001\n              )\n              .map((collab) => {\n                const isResponding = respondingToCounterProposal === collab.id;\n                const proposedDiff = Number(collab.proposed_percentage) - Number(collab.revenue_percentage);\n\n                return (\n                  <div\n                    key={collab.id}\n                    style={{\n                      padding: 16,\n                      background: 'var(--bg)',\n                      borderRadius: 8,\n                      border: '1px solid rgba(245, 158, 11, 0.3)',\n                    }}\n                  >\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                        <span style={{ fontSize: 14, color: 'var(--text)', fontWeight: 600 }}>\n                          @{collab.username}\n                        </span>\n                        <span style={{ fontSize: 12, color: '#94a3b8' }}>\n                          proposes\n                        </span>\n                      </div>\n                      <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                        <span style={{ fontSize: 13, color: '#94a3b8', textDecoration: 'line-through' }}>\n                          {collab.revenue_percentage}%\n                        </span>\n                        <span style={{ fontSize: 16, color: '#f59e0b', fontWeight: 700 }}>\n                          {collab.proposed_percentage}%\n                        </span>\n                        <span style={{\n                          fontSize: 11,\n                          color: proposedDiff > 0 ? '#ef4444' : '#10b981',\n                          fontWeight: 500,\n                        }}>\n                          ({proposedDiff > 0 ? '+' : ''}{proposedDiff.toFixed(1)}%)\n                        </span>\n                      </div>\n                    </div>\n\n                    {collab.counter_message && (\n                      <div style={{\n                        marginTop: 8,\n                        fontSize: 13,\n                        color: '#94a3b8',\n                        fontStyle: 'italic',\n                      }}>\n                        \"{collab.counter_message}\"\n                      </div>\n                    )}\n\n                    {/* Accept/Decline buttons (only for project lead) */}\n                    {isProjectLead && (\n                      <div style={{\n                        marginTop: 12,\n                        paddingTop: 12,\n                        borderTop: '1px solid rgba(148, 163, 184, 0.2)',\n                      }}>\n                        {declineMessageFor === collab.id ? (\n                          /* Decline with message form */\n                          <div style={{\n                            background: 'rgba(239, 68, 68, 0.05)',\n                            border: '1px solid rgba(239, 68, 68, 0.3)',\n                            borderRadius: 8,\n                            padding: 12,\n                          }}>\n                            <label style={{\n                              display: 'block',\n                              fontSize: 12,\n                              color: '#94a3b8',\n                              marginBottom: 8,\n                            }}>\n                              Add a note (optional):\n                            </label>\n                            <textarea\n                              value={declineMessage}\n                              onChange={(e) => setDeclineMessage(e.target.value)}\n                              placeholder=\"Explain why you're declining...\"\n                              maxLength={500}\n                              style={{\n                                width: '100%',\n                                minHeight: 70,\n                                padding: 10,\n                                background: 'var(--bg)',\n                                border: '1px solid #334155',\n                                borderRadius: 6,\n                                color: '#f8fafc',\n                                fontSize: 13,\n                                resize: 'vertical',\n                                marginBottom: 10,\n                              }}\n                            />\n                            <div style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\n                              <button\n                                onClick={() => {\n                                  setDeclineMessageFor(null);\n                                  setDeclineMessage('');\n                                }}\n                                style={{\n                                  padding: '8px 14px',\n                                  background: 'transparent',\n                                  border: '1px solid #475569',\n                                  borderRadius: 6,\n                                  color: '#94a3b8',\n                                  fontSize: 13,\n                                  fontWeight: 600,\n                                  cursor: 'pointer',\n                                }}\n                              >\n                                Cancel\n                              </button>\n                              <button\n                                onClick={() => handleCounterProposalResponse(collab.id, 'decline', declineMessage || undefined)}\n                                disabled={isResponding}\n                                style={{\n                                  padding: '8px 14px',\n                                  background: '#ef4444',\n                                  border: 'none',\n                                  borderRadius: 6,\n                                  color: '#fff',\n                                  fontSize: 13,\n                                  fontWeight: 600,\n                                  cursor: isResponding ? 'not-allowed' : 'pointer',\n                                  opacity: isResponding ? 0.7 : 1,\n                                  display: 'flex',\n                                  alignItems: 'center',\n                                  gap: 6,\n                                }}\n                              >\n                                {isResponding ? (\n                                  <Loader2 size={14} style={{ animation: 'spin 1s linear infinite' }} />\n                                ) : (\n                                  <XCircle size={14} />\n                                )}\n                                Send Decline\n                              </button>\n                            </div>\n                          </div>\n                        ) : (\n                          /* Normal Accept/Decline buttons */\n                          <div style={{ display: 'flex', gap: 10 }}>\n                            <button\n                              onClick={() => handleCounterProposalResponse(collab.id, 'accept')}\n                              disabled={isResponding}\n                              style={{\n                                flex: 1,\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                gap: 6,\n                                padding: '8px 16px',\n                                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                                border: 'none',\n                                borderRadius: 6,\n                                color: '#fff',\n                                fontSize: 13,\n                                fontWeight: 600,\n                                cursor: isResponding ? 'not-allowed' : 'pointer',\n                                opacity: isResponding ? 0.7 : 1,\n                              }}\n                            >\n                              {isResponding ? (\n                                <Loader2 size={14} style={{ animation: 'spin 1s linear infinite' }} />\n                              ) : (\n                                <Check size={14} />\n                              )}\n                              Accept\n                            </button>\n                            <button\n                              onClick={() => setDeclineMessageFor(collab.id)}\n                              disabled={isResponding}\n                              style={{\n                                flex: 1,\n                                display: 'flex',\n                                alignItems: 'center',\n                                justifyContent: 'center',\n                                gap: 6,\n                                padding: '8px 16px',\n                                background: 'transparent',\n                                border: '1px solid #ef4444',\n                                borderRadius: 6,\n                                color: '#ef4444',\n                                fontSize: 13,\n                                fontWeight: 600,\n                                cursor: isResponding ? 'not-allowed' : 'pointer',\n                                opacity: isResponding ? 0.7 : 1,\n                              }}\n                            >\n                              <XCircle size={14} />\n                              Decline\n                            </button>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                );\n              })}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","/**\n * Real-time Activity Service\n * Handles activity tracking, online status, and currently editing indicators\n */\n\nimport { API_URL as API_BASE } from '../config';\n\n// ============================================================================\n// TypeScript Interfaces\n// ============================================================================\n\nexport type ActivityType =\n  | 'section_updated'\n  | 'comment_added'\n  | 'collaborator_joined'\n  | 'collaborator_left'\n  | 'approval_given'\n  | 'approval_requested'\n  | 'ready_for_mint'\n  | 'project_minted'\n  | 'media_uploaded'\n  | 'invitation_sent';\n\nexport interface Activity {\n  id: number;\n  project_id: number;\n  user_id: number;\n  username: string;\n  avatar?: string;\n  activity_type: ActivityType;\n  description: string;\n  section_id?: number;\n  section_title?: string;\n  created_at: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface OnlineUser {\n  user_id: number;\n  username: string;\n  avatar?: string;\n  last_seen: string;\n  is_online: boolean;\n}\n\nexport interface CurrentlyEditing {\n  user_id: number;\n  username: string;\n  section_id: number;\n  section_title: string;\n  started_at: string;\n}\n\nexport interface ActivityState {\n  activities: Activity[];\n  onlineUsers: OnlineUser[];\n  currentlyEditing: CurrentlyEditing[];\n  lastUpdated: Date | null;\n  isPolling: boolean;\n  error: Error | null;\n}\n\n// ============================================================================\n// Event System for Real-time Updates\n// ============================================================================\n\ntype ActivityEventHandler = (data: any) => void;\n\nclass ActivityEventEmitter {\n  private listeners: Map<string, Set<ActivityEventHandler>> = new Map();\n\n  on(event: string, handler: ActivityEventHandler): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(handler);\n\n    return () => this.off(event, handler);\n  }\n\n  off(event: string, handler: ActivityEventHandler): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.delete(handler);\n    }\n  }\n\n  emit(event: string, data: any): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (error) {\n          console.error(`Error in activity event handler for ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  clear(): void {\n    this.listeners.clear();\n  }\n}\n\n// ============================================================================\n// Local State Management\n// ============================================================================\n\nconst projectStates = new Map<number, ActivityState>();\n\nfunction getProjectState(projectId: number): ActivityState {\n  if (!projectStates.has(projectId)) {\n    projectStates.set(projectId, {\n      activities: [],\n      onlineUsers: [],\n      currentlyEditing: [],\n      lastUpdated: null,\n      isPolling: false,\n      error: null,\n    });\n  }\n  return projectStates.get(projectId)!;\n}\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nconst CONFIG = {\n  POLLING_INTERVAL: 15000, // 15 seconds\n  ONLINE_THRESHOLD: 60000, // 1 minute - consider user offline after this\n  MAX_ACTIVITIES: 50, // Keep last 50 activities\n  MAX_RETRIES: 3,\n  RETRY_DELAY: 5000,\n};\n\n// Polling intervals per project\nconst pollingIntervals = new Map<number, NodeJS.Timeout>();\nconst retryCounts = new Map<number, number>();\n\n// ============================================================================\n// API Helper Functions\n// ============================================================================\n\n/**\n * Get fresh CSRF token from API\n * This is more reliable than reading from cookies\n */\nasync function getFreshCsrfToken(): Promise<string> {\n  try {\n    const response = await fetch(`${API_BASE}/api/auth/csrf/`, {\n      credentials: 'include',\n    });\n    const data = await response.json();\n    return data?.csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    return '';\n  }\n}\n\nasync function apiRequest<T>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> {\n  const response = await fetch(url, {\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    },\n    ...options,\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData?.error || errorData?.detail || `API request failed: ${response.status}`);\n  }\n\n  return response.json();\n}\n\n// ============================================================================\n// Core API Functions\n// ============================================================================\n\n/**\n * Get recent activities for a project\n */\nexport async function getProjectActivities(\n  projectId: number,\n  limit: number = 20\n): Promise<Activity[]> {\n  try {\n    const activities = await apiRequest<Activity[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/activities/?limit=${limit}`\n    );\n\n    const state = getProjectState(projectId);\n    state.activities = activities.slice(0, CONFIG.MAX_ACTIVITIES);\n    state.lastUpdated = new Date();\n    state.error = null;\n\n    events.emit('activity:updated', { projectId, activities });\n\n    return activities;\n  } catch (error) {\n    const state = getProjectState(projectId);\n    state.error = error as Error;\n\n    // Graceful degradation - return cached activities\n    console.warn('Failed to fetch activities, using cached data:', error);\n    return state.activities;\n  }\n}\n\n/**\n * Get online users for a project\n */\nexport async function getOnlineUsers(projectId: number): Promise<OnlineUser[]> {\n  try {\n    const users = await apiRequest<OnlineUser[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/online-users/`\n    );\n\n    const state = getProjectState(projectId);\n\n    // Determine online status based on last_seen\n    const now = Date.now();\n    const onlineUsers = users.map(user => ({\n      ...user,\n      is_online: new Date(user.last_seen).getTime() + CONFIG.ONLINE_THRESHOLD > now,\n    }));\n\n    state.onlineUsers = onlineUsers;\n    events.emit('activity:online-users', { projectId, onlineUsers });\n\n    return onlineUsers;\n  } catch (error) {\n    const state = getProjectState(projectId);\n\n    // Graceful degradation\n    console.warn('Failed to fetch online users, using cached data:', error);\n    return state.onlineUsers;\n  }\n}\n\n/**\n * Get currently editing users\n */\nexport async function getCurrentlyEditing(projectId: number): Promise<CurrentlyEditing[]> {\n  try {\n    const editing = await apiRequest<CurrentlyEditing[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/currently-editing/`\n    );\n\n    const state = getProjectState(projectId);\n    state.currentlyEditing = editing;\n    events.emit('activity:currently-editing', { projectId, editing });\n\n    return editing;\n  } catch (error) {\n    const state = getProjectState(projectId);\n\n    // Graceful degradation\n    console.warn('Failed to fetch currently editing, using cached data:', error);\n    return state.currentlyEditing;\n  }\n}\n\n/**\n * Update user's heartbeat (indicate they're active)\n */\nexport async function sendHeartbeat(projectId: number): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(`${API_BASE}/api/collaborative-projects/${projectId}/heartbeat/`, {\n      method: 'POST',\n      headers: {\n        'X-CSRFToken': csrfToken,\n      },\n    });\n  } catch (error) {\n    // Fail silently for heartbeat\n    console.debug('Heartbeat failed:', error);\n  }\n}\n\n/**\n * Notify that user is editing a section\n */\nexport async function startEditingSection(\n  projectId: number,\n  sectionId: number\n): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(\n      `${API_BASE}/api/collaborative-projects/${projectId}/start-editing/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({ section_id: sectionId }),\n      }\n    );\n\n    // Immediately refresh currently editing\n    await getCurrentlyEditing(projectId);\n  } catch (error) {\n    console.warn('Failed to notify start editing:', error);\n  }\n}\n\n/**\n * Notify that user stopped editing a section\n */\nexport async function stopEditingSection(\n  projectId: number,\n  sectionId: number\n): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(\n      `${API_BASE}/api/collaborative-projects/${projectId}/stop-editing/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({ section_id: sectionId }),\n      }\n    );\n\n    // Immediately refresh currently editing\n    await getCurrentlyEditing(projectId);\n  } catch (error) {\n    console.warn('Failed to notify stop editing:', error);\n  }\n}\n\n/**\n * Log a new activity\n */\nexport async function logActivity(\n  projectId: number,\n  activityType: ActivityType,\n  description: string,\n  metadata?: Record<string, any>\n): Promise<Activity | null> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    const activity = await apiRequest<Activity>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/log-activity/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({\n          activity_type: activityType,\n          description,\n          metadata,\n        }),\n      }\n    );\n\n    // Add to local state\n    const state = getProjectState(projectId);\n    state.activities = [activity, ...state.activities].slice(0, CONFIG.MAX_ACTIVITIES);\n\n    events.emit('activity:new', { projectId, activity });\n    events.emit('activity:updated', { projectId, activities: state.activities });\n\n    return activity;\n  } catch (error) {\n    console.warn('Failed to log activity:', error);\n    return null;\n  }\n}\n\n// ============================================================================\n// Real-time Polling System\n// ============================================================================\n\n/**\n * Poll for activity updates\n */\nasync function pollActivity(projectId: number): Promise<void> {\n  const state = getProjectState(projectId);\n  if (!state.isPolling) return;\n\n  try {\n    // Fetch all activity data in parallel\n    await Promise.all([\n      getProjectActivities(projectId, 20),\n      getOnlineUsers(projectId),\n      getCurrentlyEditing(projectId),\n    ]);\n\n    // Also send heartbeat\n    await sendHeartbeat(projectId);\n\n    // Reset retry count on success\n    retryCounts.set(projectId, 0);\n  } catch (error) {\n    console.error('Activity polling error:', error);\n\n    const retryCount = (retryCounts.get(projectId) || 0) + 1;\n    retryCounts.set(projectId, retryCount);\n\n    if (retryCount >= CONFIG.MAX_RETRIES) {\n      console.error('Max retries reached for activity polling');\n      stopPolling(projectId);\n      events.emit('activity:polling-error', { projectId, error, retryCount });\n    }\n  }\n}\n\n/**\n * Start polling for a project\n */\nexport function startPolling(projectId: number): void {\n  const state = getProjectState(projectId);\n\n  if (state.isPolling) {\n    console.warn(`Activity polling already started for project ${projectId}`);\n    return;\n  }\n\n  console.log(`Starting activity polling for project ${projectId}...`);\n  state.isPolling = true;\n  retryCounts.set(projectId, 0);\n\n  // Initial fetch\n  pollActivity(projectId);\n\n  // Set up polling interval\n  const interval = setInterval(\n    () => pollActivity(projectId),\n    CONFIG.POLLING_INTERVAL\n  );\n  pollingIntervals.set(projectId, interval);\n\n  events.emit('activity:polling-started', { projectId });\n}\n\n/**\n * Stop polling for a project\n */\nexport function stopPolling(projectId: number): void {\n  const state = getProjectState(projectId);\n\n  if (!state.isPolling) {\n    return;\n  }\n\n  console.log(`Stopping activity polling for project ${projectId}...`);\n  state.isPolling = false;\n\n  const interval = pollingIntervals.get(projectId);\n  if (interval) {\n    clearInterval(interval);\n    pollingIntervals.delete(projectId);\n  }\n\n  events.emit('activity:polling-stopped', { projectId });\n}\n\n/**\n * Check if polling is active for a project\n */\nexport function isPolling(projectId: number): boolean {\n  const state = getProjectState(projectId);\n  return state.isPolling;\n}\n\n// ============================================================================\n// Event System Export\n// ============================================================================\n\nexport const events = new ActivityEventEmitter();\n\n/**\n * Available events:\n * - 'activity:updated' - Fired when activities list is updated\n * - 'activity:new' - Fired when a new activity is logged\n * - 'activity:online-users' - Fired when online users list is updated\n * - 'activity:currently-editing' - Fired when editing status changes\n * - 'activity:polling-started' - Fired when polling starts\n * - 'activity:polling-stopped' - Fired when polling stops\n * - 'activity:polling-error' - Fired when polling encounters errors\n */\n\n// ============================================================================\n// State Access Functions\n// ============================================================================\n\n/**\n * Get current activity state for a project\n */\nexport function getState(projectId: number): Readonly<ActivityState> {\n  return { ...getProjectState(projectId) };\n}\n\n/**\n * Get cached activities (without API call)\n */\nexport function getCachedActivities(projectId: number): Activity[] {\n  return [...getProjectState(projectId).activities];\n}\n\n/**\n * Get cached online users (without API call)\n */\nexport function getCachedOnlineUsers(projectId: number): OnlineUser[] {\n  return [...getProjectState(projectId).onlineUsers];\n}\n\n/**\n * Get cached currently editing (without API call)\n */\nexport function getCachedCurrentlyEditing(projectId: number): CurrentlyEditing[] {\n  return [...getProjectState(projectId).currentlyEditing];\n}\n\n/**\n * Clear state and stop polling for a project\n */\nexport function reset(projectId: number): void {\n  stopPolling(projectId);\n  projectStates.delete(projectId);\n}\n\n/**\n * Clear all states and stop all polling\n */\nexport function resetAll(): void {\n  pollingIntervals.forEach((interval, projectId) => {\n    stopPolling(projectId);\n  });\n  projectStates.clear();\n  events.clear();\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Get activity icon based on type\n */\nexport function getActivityIcon(type: ActivityType): string {\n  const icons: Record<ActivityType, string> = {\n    section_updated: 'ðŸ“',\n    comment_added: 'ðŸ’¬',\n    collaborator_joined: 'ðŸ‘‹',\n    collaborator_left: 'ðŸ‘‹',\n    approval_given: 'âœ…',\n    approval_requested: 'ðŸ””',\n    ready_for_mint: 'ðŸŽ‰',\n    project_minted: 'ðŸª™',\n    media_uploaded: 'ðŸ“',\n    invitation_sent: 'ðŸ“¬',\n  };\n  return icons[type] || 'ðŸ“Œ';\n}\n\n/**\n * Get activity color based on type\n */\nexport function getActivityColor(type: ActivityType): string {\n  const colors: Record<ActivityType, string> = {\n    section_updated: '#3b82f6',\n    comment_added: '#06b6d4',\n    collaborator_joined: '#10b981',\n    collaborator_left: '#64748b',\n    approval_given: '#10b981',\n    approval_requested: '#f59e0b',\n    ready_for_mint: '#ec4899',\n    project_minted: '#fbbf24',\n    media_uploaded: '#8b5cf6',\n    invitation_sent: '#f59e0b',\n  };\n  return colors[type] || '#64748b';\n}\n\n/**\n * Get human-readable time ago string\n */\nexport function getTimeAgo(dateString: string): string {\n  const date = new Date(dateString);\n  const now = new Date();\n  const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n  if (seconds < 60) return 'just now';\n  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n  if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n  return date.toLocaleDateString();\n}\n\n/**\n * Check if a user is currently editing a specific section\n */\nexport function isUserEditingSection(\n  projectId: number,\n  userId: number,\n  sectionId: number\n): boolean {\n  const state = getProjectState(projectId);\n  return state.currentlyEditing.some(\n    e => e.user_id === userId && e.section_id === sectionId\n  );\n}\n\n/**\n * Get who is editing a specific section\n */\nexport function getEditorsForSection(\n  projectId: number,\n  sectionId: number\n): CurrentlyEditing[] {\n  const state = getProjectState(projectId);\n  return state.currentlyEditing.filter(e => e.section_id === sectionId);\n}\n\n// ============================================================================\n// Export Default Service\n// ============================================================================\n\nexport default {\n  // API Functions\n  getProjectActivities,\n  getOnlineUsers,\n  getCurrentlyEditing,\n  sendHeartbeat,\n  startEditingSection,\n  stopEditingSection,\n  logActivity,\n\n  // Polling Functions\n  startPolling,\n  stopPolling,\n  isPolling,\n\n  // State Functions\n  getState,\n  getCachedActivities,\n  getCachedOnlineUsers,\n  getCachedCurrentlyEditing,\n  reset,\n  resetAll,\n\n  // Event System\n  events,\n\n  // Utilities\n  getActivityIcon,\n  getActivityColor,\n  getTimeAgo,\n  isUserEditingSection,\n  getEditorsForSection,\n};\n","/**\n * React Hook for Activity System\n * Provides easy integration with activityService in React components\n */\n\nimport { useEffect, useState, useCallback, useRef } from 'react';\nimport activityService, {\n  Activity,\n  OnlineUser,\n  CurrentlyEditing,\n  ActivityType,\n  events,\n} from '../services/activityService';\n\ninterface UseActivityOptions {\n  projectId: number;\n  autoStart?: boolean; // Auto-start polling when hook mounts\n  onNewActivity?: (activity: Activity) => void; // Callback for new activities\n}\n\ninterface UseActivityReturn {\n  activities: Activity[];\n  onlineUsers: OnlineUser[];\n  currentlyEditing: CurrentlyEditing[];\n  isLoading: boolean;\n  isPolling: boolean;\n  error: Error | null;\n\n  // Actions\n  refresh: () => Promise<void>;\n  startEditing: (sectionId: number) => Promise<void>;\n  stopEditing: (sectionId: number) => Promise<void>;\n  logActivity: (\n    activityType: ActivityType,\n    description: string,\n    metadata?: Record<string, any>\n  ) => Promise<void>;\n  startPolling: () => void;\n  stopPolling: () => void;\n\n  // Utility functions\n  isUserOnline: (userId: number) => boolean;\n  isSectionBeingEdited: (sectionId: number) => boolean;\n  getEditorsForSection: (sectionId: number) => CurrentlyEditing[];\n}\n\n/**\n * Custom hook for managing project activity\n */\nexport function useActivity(options: UseActivityOptions): UseActivityReturn {\n  const { projectId, autoStart = false, onNewActivity } = options;\n\n  // State\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [onlineUsers, setOnlineUsers] = useState<OnlineUser[]>([]);\n  const [currentlyEditing, setCurrentlyEditing] = useState<CurrentlyEditing[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [isPolling, setIsPolling] = useState<boolean>(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Track current editing section\n  const currentEditingSectionRef = useRef<number | null>(null);\n\n  // Refresh all activity data\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const [activitiesData, onlineUsersData, editingData] = await Promise.all([\n        activityService.getProjectActivities(projectId),\n        activityService.getOnlineUsers(projectId),\n        activityService.getCurrentlyEditing(projectId),\n      ]);\n\n      setActivities(activitiesData);\n      setOnlineUsers(onlineUsersData);\n      setCurrentlyEditing(editingData);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to refresh activity:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [projectId]);\n\n  // Start editing a section\n  const startEditing = useCallback(\n    async (sectionId: number) => {\n      try {\n        await activityService.startEditingSection(projectId, sectionId);\n        currentEditingSectionRef.current = sectionId;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to start editing:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Stop editing a section\n  const stopEditing = useCallback(\n    async (sectionId: number) => {\n      try {\n        await activityService.stopEditingSection(projectId, sectionId);\n        if (currentEditingSectionRef.current === sectionId) {\n          currentEditingSectionRef.current = null;\n        }\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to stop editing:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Log an activity\n  const logActivity = useCallback(\n    async (\n      activityType: ActivityType,\n      description: string,\n      metadata?: Record<string, any>\n    ) => {\n      try {\n        await activityService.logActivity(\n          projectId,\n          activityType,\n          description,\n          metadata\n        );\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to log activity:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Start polling\n  const startPollingCallback = useCallback(() => {\n    activityService.startPolling(projectId);\n    setIsPolling(true);\n  }, [projectId]);\n\n  // Stop polling\n  const stopPollingCallback = useCallback(() => {\n    activityService.stopPolling(projectId);\n    setIsPolling(false);\n  }, [projectId]);\n\n  // Utility: Check if user is online\n  const isUserOnline = useCallback(\n    (userId: number): boolean => {\n      return onlineUsers.some(u => u.user_id === userId && u.is_online);\n    },\n    [onlineUsers]\n  );\n\n  // Utility: Check if section is being edited\n  const isSectionBeingEdited = useCallback(\n    (sectionId: number): boolean => {\n      return currentlyEditing.some(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  // Utility: Get editors for a section\n  const getEditorsForSection = useCallback(\n    (sectionId: number): CurrentlyEditing[] => {\n      return currentlyEditing.filter(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  // Subscribe to activity events\n  useEffect(() => {\n    // Handle activities updated\n    const unsubActivities = events.on('activity:updated', ({ projectId: pid, activities: acts }) => {\n      if (pid === projectId) {\n        setActivities(acts);\n      }\n    });\n\n    // Handle new activity\n    const unsubNew = events.on('activity:new', ({ projectId: pid, activity }) => {\n      if (pid === projectId) {\n        if (onNewActivity) {\n          onNewActivity(activity);\n        }\n      }\n    });\n\n    // Handle online users updated\n    const unsubOnlineUsers = events.on('activity:online-users', ({ projectId: pid, onlineUsers: users }) => {\n      if (pid === projectId) {\n        setOnlineUsers(users);\n      }\n    });\n\n    // Handle currently editing updated\n    const unsubEditing = events.on('activity:currently-editing', ({ projectId: pid, editing }) => {\n      if (pid === projectId) {\n        setCurrentlyEditing(editing);\n      }\n    });\n\n    // Handle polling state changes\n    const unsubPollingStarted = events.on('activity:polling-started', ({ projectId: pid }) => {\n      if (pid === projectId) {\n        setIsPolling(true);\n      }\n    });\n\n    const unsubPollingStopped = events.on('activity:polling-stopped', ({ projectId: pid }) => {\n      if (pid === projectId) {\n        setIsPolling(false);\n      }\n    });\n\n    // Handle polling errors\n    const unsubPollingError = events.on('activity:polling-error', ({ projectId: pid, error: err }) => {\n      if (pid === projectId) {\n        setError(err);\n        setIsPolling(false);\n      }\n    });\n\n    // Cleanup subscriptions\n    return () => {\n      unsubActivities();\n      unsubNew();\n      unsubOnlineUsers();\n      unsubEditing();\n      unsubPollingStarted();\n      unsubPollingStopped();\n      unsubPollingError();\n    };\n  }, [projectId, onNewActivity]);\n\n  // Auto-start polling if enabled\n  useEffect(() => {\n    if (autoStart) {\n      startPollingCallback();\n      refresh();\n    }\n\n    return () => {\n      if (autoStart) {\n        stopPollingCallback();\n\n        // Stop editing current section on unmount\n        if (currentEditingSectionRef.current !== null) {\n          activityService.stopEditingSection(projectId, currentEditingSectionRef.current);\n        }\n      }\n    };\n  }, [autoStart, startPollingCallback, stopPollingCallback, refresh, projectId]);\n\n  return {\n    activities,\n    onlineUsers,\n    currentlyEditing,\n    isLoading,\n    isPolling,\n    error,\n\n    refresh,\n    startEditing,\n    stopEditing,\n    logActivity,\n    startPolling: startPollingCallback,\n    stopPolling: stopPollingCallback,\n\n    isUserOnline,\n    isSectionBeingEdited,\n    getEditorsForSection,\n  };\n}\n\n/**\n * Simple hook to just get online status\n */\nexport function useOnlineStatus(\n  projectId: number,\n  autoStart = false\n): {\n  onlineUsers: OnlineUser[];\n  isUserOnline: (userId: number) => boolean;\n  refresh: () => Promise<void>;\n} {\n  const [onlineUsers, setOnlineUsers] = useState<OnlineUser[]>([]);\n\n  const refresh = useCallback(async () => {\n    try {\n      const users = await activityService.getOnlineUsers(projectId);\n      setOnlineUsers(users);\n    } catch (err) {\n      console.error('Failed to get online users:', err);\n    }\n  }, [projectId]);\n\n  const isUserOnline = useCallback(\n    (userId: number): boolean => {\n      return onlineUsers.some(u => u.user_id === userId && u.is_online);\n    },\n    [onlineUsers]\n  );\n\n  useEffect(() => {\n    const unsubOnlineUsers = events.on('activity:online-users', ({ projectId: pid, onlineUsers: users }) => {\n      if (pid === projectId) {\n        setOnlineUsers(users);\n      }\n    });\n\n    if (autoStart) {\n      refresh();\n    }\n\n    return () => {\n      unsubOnlineUsers();\n    };\n  }, [autoStart, refresh, projectId]);\n\n  return { onlineUsers, isUserOnline, refresh };\n}\n\n/**\n * Simple hook for editing indicators\n */\nexport function useEditingIndicators(\n  projectId: number,\n  autoStart = false\n): {\n  currentlyEditing: CurrentlyEditing[];\n  isSectionBeingEdited: (sectionId: number) => boolean;\n  getEditorsForSection: (sectionId: number) => CurrentlyEditing[];\n  refresh: () => Promise<void>;\n} {\n  const [currentlyEditing, setCurrentlyEditing] = useState<CurrentlyEditing[]>([]);\n\n  const refresh = useCallback(async () => {\n    try {\n      const editing = await activityService.getCurrentlyEditing(projectId);\n      setCurrentlyEditing(editing);\n    } catch (err) {\n      console.error('Failed to get editing indicators:', err);\n    }\n  }, [projectId]);\n\n  const isSectionBeingEdited = useCallback(\n    (sectionId: number): boolean => {\n      return currentlyEditing.some(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  const getEditorsForSection = useCallback(\n    (sectionId: number): CurrentlyEditing[] => {\n      return currentlyEditing.filter(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  useEffect(() => {\n    const unsubEditing = events.on('activity:currently-editing', ({ projectId: pid, editing }) => {\n      if (pid === projectId) {\n        setCurrentlyEditing(editing);\n      }\n    });\n\n    if (autoStart) {\n      refresh();\n    }\n\n    return () => {\n      unsubEditing();\n    };\n  }, [autoStart, refresh, projectId]);\n\n  return {\n    currentlyEditing,\n    isSectionBeingEdited,\n    getEditorsForSection,\n    refresh,\n  };\n}\n\nexport default useActivity;\n","/**\n * Timeline Utilities\n * Merges task deadlines and activities into a unified chronological timeline\n */\n\nimport { CollaboratorRole, ContractTask } from '../services/collaborationApi';\nimport { Activity } from '../services/activityService';\n\n// Timeline item types\nexport type TimelineItemType = 'task' | 'activity';\n\nexport type TaskStatus = 'pending' | 'in_progress' | 'complete' | 'signed_off' | 'cancelled';\n\nexport interface TaskTimelineData {\n  id: number;\n  title: string;\n  description: string;\n  deadline: string;\n  status: TaskStatus;\n  is_overdue: boolean;\n  days_until_deadline?: number;\n  collaborator_username: string;\n  collaborator_id: number;\n  collaborator_role: string;\n  marked_complete_at?: string;\n  signed_off_at?: string;\n}\n\nexport interface TimelineItem {\n  id: string;\n  type: TimelineItemType;\n  timestamp: Date;\n  sortPriority: number; // Lower = higher priority (overdue tasks get 0)\n  task?: TaskTimelineData;\n  activity?: Activity;\n}\n\nexport type DateGroup = 'overdue' | 'today' | 'tomorrow' | 'this_week' | 'this_month' | 'older' | 'future';\n\nexport interface GroupedTimeline {\n  group: DateGroup;\n  label: string;\n  items: TimelineItem[];\n}\n\n/**\n * Merge tasks and activities into a unified timeline\n */\nexport function mergeTasksAndActivities(\n  collaborators: CollaboratorRole[],\n  activities: Activity[]\n): TimelineItem[] {\n  const items: TimelineItem[] = [];\n\n  // Extract and convert tasks from all collaborators\n  collaborators.forEach(collaborator => {\n    if (collaborator.contract_tasks && collaborator.contract_tasks.length > 0) {\n      collaborator.contract_tasks.forEach(task => {\n        // Use deadline as primary timestamp, or completion/signoff date if available\n        let timestamp: Date;\n        if (task.signed_off_at) {\n          timestamp = new Date(task.signed_off_at);\n        } else if (task.marked_complete_at) {\n          timestamp = new Date(task.marked_complete_at);\n        } else {\n          timestamp = new Date(task.deadline);\n        }\n\n        // Overdue tasks get highest priority (0), then by date\n        const sortPriority = task.is_overdue ? 0 : 1;\n\n        items.push({\n          id: `task-${task.id}`,\n          type: 'task',\n          timestamp,\n          sortPriority,\n          task: {\n            id: task.id,\n            title: task.title,\n            description: task.description,\n            deadline: task.deadline,\n            status: task.status,\n            is_overdue: task.is_overdue,\n            days_until_deadline: task.days_until_deadline,\n            collaborator_username: collaborator.username,\n            collaborator_id: collaborator.user,\n            collaborator_role: collaborator.role,\n            marked_complete_at: task.marked_complete_at,\n            signed_off_at: task.signed_off_at,\n          },\n        });\n      });\n    }\n  });\n\n  // Convert activities to timeline items\n  activities.forEach(activity => {\n    items.push({\n      id: `activity-${activity.id}`,\n      type: 'activity',\n      timestamp: new Date(activity.created_at),\n      sortPriority: 2, // Activities have lower priority than tasks\n      activity,\n    });\n  });\n\n  // Sort: overdue tasks first (priority 0), then by timestamp descending\n  return items.sort((a, b) => {\n    // First sort by priority (overdue tasks first)\n    if (a.sortPriority !== b.sortPriority) {\n      return a.sortPriority - b.sortPriority;\n    }\n    // Then by timestamp (newest first for activities, soonest deadline first for tasks)\n    if (a.type === 'task' && b.type === 'task') {\n      // For tasks, sort by deadline (soonest first)\n      return a.timestamp.getTime() - b.timestamp.getTime();\n    }\n    // For activities or mixed, sort newest first\n    return b.timestamp.getTime() - a.timestamp.getTime();\n  });\n}\n\n/**\n * Get date group for a given date\n */\nexport function getDateGroup(date: Date): DateGroup {\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const tomorrow = new Date(today);\n  tomorrow.setDate(tomorrow.getDate() + 1);\n  const dayAfterTomorrow = new Date(today);\n  dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);\n  const oneWeekFromNow = new Date(today);\n  oneWeekFromNow.setDate(oneWeekFromNow.getDate() + 7);\n  const oneMonthFromNow = new Date(today);\n  oneMonthFromNow.setMonth(oneMonthFromNow.getMonth() + 1);\n\n  const itemDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n\n  if (itemDate < today) {\n    return 'older';\n  } else if (itemDate.getTime() === today.getTime()) {\n    return 'today';\n  } else if (itemDate.getTime() === tomorrow.getTime()) {\n    return 'tomorrow';\n  } else if (itemDate < oneWeekFromNow) {\n    return 'this_week';\n  } else if (itemDate < oneMonthFromNow) {\n    return 'this_month';\n  } else {\n    return 'future';\n  }\n}\n\n/**\n * Get label for date group\n */\nexport function getDateGroupLabel(group: DateGroup): string {\n  switch (group) {\n    case 'overdue':\n      return 'Overdue';\n    case 'today':\n      return 'Today';\n    case 'tomorrow':\n      return 'Tomorrow';\n    case 'this_week':\n      return 'This Week';\n    case 'this_month':\n      return 'This Month';\n    case 'older':\n      return 'Earlier';\n    case 'future':\n      return 'Upcoming';\n    default:\n      return 'Other';\n  }\n}\n\n/**\n * Group timeline items by date\n */\nexport function groupTimelineByDate(items: TimelineItem[]): GroupedTimeline[] {\n  const groups: Map<DateGroup, TimelineItem[]> = new Map();\n\n  items.forEach(item => {\n    let group: DateGroup;\n\n    // For tasks, check if overdue first\n    if (item.type === 'task' && item.task?.is_overdue) {\n      group = 'overdue';\n    } else {\n      group = getDateGroup(item.timestamp);\n    }\n\n    if (!groups.has(group)) {\n      groups.set(group, []);\n    }\n    groups.get(group)!.push(item);\n  });\n\n  // Define group order\n  const groupOrder: DateGroup[] = ['overdue', 'today', 'tomorrow', 'this_week', 'this_month', 'future', 'older'];\n\n  // Build result in order\n  const result: GroupedTimeline[] = [];\n  groupOrder.forEach(group => {\n    const groupItems = groups.get(group);\n    if (groupItems && groupItems.length > 0) {\n      result.push({\n        group,\n        label: getDateGroupLabel(group),\n        items: groupItems,\n      });\n    }\n  });\n\n  return result;\n}\n\n/**\n * Get urgency level for a task\n */\nexport function getTaskUrgency(task: TaskTimelineData): 'overdue' | 'due_today' | 'due_soon' | 'pending' | 'complete' | 'signed_off' {\n  if (task.status === 'signed_off') return 'signed_off';\n  if (task.status === 'complete') return 'complete';\n  if (task.status === 'cancelled') return 'pending';\n  if (task.is_overdue) return 'overdue';\n\n  const daysUntil = task.days_until_deadline;\n  if (daysUntil !== undefined) {\n    if (daysUntil === 0) return 'due_today';\n    if (daysUntil <= 3) return 'due_soon';\n  }\n\n  return 'pending';\n}\n\n/**\n * Format relative time (e.g., \"2 hours ago\", \"in 3 days\")\n */\nexport function formatRelativeTime(date: Date): string {\n  const now = new Date();\n  const diffMs = date.getTime() - now.getTime();\n  const diffMins = Math.round(diffMs / (1000 * 60));\n  const diffHours = Math.round(diffMs / (1000 * 60 * 60));\n  const diffDays = Math.round(diffMs / (1000 * 60 * 60 * 24));\n\n  if (diffMs < 0) {\n    // Past\n    const absDays = Math.abs(diffDays);\n    const absHours = Math.abs(diffHours);\n    const absMins = Math.abs(diffMins);\n\n    if (absDays >= 1) return `${absDays} day${absDays > 1 ? 's' : ''} ago`;\n    if (absHours >= 1) return `${absHours} hour${absHours > 1 ? 's' : ''} ago`;\n    if (absMins >= 1) return `${absMins} min${absMins > 1 ? 's' : ''} ago`;\n    return 'just now';\n  } else {\n    // Future\n    if (diffDays >= 1) return `in ${diffDays} day${diffDays > 1 ? 's' : ''}`;\n    if (diffHours >= 1) return `in ${diffHours} hour${diffHours > 1 ? 's' : ''}`;\n    if (diffMins >= 1) return `in ${diffMins} min${diffMins > 1 ? 's' : ''}`;\n    return 'now';\n  }\n}\n","/**\n * TaskTimelineItem Component\n * Renders a task deadline with urgency-based styling\n */\n\nimport React from 'react';\nimport {\n  AlertTriangle,\n  Clock,\n  CircleDot,\n  CircleCheck,\n  CheckCircle2,\n  XCircle,\n} from 'lucide-react';\nimport { TaskTimelineData, getTaskUrgency, formatRelativeTime } from '../../../utils/timelineUtils';\n\ninterface TaskTimelineItemProps {\n  task: TaskTimelineData;\n  onViewDetails?: () => void;\n}\n\n// Urgency-based styling configurations\nconst urgencyStyles = {\n  overdue: {\n    background: 'rgba(239, 68, 68, 0.1)',\n    borderColor: '#ef4444',\n    textColor: '#f87171',\n    icon: AlertTriangle,\n    statusLabel: 'Overdue',\n    statusBg: '#ef444420',\n  },\n  due_today: {\n    background: 'rgba(245, 158, 11, 0.12)',\n    borderColor: '#f59e0b',\n    textColor: '#fbbf24',\n    icon: Clock,\n    statusLabel: 'Due Today',\n    statusBg: '#f59e0b20',\n  },\n  due_soon: {\n    background: 'rgba(245, 158, 11, 0.08)',\n    borderColor: '#f59e0b',\n    textColor: '#fbbf24',\n    icon: Clock,\n    statusLabel: 'Due Soon',\n    statusBg: '#f59e0b20',\n  },\n  pending: {\n    background: 'var(--bg)',\n    borderColor: '#3b82f6',\n    textColor: 'var(--text)',\n    icon: CircleDot,\n    statusLabel: 'Pending',\n    statusBg: '#3b82f620',\n  },\n  complete: {\n    background: 'rgba(245, 158, 11, 0.06)',\n    borderColor: '#f59e0b',\n    textColor: '#fbbf24',\n    icon: CircleCheck,\n    statusLabel: 'Awaiting Sign-off',\n    statusBg: '#f59e0b20',\n  },\n  signed_off: {\n    background: 'rgba(16, 185, 129, 0.08)',\n    borderColor: '#10b981',\n    textColor: '#34d399',\n    icon: CheckCircle2,\n    statusLabel: 'Signed Off',\n    statusBg: '#10b98120',\n  },\n};\n\nexport function TaskTimelineItem({ task, onViewDetails }: TaskTimelineItemProps) {\n  const urgency = getTaskUrgency(task);\n  const style = urgencyStyles[urgency];\n  const Icon = style.icon;\n\n  // Format deadline date\n  const deadlineDate = new Date(task.deadline);\n  const formattedDeadline = deadlineDate.toLocaleDateString('en-US', {\n    month: 'short',\n    day: 'numeric',\n    year: deadlineDate.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined,\n  });\n\n  // Get time indicator text\n  const getTimeIndicator = () => {\n    if (task.status === 'signed_off') {\n      return task.signed_off_at ? formatRelativeTime(new Date(task.signed_off_at)) : 'Completed';\n    }\n    if (task.status === 'complete') {\n      return 'Awaiting review';\n    }\n    if (task.is_overdue) {\n      const daysOverdue = task.days_until_deadline ? Math.abs(task.days_until_deadline) : 0;\n      return `${daysOverdue} day${daysOverdue !== 1 ? 's' : ''} overdue`;\n    }\n    if (task.days_until_deadline !== undefined) {\n      if (task.days_until_deadline === 0) return 'Due today';\n      if (task.days_until_deadline === 1) return 'Due tomorrow';\n      return `${task.days_until_deadline} days left`;\n    }\n    return formattedDeadline;\n  };\n\n  return (\n    <div\n      onClick={onViewDetails}\n      style={{\n        background: style.background,\n        borderLeft: `4px solid ${style.borderColor}`,\n        borderRadius: 8,\n        padding: 16,\n        cursor: onViewDetails ? 'pointer' : 'default',\n        transition: 'background 0.15s ease',\n      }}\n      onMouseEnter={(e) => {\n        if (onViewDetails) {\n          e.currentTarget.style.background = urgency === 'overdue'\n            ? 'rgba(239, 68, 68, 0.15)'\n            : urgency === 'due_today' || urgency === 'due_soon'\n              ? 'rgba(245, 158, 11, 0.15)'\n              : 'rgba(59, 130, 246, 0.08)';\n        }\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = style.background;\n      }}\n    >\n      <div style={{ display: 'flex', alignItems: 'flex-start', gap: 12 }}>\n        {/* Icon */}\n        <div\n          style={{\n            width: 36,\n            height: 36,\n            borderRadius: 8,\n            background: style.statusBg,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            flexShrink: 0,\n          }}\n        >\n          <Icon size={18} style={{ color: style.borderColor }} />\n        </div>\n\n        {/* Content */}\n        <div style={{ flex: 1, minWidth: 0 }}>\n          {/* Title row */}\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start', gap: 12 }}>\n            <h4\n              style={{\n                margin: 0,\n                fontSize: 14,\n                fontWeight: 600,\n                color: style.textColor,\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              {task.title}\n            </h4>\n            <span\n              style={{\n                fontSize: 12,\n                color: style.textColor,\n                whiteSpace: 'nowrap',\n                flexShrink: 0,\n              }}\n            >\n              {formattedDeadline}\n            </span>\n          </div>\n\n          {/* Collaborator info */}\n          <div style={{ marginTop: 4, display: 'flex', alignItems: 'center', gap: 8 }}>\n            <span style={{ fontSize: 12, color: '#94a3b8' }}>\n              @{task.collaborator_username}\n            </span>\n            <span style={{ fontSize: 12, color: '#64748b' }}>\n              {task.collaborator_role}\n            </span>\n          </div>\n\n          {/* Description (if short enough) */}\n          {task.description && task.description.length <= 100 && (\n            <p\n              style={{\n                margin: '8px 0 0',\n                fontSize: 13,\n                color: '#94a3b8',\n                lineHeight: 1.4,\n              }}\n            >\n              {task.description}\n            </p>\n          )}\n\n          {/* Footer row */}\n          <div\n            style={{\n              marginTop: 10,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              gap: 12,\n            }}\n          >\n            {/* Time indicator */}\n            <span\n              style={{\n                fontSize: 12,\n                fontWeight: 500,\n                color: style.borderColor,\n              }}\n            >\n              {getTimeIndicator()}\n            </span>\n\n            {/* Status badge */}\n            <span\n              style={{\n                fontSize: 11,\n                fontWeight: 600,\n                padding: '3px 8px',\n                borderRadius: 4,\n                background: style.statusBg,\n                color: style.borderColor,\n                textTransform: 'uppercase',\n                letterSpacing: '0.02em',\n              }}\n            >\n              {task.status === 'in_progress' ? 'In Progress' : style.statusLabel}\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TaskTimelineItem;\n","/**\n * ActivityTimelineItem Component\n * Renders an activity event in the unified timeline\n */\n\nimport React from 'react';\nimport {\n  FileEdit,\n  MessageCircle,\n  UserPlus,\n  UserMinus,\n  CheckCircle,\n  Bell,\n  Sparkles,\n  Coins,\n  Upload,\n  Send,\n  Activity as ActivityIcon,\n} from 'lucide-react';\nimport { Activity, ActivityType, getTimeAgo } from '../../../services/activityService';\n\ninterface ActivityTimelineItemProps {\n  activity: Activity;\n  compact?: boolean;\n}\n\n// Activity type configurations with Lucide icons\nconst activityConfig: Record<ActivityType, { icon: React.ElementType; color: string; label: string }> = {\n  section_updated: { icon: FileEdit, color: '#3b82f6', label: 'Section Updated' },\n  comment_added: { icon: MessageCircle, color: '#06b6d4', label: 'Comment Added' },\n  collaborator_joined: { icon: UserPlus, color: '#10b981', label: 'Joined' },\n  collaborator_left: { icon: UserMinus, color: '#64748b', label: 'Left' },\n  approval_given: { icon: CheckCircle, color: '#10b981', label: 'Approved' },\n  approval_requested: { icon: Bell, color: '#f59e0b', label: 'Approval Requested' },\n  ready_for_mint: { icon: Sparkles, color: '#ec4899', label: 'Ready for Mint' },\n  project_minted: { icon: Coins, color: '#fbbf24', label: 'Minted' },\n  media_uploaded: { icon: Upload, color: '#8b5cf6', label: 'Media Uploaded' },\n  invitation_sent: { icon: Send, color: '#f59e0b', label: 'Invitation Sent' },\n};\n\nexport function ActivityTimelineItem({ activity, compact = false }: ActivityTimelineItemProps) {\n  const config = activityConfig[activity.activity_type] || {\n    icon: ActivityIcon,\n    color: '#64748b',\n    label: 'Activity',\n  };\n\n  const Icon = config.icon;\n  const timeAgo = getTimeAgo(activity.created_at);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: compact ? 'center' : 'flex-start',\n        gap: compact ? 10 : 12,\n        padding: compact ? '10px 14px' : '14px 16px',\n        background: 'var(--bg)',\n        borderLeft: `3px solid ${config.color}`,\n        borderRadius: 8,\n        transition: 'background 0.15s ease',\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = 'rgba(255, 255, 255, 0.03)';\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = 'var(--bg)';\n      }}\n    >\n      {/* Avatar with activity badge */}\n      <div style={{ position: 'relative', flexShrink: 0 }}>\n        <div\n          style={{\n            width: compact ? 32 : 40,\n            height: compact ? 32 : 40,\n            borderRadius: '50%',\n            background: activity.avatar\n              ? `url(${activity.avatar}) center/cover`\n              : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#fff',\n            fontSize: compact ? 12 : 14,\n            fontWeight: 700,\n          }}\n        >\n          {!activity.avatar && activity.username.charAt(0).toUpperCase()}\n        </div>\n\n        {/* Activity type badge */}\n        <div\n          style={{\n            position: 'absolute',\n            bottom: -2,\n            right: -2,\n            width: compact ? 16 : 18,\n            height: compact ? 16 : 18,\n            borderRadius: '50%',\n            background: config.color,\n            border: '2px solid var(--bg)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <Icon size={compact ? 8 : 10} style={{ color: '#fff' }} />\n        </div>\n      </div>\n\n      {/* Content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        {/* Description */}\n        <div\n          style={{\n            fontSize: compact ? 12 : 13,\n            fontWeight: 500,\n            color: 'var(--text)',\n            lineHeight: 1.4,\n            marginBottom: compact ? 2 : 4,\n          }}\n        >\n          {activity.description}\n        </div>\n\n        {/* Meta row */}\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            fontSize: compact ? 10 : 11,\n            color: '#64748b',\n            flexWrap: 'wrap',\n          }}\n        >\n          <span style={{ color: config.color, fontWeight: 600 }}>\n            @{activity.username}\n          </span>\n          {activity.section_title && (\n            <>\n              <span style={{ color: '#475569' }}>in</span>\n              <span style={{ color: '#94a3b8' }}>{activity.section_title}</span>\n            </>\n          )}\n          <span style={{ color: '#475569' }}>â€¢</span>\n          <span>{timeAgo}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ActivityTimelineItem;\n","/**\n * UnifiedTimeline Component\n * Main container that renders a chronological timeline of tasks and activities\n */\n\nimport React from 'react';\nimport { ListTodo, Activity as ActivityIcon } from 'lucide-react';\nimport {\n  TimelineItem,\n  GroupedTimeline,\n  groupTimelineByDate,\n} from '../../../utils/timelineUtils';\nimport { TaskTimelineItem } from './TaskTimelineItem';\nimport { ActivityTimelineItem } from './ActivityTimelineItem';\n\ninterface UnifiedTimelineProps {\n  items: TimelineItem[];\n  isLoading?: boolean;\n  onTaskClick?: (taskId: number) => void;\n}\n\n// Date group styling\nconst groupStyles: Record<string, { color: string; bgColor: string }> = {\n  overdue: { color: '#ef4444', bgColor: 'rgba(239, 68, 68, 0.15)' },\n  today: { color: '#f59e0b', bgColor: 'rgba(245, 158, 11, 0.1)' },\n  tomorrow: { color: '#3b82f6', bgColor: 'rgba(59, 130, 246, 0.1)' },\n  this_week: { color: '#8b5cf6', bgColor: 'rgba(139, 92, 246, 0.1)' },\n  this_month: { color: '#06b6d4', bgColor: 'rgba(6, 182, 212, 0.1)' },\n  future: { color: '#10b981', bgColor: 'rgba(16, 185, 129, 0.1)' },\n  older: { color: '#64748b', bgColor: 'rgba(100, 116, 139, 0.1)' },\n};\n\nexport function UnifiedTimeline({ items, isLoading = false, onTaskClick }: UnifiedTimelineProps) {\n  // Group items by date\n  const groupedItems = groupTimelineByDate(items);\n\n  // Count stats\n  const taskCount = items.filter(i => i.type === 'task').length;\n  const activityCount = items.filter(i => i.type === 'activity').length;\n  const overdueCount = items.filter(i => i.type === 'task' && i.task?.is_overdue).length;\n\n  if (isLoading) {\n    return (\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          padding: 60,\n          color: '#94a3b8',\n        }}\n      >\n        Loading timeline...\n      </div>\n    );\n  }\n\n  if (items.length === 0) {\n    return (\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 48,\n          textAlign: 'center',\n        }}\n      >\n        <div\n          style={{\n            width: 64,\n            height: 64,\n            borderRadius: '50%',\n            background: 'rgba(139, 92, 246, 0.1)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            margin: '0 auto 16px',\n          }}\n        >\n          <ListTodo size={28} style={{ color: '#8b5cf6' }} />\n        </div>\n        <h3 style={{ margin: '0 0 8px', color: 'var(--text)', fontSize: 16, fontWeight: 600 }}>\n          No Timeline Items\n        </h3>\n        <p style={{ margin: 0, color: '#64748b', fontSize: 14 }}>\n          Tasks and activities will appear here as your team collaborates.\n        </p>\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>\n      {/* Summary stats */}\n      <div\n        style={{\n          display: 'flex',\n          gap: 16,\n          flexWrap: 'wrap',\n        }}\n      >\n        {overdueCount > 0 && (\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              padding: '8px 14px',\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid rgba(239, 68, 68, 0.3)',\n              borderRadius: 8,\n            }}\n          >\n            <ListTodo size={16} style={{ color: '#ef4444' }} />\n            <span style={{ fontSize: 13, fontWeight: 600, color: '#ef4444' }}>\n              {overdueCount} overdue\n            </span>\n          </div>\n        )}\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            padding: '8px 14px',\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n          }}\n        >\n          <ListTodo size={16} style={{ color: '#3b82f6' }} />\n          <span style={{ fontSize: 13, color: '#94a3b8' }}>\n            {taskCount} task{taskCount !== 1 ? 's' : ''}\n          </span>\n        </div>\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            padding: '8px 14px',\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n          }}\n        >\n          <ActivityIcon size={16} style={{ color: '#8b5cf6' }} />\n          <span style={{ fontSize: 13, color: '#94a3b8' }}>\n            {activityCount} activit{activityCount !== 1 ? 'ies' : 'y'}\n          </span>\n        </div>\n      </div>\n\n      {/* Grouped timeline */}\n      {groupedItems.map((group) => (\n        <TimelineGroup\n          key={group.group}\n          group={group}\n          onTaskClick={onTaskClick}\n        />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Timeline Group - renders a date-grouped section\n */\ninterface TimelineGroupProps {\n  group: GroupedTimeline;\n  onTaskClick?: (taskId: number) => void;\n}\n\nfunction TimelineGroup({ group, onTaskClick }: TimelineGroupProps) {\n  const style = groupStyles[group.group] || groupStyles.older;\n\n  return (\n    <div>\n      {/* Group header */}\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 12,\n          marginBottom: 12,\n        }}\n      >\n        <div\n          style={{\n            padding: '6px 14px',\n            background: style.bgColor,\n            borderRadius: 6,\n            fontSize: 12,\n            fontWeight: 700,\n            color: style.color,\n            textTransform: 'uppercase',\n            letterSpacing: '0.04em',\n          }}\n        >\n          {group.label}\n        </div>\n        <div\n          style={{\n            flex: 1,\n            height: 1,\n            background: 'var(--panel-border)',\n          }}\n        />\n        <span style={{ fontSize: 12, color: '#64748b' }}>\n          {group.items.length} item{group.items.length !== 1 ? 's' : ''}\n        </span>\n      </div>\n\n      {/* Items */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 10 }}>\n        {group.items.map((item) => (\n          <div key={item.id}>\n            {item.type === 'task' && item.task ? (\n              <TaskTimelineItem\n                task={item.task}\n                onViewDetails={onTaskClick ? () => onTaskClick(item.task!.id) : undefined}\n              />\n            ) : item.type === 'activity' && item.activity ? (\n              <ActivityTimelineItem activity={item.activity} />\n            ) : null}\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default UnifiedTimeline;\n","/**\n * ActivityTab Component\n * Shows a unified timeline of task deadlines and project activities\n */\n\nimport React, { useMemo } from 'react';\nimport { Activity as ActivityIcon } from 'lucide-react';\nimport { CollaborativeProject } from '../../../services/collaborationApi';\nimport { useActivity } from '../../../hooks/useActivity';\nimport { UnifiedTimeline } from '../timeline';\nimport { mergeTasksAndActivities } from '../../../utils/timelineUtils';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ActivityTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n}\n\nexport default function ActivityTab({\n  project,\n  currentUser,\n}: ActivityTabProps) {\n  // Activity tracking\n  const {\n    activities,\n    onlineUsers,\n    isPolling,\n  } = useActivity({\n    projectId: project.id,\n    autoStart: true,\n  });\n\n  // Merge tasks and activities into unified timeline\n  const timelineItems = useMemo(() => {\n    const collaborators = project.collaborators || [];\n    return mergeTasksAndActivities(collaborators, activities);\n  }, [project.collaborators, activities]);\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <ActivityIcon size={20} style={{ color: '#8b5cf6' }} />\n          <h2 style={{ margin: 0, color: 'var(--text)', fontSize: 20, fontWeight: 600 }}>\n            Project Timeline\n          </h2>\n        </div>\n\n        {/* Online Status */}\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            padding: '8px 14px',\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n          }}\n        >\n          <div\n            style={{\n              width: 8,\n              height: 8,\n              borderRadius: '50%',\n              background: isPolling ? '#10b981' : '#64748b',\n              boxShadow: isPolling ? '0 0 6px rgba(16, 185, 129, 0.5)' : 'none',\n            }}\n          />\n          <span style={{ fontSize: 13, color: '#94a3b8' }}>\n            {onlineUsers.length} collaborator{onlineUsers.length !== 1 ? 's' : ''} online\n          </span>\n        </div>\n      </div>\n\n      {/* Online users list (if any) */}\n      {onlineUsers.length > 0 && (\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            padding: '12px 16px',\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 10,\n          }}\n        >\n          <span style={{ fontSize: 12, color: '#64748b', marginRight: 8 }}>Online now:</span>\n          <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n            {onlineUsers.map((user) => (\n              <div\n                key={user.user_id}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 6,\n                  padding: '4px 10px',\n                  background: 'rgba(16, 185, 129, 0.1)',\n                  borderRadius: 20,\n                }}\n              >\n                <div\n                  style={{\n                    width: 6,\n                    height: 6,\n                    borderRadius: '50%',\n                    background: '#10b981',\n                  }}\n                />\n                <span style={{ fontSize: 12, color: '#10b981', fontWeight: 500 }}>\n                  @{user.username}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n\n      {/* Unified Timeline */}\n      <UnifiedTimeline items={timelineItems} />\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { CollaborativeProject, collaborationApi } from '../../../services/collaborationApi';\nimport CopyrightPreview from '../../BookEditor/CopyrightPreview';\nimport { Check, Clock, PartyPopper, AlertCircle } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface PublishTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ntype PublishStep = 'customize' | 'approve' | 'mint' | 'share';\n\nexport default function PublishTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: PublishTabProps) {\n  const [step, setStep] = useState<PublishStep>('customize');\n  const [minting, setMinting] = useState(false);\n  const [error, setError] = useState('');\n  const [saving, setSaving] = useState(false);\n\n  // Customization state\n  const [teaserPercent, setTeaserPercent] = useState(project.teaser_percent || 10);\n  const [watermark, setWatermark] = useState(project.watermark_preview || false);\n  const [price, setPrice] = useState(parseFloat(String(project.price_usd)) || 1);\n  const [editions, setEditions] = useState(project.editions || 1);\n  const [authorsNote, setAuthorsNote] = useState(project.authors_note || '');\n\n  const collaborators = project.collaborators || [];\n  const acceptedCollaborators = collaborators.filter(c => c.status === 'accepted');\n  const sections = project.sections || [];\n\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const isProjectLead = project.created_by === currentUser.id;\n\n  // Helper function to strip HTML tags and check content length\n  const getTextContentLength = (html: string): number => {\n    const stripped = (html || '')\n      .replace(/<[^>]*>/g, '')  // Remove HTML tags\n      .replace(/&nbsp;/g, ' ')  // Replace &nbsp;\n      .trim();\n    return stripped.length;\n  };\n\n  // Validation checks for minimum publishing criteria\n  const titleValid = Boolean(\n    project.title &&\n    project.title.trim().length >= 3 &&\n    !project.title.startsWith('Collaboration Invite')\n  );\n\n  const hasContentSections = sections.length > 0;\n\n  // For books: check text content has at least 50 characters\n  const textSections = sections.filter(s => s.section_type === 'text');\n  const hasValidTextContent = project.content_type === 'book'\n    ? textSections.some(s => getTextContentLength(s.content_html || '') >= 50)\n    : true;\n\n  // For art/music/video: check media files exist\n  const mediaSections = sections.filter(s => s.section_type !== 'text');\n  const hasValidMediaContent = ['art', 'music', 'video'].includes(project.content_type)\n    ? mediaSections.some(s => s.media_file)\n    : true;\n\n  const priceValid = price > 0;\n  const editionsValid = editions >= 1;\n\n  // Check if all contract tasks are signed off\n  const collaboratorsWithTasks = acceptedCollaborators.filter(c => (c.tasks_total || 0) > 0);\n  const allTasksSignedOff = collaboratorsWithTasks.length === 0 ||\n    collaboratorsWithTasks.every(c => c.all_tasks_complete);\n  const incompleteTaskCount = collaboratorsWithTasks.reduce(\n    (sum, c) => sum + ((c.tasks_total || 0) - (c.tasks_signed_off || 0)),\n    0\n  );\n\n  // Check if all requirements are met\n  const checklistItems = [\n    {\n      id: 'title',\n      label: 'Valid project title',\n      checked: titleValid,\n      hint: !titleValid ? 'Set a title (min 3 characters, not a placeholder)' : undefined,\n    },\n    {\n      id: 'content',\n      label: project.content_type === 'book'\n        ? 'Book has text content (min 50 characters)'\n        : `${project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} has media files`,\n      checked: hasContentSections && (project.content_type === 'book' ? hasValidTextContent : hasValidMediaContent),\n      hint: !hasContentSections\n        ? 'Add at least one section'\n        : (project.content_type === 'book' && !hasValidTextContent)\n          ? 'Add at least 50 characters of text'\n          : undefined,\n    },\n    {\n      id: 'price',\n      label: 'Price set (greater than $0)',\n      checked: priceValid,\n      hint: !priceValid ? 'Set a price for your NFT' : undefined,\n    },\n    {\n      id: 'editions',\n      label: 'Edition count set',\n      checked: editionsValid,\n      hint: !editionsValid ? 'Set at least 1 edition' : undefined,\n    },\n    {\n      id: 'splits',\n      label: 'Revenue splits total 100%',\n      checked: Math.abs(collaborators.reduce((sum, c) => sum + parseFloat(String(c.revenue_percentage)), 0) - 100) < 0.01,\n    },\n    {\n      id: 'tasks',\n      label: 'All contract tasks signed off',\n      checked: allTasksSignedOff,\n      hint: !allTasksSignedOff\n        ? `${incompleteTaskCount} task${incompleteTaskCount === 1 ? '' : 's'} still need sign-off`\n        : undefined,\n    },\n    {\n      id: 'invited',\n      label: 'All collaborators responded',\n      checked: collaborators.every(c => c.status === 'accepted' || c.status === 'declined'),\n    },\n    {\n      id: 'approved',\n      label: 'All collaborators approved',\n      checked: project.is_fully_approved,\n    },\n  ];\n\n  const allChecked = checklistItems.every(item => item.checked);\n\n  // Determine current step based on project state\n  useEffect(() => {\n    if (project.status === 'minted') {\n      setStep('share');\n    } else if (project.is_fully_approved) {\n      setStep('mint');\n    }\n  }, [project.status, project.is_fully_approved]);\n\n  const handleSaveCustomization = async () => {\n    if (!isProjectLead) return;\n\n    setSaving(true);\n    setError('');\n\n    try {\n      const updatedProject = await collaborationApi.updateCustomization(project.id, {\n        price_usd: price,\n        editions: editions,\n        teaser_percent: teaserPercent,\n        watermark_preview: watermark,\n        authors_note: authorsNote,\n      });\n      onProjectUpdate?.(updatedProject);\n      setStep('approve');\n    } catch (err: any) {\n      setError(err.message || 'Failed to save customization');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleApproveVersion = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveCurrentVersion(project.id);\n      onProjectUpdate?.(updatedProject);\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve');\n    }\n  };\n\n  const handleApproveRevenue = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveProject(project.id, {\n        approve_content: currentUserRole?.approved_current_version || false,\n        approve_revenue: true,\n      });\n      onProjectUpdate?.(updatedProject);\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve revenue split');\n    }\n  };\n\n  const handleMint = async () => {\n    if (!allChecked || !isProjectLead) return;\n\n    setMinting(true);\n    setError('');\n\n    try {\n      const result = await collaborationApi.mintProject(project.id);\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n      setStep('share');\n    } catch (err: any) {\n      setError(err.message || 'Failed to mint project');\n    } finally {\n      setMinting(false);\n    }\n  };\n\n  const steps: { id: PublishStep; label: string }[] = [\n    { id: 'customize', label: 'Customize' },\n    { id: 'approve', label: 'Approve' },\n    { id: 'mint', label: 'Mint' },\n    { id: 'share', label: 'Share' },\n  ];\n\n  const stepIndex = steps.findIndex(s => s.id === step);\n\n  // Calculate user's estimated earnings\n  const creatorPool = price * 0.9 * editions;\n  const userEstimatedEarnings = creatorPool * (currentUserRole?.revenue_percentage || 0) / 100;\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Step Progress Bar */}\n      <div style={{\n        display: 'grid',\n        gridTemplateColumns: `repeat(${steps.length}, 1fr)`,\n        gap: 8,\n        alignItems: 'end',\n      }}>\n        {steps.map((s, i) => {\n          const isCurrent = s.id === step;\n          const isCompleted = i < stepIndex || project.status === 'minted';\n          const canClick = i <= stepIndex || project.status === 'minted';\n\n          return (\n            <div\n              key={s.id}\n              onClick={() => canClick && setStep(s.id)}\n              style={{ cursor: canClick ? 'pointer' : 'default' }}\n            >\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                <div style={{\n                  width: 24,\n                  height: 24,\n                  borderRadius: 999,\n                  border: '1px solid var(--panel-border)',\n                  background: isCurrent ? 'var(--accent)' : isCompleted ? '#10b981' : 'var(--panel)',\n                  color: isCurrent || isCompleted ? '#111' : 'var(--text-dim)',\n                  display: 'grid',\n                  placeItems: 'center',\n                  fontSize: 12,\n                  fontWeight: 700,\n                }}>\n                  {isCompleted ? 'âœ“' : i + 1}\n                </div>\n                <div style={{\n                  fontSize: 13,\n                  color: isCurrent ? 'var(--text)' : 'var(--text-dim)',\n                  fontWeight: isCurrent ? 700 : 600,\n                }}>\n                  {s.label}\n                </div>\n              </div>\n              <div style={{\n                height: 3,\n                marginTop: 6,\n                borderRadius: 999,\n                background: isCurrent\n                  ? 'radial-gradient(60% 100% at 50% 100%, rgba(245,158,11,0.9), rgba(245,158,11,0.2))'\n                  : isCompleted ? '#10b981' : 'transparent',\n                boxShadow: isCurrent ? '0 0 8px rgba(245,158,11,0.7)' : 'none',\n              }} />\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Back button */}\n      {stepIndex > 0 && step !== 'share' && (\n        <div style={{ display: 'flex', justifyContent: 'flex-start' }}>\n          <button\n            onClick={() => setStep(steps[stepIndex - 1].id)}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              color: 'var(--text-dim)',\n              borderRadius: 8,\n              padding: '6px 12px',\n              cursor: 'pointer',\n              fontSize: 13,\n            }}\n          >\n            Back\n          </button>\n        </div>\n      )}\n\n      {/* Error display */}\n      {error && (\n        <div style={{\n          padding: 12,\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 8,\n          color: '#ef4444',\n          fontSize: 13,\n        }}>\n          {error}\n        </div>\n      )}\n\n      {/* Step Content */}\n      {step === 'customize' && (\n        <CustomizeStep\n          isProjectLead={isProjectLead}\n          teaserPercent={teaserPercent}\n          setTeaserPercent={setTeaserPercent}\n          watermark={watermark}\n          setWatermark={setWatermark}\n          price={price}\n          setPrice={setPrice}\n          editions={editions}\n          setEditions={setEditions}\n          authorsNote={authorsNote}\n          setAuthorsNote={setAuthorsNote}\n          onNext={isProjectLead ? handleSaveCustomization : () => setStep('approve')}\n          saving={saving}\n          authorName={project.created_by_username || 'Creator'}\n        />\n      )}\n\n      {step === 'approve' && (\n        <ApproveStep\n          project={project}\n          currentUser={currentUser}\n          currentUserRole={currentUserRole}\n          acceptedCollaborators={acceptedCollaborators}\n          checklistItems={checklistItems}\n          price={price}\n          editions={editions}\n          userEstimatedEarnings={userEstimatedEarnings}\n          onApproveVersion={handleApproveVersion}\n          onApproveRevenue={handleApproveRevenue}\n          onNext={() => setStep('mint')}\n        />\n      )}\n\n      {step === 'mint' && (\n        <MintStep\n          project={project}\n          isProjectLead={isProjectLead}\n          allChecked={allChecked}\n          checklistItems={checklistItems}\n          price={price}\n          editions={editions}\n          minting={minting}\n          onMint={handleMint}\n        />\n      )}\n\n      {step === 'share' && (\n        <ShareStep project={project} />\n      )}\n    </div>\n  );\n}\n\n// ===== Step Components =====\n\ninterface CustomizeStepProps {\n  isProjectLead: boolean;\n  teaserPercent: number;\n  setTeaserPercent: (v: number) => void;\n  watermark: boolean;\n  setWatermark: (v: boolean) => void;\n  price: number;\n  setPrice: (v: number) => void;\n  editions: number;\n  setEditions: (v: number) => void;\n  authorsNote: string;\n  setAuthorsNote: (v: string) => void;\n  onNext: () => void;\n  saving: boolean;\n  authorName: string;\n}\n\n// Helper to count words\nfunction countWords(text: string): number {\n  return text.trim().split(/\\s+/).filter(w => w.length > 0).length;\n}\n\nfunction CustomizeStep({\n  isProjectLead,\n  teaserPercent,\n  setTeaserPercent,\n  watermark,\n  setWatermark,\n  price,\n  setPrice,\n  editions,\n  setEditions,\n  authorsNote,\n  setAuthorsNote,\n  onNext,\n  saving,\n  authorName,\n}: CustomizeStepProps) {\n  const wordCount = countWords(authorsNote);\n  const maxWords = 100;\n  const isOverLimit = wordCount > maxWords;\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n    }}>\n      <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18 }}>\n        Customize Your NFT\n      </h3>\n\n      {!isProjectLead && (\n        <div style={{\n          padding: 16,\n          background: 'rgba(245, 158, 11, 0.1)',\n          borderRadius: 8,\n          marginBottom: 20,\n          color: '#f59e0b',\n          fontSize: 13,\n        }}>\n          Only the project owner can modify these settings.\n        </div>\n      )}\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n        {/* Teaser Slider */}\n        <div>\n          <label style={{ fontSize: 13, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n            Teaser shown to public: {teaserPercent}%\n          </label>\n          <input\n            type=\"range\"\n            min={0}\n            max={100}\n            value={teaserPercent}\n            onChange={(e) => setTeaserPercent(parseInt(e.target.value))}\n            disabled={!isProjectLead}\n            style={{ width: '100%' }}\n          />\n        </div>\n\n        {/* Watermark Checkbox */}\n        <label style={{ display: 'flex', alignItems: 'center', gap: 8, cursor: isProjectLead ? 'pointer' : 'not-allowed' }}>\n          <input\n            type=\"checkbox\"\n            checked={watermark}\n            onChange={(e) => setWatermark(e.target.checked)}\n            disabled={!isProjectLead}\n          />\n          <span style={{ fontSize: 13, color: 'var(--text)' }}>Show watermark on teaser</span>\n        </label>\n\n        {/* Price and Editions */}\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>\n          <div>\n            <label style={{ fontSize: 12, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n              Price per edition (USD)\n            </label>\n            <input\n              type=\"number\"\n              min={0.01}\n              step={0.01}\n              value={price}\n              onChange={(e) => setPrice(parseFloat(e.target.value) || 0)}\n              disabled={!isProjectLead}\n              style={{\n                width: '100%',\n                padding: '10px 14px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 16,\n              }}\n            />\n          </div>\n          <div>\n            <label style={{ fontSize: 12, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n              Number of editions\n            </label>\n            <input\n              type=\"number\"\n              min={1}\n              value={editions}\n              onChange={(e) => setEditions(parseInt(e.target.value) || 1)}\n              disabled={!isProjectLead}\n              style={{\n                width: '100%',\n                padding: '10px 14px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 16,\n              }}\n            />\n          </div>\n        </div>\n\n        {/* Author's Note */}\n        <div>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>\n            <label style={{ fontSize: 13, color: '#94a3b8' }}>\n              Author's Note (optional)\n            </label>\n            <span style={{ fontSize: 11, color: isOverLimit ? '#ef4444' : '#64748b' }}>\n              {wordCount}/{maxWords} words\n            </span>\n          </div>\n          <textarea\n            value={authorsNote}\n            onChange={(e) => setAuthorsNote(e.target.value)}\n            placeholder=\"Share a brief note about this work with your audience...\"\n            disabled={!isProjectLead}\n            style={{\n              width: '100%',\n              minHeight: 80,\n              padding: '10px 14px',\n              background: 'var(--bg)',\n              border: `1px solid ${isOverLimit ? '#ef4444' : 'var(--panel-border)'}`,\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              resize: 'vertical',\n              fontFamily: 'inherit',\n              cursor: isProjectLead ? 'text' : 'not-allowed',\n              opacity: isProjectLead ? 1 : 0.6,\n            }}\n          />\n          {isOverLimit && (\n            <div style={{ fontSize: 11, color: '#ef4444', marginTop: 4 }}>\n              Please keep your note under {maxWords} words.\n            </div>\n          )}\n        </div>\n\n        <div style={{ fontSize: 12, color: '#64748b' }}>\n          Platform fee applies per terms. Changing price or editions will reset all revenue split approvals.\n        </div>\n\n        {/* Copyright Preview */}\n        <CopyrightPreview authorName={authorName} />\n      </div>\n\n      {/* Next Button */}\n      <div style={{ marginTop: 24, display: 'flex', justifyContent: 'flex-end' }}>\n        <button\n          onClick={onNext}\n          disabled={isProjectLead && saving}\n          style={{\n            padding: '12px 32px',\n            background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n            border: 'none',\n            borderRadius: 8,\n            color: '#111',\n            fontWeight: 700,\n            fontSize: 14,\n            cursor: (isProjectLead && saving) ? 'not-allowed' : 'pointer',\n            opacity: (isProjectLead && saving) ? 0.7 : 1,\n          }}\n        >\n          {isProjectLead ? (saving ? 'Saving...' : 'Save & Continue') : 'Continue to Approve'}\n        </button>\n      </div>\n    </div>\n  );\n}\n\ninterface ApproveStepProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  currentUserRole: any;\n  acceptedCollaborators: any[];\n  checklistItems: { id: string; label: string; checked: boolean; hint?: string }[];\n  price: number;\n  editions: number;\n  userEstimatedEarnings: number;\n  onApproveVersion: () => void;\n  onApproveRevenue: () => void;\n  onNext: () => void;\n}\n\nfunction ApproveStep({\n  project,\n  currentUser,\n  currentUserRole,\n  acceptedCollaborators,\n  checklistItems,\n  price,\n  editions,\n  userEstimatedEarnings,\n  onApproveVersion,\n  onApproveRevenue,\n  onNext,\n}: ApproveStepProps) {\n  const userHasApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Status Banner */}\n      <div style={{\n        background: project.is_fully_approved\n          ? 'rgba(16, 185, 129, 0.1)'\n          : 'rgba(245, 158, 11, 0.1)',\n        border: `1px solid ${project.is_fully_approved ? '#10b981' : '#f59e0b'}`,\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        alignItems: 'center',\n        gap: 16,\n      }}>\n        <div style={{\n          width: 48,\n          height: 48,\n          borderRadius: '50%',\n          background: project.is_fully_approved\n            ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n            : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          fontSize: 24,\n        }}>\n          {project.is_fully_approved ? <Check size={24} /> : <Clock size={24} />}\n        </div>\n        <div>\n          <div style={{\n            fontSize: 18,\n            fontWeight: 700,\n            color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n          }}>\n            {project.is_fully_approved ? 'All Approved!' : 'Awaiting Approvals'}\n          </div>\n          <div style={{ fontSize: 14, color: '#94a3b8', marginTop: 4 }}>\n            {project.is_fully_approved\n              ? 'All collaborators have approved. Proceed to mint.'\n              : 'Waiting for all collaborators to approve content and revenue split.'}\n          </div>\n        </div>\n      </div>\n\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 20 }}>\n        {/* Your Approval Actions */}\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Your Approval\n          </h3>\n\n          {userHasApproved ? (\n            <div style={{\n              textAlign: 'center',\n              padding: 24,\n              background: 'rgba(16, 185, 129, 0.1)',\n              borderRadius: 8,\n            }}>\n              <div style={{ display: 'flex', justifyContent: 'center', marginBottom: 12 }}>\n                <Check size={48} style={{ color: '#10b981' }} />\n              </div>\n              <div style={{ fontSize: 16, fontWeight: 600, color: '#10b981' }}>\n                You've approved this project\n              </div>\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n              <div style={{ padding: 16, background: 'var(--bg)', borderRadius: 8 }}>\n                <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)', marginBottom: 8 }}>\n                  Content Approval\n                </div>\n                <div style={{ fontSize: 12, color: '#94a3b8', marginBottom: 12 }}>\n                  Confirm you're happy with all content in this project.\n                </div>\n                <button\n                  onClick={onApproveVersion}\n                  disabled={currentUserRole?.approved_current_version}\n                  style={{\n                    width: '100%',\n                    padding: '10px 16px',\n                    background: currentUserRole?.approved_current_version\n                      ? '#374151'\n                      : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                    border: 'none',\n                    borderRadius: 8,\n                    color: '#fff',\n                    fontWeight: 600,\n                    cursor: currentUserRole?.approved_current_version ? 'not-allowed' : 'pointer',\n                    fontSize: 13,\n                  }}\n                >\n                  {currentUserRole?.approved_current_version ? 'âœ“ Content Approved' : 'Approve Content'}\n                </button>\n              </div>\n\n              <div style={{ padding: 16, background: 'var(--bg)', borderRadius: 8 }}>\n                <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)', marginBottom: 8 }}>\n                  Revenue Split Approval\n                </div>\n                <div style={{ fontSize: 12, color: '#94a3b8', marginBottom: 12 }}>\n                  ${price.toFixed(2)} x {editions} editions = ${(price * editions).toFixed(2)} gross.\n                  Your share: {currentUserRole?.revenue_percentage || 0}% = ${userEstimatedEarnings.toFixed(2)} (after 10% platform fee)\n                </div>\n                <button\n                  onClick={onApproveRevenue}\n                  disabled={currentUserRole?.approved_revenue_split}\n                  style={{\n                    width: '100%',\n                    padding: '10px 16px',\n                    background: currentUserRole?.approved_revenue_split\n                      ? '#374151'\n                      : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                    border: 'none',\n                    borderRadius: 8,\n                    color: '#fff',\n                    fontWeight: 600,\n                    cursor: currentUserRole?.approved_revenue_split ? 'not-allowed' : 'pointer',\n                    fontSize: 13,\n                  }}\n                >\n                  {currentUserRole?.approved_revenue_split ? 'âœ“ Revenue Approved' : 'Approve Revenue Split'}\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Approval Progress */}\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Team Approval Status\n          </h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {acceptedCollaborators.map((collab) => {\n              const hasApproved = collab.approved_current_version && collab.approved_revenue_split;\n              return (\n                <div\n                  key={collab.id}\n                  style={{\n                    padding: 12,\n                    background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg)',\n                    border: `1px solid ${hasApproved ? '#10b981' : 'var(--panel-border)'}`,\n                    borderRadius: 8,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'space-between',\n                  }}\n                >\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                    <div style={{\n                      width: 32,\n                      height: 32,\n                      borderRadius: '50%',\n                      background: hasApproved\n                        ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n                        : 'linear-gradient(135deg, #64748b 0%, #475569 100%)',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      color: '#fff',\n                      fontSize: 12,\n                      fontWeight: 600,\n                    }}>\n                      {hasApproved ? 'âœ“' : collab.username.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                      <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                        @{collab.username}\n                      </div>\n                      <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                        {collab.role} - {collab.revenue_percentage}%\n                      </div>\n                    </div>\n                  </div>\n                  <div style={{ display: 'flex', gap: 6 }}>\n                    <span style={{\n                      fontSize: 10,\n                      padding: '3px 6px',\n                      borderRadius: 4,\n                      background: collab.approved_current_version ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                      color: collab.approved_current_version ? '#10b981' : '#64748b',\n                    }}>\n                      {collab.approved_current_version ? 'âœ“' : 'â—‹'} Content\n                    </span>\n                    <span style={{\n                      fontSize: 10,\n                      padding: '3px 6px',\n                      borderRadius: 4,\n                      background: collab.approved_revenue_split ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                      color: collab.approved_revenue_split ? '#10b981' : '#64748b',\n                    }}>\n                      {collab.approved_revenue_split ? 'âœ“' : 'â—‹'} Revenue\n                    </span>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Next Button */}\n      {project.is_fully_approved && (\n        <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\n          <button\n            onClick={onNext}\n            style={{\n              padding: '12px 32px',\n              background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#111',\n              fontWeight: 700,\n              fontSize: 14,\n              cursor: 'pointer',\n            }}\n          >\n            Next\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface MintStepProps {\n  project: CollaborativeProject;\n  isProjectLead: boolean;\n  allChecked: boolean;\n  checklistItems: { id: string; label: string; checked: boolean; hint?: string }[];\n  price: number;\n  editions: number;\n  minting: boolean;\n  onMint: () => void;\n}\n\nfunction MintStep({\n  project,\n  isProjectLead,\n  allChecked,\n  checklistItems,\n  price,\n  editions,\n  minting,\n  onMint,\n}: MintStepProps) {\n  const [agree, setAgree] = useState(false);\n\n  const gross = price * editions;\n  const platformFee = gross * 0.1;\n  const net = gross - platformFee;\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n    }}>\n      <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18 }}>\n        Review & Mint\n      </h3>\n\n      {/* Checklist */}\n      <div style={{ marginBottom: 24 }}>\n        <h4 style={{ margin: '0 0 12px', color: 'var(--text)', fontSize: 14 }}>Pre-mint Checklist</h4>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {checklistItems.map((item) => (\n            <div\n              key={item.id}\n              style={{\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 4,\n                padding: 10,\n                background: item.checked ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.05)',\n                borderRadius: 6,\n                border: item.checked ? 'none' : '1px solid rgba(239, 68, 68, 0.2)',\n              }}\n            >\n              <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                <div style={{\n                  width: 20,\n                  height: 20,\n                  borderRadius: '50%',\n                  background: item.checked ? '#10b981' : '#ef4444',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: '#fff',\n                  fontSize: 10,\n                }}>\n                  {item.checked ? 'âœ“' : '!'}\n                </div>\n                <span style={{ fontSize: 13, color: item.checked ? '#10b981' : 'var(--text)' }}>\n                  {item.label}\n                </span>\n              </div>\n              {!item.checked && item.hint && (\n                <span style={{ fontSize: 11, color: '#ef4444', marginLeft: 30 }}>\n                  {item.hint}\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Financial Summary */}\n      <div style={{\n        padding: 16,\n        background: 'var(--bg)',\n        borderRadius: 8,\n        marginBottom: 24,\n      }}>\n        <h4 style={{ margin: '0 0 12px', color: 'var(--text)', fontSize: 14 }}>Financial Summary</h4>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8, fontSize: 13, color: '#94a3b8' }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Price per edition:</span>\n            <span style={{ color: 'var(--text)' }}>${price.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Editions:</span>\n            <span style={{ color: 'var(--text)' }}>{editions}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Gross Revenue (if all sold):</span>\n            <span style={{ color: 'var(--text)' }}>${gross.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Platform Fee (10%):</span>\n            <span style={{ color: '#ef4444' }}>-${platformFee.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--panel-border)', paddingTop: 8 }}>\n            <span style={{ fontWeight: 600 }}>Creator Pool:</span>\n            <span style={{ color: '#10b981', fontWeight: 600 }}>${net.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Terms Agreement */}\n      <div style={{ marginBottom: 24 }}>\n        <div style={{ display: 'flex', gap: 12, marginBottom: 12 }}>\n          <a href=\"/legal/terms\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Terms of Service\n          </a>\n          <a href=\"/legal/creator-agreement\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Creator Agreement\n          </a>\n          <a href=\"/legal/content-policy\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Content Policy\n          </a>\n        </div>\n        <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 12, cursor: 'pointer' }}>\n          <input\n            type=\"checkbox\"\n            checked={agree}\n            onChange={(e) => setAgree(e.target.checked)}\n          />\n          <span style={{ fontSize: 13, color: 'var(--text)' }}>\n            I agree to the Terms and understand fees\n          </span>\n        </label>\n      </div>\n\n      {/* Mint Button */}\n      {isProjectLead ? (\n        <button\n          onClick={onMint}\n          disabled={!allChecked || !agree || minting}\n          style={{\n            width: '100%',\n            padding: '14px 24px',\n            background: allChecked && agree\n              ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'\n              : '#374151',\n            border: 'none',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 700,\n            fontSize: 16,\n            cursor: allChecked && agree && !minting ? 'pointer' : 'not-allowed',\n            opacity: allChecked && agree ? 1 : 0.5,\n          }}\n        >\n          {minting ? 'Minting...' : 'Mint & Publish NFT'}\n        </button>\n      ) : (\n        <div style={{\n          textAlign: 'center',\n          padding: 16,\n          background: 'rgba(245, 158, 11, 0.1)',\n          borderRadius: 8,\n          color: '#f59e0b',\n          fontSize: 14,\n        }}>\n          Waiting for project owner to mint the NFT.\n        </div>\n      )}\n\n      <div style={{ fontSize: 11, color: '#64748b', marginTop: 12, textAlign: 'center' }}>\n        Once minted, content cannot be changed.\n      </div>\n    </div>\n  );\n}\n\nfunction ShareStep({ project }: { project: CollaborativeProject }) {\n  // Use /collaborations/ route since collaborative projects don't have a Content entry yet\n  // TODO: Once backend creates Content on mint, switch to /content/${content_id}\n  const projectUrl = `${window.location.origin}/collaborations/${project.id}`;\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(projectUrl);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n      textAlign: 'center',\n    }}>\n      <div style={{ display: 'flex', justifyContent: 'center', marginBottom: 16 }}>\n        <PartyPopper size={64} style={{ color: '#f59e0b' }} />\n      </div>\n      <h3 style={{ margin: '0 0 8px', color: 'var(--text)', fontSize: 24 }}>\n        Successfully Minted!\n      </h3>\n      <p style={{ fontSize: 14, color: '#94a3b8', marginBottom: 24 }}>\n        Your collaborative NFT is now live. Share it with the world!\n      </p>\n\n      <div style={{\n        display: 'flex',\n        gap: 8,\n        maxWidth: 500,\n        margin: '0 auto 24px',\n      }}>\n        <input\n          value={projectUrl}\n          readOnly\n          style={{\n            flex: 1,\n            padding: '10px 14px',\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n            color: 'var(--text)',\n            fontSize: 13,\n          }}\n        />\n        <button\n          onClick={handleCopy}\n          style={{\n            padding: '10px 20px',\n            background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n            border: 'none',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 600,\n            cursor: 'pointer',\n            fontSize: 13,\n          }}\n        >\n          {copied ? 'Copied!' : 'Copy Link'}\n        </button>\n      </div>\n\n      <div style={{\n        display: 'flex',\n        justifyContent: 'center',\n        gap: 16,\n      }}>\n        <a\n          href={`https://twitter.com/intent/tweet?text=Check out our collaborative NFT!&url=${encodeURIComponent(projectUrl)}`}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          style={{\n            padding: '10px 20px',\n            background: '#1DA1F2',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 600,\n            textDecoration: 'none',\n            fontSize: 13,\n          }}\n        >\n          Share on X\n        </a>\n      </div>\n    </div>\n  );\n}\n","/**\n * useComments Hook\n * Manages comments with real-time updates, threading, and optimistic updates\n */\n\nimport { useState, useCallback, useEffect } from 'react';\nimport {\n  ProjectComment,\n  collaborationApi,\n  CreateCommentData,\n} from '../services/collaborationApi';\n\ninterface UseCommentsOptions {\n  projectId: number;\n  sectionId?: number;\n  includeResolved?: boolean;\n  pollingInterval?: number; // Auto-refresh interval in ms\n}\n\ninterface UseCommentsReturn {\n  comments: ProjectComment[];\n  commentsBySection: { [sectionId: string]: ProjectComment[] };\n  unresolvedCount: number;\n  totalCount: number;\n  isLoading: boolean;\n  error: Error | null;\n\n  // Actions\n  refresh: () => Promise<void>;\n  addComment: (\n    content: string,\n    mentions: number[],\n    attachments?: File[],\n    parentCommentId?: number,\n    sectionId?: number\n  ) => Promise<ProjectComment>;\n  updateComment: (commentId: number, content: string) => Promise<ProjectComment>;\n  deleteComment: (commentId: number) => Promise<void>;\n  resolveComment: (commentId: number) => Promise<ProjectComment>;\n  unresolveComment: (commentId: number) => Promise<ProjectComment>;\n  addReaction: (commentId: number, emoji: string) => Promise<void>;\n  removeReaction: (commentId: number, reactionId: number) => Promise<void>;\n\n  // Utilities\n  getCommentById: (commentId: number) => ProjectComment | undefined;\n  getReplies: (parentCommentId: number) => ProjectComment[];\n}\n\n/**\n * Build threaded comment structure\n */\nfunction buildCommentTree(flatComments: ProjectComment[]): ProjectComment[] {\n  const commentMap = new Map<number, ProjectComment>();\n  const rootComments: ProjectComment[] = [];\n\n  // First pass: create map and initialize replies arrays\n  flatComments.forEach((comment) => {\n    commentMap.set(comment.id, { ...comment, replies: [] });\n  });\n\n  // Second pass: build tree structure\n  flatComments.forEach((comment) => {\n    const commentWithReplies = commentMap.get(comment.id)!;\n\n    if (comment.parent_comment) {\n      // Add to parent's replies\n      const parent = commentMap.get(comment.parent_comment);\n      if (parent) {\n        parent.replies!.push(commentWithReplies);\n      } else {\n        // Parent not found, treat as root\n        rootComments.push(commentWithReplies);\n      }\n    } else {\n      // Root comment\n      rootComments.push(commentWithReplies);\n    }\n  });\n\n  return rootComments;\n}\n\n/**\n * Group comments by section\n */\nfunction groupCommentsBySection(comments: ProjectComment[]): {\n  [sectionId: string]: ProjectComment[];\n} {\n  const grouped: { [sectionId: string]: ProjectComment[] } = {\n    general: [], // Comments without a section\n  };\n\n  comments.forEach((comment) => {\n    if (comment.section) {\n      const key = comment.section.toString();\n      if (!grouped[key]) {\n        grouped[key] = [];\n      }\n      grouped[key].push(comment);\n    } else {\n      grouped.general.push(comment);\n    }\n  });\n\n  return grouped;\n}\n\n/**\n * Custom hook for managing comments\n */\nexport function useComments(options: UseCommentsOptions): UseCommentsReturn {\n  const {\n    projectId,\n    sectionId,\n    includeResolved = false,\n    pollingInterval = 0, // 0 means no polling\n  } = options;\n\n  // State\n  const [flatComments, setFlatComments] = useState<ProjectComment[]>([]);\n  const [comments, setComments] = useState<ProjectComment[]>([]);\n  const [commentsBySection, setCommentsBySection] = useState<{\n    [sectionId: string]: ProjectComment[];\n  }>({});\n  const [unresolvedCount, setUnresolvedCount] = useState(0);\n  const [totalCount, setTotalCount] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Process flat comments into tree structure\n  useEffect(() => {\n    const tree = buildCommentTree(flatComments);\n    const grouped = groupCommentsBySection(flatComments);\n\n    setComments(tree);\n    setCommentsBySection(grouped);\n    setUnresolvedCount(flatComments.filter((c) => !c.resolved).length);\n    setTotalCount(flatComments.length);\n  }, [flatComments]);\n\n  // Refresh comments from API\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      let fetchedComments: ProjectComment[];\n\n      if (sectionId) {\n        // Get comments for specific section\n        fetchedComments = await collaborationApi.getComments(projectId, sectionId);\n      } else {\n        // Get all comments\n        fetchedComments = await collaborationApi.getComments(projectId);\n      }\n\n      // Filter out resolved comments if needed\n      if (!includeResolved) {\n        fetchedComments = fetchedComments.filter((c) => !c.resolved);\n      }\n\n      setFlatComments(fetchedComments);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to fetch comments:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [projectId, sectionId, includeResolved]);\n\n  // Add comment with optimistic update\n  const addComment = useCallback(\n    async (\n      content: string,\n      mentions: number[],\n      attachments?: File[],\n      parentCommentId?: number,\n      commentSectionId?: number\n    ): Promise<ProjectComment> => {\n      const data: CreateCommentData = {\n        project: projectId,\n        content,\n        mentions,\n        attachments,\n        parent_comment: parentCommentId,\n        section: commentSectionId || sectionId,\n      };\n\n      try {\n        const newComment = await collaborationApi.addComment(data);\n\n        // Optimistic update\n        setFlatComments((prev) => [...prev, newComment]);\n\n        return newComment;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to add comment:', err);\n        throw err;\n      }\n    },\n    [projectId, sectionId]\n  );\n\n  // Update comment\n  const updateComment = useCallback(\n    async (commentId: number, content: string): Promise<ProjectComment> => {\n      try {\n        const updatedComment = await collaborationApi.updateComment(commentId, content);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? updatedComment : c))\n        );\n\n        return updatedComment;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to update comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Delete comment with optimistic update\n  const deleteComment = useCallback(async (commentId: number): Promise<void> => {\n    try {\n      // Optimistic update\n      setFlatComments((prev) => prev.filter((c) => c.id !== commentId));\n\n      await collaborationApi.deleteComment(commentId);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to delete comment:', err);\n      // Revert optimistic update\n      await refresh();\n      throw err;\n    }\n  }, [refresh]);\n\n  // Resolve comment\n  const resolveComment = useCallback(\n    async (commentId: number): Promise<ProjectComment> => {\n      try {\n        const resolved = await collaborationApi.resolveComment(commentId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? resolved : c))\n        );\n\n        return resolved;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to resolve comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Unresolve comment\n  const unresolveComment = useCallback(\n    async (commentId: number): Promise<ProjectComment> => {\n      try {\n        const unresolved = await collaborationApi.unresolveComment(commentId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? unresolved : c))\n        );\n\n        return unresolved;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to unresolve comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Add reaction\n  const addReaction = useCallback(async (commentId: number, emoji: string): Promise<void> => {\n    try {\n      const reaction = await collaborationApi.addReaction(commentId, emoji);\n\n      // Update in state\n      setFlatComments((prev) =>\n        prev.map((c) => {\n          if (c.id === commentId) {\n            return {\n              ...c,\n              reactions: [...(c.reactions || []), reaction],\n            };\n          }\n          return c;\n        })\n      );\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to add reaction:', err);\n      throw err;\n    }\n  }, []);\n\n  // Remove reaction\n  const removeReaction = useCallback(\n    async (commentId: number, reactionId: number): Promise<void> => {\n      try {\n        await collaborationApi.removeReaction(commentId, reactionId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => {\n            if (c.id === commentId) {\n              return {\n                ...c,\n                reactions: (c.reactions || []).filter((r) => r.id !== reactionId),\n              };\n            }\n            return c;\n          })\n        );\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to remove reaction:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Get comment by ID\n  const getCommentById = useCallback(\n    (commentId: number): ProjectComment | undefined => {\n      return flatComments.find((c) => c.id === commentId);\n    },\n    [flatComments]\n  );\n\n  // Get replies for a comment\n  const getReplies = useCallback(\n    (parentCommentId: number): ProjectComment[] => {\n      return flatComments.filter((c) => c.parent_comment === parentCommentId);\n    },\n    [flatComments]\n  );\n\n  // Initial load\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  // Polling for real-time updates\n  useEffect(() => {\n    if (pollingInterval <= 0) return;\n\n    const interval = setInterval(() => {\n      refresh();\n    }, pollingInterval);\n\n    return () => clearInterval(interval);\n  }, [pollingInterval, refresh]);\n\n  return {\n    comments,\n    commentsBySection,\n    unresolvedCount,\n    totalCount,\n    isLoading,\n    error,\n\n    refresh,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n\n    getCommentById,\n    getReplies,\n  };\n}\n\nexport default useComments;\n","/**\n * OnlineStatus Component\n * Shows online/offline indicator with last seen timestamp\n */\n\nimport React from 'react';\nimport { OnlineUser, getTimeAgo } from '../../services/activityService';\n\ninterface OnlineStatusProps {\n  userId: number;\n  onlineUsers: OnlineUser[];\n  size?: 'small' | 'medium' | 'large';\n  showLabel?: boolean;\n  showLastSeen?: boolean;\n}\n\nexport function OnlineStatus({\n  userId,\n  onlineUsers,\n  size = 'medium',\n  showLabel = false,\n  showLastSeen = false,\n}: OnlineStatusProps) {\n  const user = onlineUsers.find(u => u.user_id === userId);\n  const isOnline = user?.is_online ?? false;\n  const lastSeen = user?.last_seen;\n\n  // Sizes for the indicator dot\n  const dotSizes = {\n    small: 6,\n    medium: 8,\n    large: 10,\n  };\n\n  const dotSize = dotSizes[size];\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n      }}\n      title={\n        isOnline\n          ? 'Online'\n          : lastSeen\n          ? `Last seen ${getTimeAgo(lastSeen)}`\n          : 'Offline'\n      }\n    >\n      {/* Status Indicator Dot */}\n      <div\n        aria-label={isOnline ? 'Online' : 'Offline'}\n        style={{\n          width: dotSize,\n          height: dotSize,\n          borderRadius: '50%',\n          background: isOnline ? '#10b981' : '#64748b',\n          boxShadow: isOnline ? '0 0 8px rgba(16, 185, 129, 0.5)' : 'none',\n          transition: 'all 0.3s',\n        }}\n      />\n\n      {/* Optional Label */}\n      {showLabel && (\n        <span\n          style={{\n            fontSize: size === 'small' ? 10 : size === 'medium' ? 11 : 12,\n            color: isOnline ? '#10b981' : '#64748b',\n            fontWeight: 600,\n          }}\n        >\n          {isOnline ? 'Online' : 'Offline'}\n        </span>\n      )}\n\n      {/* Optional Last Seen */}\n      {!isOnline && showLastSeen && lastSeen && (\n        <span\n          style={{\n            fontSize: size === 'small' ? 9 : size === 'medium' ? 10 : 11,\n            color: '#64748b',\n          }}\n        >\n          {getTimeAgo(lastSeen)}\n        </span>\n      )}\n    </div>\n  );\n}\n\n/**\n * Online Status Badge (for larger display)\n */\ninterface OnlineStatusBadgeProps {\n  userId: number;\n  username: string;\n  onlineUsers: OnlineUser[];\n  avatar?: string;\n}\n\nexport function OnlineStatusBadge({\n  userId,\n  username,\n  onlineUsers,\n  avatar,\n}: OnlineStatusBadgeProps) {\n  const user = onlineUsers.find(u => u.user_id === userId);\n  const isOnline = user?.is_online ?? false;\n  const lastSeen = user?.last_seen;\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: 10,\n        padding: '8px 12px',\n        background: 'var(--bg)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 8,\n      }}\n    >\n      {/* Avatar or placeholder */}\n      <div\n        style={{\n          position: 'relative',\n          width: 32,\n          height: 32,\n          borderRadius: '50%',\n          background: avatar\n            ? `url(${avatar}) center/cover`\n            : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          color: '#fff',\n          fontSize: 14,\n          fontWeight: 700,\n        }}\n      >\n        {!avatar && username.charAt(0).toUpperCase()}\n\n        {/* Online indicator on avatar */}\n        <div\n          aria-label={isOnline ? 'Online' : 'Offline'}\n          style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: 10,\n            height: 10,\n            borderRadius: '50%',\n            background: isOnline ? '#10b981' : '#64748b',\n            border: '2px solid var(--bg)',\n            boxShadow: isOnline ? '0 0 8px rgba(16, 185, 129, 0.5)' : 'none',\n          }}\n        />\n      </div>\n\n      {/* User info */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            fontSize: 13,\n            fontWeight: 600,\n            color: 'var(--text)',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          @{username}\n        </div>\n        <div\n          style={{\n            fontSize: 11,\n            color: isOnline ? '#10b981' : '#64748b',\n          }}\n        >\n          {isOnline ? (\n            'Online now'\n          ) : lastSeen ? (\n            `Last seen ${getTimeAgo(lastSeen)}`\n          ) : (\n            'Offline'\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Online Users Summary (shows count)\n */\ninterface OnlineUsersSummaryProps {\n  onlineUsers: OnlineUser[];\n  totalUsers: number;\n}\n\nexport function OnlineUsersSummary({\n  onlineUsers,\n  totalUsers,\n}: OnlineUsersSummaryProps) {\n  const onlineCount = onlineUsers.filter(u => u.is_online).length;\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n        padding: '4px 10px',\n        background: onlineCount > 0 ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n        border: `1px solid ${onlineCount > 0 ? '#10b981' : '#64748b'}`,\n        borderRadius: 12,\n        fontSize: 11,\n        fontWeight: 600,\n      }}\n      title={`${onlineCount} online, ${totalUsers - onlineCount} offline`}\n    >\n      <div\n        style={{\n          width: 6,\n          height: 6,\n          borderRadius: '50%',\n          background: onlineCount > 0 ? '#10b981' : '#64748b',\n        }}\n      />\n      <span style={{ color: onlineCount > 0 ? '#10b981' : '#64748b' }}>\n        {onlineCount} / {totalUsers} online\n      </span>\n    </div>\n  );\n}\n\nexport default OnlineStatus;\n","/**\n * EditingIndicator Component\n * Shows when users are currently editing a section\n */\n\nimport React from 'react';\nimport { CurrentlyEditing, getTimeAgo } from '../../services/activityService';\n\ninterface EditingIndicatorProps {\n  sectionId: number;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number; // To exclude current user from display\n}\n\n/**\n * Show editing indicator for a specific section\n */\nexport function EditingIndicator({\n  sectionId,\n  currentlyEditing,\n  currentUserId,\n}: EditingIndicatorProps) {\n  // Filter editors for this section (excluding current user)\n  const editors = currentlyEditing.filter(\n    e => e.section_id === sectionId && e.user_id !== currentUserId\n  );\n\n  if (editors.length === 0) {\n    return null;\n  }\n\n  const editor = editors[0]; // Show first editor\n  const othersCount = editors.length - 1;\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 8,\n        padding: '6px 12px',\n        background: 'rgba(251, 191, 36, 0.1)',\n        border: '1px solid #f59e0b',\n        borderRadius: 8,\n        fontSize: 12,\n        color: '#f59e0b',\n        fontWeight: 600,\n      }}\n      role=\"status\"\n      aria-live=\"polite\"\n    >\n      <span\n        style={{\n          display: 'inline-block',\n          animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n        }}\n      >\n        â³\n      </span>\n      <span>\n        @{editor.username} is editing\n        {othersCount > 0 && ` +${othersCount} other${othersCount > 1 ? 's' : ''}`}\n      </span>\n\n      <style>{`\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      `}</style>\n    </div>\n  );\n}\n\n/**\n * Show available to edit indicator\n */\ninterface AvailableToEditProps {\n  canEdit: boolean;\n}\n\nexport function AvailableToEdit({ canEdit }: AvailableToEditProps) {\n  if (!canEdit) {\n    return (\n      <div\n        style={{\n          display: 'inline-flex',\n          alignItems: 'center',\n          gap: 6,\n          padding: '6px 12px',\n          background: 'rgba(100, 116, 139, 0.1)',\n          border: '1px solid #64748b',\n          borderRadius: 8,\n          fontSize: 12,\n          color: '#64748b',\n          fontWeight: 600,\n        }}\n      >\n        ðŸ”’ Read only\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n        padding: '6px 12px',\n        background: 'rgba(16, 185, 129, 0.1)',\n        border: '1px solid #10b981',\n        borderRadius: 8,\n        fontSize: 12,\n        color: '#10b981',\n        fontWeight: 600,\n      }}\n    >\n      âœï¸ Available to edit\n    </div>\n  );\n}\n\n/**\n * Section Header with Editing Indicator\n * Combines section info with real-time editing status\n */\ninterface SectionHeaderWithStatusProps {\n  sectionNumber: number;\n  sectionTitle: string;\n  sectionId: number;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number;\n  canEdit: boolean;\n}\n\nexport function SectionHeaderWithStatus({\n  sectionNumber,\n  sectionTitle,\n  sectionId,\n  currentlyEditing,\n  currentUserId,\n  canEdit,\n}: SectionHeaderWithStatusProps) {\n  const editors = currentlyEditing.filter(\n    e => e.section_id === sectionId && e.user_id !== currentUserId\n  );\n\n  const isBeingEdited = editors.length > 0;\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        marginBottom: 12,\n        flexWrap: 'wrap',\n        gap: 12,\n      }}\n    >\n      {/* Section Title */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <h4\n          style={{\n            margin: 0,\n            fontSize: 16,\n            fontWeight: 700,\n            color: 'var(--text)',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          Section {sectionNumber}: {sectionTitle}\n        </h4>\n      </div>\n\n      {/* Status Indicators */}\n      <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n        {isBeingEdited ? (\n          <EditingIndicator\n            sectionId={sectionId}\n            currentlyEditing={currentlyEditing}\n            currentUserId={currentUserId}\n          />\n        ) : (\n          <AvailableToEdit canEdit={canEdit} />\n        )}\n      </div>\n    </div>\n  );\n}\n\n/**\n * Typing indicator with animated dots\n */\ninterface TypingIndicatorProps {\n  username: string;\n}\n\nexport function TypingIndicator({ username }: TypingIndicatorProps) {\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 8,\n        padding: '4px 10px',\n        background: 'rgba(59, 130, 246, 0.1)',\n        border: '1px solid #3b82f6',\n        borderRadius: 12,\n        fontSize: 11,\n        color: '#3b82f6',\n        fontWeight: 600,\n      }}\n      role=\"status\"\n      aria-live=\"polite\"\n    >\n      <span>@{username} is typing</span>\n      <span\n        style={{\n          display: 'inline-flex',\n          gap: 2,\n        }}\n      >\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot1 1.4s infinite',\n          }}\n        />\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot2 1.4s infinite',\n          }}\n        />\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot3 1.4s infinite',\n          }}\n        />\n      </span>\n\n      <style>{`\n        @keyframes dot1 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          30% { opacity: 1; transform: translateY(-4px); }\n        }\n        @keyframes dot2 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          40% { opacity: 1; transform: translateY(-4px); }\n        }\n        @keyframes dot3 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          50% { opacity: 1; transform: translateY(-4px); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\n/**\n * List of all currently editing users\n */\ninterface CurrentlyEditingListProps {\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number;\n}\n\nexport function CurrentlyEditingList({\n  currentlyEditing,\n  currentUserId,\n}: CurrentlyEditingListProps) {\n  // Filter out current user\n  const editors = currentlyEditing.filter(e => e.user_id !== currentUserId);\n\n  if (editors.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 16,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 12,\n        }}\n      >\n        No one is currently editing\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 8,\n      }}\n    >\n      {editors.map((editor, index) => (\n        <div\n          key={`${editor.user_id}-${editor.section_id}-${index}`}\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 10,\n            padding: '8px 12px',\n            background: 'rgba(251, 191, 36, 0.05)',\n            border: '1px solid rgba(251, 191, 36, 0.2)',\n            borderRadius: 8,\n          }}\n        >\n          <span\n            style={{\n              fontSize: 16,\n              animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n            }}\n          >\n            â³\n          </span>\n\n          <div style={{ flex: 1, minWidth: 0 }}>\n            <div\n              style={{\n                fontSize: 12,\n                fontWeight: 600,\n                color: 'var(--text)',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              @{editor.username}\n            </div>\n            <div\n              style={{\n                fontSize: 11,\n                color: '#94a3b8',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              Editing: {editor.section_title}\n            </div>\n          </div>\n\n          <div\n            style={{\n              fontSize: 10,\n              color: '#64748b',\n            }}\n          >\n            {getTimeAgo(editor.started_at)}\n          </div>\n        </div>\n      ))}\n\n      <style>{`\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default EditingIndicator;\n","/**\n * ActivityFeed Component\n * Shows recent project activities\n */\n\nimport React from 'react';\nimport {\n  Activity,\n  ActivityType,\n  getActivityIcon,\n  getActivityColor,\n  getTimeAgo,\n} from '../../services/activityService';\n\ninterface ActivityFeedProps {\n  activities: Activity[];\n  maxItems?: number;\n  showAvatar?: boolean;\n  compact?: boolean;\n}\n\n/**\n * Activity Feed - shows list of recent activities\n */\nexport function ActivityFeed({\n  activities,\n  maxItems = 20,\n  showAvatar = true,\n  compact = false,\n}: ActivityFeedProps) {\n  const displayActivities = activities.slice(0, maxItems);\n\n  if (displayActivities.length === 0) {\n    return (\n      <div\n        style={{\n          padding: compact ? 16 : 32,\n          textAlign: 'center',\n          color: '#64748b',\n        }}\n      >\n        <div style={{ fontSize: compact ? 32 : 48, marginBottom: 8 }}>ðŸ“‹</div>\n        <div style={{ fontSize: compact ? 12 : 14, fontWeight: 600, marginBottom: 4 }}>\n          No activity yet\n        </div>\n        <div style={{ fontSize: compact ? 11 : 12, color: '#64748b' }}>\n          Project activities will appear here\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: compact ? 6 : 8,\n      }}\n    >\n      {displayActivities.map((activity) => (\n        <ActivityItem\n          key={activity.id}\n          activity={activity}\n          showAvatar={showAvatar}\n          compact={compact}\n        />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Single Activity Item\n */\ninterface ActivityItemProps {\n  activity: Activity;\n  showAvatar?: boolean;\n  compact?: boolean;\n}\n\nfunction ActivityItem({ activity, showAvatar = true, compact = false }: ActivityItemProps) {\n  const icon = getActivityIcon(activity.activity_type);\n  const color = getActivityColor(activity.activity_type);\n  const timeAgo = getTimeAgo(activity.created_at);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: compact ? 'center' : 'flex-start',\n        gap: compact ? 8 : 12,\n        padding: compact ? '8px 12px' : '12px 16px',\n        background: 'var(--bg)',\n        border: '1px solid var(--panel-border)',\n        borderLeft: `3px solid ${color}`,\n        borderRadius: 8,\n        transition: 'all 0.2s',\n        cursor: 'pointer',\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = 'var(--panel)';\n        e.currentTarget.style.borderLeftColor = color;\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = 'var(--bg)';\n        e.currentTarget.style.borderLeftColor = color;\n      }}\n    >\n      {/* Icon or Avatar */}\n      {showAvatar ? (\n        <div\n          style={{\n            position: 'relative',\n            width: compact ? 28 : 36,\n            height: compact ? 28 : 36,\n            borderRadius: '50%',\n            background: activity.avatar\n              ? `url(${activity.avatar}) center/cover`\n              : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#fff',\n            fontSize: compact ? 12 : 14,\n            fontWeight: 700,\n            flexShrink: 0,\n          }}\n        >\n          {!activity.avatar && activity.username.charAt(0).toUpperCase()}\n\n          {/* Activity type badge */}\n          <div\n            style={{\n              position: 'absolute',\n              bottom: -2,\n              right: -2,\n              width: compact ? 14 : 16,\n              height: compact ? 14 : 16,\n              borderRadius: '50%',\n              background: `${color}`,\n              border: '2px solid var(--bg)',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              fontSize: compact ? 8 : 9,\n            }}\n          >\n            {icon}\n          </div>\n        </div>\n      ) : (\n        <div\n          style={{\n            width: compact ? 24 : 32,\n            height: compact ? 24 : 32,\n            borderRadius: 8,\n            background: `${color}20`,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: compact ? 14 : 16,\n            flexShrink: 0,\n          }}\n        >\n          {icon}\n        </div>\n      )}\n\n      {/* Content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            fontSize: compact ? 12 : 13,\n            fontWeight: 600,\n            color: 'var(--text)',\n            marginBottom: compact ? 2 : 4,\n            lineHeight: 1.4,\n          }}\n        >\n          {activity.description}\n        </div>\n\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            fontSize: compact ? 10 : 11,\n            color: '#64748b',\n          }}\n        >\n          <span>@{activity.username}</span>\n          {activity.section_title && (\n            <>\n              <span>â€¢</span>\n              <span style={{ color: '#94a3b8' }}>{activity.section_title}</span>\n            </>\n          )}\n          <span>â€¢</span>\n          <span>{timeAgo}</span>\n        </div>\n      </div>\n\n      {/* Activity type badge (for non-avatar mode) */}\n      {!showAvatar && !compact && (\n        <div\n          style={{\n            padding: '2px 8px',\n            background: `${color}20`,\n            color: color,\n            fontSize: 10,\n            fontWeight: 700,\n            borderRadius: 4,\n            textTransform: 'uppercase',\n            flexShrink: 0,\n          }}\n        >\n          {activity.activity_type.replace(/_/g, ' ')}\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Activity Feed Panel - with header and filters\n */\ninterface ActivityFeedPanelProps {\n  activities: Activity[];\n  isLoading?: boolean;\n  onRefresh?: () => void;\n  filterType?: ActivityType | 'all';\n  onFilterChange?: (type: ActivityType | 'all') => void;\n}\n\nexport function ActivityFeedPanel({\n  activities,\n  isLoading = false,\n  onRefresh,\n  filterType = 'all',\n  onFilterChange,\n}: ActivityFeedPanelProps) {\n  // Filter activities by type\n  const filteredActivities =\n    filterType === 'all'\n      ? activities\n      : activities.filter(a => a.activity_type === filterType);\n\n  const activityTypes: Array<ActivityType | 'all'> = [\n    'all',\n    'section_updated',\n    'comment_added',\n    'collaborator_joined',\n    'approval_given',\n  ];\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          marginBottom: 16,\n          paddingBottom: 12,\n          borderBottom: '1px solid var(--panel-border)',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <h3\n            style={{\n              margin: 0,\n              fontSize: 16,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            Recent Activity\n          </h3>\n          {isLoading && (\n            <div\n              style={{\n                fontSize: 12,\n                color: '#f59e0b',\n                fontWeight: 600,\n              }}\n            >\n              Updating...\n            </div>\n          )}\n        </div>\n\n        {onRefresh && (\n          <button\n            onClick={onRefresh}\n            disabled={isLoading}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 6,\n              padding: '4px 12px',\n              color: '#94a3b8',\n              cursor: isLoading ? 'not-allowed' : 'pointer',\n              fontSize: 11,\n              fontWeight: 600,\n              opacity: isLoading ? 0.5 : 1,\n            }}\n          >\n            ðŸ”„ Refresh\n          </button>\n        )}\n      </div>\n\n      {/* Filters */}\n      {onFilterChange && (\n        <div\n          style={{\n            display: 'flex',\n            gap: 6,\n            marginBottom: 12,\n            flexWrap: 'wrap',\n          }}\n        >\n          {activityTypes.map((type) => {\n            const isActive = filterType === type;\n            return (\n              <button\n                key={type}\n                onClick={() => onFilterChange(type)}\n                style={{\n                  background: isActive ? '#3b82f6' : 'transparent',\n                  color: isActive ? '#fff' : '#94a3b8',\n                  border: `1px solid ${isActive ? '#3b82f6' : 'var(--panel-border)'}`,\n                  borderRadius: 6,\n                  padding: '4px 10px',\n                  fontSize: 10,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  textTransform: 'capitalize',\n                  transition: 'all 0.2s',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isActive) {\n                    e.currentTarget.style.borderColor = '#3b82f6';\n                    e.currentTarget.style.color = '#3b82f6';\n                  }\n                }}\n                onMouseLeave={(e) => {\n                  if (!isActive) {\n                    e.currentTarget.style.borderColor = 'var(--panel-border)';\n                    e.currentTarget.style.color = '#94a3b8';\n                  }\n                }}\n              >\n                {type === 'all' ? 'All' : type.replace(/_/g, ' ')}\n              </button>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Activity List */}\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n        }}\n      >\n        <ActivityFeed activities={filteredActivities} maxItems={50} />\n      </div>\n    </div>\n  );\n}\n\n/**\n * Compact Activity Summary - for sidebar\n */\ninterface ActivitySummaryProps {\n  activities: Activity[];\n  maxItems?: number;\n}\n\nexport function ActivitySummary({ activities, maxItems = 5 }: ActivitySummaryProps) {\n  const recentActivities = activities.slice(0, maxItems);\n\n  if (recentActivities.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 12,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 11,\n        }}\n      >\n        No recent activity\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 6,\n      }}\n    >\n      {recentActivities.map((activity) => {\n        const icon = getActivityIcon(activity.activity_type);\n        const color = getActivityColor(activity.activity_type);\n        const timeAgo = getTimeAgo(activity.created_at);\n\n        return (\n          <div\n            key={activity.id}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              fontSize: 11,\n              color: '#cbd5e1',\n              lineHeight: 1.4,\n            }}\n          >\n            <span style={{ fontSize: 12 }}>{icon}</span>\n            <div style={{ flex: 1, minWidth: 0 }}>\n              <span style={{ fontWeight: 600, color: color }}>\n                @{activity.username}\n              </span>{' '}\n              <span style={{ color: '#94a3b8' }}>\n                {activity.description.toLowerCase()}\n              </span>\n              <div style={{ fontSize: 10, color: '#64748b', marginTop: 2 }}>\n                {timeAgo}\n              </div>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default ActivityFeed;\n","/**\n * CommentComposer Component\n * Rich text composer for adding comments with @mentions and file attachments\n */\n\nimport React, { useState, useRef, useEffect, KeyboardEvent } from 'react';\nimport { CollaboratorRole } from '../../services/collaborationApi';\n\ninterface CommentComposerProps {\n  projectId: number;\n  sectionId?: number;\n  parentCommentId?: number;\n  collaborators: CollaboratorRole[];\n  placeholder?: string;\n  autoFocus?: boolean;\n  onSubmit: (content: string, mentions: number[], attachments?: File[]) => Promise<void>;\n  onCancel?: () => void;\n  initialValue?: string;\n  submitButtonText?: string;\n  compact?: boolean;\n}\n\ninterface MentionSuggestion {\n  userId: number;\n  username: string;\n  displayName: string;\n  avatar?: string;\n}\n\nexport function CommentComposer({\n  projectId,\n  sectionId,\n  parentCommentId,\n  collaborators,\n  placeholder = 'Add a comment...',\n  autoFocus = false,\n  onSubmit,\n  onCancel,\n  initialValue = '',\n  submitButtonText = 'Comment',\n  compact = false,\n}: CommentComposerProps) {\n  const [content, setContent] = useState(initialValue);\n  const [mentions, setMentions] = useState<number[]>([]);\n  const [attachments, setAttachments] = useState<File[]>([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // @mention autocomplete\n  const [showMentions, setShowMentions] = useState(false);\n  const [mentionQuery, setMentionQuery] = useState('');\n  const [mentionSuggestions, setMentionSuggestions] = useState<MentionSuggestion[]>([]);\n  const [selectedMentionIndex, setSelectedMentionIndex] = useState(0);\n  const [mentionStart, setMentionStart] = useState<number | null>(null);\n\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Convert collaborators to mention suggestions\n  const allSuggestions: MentionSuggestion[] = collaborators\n    .filter(c => c.status === 'accepted')\n    .map(c => ({\n      userId: c.user,\n      username: c.username,\n      displayName: c.display_name || c.username,\n      avatar: undefined, // Add avatar support if available\n    }));\n\n  // Handle content change and detect @mentions\n  const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const newContent = e.target.value;\n    setContent(newContent);\n\n    const cursorPosition = e.target.selectionStart;\n    const textBeforeCursor = newContent.slice(0, cursorPosition);\n\n    // Check if we're typing an @mention\n    const lastAtSymbol = textBeforeCursor.lastIndexOf('@');\n    if (lastAtSymbol !== -1) {\n      const textAfterAt = textBeforeCursor.slice(lastAtSymbol + 1);\n\n      // Check if there's a space after @ (which ends the mention)\n      if (!textAfterAt.includes(' ') && !textAfterAt.includes('\\n')) {\n        const query = textAfterAt.toLowerCase();\n        setMentionQuery(query);\n        setMentionStart(lastAtSymbol);\n\n        // Filter suggestions\n        const filtered = allSuggestions.filter(\n          s =>\n            s.username.toLowerCase().includes(query) ||\n            s.displayName.toLowerCase().includes(query)\n        );\n\n        setMentionSuggestions(filtered);\n        setShowMentions(filtered.length > 0);\n        setSelectedMentionIndex(0);\n        return;\n      }\n    }\n\n    // Hide mentions if not in mention mode\n    setShowMentions(false);\n  };\n\n  // Handle keyboard navigation in mention dropdown\n  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (showMentions) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedMentionIndex(prev =>\n          prev < mentionSuggestions.length - 1 ? prev + 1 : prev\n        );\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedMentionIndex(prev => (prev > 0 ? prev - 1 : prev));\n      } else if (e.key === 'Enter' || e.key === 'Tab') {\n        e.preventDefault();\n        if (mentionSuggestions[selectedMentionIndex]) {\n          insertMention(mentionSuggestions[selectedMentionIndex]);\n        }\n      } else if (e.key === 'Escape') {\n        setShowMentions(false);\n      }\n    } else if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n      // Cmd+Enter or Ctrl+Enter to submit\n      e.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  // Insert mention into text\n  const insertMention = (suggestion: MentionSuggestion) => {\n    if (mentionStart === null) return;\n\n    const beforeMention = content.slice(0, mentionStart);\n    const afterCursor = content.slice(textareaRef.current?.selectionStart || content.length);\n    const newContent = `${beforeMention}@${suggestion.username} ${afterCursor}`;\n\n    setContent(newContent);\n    setShowMentions(false);\n\n    // Add to mentions list\n    if (!mentions.includes(suggestion.userId)) {\n      setMentions([...mentions, suggestion.userId]);\n    }\n\n    // Move cursor after mention\n    setTimeout(() => {\n      const newPosition = mentionStart + suggestion.username.length + 2;\n      textareaRef.current?.setSelectionRange(newPosition, newPosition);\n      textareaRef.current?.focus();\n    }, 0);\n  };\n\n  // Handle file attachment\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const newFiles = Array.from(e.target.files);\n      setAttachments([...attachments, ...newFiles]);\n    }\n  };\n\n  // Remove attachment\n  const removeAttachment = (index: number) => {\n    setAttachments(attachments.filter((_, i) => i !== index));\n  };\n\n  // Submit comment\n  const handleSubmit = async () => {\n    if (!content.trim() && attachments.length === 0) return;\n\n    setIsSubmitting(true);\n    try {\n      await onSubmit(content, mentions, attachments.length > 0 ? attachments : undefined);\n\n      // Clear form\n      setContent('');\n      setMentions([]);\n      setAttachments([]);\n    } catch (error) {\n      console.error('Failed to submit comment:', error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Auto-focus\n  useEffect(() => {\n    if (autoFocus && textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  }, [autoFocus]);\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: compact ? 8 : 12,\n        padding: compact ? 12 : 16,\n        position: 'relative',\n      }}\n    >\n      {/* Textarea */}\n      <div style={{ position: 'relative' }}>\n        <textarea\n          ref={textareaRef}\n          value={content}\n          onChange={handleContentChange}\n          onKeyDown={handleKeyDown}\n          placeholder={placeholder}\n          style={{\n            width: '100%',\n            minHeight: compact ? 60 : 80,\n            maxHeight: 200,\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n            padding: 10,\n            color: 'var(--text)',\n            fontSize: compact ? 12 : 13,\n            lineHeight: 1.5,\n            resize: 'vertical',\n            outline: 'none',\n            fontFamily: 'inherit',\n          }}\n        />\n\n        {/* @mention autocomplete dropdown */}\n        {showMentions && (\n          <div\n            style={{\n              position: 'absolute',\n              bottom: '100%',\n              left: 0,\n              marginBottom: 4,\n              minWidth: 200,\n              maxWidth: 300,\n              background: '#1e293b',\n              border: '1px solid #334155',\n              borderRadius: 8,\n              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n              maxHeight: 200,\n              overflowY: 'auto',\n              zIndex: 1000,\n            }}\n          >\n            {mentionSuggestions.map((suggestion, index) => (\n              <div\n                key={suggestion.userId}\n                onClick={() => insertMention(suggestion)}\n                style={{\n                  padding: '8px 12px',\n                  cursor: 'pointer',\n                  background: index === selectedMentionIndex ? '#334155' : 'transparent',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 8,\n                  transition: 'background 0.2s',\n                }}\n                onMouseEnter={() => setSelectedMentionIndex(index)}\n              >\n                {/* Avatar placeholder */}\n                <div\n                  style={{\n                    width: 24,\n                    height: 24,\n                    borderRadius: '50%',\n                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 11,\n                    fontWeight: 700,\n                  }}\n                >\n                  {suggestion.username.charAt(0).toUpperCase()}\n                </div>\n\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div\n                    style={{\n                      fontSize: 13,\n                      fontWeight: 600,\n                      color: '#e5e7eb',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      whiteSpace: 'nowrap',\n                    }}\n                  >\n                    @{suggestion.username}\n                  </div>\n                  {suggestion.displayName !== suggestion.username && (\n                    <div\n                      style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}\n                    >\n                      {suggestion.displayName}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Attachments */}\n      {attachments.length > 0 && (\n        <div\n          style={{\n            marginTop: 8,\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 6,\n          }}\n        >\n          {attachments.map((file, index) => (\n            <div\n              key={`${file.name}-${file.size}`}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                padding: '6px 10px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                fontSize: 12,\n              }}\n            >\n              <span>ðŸ“Ž</span>\n              <span\n                style={{\n                  flex: 1,\n                  color: 'var(--text)',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {file.name}\n              </span>\n              <span style={{ color: '#64748b', fontSize: 11 }}>\n                {(file.size / 1024).toFixed(1)} KB\n              </span>\n              <button\n                onClick={() => removeAttachment(index)}\n                style={{\n                  background: 'transparent',\n                  border: 'none',\n                  color: '#ef4444',\n                  cursor: 'pointer',\n                  fontSize: 16,\n                  padding: 0,\n                  lineHeight: 1,\n                }}\n              >\n                Ã—\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Actions */}\n      <div\n        style={{\n          marginTop: 12,\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          gap: 8,\n        }}\n      >\n        {/* Left actions */}\n        <div>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            style={{ display: 'none' }}\n            onChange={handleFileSelect}\n          />\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={isSubmitting}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 6,\n              padding: compact ? '4px 10px' : '6px 12px',\n              color: '#94a3b8',\n              cursor: isSubmitting ? 'not-allowed' : 'pointer',\n              fontSize: compact ? 11 : 12,\n              fontWeight: 600,\n              display: 'flex',\n              alignItems: 'center',\n              gap: 6,\n            }}\n          >\n            ðŸ“Ž Attach\n          </button>\n        </div>\n\n        {/* Right actions */}\n        <div style={{ display: 'flex', gap: 8 }}>\n          {onCancel && (\n            <button\n              onClick={onCancel}\n              disabled={isSubmitting}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                padding: compact ? '4px 12px' : '6px 16px',\n                color: '#94a3b8',\n                cursor: isSubmitting ? 'not-allowed' : 'pointer',\n                fontSize: compact ? 11 : 12,\n                fontWeight: 600,\n              }}\n            >\n              Cancel\n            </button>\n          )}\n          <button\n            onClick={handleSubmit}\n            disabled={isSubmitting || (!content.trim() && attachments.length === 0)}\n            style={{\n              background: isSubmitting || (!content.trim() && attachments.length === 0)\n                ? '#374151'\n                : '#3b82f6',\n              border: 'none',\n              borderRadius: 6,\n              padding: compact ? '4px 12px' : '6px 16px',\n              color: '#fff',\n              cursor: isSubmitting || (!content.trim() && attachments.length === 0)\n                ? 'not-allowed'\n                : 'pointer',\n              fontSize: compact ? 11 : 12,\n              fontWeight: 700,\n            }}\n          >\n            {isSubmitting ? 'Posting...' : submitButtonText}\n          </button>\n        </div>\n      </div>\n\n      {/* Hint */}\n      {!compact && (\n        <div\n          style={{\n            marginTop: 8,\n            fontSize: 10,\n            color: '#64748b',\n          }}\n        >\n          Tip: Use @ to mention collaborators â€¢ {navigator.platform.includes('Mac') ? 'Cmd' : 'Ctrl'}+Enter to submit\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default CommentComposer;\n","/**\n * CommentReactions Component\n * Displays and manages emoji reactions on comments\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { ProjectComment, CommentReaction } from '../../services/collaborationApi';\n\ninterface CommentReactionsProps {\n  comment: ProjectComment;\n  currentUserId: number;\n  onReaction: (emoji: string) => Promise<void>;\n  onRemoveReaction: (reactionId: number) => Promise<void>;\n}\n\nconst AVAILABLE_EMOJIS = ['ðŸ‘', 'ðŸ‘Ž', 'â¤ï¸', 'ðŸ˜Š', 'ðŸŽ‰', 'ðŸ”¥', 'ðŸ‘€', 'ðŸ¤”'];\n\nexport function CommentReactions({\n  comment,\n  currentUserId,\n  onReaction,\n  onRemoveReaction,\n}: CommentReactionsProps) {\n  const [showPicker, setShowPicker] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const pickerRef = useRef<HTMLDivElement>(null);\n\n  // Group reactions by emoji\n  const groupedReactions: { [emoji: string]: CommentReaction[] } = {};\n  if (comment.reactions) {\n    comment.reactions.forEach((reaction) => {\n      if (!groupedReactions[reaction.emoji]) {\n        groupedReactions[reaction.emoji] = [];\n      }\n      groupedReactions[reaction.emoji].push(reaction);\n    });\n  }\n\n  // Check if current user has reacted with specific emoji\n  const hasUserReacted = (emoji: string): CommentReaction | undefined => {\n    return groupedReactions[emoji]?.find(r => r.user_id === currentUserId);\n  };\n\n  // Handle emoji click\n  const handleEmojiClick = async (emoji: string) => {\n    const existingReaction = hasUserReacted(emoji);\n\n    setIsAdding(true);\n    try {\n      if (existingReaction) {\n        // Remove reaction if already exists\n        await onRemoveReaction(existingReaction.id);\n      } else {\n        // Add new reaction\n        await onReaction(emoji);\n      }\n    } catch (error) {\n      console.error('Failed to toggle reaction:', error);\n    } finally {\n      setIsAdding(false);\n      setShowPicker(false);\n    }\n  };\n\n  // Close picker when clicking outside\n  useEffect(() => {\n    if (!showPicker) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {\n        setShowPicker(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [showPicker]);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        flexWrap: 'wrap',\n        gap: 6,\n        marginTop: 8,\n      }}\n    >\n      {/* Existing reactions */}\n      {Object.entries(groupedReactions).map(([emoji, reactions]) => {\n        const userReaction = hasUserReacted(emoji);\n        const hasReacted = !!userReaction;\n\n        return (\n          <button\n            key={emoji}\n            onClick={() => handleEmojiClick(emoji)}\n            disabled={isAdding}\n            title={reactions.map(r => r.username).join(', ')}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 4,\n              padding: '4px 8px',\n              background: hasReacted ? 'rgba(59, 130, 246, 0.2)' : 'rgba(100, 116, 139, 0.1)',\n              border: `1px solid ${hasReacted ? '#3b82f6' : '#334155'}`,\n              borderRadius: 12,\n              cursor: isAdding ? 'not-allowed' : 'pointer',\n              fontSize: 14,\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              if (!isAdding) {\n                e.currentTarget.style.transform = 'scale(1.05)';\n              }\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.transform = 'scale(1)';\n            }}\n          >\n            <span>{emoji}</span>\n            <span\n              style={{\n                fontSize: 11,\n                fontWeight: 600,\n                color: hasReacted ? '#3b82f6' : '#94a3b8',\n              }}\n            >\n              {reactions.length}\n            </span>\n          </button>\n        );\n      })}\n\n      {/* Add reaction button */}\n      <div style={{ position: 'relative' }}>\n        <button\n          onClick={() => setShowPicker(!showPicker)}\n          disabled={isAdding}\n          style={{\n            padding: '4px 8px',\n            background: 'transparent',\n            border: '1px solid #334155',\n            borderRadius: 12,\n            cursor: isAdding ? 'not-allowed' : 'pointer',\n            fontSize: 14,\n            color: '#94a3b8',\n            transition: 'all 0.2s',\n          }}\n          onMouseEnter={(e) => {\n            if (!isAdding) {\n              e.currentTarget.style.borderColor = '#3b82f6';\n              e.currentTarget.style.color = '#3b82f6';\n            }\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.borderColor = '#334155';\n            e.currentTarget.style.color = '#94a3b8';\n          }}\n        >\n          +\n        </button>\n\n        {/* Emoji picker */}\n        {showPicker && (\n          <div\n            ref={pickerRef}\n            style={{\n              position: 'absolute',\n              bottom: '100%',\n              left: 0,\n              marginBottom: 4,\n              background: '#1e293b',\n              border: '1px solid #334155',\n              borderRadius: 12,\n              padding: 8,\n              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n              display: 'grid',\n              gridTemplateColumns: 'repeat(4, 1fr)',\n              gap: 4,\n              zIndex: 100,\n            }}\n          >\n            {AVAILABLE_EMOJIS.map((emoji) => (\n              <button\n                key={emoji}\n                onClick={() => handleEmojiClick(emoji)}\n                disabled={isAdding}\n                style={{\n                  width: 40,\n                  height: 40,\n                  padding: 0,\n                  background: hasUserReacted(emoji) ? 'rgba(59, 130, 246, 0.2)' : 'transparent',\n                  border: hasUserReacted(emoji) ? '1px solid #3b82f6' : '1px solid transparent',\n                  borderRadius: 8,\n                  cursor: isAdding ? 'not-allowed' : 'pointer',\n                  fontSize: 20,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  transition: 'all 0.2s',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isAdding) {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.1)';\n                    e.currentTarget.style.transform = 'scale(1.1)';\n                  }\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.background = hasUserReacted(emoji)\n                    ? 'rgba(59, 130, 246, 0.2)'\n                    : 'transparent';\n                  e.currentTarget.style.transform = 'scale(1)';\n                }}\n              >\n                {emoji}\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CommentReactions;\n","/**\n * CommentThread Component\n * Displays threaded comments with replies, reactions, and actions\n */\n\nimport React, { useState } from 'react';\nimport { ProjectComment, CollaboratorRole } from '../../services/collaborationApi';\nimport { getTimeAgo } from '../../services/activityService';\nimport CommentComposer from './CommentComposer';\nimport CommentReactions from './CommentReactions';\n\ninterface CommentThreadProps {\n  comment: ProjectComment;\n  projectId: number;\n  currentUserId: number;\n  collaborators: CollaboratorRole[];\n  depth?: number;\n  maxDepth?: number;\n  onReply: (parentId: number, content: string, mentions: number[], attachments?: File[]) => Promise<void>;\n  onEdit: (commentId: number, content: string) => Promise<ProjectComment | void>;\n  onDelete: (commentId: number) => Promise<ProjectComment | void>;\n  onResolve: (commentId: number) => Promise<ProjectComment | void>;\n  onUnresolve: (commentId: number) => Promise<ProjectComment | void>;\n  onReaction: (commentId: number, emoji: string) => Promise<void>;\n  onRemoveReaction: (commentId: number, reactionId: number) => Promise<void>;\n}\n\nexport function CommentThread({\n  comment,\n  projectId,\n  currentUserId,\n  collaborators,\n  depth = 0,\n  maxDepth = 3,\n  onReply,\n  onEdit,\n  onDelete,\n  onResolve,\n  onUnresolve,\n  onReaction,\n  onRemoveReaction,\n}: CommentThreadProps) {\n  const [showReplyComposer, setShowReplyComposer] = useState(false);\n  const [showEditComposer, setShowEditComposer] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showEditHistory, setShowEditHistory] = useState(false);\n\n  const isAuthor = comment.author === currentUserId;\n  const canReply = depth < maxDepth;\n\n  // Handle reply\n  const handleReply = async (content: string, mentions: number[], attachments?: File[]) => {\n    await onReply(comment.id, content, mentions, attachments);\n    setShowReplyComposer(false);\n  };\n\n  // Handle edit\n  const handleEdit = async (content: string) => {\n    await onEdit(comment.id, content);\n    setShowEditComposer(false);\n  };\n\n  // Handle delete\n  const handleDelete = async () => {\n    if (confirm('Are you sure you want to delete this comment?')) {\n      await onDelete(comment.id);\n    }\n    setShowMenu(false);\n  };\n\n  // Handle resolve/unresolve\n  const handleResolve = async () => {\n    if (comment.resolved) {\n      await onUnresolve(comment.id);\n    } else {\n      await onResolve(comment.id);\n    }\n    setShowMenu(false);\n  };\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        gap: 12,\n        opacity: comment.resolved ? 0.6 : 1,\n        transition: 'opacity 0.2s',\n      }}\n    >\n      {/* Indent line for replies */}\n      {depth > 0 && (\n        <div\n          style={{\n            width: 2,\n            background: '#334155',\n            flexShrink: 0,\n            marginLeft: 16,\n          }}\n        />\n      )}\n\n      {/* Comment content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            background: 'var(--bg)',\n            border: `1px solid ${comment.resolved ? '#10b981' : 'var(--panel-border)'}`,\n            borderRadius: 8,\n            padding: 12,\n          }}\n        >\n          {/* Header */}\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              marginBottom: 8,\n            }}\n          >\n            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n              {/* Avatar */}\n              <div\n                style={{\n                  width: 28,\n                  height: 28,\n                  borderRadius: '50%',\n                  background: comment.author_avatar\n                    ? `url(${comment.author_avatar}) center/cover`\n                    : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: '#fff',\n                  fontSize: 12,\n                  fontWeight: 700,\n                }}\n              >\n                {!comment.author_avatar && comment.author_username.charAt(0).toUpperCase()}\n              </div>\n\n              {/* Author & timestamp */}\n              <div>\n                <span\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                  }}\n                >\n                  @{comment.author_username}\n                </span>\n                {comment.edited && (\n                  <span\n                    style={{\n                      marginLeft: 6,\n                      fontSize: 11,\n                      color: '#64748b',\n                      cursor: comment.edit_history ? 'pointer' : 'default',\n                    }}\n                    onClick={() => comment.edit_history && setShowEditHistory(!showEditHistory)}\n                    title={comment.edit_history ? 'Click to see edit history' : undefined}\n                  >\n                    (edited)\n                  </span>\n                )}\n              </div>\n\n              <span style={{ fontSize: 11, color: '#64748b' }}>â€¢</span>\n              <span style={{ fontSize: 11, color: '#64748b' }}>\n                {getTimeAgo(comment.created_at)}\n              </span>\n\n              {/* Section indicator */}\n              {comment.section_title && (\n                <>\n                  <span style={{ fontSize: 11, color: '#64748b' }}>â€¢</span>\n                  <span\n                    style={{\n                      fontSize: 10,\n                      color: '#94a3b8',\n                      background: 'rgba(59, 130, 246, 0.1)',\n                      padding: '2px 6px',\n                      borderRadius: 4,\n                    }}\n                  >\n                    {comment.section_title}\n                  </span>\n                </>\n              )}\n\n              {/* Resolved badge */}\n              {comment.resolved && (\n                <span\n                  style={{\n                    fontSize: 10,\n                    color: '#10b981',\n                    background: 'rgba(16, 185, 129, 0.1)',\n                    padding: '2px 6px',\n                    borderRadius: 4,\n                    fontWeight: 600,\n                  }}\n                  title={\n                    comment.resolved_by_username\n                      ? `Resolved by @${comment.resolved_by_username}`\n                      : 'Resolved'\n                  }\n                >\n                  âœ“ Resolved\n                </span>\n              )}\n            </div>\n\n            {/* Menu button */}\n            <div style={{ position: 'relative' }}>\n              <button\n                onClick={() => setShowMenu(!showMenu)}\n                style={{\n                  background: 'transparent',\n                  border: 'none',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                  fontSize: 18,\n                  padding: '2px 6px',\n                  lineHeight: 1,\n                }}\n              >\n                â‹®\n              </button>\n\n              {/* Dropdown menu */}\n              {showMenu && (\n                <div\n                  style={{\n                    position: 'absolute',\n                    top: '100%',\n                    right: 0,\n                    marginTop: 4,\n                    background: '#1e293b',\n                    border: '1px solid #334155',\n                    borderRadius: 8,\n                    boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n                    minWidth: 150,\n                    zIndex: 100,\n                  }}\n                >\n                  {isAuthor && (\n                    <>\n                      <button\n                        onClick={() => {\n                          setShowEditComposer(true);\n                          setShowMenu(false);\n                        }}\n                        style={{\n                          width: '100%',\n                          background: 'transparent',\n                          border: 'none',\n                          color: '#e5e7eb',\n                          padding: '8px 12px',\n                          textAlign: 'left',\n                          cursor: 'pointer',\n                          fontSize: 13,\n                        }}\n                        onMouseEnter={(e) => {\n                          e.currentTarget.style.background = '#334155';\n                        }}\n                        onMouseLeave={(e) => {\n                          e.currentTarget.style.background = 'transparent';\n                        }}\n                      >\n                        âœï¸ Edit\n                      </button>\n                      <button\n                        onClick={handleDelete}\n                        style={{\n                          width: '100%',\n                          background: 'transparent',\n                          border: 'none',\n                          color: '#ef4444',\n                          padding: '8px 12px',\n                          textAlign: 'left',\n                          cursor: 'pointer',\n                          fontSize: 13,\n                        }}\n                        onMouseEnter={(e) => {\n                          e.currentTarget.style.background = '#334155';\n                        }}\n                        onMouseLeave={(e) => {\n                          e.currentTarget.style.background = 'transparent';\n                        }}\n                      >\n                        ðŸ—‘ï¸ Delete\n                      </button>\n                    </>\n                  )}\n                  <button\n                    onClick={handleResolve}\n                    style={{\n                      width: '100%',\n                      background: 'transparent',\n                      border: 'none',\n                      color: comment.resolved ? '#94a3b8' : '#10b981',\n                      padding: '8px 12px',\n                      textAlign: 'left',\n                      cursor: 'pointer',\n                      fontSize: 13,\n                    }}\n                    onMouseEnter={(e) => {\n                      e.currentTarget.style.background = '#334155';\n                    }}\n                    onMouseLeave={(e) => {\n                      e.currentTarget.style.background = 'transparent';\n                    }}\n                  >\n                    {comment.resolved ? 'â†©ï¸ Unresolve' : 'âœ“ Resolve'}\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Edit history */}\n          {showEditHistory && comment.edit_history && comment.edit_history.length > 0 && (\n            <div\n              style={{\n                marginBottom: 8,\n                padding: 8,\n                background: 'rgba(100, 116, 139, 0.1)',\n                border: '1px solid #334155',\n                borderRadius: 6,\n                fontSize: 11,\n                color: '#94a3b8',\n              }}\n            >\n              <div style={{ fontWeight: 600, marginBottom: 4 }}>Edit History:</div>\n              {comment.edit_history.map((edit) => (\n                <div key={edit.edited_at} style={{ marginBottom: 4 }}>\n                  <span style={{ color: '#64748b' }}>\n                    {new Date(edit.edited_at).toLocaleString()}:\n                  </span>{' '}\n                  {edit.content}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Content */}\n          {showEditComposer ? (\n            <CommentComposer\n              projectId={projectId}\n              collaborators={collaborators}\n              onSubmit={async (content) => {\n                await handleEdit(content);\n              }}\n              onCancel={() => setShowEditComposer(false)}\n              initialValue={comment.content}\n              submitButtonText=\"Save\"\n              compact={true}\n            />\n          ) : (\n            <div\n              style={{\n                fontSize: 13,\n                color: '#cbd5e1',\n                lineHeight: 1.6,\n                marginBottom: 8,\n                whiteSpace: 'pre-wrap',\n              }}\n            >\n              {comment.content}\n            </div>\n          )}\n\n          {/* Attachments */}\n          {comment.attachments && comment.attachments.length > 0 && (\n            <div\n              style={{\n                marginTop: 8,\n                marginBottom: 8,\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 6,\n              }}\n            >\n              {comment.attachments.map((attachment) => (\n                <a\n                  key={attachment.id}\n                  href={attachment.file_url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                    padding: '6px 10px',\n                    background: 'rgba(59, 130, 246, 0.1)',\n                    border: '1px solid rgba(59, 130, 246, 0.3)',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    color: '#3b82f6',\n                    textDecoration: 'none',\n                    transition: 'all 0.2s',\n                  }}\n                  onMouseEnter={(e) => {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.2)';\n                  }}\n                  onMouseLeave={(e) => {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.1)';\n                  }}\n                >\n                  <span>ðŸ“Ž</span>\n                  <span style={{ flex: 1 }}>{attachment.filename}</span>\n                  <span style={{ fontSize: 11, color: '#94a3b8' }}>\n                    {(attachment.file_size / 1024).toFixed(1)} KB\n                  </span>\n                </a>\n              ))}\n            </div>\n          )}\n\n          {/* Reactions */}\n          <CommentReactions\n            comment={comment}\n            currentUserId={currentUserId}\n            onReaction={(emoji) => onReaction(comment.id, emoji)}\n            onRemoveReaction={(reactionId) => onRemoveReaction(comment.id, reactionId)}\n          />\n\n          {/* Actions */}\n          {!showEditComposer && (\n            <div\n              style={{\n                marginTop: 8,\n                display: 'flex',\n                gap: 12,\n                fontSize: 12,\n              }}\n            >\n              {canReply && (\n                <button\n                  onClick={() => setShowReplyComposer(!showReplyComposer)}\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    color: '#3b82f6',\n                    cursor: 'pointer',\n                    fontSize: 12,\n                    fontWeight: 600,\n                    padding: 0,\n                  }}\n                >\n                  Reply\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Reply composer */}\n        {showReplyComposer && (\n          <div style={{ marginTop: 12 }}>\n            <CommentComposer\n              projectId={projectId}\n              parentCommentId={comment.id}\n              collaborators={collaborators}\n              placeholder={`Reply to @${comment.author_username}...`}\n              onSubmit={handleReply}\n              onCancel={() => setShowReplyComposer(false)}\n              submitButtonText=\"Reply\"\n              compact={true}\n              autoFocus={true}\n            />\n          </div>\n        )}\n\n        {/* Replies */}\n        {comment.replies && comment.replies.length > 0 && (\n          <div style={{ marginTop: 12, display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {comment.replies.map((reply) => (\n              <CommentThread\n                key={reply.id}\n                comment={reply}\n                projectId={projectId}\n                currentUserId={currentUserId}\n                collaborators={collaborators}\n                depth={depth + 1}\n                maxDepth={maxDepth}\n                onReply={onReply}\n                onEdit={onEdit}\n                onDelete={onDelete}\n                onResolve={onResolve}\n                onUnresolve={onUnresolve}\n                onReaction={onReaction}\n                onRemoveReaction={onRemoveReaction}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CommentThread;\n","/**\n * ApprovalRequestModal Component\n * Modal for requesting approval from collaborators\n */\n\nimport React, { useState } from 'react';\nimport { CollaborativeProject, CollaboratorRole } from '../../services/collaborationApi';\n\ninterface ApprovalRequestModalProps {\n  project: CollaborativeProject;\n  pendingCollaborators: CollaboratorRole[];\n  onClose: () => void;\n  onSubmit: (selectedCollaboratorIds: number[], message: string, deadline: number) => void;\n}\n\nexport function ApprovalRequestModal({\n  project,\n  pendingCollaborators,\n  onClose,\n  onSubmit,\n}: ApprovalRequestModalProps) {\n  const [selectedCollaborators, setSelectedCollaborators] = useState<Set<number>>(\n    new Set(pendingCollaborators.map(c => c.user))\n  );\n  const [message, setMessage] = useState('');\n  const [deadline, setDeadline] = useState(7); // days\n\n  const handleToggleCollaborator = (userId: number) => {\n    const newSelected = new Set(selectedCollaborators);\n    if (newSelected.has(userId)) {\n      newSelected.delete(userId);\n    } else {\n      newSelected.add(userId);\n    }\n    setSelectedCollaborators(newSelected);\n  };\n\n  const handleSubmit = () => {\n    if (selectedCollaborators.size === 0) {\n      alert('Please select at least one collaborator to request approval from.');\n      return;\n    }\n    onSubmit(Array.from(selectedCollaborators), message, deadline);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.7)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n          maxWidth: 500,\n          width: '90%',\n          maxHeight: '80vh',\n          overflow: 'auto',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <h2\n          style={{\n            margin: 0,\n            marginBottom: 20,\n            fontSize: 20,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          Request Approval from Team\n        </h2>\n\n        {/* Collaborator selection */}\n        <div style={{ marginBottom: 20 }}>\n          <div\n            style={{\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 12,\n            }}\n          >\n            Send approval request to:\n          </div>\n\n          {pendingCollaborators.length === 0 ? (\n            <div\n              style={{\n                padding: 16,\n                background: 'rgba(16, 185, 129, 0.1)',\n                border: '1px solid rgba(16, 185, 129, 0.3)',\n                borderRadius: 8,\n                fontSize: 13,\n                color: '#10b981',\n                textAlign: 'center',\n              }}\n            >\n              All collaborators have already approved!\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              {pendingCollaborators.map((collab) => (\n                <label\n                  key={collab.user}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 10,\n                    padding: 12,\n                    background: selectedCollaborators.has(collab.user)\n                      ? 'rgba(59, 130, 246, 0.1)'\n                      : 'var(--bg)',\n                    border: `1px solid ${\n                      selectedCollaborators.has(collab.user)\n                        ? '#3b82f6'\n                        : 'var(--panel-border)'\n                    }`,\n                    borderRadius: 8,\n                    cursor: 'pointer',\n                    transition: 'all 0.2s',\n                  }}\n                  onMouseEnter={(e) => {\n                    if (!selectedCollaborators.has(collab.user)) {\n                      e.currentTarget.style.background = 'rgba(59, 130, 246, 0.05)';\n                    }\n                  }}\n                  onMouseLeave={(e) => {\n                    if (!selectedCollaborators.has(collab.user)) {\n                      e.currentTarget.style.background = 'var(--bg)';\n                    }\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedCollaborators.has(collab.user)}\n                    onChange={() => handleToggleCollaborator(collab.user)}\n                    style={{ cursor: 'pointer' }}\n                  />\n                  <div style={{ flex: 1 }}>\n                    <div\n                      style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: 'var(--text)',\n                      }}\n                    >\n                      @{collab.username}\n                    </div>\n                    <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                      {collab.role}\n                    </div>\n                  </div>\n                </label>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Optional message */}\n        <div style={{ marginBottom: 20 }}>\n          <label\n            style={{\n              display: 'block',\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 8,\n            }}\n          >\n            Message (optional):\n          </label>\n          <textarea\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            placeholder=\"Hi team! I think we're ready to mint this. Please review and approve if you're satisfied.\"\n            style={{\n              width: '100%',\n              minHeight: 100,\n              padding: 12,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 13,\n              fontFamily: 'inherit',\n              resize: 'vertical',\n              outline: 'none',\n            }}\n            onFocus={(e) => {\n              e.currentTarget.style.borderColor = '#3b82f6';\n            }}\n            onBlur={(e) => {\n              e.currentTarget.style.borderColor = 'var(--panel-border)';\n            }}\n          />\n        </div>\n\n        {/* Deadline */}\n        <div style={{ marginBottom: 24 }}>\n          <label\n            style={{\n              display: 'block',\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 8,\n            }}\n          >\n            Approval deadline:\n          </label>\n          <select\n            value={deadline}\n            onChange={(e) => setDeadline(Number(e.target.value))}\n            style={{\n              width: '100%',\n              padding: 12,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 13,\n              cursor: 'pointer',\n              outline: 'none',\n            }}\n            onFocus={(e) => {\n              e.currentTarget.style.borderColor = '#3b82f6';\n            }}\n            onBlur={(e) => {\n              e.currentTarget.style.borderColor = 'var(--panel-border)';\n            }}\n          >\n            <option value={1}>1 day</option>\n            <option value={3}>3 days</option>\n            <option value={7}>7 days</option>\n            <option value={14}>14 days</option>\n            <option value={30}>30 days</option>\n          </select>\n        </div>\n\n        {/* Info note */}\n        <div\n          style={{\n            marginBottom: 20,\n            padding: 12,\n            background: 'rgba(59, 130, 246, 0.1)',\n            border: '1px solid rgba(59, 130, 246, 0.3)',\n            borderRadius: 8,\n            fontSize: 12,\n            color: '#94a3b8',\n            lineHeight: 1.5,\n          }}\n        >\n          Selected collaborators will receive a notification and email with your message. They\n          can approve anytime before the deadline.\n        </div>\n\n        {/* Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={onClose}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = 'var(--bg)';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n            }}\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleSubmit}\n            disabled={pendingCollaborators.length === 0 || selectedCollaborators.size === 0}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? '#374151'\n                  : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'not-allowed'\n                  : 'pointer',\n              boxShadow:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'none'\n                  : '0 4px 12px rgba(59, 130, 246, 0.3)',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              if (pendingCollaborators.length > 0 && selectedCollaborators.size > 0) {\n                e.currentTarget.style.transform = 'translateY(-1px)';\n                e.currentTarget.style.boxShadow = '0 6px 16px rgba(59, 130, 246, 0.4)';\n              }\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.transform = 'translateY(0)';\n              e.currentTarget.style.boxShadow =\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'none'\n                  : '0 4px 12px rgba(59, 130, 246, 0.3)';\n            }}\n          >\n            Send Approval Request\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ApprovalRequestModal;\n","/**\n * IndividualApprovalView Component\n * Interface for individual collaborators to approve a project\n */\n\nimport React, { useState } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\n\ninterface IndividualApprovalViewProps {\n  project: CollaborativeProject;\n  currentUserId: number;\n  onClose: () => void;\n  onApprove: (feedback?: string) => void;\n}\n\nexport function IndividualApprovalView({\n  project,\n  currentUserId,\n  onClose,\n  onApprove,\n}: IndividualApprovalViewProps) {\n  const [approveContent, setApproveContent] = useState(false);\n  const [approveRevenue, setApproveRevenue] = useState(false);\n  const [feedback, setFeedback] = useState('');\n\n  const currentUserCollab = project.collaborators?.find(c => c.user === currentUserId);\n  const hasAlreadyApproved =\n    currentUserCollab?.approved_current_version && currentUserCollab?.approved_revenue_split;\n\n  const canApprove = approveContent && approveRevenue;\n\n  // Calculate project stats\n  const totalSections = project.sections?.length || 0;\n  const completedSections =\n    project.sections?.filter(s => {\n      if (s.section_type === 'text') {\n        return s.content_html && s.content_html.trim() !== '';\n      }\n      return !!s.media_file;\n    }).length || 0;\n\n  const totalRevenue =\n    project.collaborators?.reduce((sum, c) => sum + c.revenue_percentage, 0) || 0;\n  const revenueSplitsCorrect = Math.abs(totalRevenue - 100) < 0.01;\n\n  const handleApprove = () => {\n    if (!canApprove) {\n      alert('Please check both approval boxes before proceeding.');\n      return;\n    }\n    onApprove(feedback.trim() || undefined);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.7)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n        padding: 20,\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n          maxWidth: 600,\n          width: '100%',\n          maxHeight: '90vh',\n          overflow: 'auto',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <h2\n          style={{\n            margin: 0,\n            marginBottom: 8,\n            fontSize: 22,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          {hasAlreadyApproved ? 'Review Your Approval' : 'Approve Project'}\n        </h2>\n        <p\n          style={{\n            margin: 0,\n            marginBottom: 24,\n            fontSize: 14,\n            color: '#94a3b8',\n          }}\n        >\n          {hasAlreadyApproved\n            ? \"You've already approved this project. Review the details below.\"\n            : 'Review the project details and approve if everything looks good.'}\n        </p>\n\n        {/* Project overview */}\n        <div\n          style={{\n            marginBottom: 24,\n            padding: 16,\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n          }}\n        >\n          <h3\n            style={{\n              margin: 0,\n              marginBottom: 12,\n              fontSize: 16,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            {project.title}\n          </h3>\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {/* Content type */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Type:</span>{' '}\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)}\n            </div>\n\n            {/* Sections */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Sections:</span> {completedSections} / {totalSections} completed\n              {completedSections === totalSections && totalSections > 0 && (\n                <span style={{ color: '#10b981', marginLeft: 8 }}>âœ“</span>\n              )}\n            </div>\n\n            {/* Collaborators */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Collaborators:</span>{' '}\n              {project.collaborators?.filter(c => c.status === 'accepted').length || 0}\n            </div>\n          </div>\n        </div>\n\n        {/* Revenue split */}\n        <div\n          style={{\n            marginBottom: 24,\n            padding: 16,\n            background: revenueSplitsCorrect\n              ? 'rgba(16, 185, 129, 0.1)'\n              : 'rgba(239, 68, 68, 0.1)',\n            border: `1px solid ${revenueSplitsCorrect ? '#10b981' : '#ef4444'}`,\n            borderRadius: 8,\n          }}\n        >\n          <h3\n            style={{\n              margin: 0,\n              marginBottom: 12,\n              fontSize: 14,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            Revenue Split\n          </h3>\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {project.collaborators\n              ?.filter(c => c.status === 'accepted')\n              .map((collab) => {\n                const isCurrentUser = collab.user === currentUserId;\n                return (\n                  <div\n                    key={collab.id}\n                    style={{\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      alignItems: 'center',\n                      padding: 10,\n                      background: isCurrentUser ? 'rgba(59, 130, 246, 0.1)' : 'transparent',\n                      border: isCurrentUser ? '1px solid #3b82f6' : 'none',\n                      borderRadius: 6,\n                    }}\n                  >\n                    <div>\n                      <span\n                        style={{\n                          fontSize: 13,\n                          fontWeight: 600,\n                          color: 'var(--text)',\n                        }}\n                      >\n                        @{collab.username}\n                        {isCurrentUser && ' (you)'}\n                      </span>\n                      <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                        {collab.role}\n                      </div>\n                    </div>\n                    <div\n                      style={{\n                        fontSize: 16,\n                        fontWeight: 700,\n                        color: isCurrentUser ? '#3b82f6' : '#10b981',\n                      }}\n                    >\n                      {collab.revenue_percentage}%\n                    </div>\n                  </div>\n                );\n              })}\n          </div>\n\n          <div\n            style={{\n              marginTop: 12,\n              paddingTop: 12,\n              borderTop: '1px solid var(--panel-border)',\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n            }}\n          >\n            <span style={{ fontSize: 13, fontWeight: 700, color: 'var(--text)' }}>\n              Total:\n            </span>\n            <span\n              style={{\n                fontSize: 16,\n                fontWeight: 700,\n                color: revenueSplitsCorrect ? '#10b981' : '#ef4444',\n              }}\n            >\n              {totalRevenue.toFixed(1)}%\n            </span>\n          </div>\n\n          {!revenueSplitsCorrect && (\n            <div\n              style={{\n                marginTop: 12,\n                fontSize: 12,\n                color: '#ef4444',\n                fontWeight: 600,\n              }}\n            >\n              Revenue splits must total 100%\n            </div>\n          )}\n        </div>\n\n        {/* Approval checkboxes */}\n        {!hasAlreadyApproved && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n            }}\n          >\n            <h3\n              style={{\n                margin: 0,\n                marginBottom: 12,\n                fontSize: 14,\n                fontWeight: 700,\n                color: 'var(--text)',\n              }}\n            >\n              Approval Checklist\n            </h3>\n\n            <label\n              style={{\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: 10,\n                marginBottom: 12,\n                cursor: 'pointer',\n              }}\n            >\n              <input\n                type=\"checkbox\"\n                checked={approveContent}\n                onChange={(e) => setApproveContent(e.target.checked)}\n                style={{\n                  marginTop: 2,\n                  cursor: 'pointer',\n                }}\n              />\n              <div>\n                <div\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                    marginBottom: 4,\n                  }}\n                >\n                  I approve the current version of the content\n                </div>\n                <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                  I have reviewed all sections and am satisfied with the quality and content.\n                </div>\n              </div>\n            </label>\n\n            <label\n              style={{\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: 10,\n                cursor: 'pointer',\n              }}\n            >\n              <input\n                type=\"checkbox\"\n                checked={approveRevenue}\n                onChange={(e) => setApproveRevenue(e.target.checked)}\n                style={{\n                  marginTop: 2,\n                  cursor: 'pointer',\n                }}\n              />\n              <div>\n                <div\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                    marginBottom: 4,\n                  }}\n                >\n                  I approve the revenue split\n                </div>\n                <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                  I agree to the revenue distribution shown above ({currentUserCollab?.revenue_percentage}% for me).\n                </div>\n              </div>\n            </label>\n          </div>\n        )}\n\n        {/* Optional feedback */}\n        {!hasAlreadyApproved && (\n          <div style={{ marginBottom: 24 }}>\n            <label\n              style={{\n                display: 'block',\n                fontSize: 14,\n                fontWeight: 600,\n                color: 'var(--text)',\n                marginBottom: 8,\n              }}\n            >\n              Feedback (optional):\n            </label>\n            <textarea\n              value={feedback}\n              onChange={(e) => setFeedback(e.target.value)}\n              placeholder=\"Any comments or suggestions for the team...\"\n              style={{\n                width: '100%',\n                minHeight: 80,\n                padding: 12,\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 13,\n                fontFamily: 'inherit',\n                resize: 'vertical',\n                outline: 'none',\n              }}\n              onFocus={(e) => {\n                e.currentTarget.style.borderColor = '#3b82f6';\n              }}\n              onBlur={(e) => {\n                e.currentTarget.style.borderColor = 'var(--panel-border)';\n              }}\n            />\n          </div>\n        )}\n\n        {/* Warning */}\n        {!hasAlreadyApproved && (\n          <div\n            style={{\n              marginBottom: 20,\n              padding: 12,\n              background: 'rgba(251, 191, 36, 0.1)',\n              border: '1px solid #f59e0b',\n              borderRadius: 8,\n              fontSize: 12,\n              color: '#f59e0b',\n              lineHeight: 1.5,\n            }}\n          >\n            By approving, you confirm that you're ready for this project to be minted as an NFT.\n            This approval cannot be undone.\n          </div>\n        )}\n\n        {/* Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={onClose}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = 'var(--bg)';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n            }}\n          >\n            {hasAlreadyApproved ? 'Close' : 'Cancel'}\n          </button>\n\n          {!hasAlreadyApproved && (\n            <button\n              onClick={handleApprove}\n              disabled={!canApprove || !revenueSplitsCorrect}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background:\n                  !canApprove || !revenueSplitsCorrect\n                    ? '#374151'\n                    : 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: !canApprove || !revenueSplitsCorrect ? 'not-allowed' : 'pointer',\n                boxShadow:\n                  !canApprove || !revenueSplitsCorrect\n                    ? 'none'\n                    : '0 4px 12px rgba(16, 185, 129, 0.3)',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                if (canApprove && revenueSplitsCorrect) {\n                  e.currentTarget.style.transform = 'translateY(-1px)';\n                  e.currentTarget.style.boxShadow = '0 6px 16px rgba(16, 185, 129, 0.4)';\n                }\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'translateY(0)';\n                e.currentTarget.style.boxShadow =\n                  !canApprove || !revenueSplitsCorrect\n                    ? 'none'\n                    : '0 4px 12px rgba(16, 185, 129, 0.3)';\n              }}\n            >\n              Approve Project\n            </button>\n          )}\n        </div>\n\n        {/* Already approved message */}\n        {hasAlreadyApproved && (\n          <div\n            style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(16, 185, 129, 0.1)',\n              border: '1px solid rgba(16, 185, 129, 0.3)',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#10b981',\n              textAlign: 'center',\n              fontWeight: 600,\n            }}\n          >\n            You have already approved this project\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default IndividualApprovalView;\n","/**\n * MintingProgressModal Component\n * Shows minting progress with multi-stage status updates\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\n\ninterface MintingProgressModalProps {\n  project: CollaborativeProject;\n  onClose: () => void;\n  onComplete?: (nftId: string) => void;\n}\n\ntype MintingStage =\n  | 'validating'\n  | 'uploading'\n  | 'creating_contract'\n  | 'minting'\n  | 'finalizing'\n  | 'completed'\n  | 'error';\n\ninterface StageInfo {\n  label: string;\n  description: string;\n  icon: string;\n}\n\nconst STAGES: Record<MintingStage, StageInfo> = {\n  validating: {\n    label: 'Validating Project',\n    description: 'Checking project data and approvals...',\n    icon: 'ðŸ”',\n  },\n  uploading: {\n    label: 'Uploading to IPFS',\n    description: 'Storing content on decentralized storage...',\n    icon: 'â˜ï¸',\n  },\n  creating_contract: {\n    label: 'Creating Smart Contract',\n    description: 'Deploying NFT contract on blockchain...',\n    icon: 'ðŸ“œ',\n  },\n  minting: {\n    label: 'Minting NFT',\n    description: 'Creating your unique NFT token...',\n    icon: 'âœ¨',\n  },\n  finalizing: {\n    label: 'Finalizing',\n    description: 'Completing the process and updating records...',\n    icon: 'ðŸŽ¯',\n  },\n  completed: {\n    label: 'Minting Complete!',\n    description: 'Your NFT has been successfully created.',\n    icon: 'ðŸŽ‰',\n  },\n  error: {\n    label: 'Minting Failed',\n    description: 'An error occurred during the minting process.',\n    icon: 'âŒ',\n  },\n};\n\nexport function MintingProgressModal({\n  project,\n  onClose,\n  onComplete,\n}: MintingProgressModalProps) {\n  const [currentStage, setCurrentStage] = useState<MintingStage>('validating');\n  const [error, setError] = useState<string | null>(null);\n  const [nftData, setNftData] = useState<{\n    id: string;\n    tokenId: string;\n    contractAddress: string;\n    ipfsHash: string;\n  } | null>(null);\n\n  const stageOrder: MintingStage[] = [\n    'validating',\n    'uploading',\n    'creating_contract',\n    'minting',\n    'finalizing',\n  ];\n\n  const currentStageIndex = stageOrder.indexOf(currentStage);\n  const progress = currentStage === 'completed' ? 100 : ((currentStageIndex + 1) / stageOrder.length) * 100;\n\n  // Simulate minting process\n  useEffect(() => {\n    if (currentStage === 'error' || currentStage === 'completed') {\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      const currentIndex = stageOrder.indexOf(currentStage);\n      if (currentIndex < stageOrder.length - 1) {\n        setCurrentStage(stageOrder[currentIndex + 1]);\n      } else {\n        // Completed!\n        setCurrentStage('completed');\n        setNftData({\n          id: `nft-${project.id}`,\n          tokenId: `${Math.floor(Math.random() * 10000)}`,\n          contractAddress: '0x' + Array(40).fill(0).map(() =>\n            Math.floor(Math.random() * 16).toString(16)\n          ).join(''),\n          ipfsHash: 'Qm' + Array(44).fill(0).map(() =>\n            'abcdefghijklmnopqrstuvwxyz0123456789'[Math.floor(Math.random() * 36)]\n          ).join(''),\n        });\n        if (onComplete) {\n          onComplete(`nft-${project.id}`);\n        }\n      }\n    }, 2000 + Math.random() * 1000); // 2-3 seconds per stage\n\n    return () => clearTimeout(timer);\n  }, [currentStage]);\n\n  const handleClose = () => {\n    if (currentStage !== 'completed' && currentStage !== 'error') {\n      const confirmed = confirm(\n        'Minting is still in progress. Are you sure you want to close this window?'\n      );\n      if (!confirmed) return;\n    }\n    onClose();\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.8)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n      }}\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          handleClose();\n        }\n      }}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 32,\n          maxWidth: 500,\n          width: '90%',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div style={{ textAlign: 'center', marginBottom: 32 }}>\n          <div style={{ fontSize: 48, marginBottom: 16 }}>\n            {STAGES[currentStage].icon}\n          </div>\n          <h2\n            style={{\n              margin: 0,\n              marginBottom: 8,\n              fontSize: 24,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            {STAGES[currentStage].label}\n          </h2>\n          <p\n            style={{\n              margin: 0,\n              fontSize: 14,\n              color: '#94a3b8',\n            }}\n          >\n            {STAGES[currentStage].description}\n          </p>\n        </div>\n\n        {/* Progress bar */}\n        {currentStage !== 'completed' && currentStage !== 'error' && (\n          <div style={{ marginBottom: 32 }}>\n            <div\n              style={{\n                height: 8,\n                background: '#1e293b',\n                borderRadius: 4,\n                overflow: 'hidden',\n                marginBottom: 8,\n              }}\n            >\n              <div\n                style={{\n                  height: '100%',\n                  width: `${progress}%`,\n                  background: 'linear-gradient(90deg, #3b82f6 0%, #2563eb 100%)',\n                  transition: 'width 0.5s ease',\n                }}\n              />\n            </div>\n            <div\n              style={{\n                fontSize: 12,\n                color: '#94a3b8',\n                textAlign: 'center',\n              }}\n            >\n              {Math.round(progress)}% complete\n            </div>\n          </div>\n        )}\n\n        {/* Stage list */}\n        <div style={{ marginBottom: 24 }}>\n          {stageOrder.map((stage, index) => {\n            const isCompleted = index < currentStageIndex;\n            const isCurrent = stage === currentStage;\n            const isPending = index > currentStageIndex;\n\n            return (\n              <div\n                key={stage}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 12,\n                  padding: 12,\n                  marginBottom: 8,\n                  background: isCurrent\n                    ? 'rgba(59, 130, 246, 0.1)'\n                    : isCompleted\n                    ? 'rgba(16, 185, 129, 0.1)'\n                    : 'transparent',\n                  border: `1px solid ${\n                    isCurrent\n                      ? '#3b82f6'\n                      : isCompleted\n                      ? '#10b981'\n                      : 'var(--panel-border)'\n                  }`,\n                  borderRadius: 8,\n                  opacity: isPending ? 0.5 : 1,\n                  transition: 'all 0.3s',\n                }}\n              >\n                <div\n                  style={{\n                    width: 24,\n                    height: 24,\n                    borderRadius: '50%',\n                    background: isCompleted\n                      ? '#10b981'\n                      : isCurrent\n                      ? '#3b82f6'\n                      : '#334155',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 12,\n                    fontWeight: 700,\n                    flexShrink: 0,\n                  }}\n                >\n                  {isCompleted ? 'âœ“' : index + 1}\n                </div>\n                <div style={{ flex: 1 }}>\n                  <div\n                    style={{\n                      fontSize: 13,\n                      fontWeight: 600,\n                      color: 'var(--text)',\n                    }}\n                  >\n                    {STAGES[stage].label}\n                  </div>\n                </div>\n                {isCurrent && (\n                  <div\n                    style={{\n                      fontSize: 16,\n                      animation: 'spin 1s linear infinite',\n                    }}\n                  >\n                    â³\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Error message */}\n        {currentStage === 'error' && error && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#ef4444',\n              lineHeight: 1.5,\n            }}\n          >\n            {error}\n          </div>\n        )}\n\n        {/* Success details */}\n        {currentStage === 'completed' && nftData && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'rgba(16, 185, 129, 0.1)',\n              border: '1px solid rgba(16, 185, 129, 0.3)',\n              borderRadius: 8,\n            }}\n          >\n            <h3\n              style={{\n                margin: 0,\n                marginBottom: 12,\n                fontSize: 14,\n                fontWeight: 700,\n                color: '#10b981',\n              }}\n            >\n              NFT Details\n            </h3>\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>Token ID:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontWeight: 600,\n                  }}\n                >\n                  {nftData.tokenId}\n                </span>\n              </div>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>Contract:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontSize: 10,\n                    wordBreak: 'break-all',\n                  }}\n                >\n                  {nftData.contractAddress}\n                </span>\n              </div>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>IPFS:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontSize: 10,\n                    wordBreak: 'break-all',\n                  }}\n                >\n                  {nftData.ipfsHash}\n                </span>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Actions */}\n        {currentStage === 'completed' && (\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            <button\n              onClick={() => {\n                // TODO: Navigate to NFT view\n                alert('Navigate to NFT view');\n              }}\n              style={{\n                width: '100%',\n                padding: '14px 20px',\n                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: 'pointer',\n                boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.transform = 'translateY(-1px)';\n                e.currentTarget.style.boxShadow = '0 6px 16px rgba(16, 185, 129, 0.4)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'translateY(0)';\n                e.currentTarget.style.boxShadow = '0 4px 12px rgba(16, 185, 129, 0.3)';\n              }}\n            >\n              View NFT\n            </button>\n            <button\n              onClick={onClose}\n              style={{\n                width: '100%',\n                padding: '12px 20px',\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                fontWeight: 600,\n                cursor: 'pointer',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.background = 'var(--bg)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'transparent';\n              }}\n            >\n              Close\n            </button>\n          </div>\n        )}\n\n        {currentStage === 'error' && (\n          <div style={{ display: 'flex', gap: 12 }}>\n            <button\n              onClick={() => {\n                setCurrentStage('validating');\n                setError(null);\n              }}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: 'pointer',\n                boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)',\n              }}\n            >\n              Retry\n            </button>\n            <button\n              onClick={onClose}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              Close\n            </button>\n          </div>\n        )}\n\n        {/* Progress indicator */}\n        {currentStage !== 'completed' && currentStage !== 'error' && (\n          <div\n            style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(59, 130, 246, 0.1)',\n              border: '1px solid rgba(59, 130, 246, 0.3)',\n              borderRadius: 8,\n              fontSize: 12,\n              color: '#94a3b8',\n              textAlign: 'center',\n              lineHeight: 1.5,\n            }}\n          >\n            This process may take a few minutes. Please don't close this window.\n          </div>\n        )}\n      </div>\n\n      <style>{`\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default MintingProgressModal;\n","/**\n * MintingWorkflow Component\n * Democratic approval and minting workflow for collaborative projects\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\nimport ApprovalRequestModal from './ApprovalRequestModal';\nimport IndividualApprovalView from './IndividualApprovalView';\nimport MintingProgressModal from './MintingProgressModal';\nimport { useBetaMode } from '../../hooks/useBetaMode';\n\ninterface MintingWorkflowProps {\n  project: CollaborativeProject;\n  currentUserId: number;\n  onApprovalRequest?: () => void;\n  onApprove?: () => void;\n  onMint?: () => Promise<void>;\n}\n\ninterface ChecklistItem {\n  id: string;\n  label: string;\n  checked: boolean;\n  required: boolean;\n}\n\nexport function MintingWorkflow({\n  project,\n  currentUserId,\n  onApprovalRequest,\n  onApprove,\n  onMint,\n}: MintingWorkflowProps) {\n  const [showApprovalRequestModal, setShowApprovalRequestModal] = useState(false);\n  const [showApprovalView, setShowApprovalView] = useState(false);\n  const [showMintingProgress, setShowMintingProgress] = useState(false);\n  const [checklist, setChecklist] = useState<ChecklistItem[]>([]);\n  const { isSolanaDevnet } = useBetaMode();\n\n  const isProjectCreator = project.created_by === currentUserId;\n  const acceptedCollaborators = project.collaborators?.filter(c => c.status === 'accepted') || [];\n  const approvedCollaborators = acceptedCollaborators.filter(\n    c => c.approved_current_version && c.approved_revenue_split\n  );\n  const pendingCollaborators = acceptedCollaborators.filter(\n    c => !c.approved_current_version || !c.approved_revenue_split\n  );\n\n  const currentUserRole = acceptedCollaborators.find(c => c.user === currentUserId);\n  const hasUserApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  const approvalProgress = acceptedCollaborators.length > 0\n    ? approvedCollaborators.length / acceptedCollaborators.length\n    : 0;\n\n  // Build checklist\n  useEffect(() => {\n    const items: ChecklistItem[] = [];\n\n    // Check sections\n    const hasContent = project.sections && project.sections.length > 0;\n    const allSectionsComplete = project.sections?.every(s => {\n      if (s.section_type === 'text') {\n        return s.content_html && s.content_html.trim() !== '';\n      }\n      return !!s.media_file;\n    }) ?? false;\n\n    items.push({\n      id: 'sections',\n      label: 'All sections completed',\n      checked: hasContent && allSectionsComplete,\n      required: true,\n    });\n\n    // Check revenue splits\n    const totalRevenue = project.collaborators?.reduce((sum, c) => sum + c.revenue_percentage, 0) || 0;\n    const revenueSplitsCorrect = Math.abs(totalRevenue - 100) < 0.01;\n\n    items.push({\n      id: 'revenue',\n      label: 'Revenue splits agreed (totals 100%)',\n      checked: revenueSplitsCorrect,\n      required: true,\n    });\n\n    // Check collaborators\n    const allCollaboratorsAccepted = project.collaborators?.every(c => c.status === 'accepted') ?? true;\n\n    items.push({\n      id: 'collaborators',\n      label: 'All collaborators invited/accepted',\n      checked: allCollaboratorsAccepted,\n      required: true,\n    });\n\n    // Check approvals\n    const allApproved = project.is_fully_approved;\n\n    items.push({\n      id: 'approvals',\n      label: 'Approval from all collaborators',\n      checked: allApproved,\n      required: true,\n    });\n\n    setChecklist(items);\n  }, [project]);\n\n  const allRequiredChecked = checklist.filter(i => i.required).every(i => i.checked);\n  const canRequestApproval = checklist.slice(0, 3).every(i => i.checked) && !hasUserApproved;\n  const canMint = allRequiredChecked && project.is_fully_approved;\n  const canForceMint = isProjectCreator && checklist.slice(0, 3).every(i => i.checked);\n\n  // Handle minting\n  const handleMint = async () => {\n    if (!canMint) return;\n\n    const confirmed = confirm(\n      'Are you sure you want to mint this project as an NFT? This action cannot be undone.'\n    );\n\n    if (!confirmed) return;\n\n    setShowMintingProgress(true);\n    try {\n      if (onMint) {\n        await onMint();\n      }\n    } catch (error) {\n      console.error('Minting failed:', error);\n    }\n  };\n\n  // Handle force mint (creator only)\n  const handleForceMint = async () => {\n    if (!canForceMint) return;\n\n    const confirmed = confirm(\n      `WARNING: Force minting will proceed without approval from all collaborators.\\n\\n` +\n      `${pendingCollaborators.length} collaborator(s) haven't approved yet.\\n\\n` +\n      `Are you sure you want to continue?`\n    );\n\n    if (!confirmed) return;\n\n    setShowMintingProgress(true);\n    try {\n      if (onMint) {\n        await onMint();\n      }\n    } catch (error) {\n      console.error('Force minting failed:', error);\n    }\n  };\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}\n    >\n      {isSolanaDevnet && (\n        <div style={{\n          padding: '12px 16px',\n          backgroundColor: '#dbeafe',\n          color: '#1e40af',\n          borderRadius: '8px',\n          fontSize: '13px',\n          marginBottom: '20px',\n          border: '1px solid #3b82f6',\n        }}>\n          ðŸŒ <strong>Devnet Mode:</strong> This NFT will be minted on Solana devnet for testing. Not a real NFT.\n        </div>\n      )}\n\n      <h2\n        style={{\n          margin: 0,\n          marginBottom: 20,\n          fontSize: 20,\n          fontWeight: 700,\n          color: 'var(--text)',\n        }}\n      >\n        Ready to Mint?\n      </h2>\n\n      {/* Pre-mint checklist */}\n      <div style={{ marginBottom: 24 }}>\n        <h3\n          style={{\n            margin: 0,\n            marginBottom: 12,\n            fontSize: 14,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          Pre-mint Checklist:\n        </h3>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {checklist.map((item) => (\n            <div\n              key={item.id}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                padding: 10,\n                background: item.checked ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                border: `1px solid ${item.checked ? '#10b981' : '#334155'}`,\n                borderRadius: 8,\n              }}\n            >\n              <span style={{ fontSize: 16 }}>\n                {item.checked ? 'âœ…' : 'â³'}\n              </span>\n              <span\n                style={{\n                  fontSize: 13,\n                  color: item.checked ? '#10b981' : '#94a3b8',\n                  fontWeight: 600,\n                }}\n              >\n                {item.label}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Approval progress */}\n      <div style={{ marginBottom: 24 }}>\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            marginBottom: 8,\n          }}\n        >\n          <span style={{ fontSize: 14, fontWeight: 700, color: 'var(--text)' }}>\n            Approval Progress:\n          </span>\n          <span\n            style={{\n              fontSize: 14,\n              fontWeight: 700,\n              color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n            }}\n          >\n            {approvedCollaborators.length} / {acceptedCollaborators.length}\n          </span>\n        </div>\n\n        {/* Progress bar */}\n        <div\n          style={{\n            height: 8,\n            background: '#1e293b',\n            borderRadius: 4,\n            overflow: 'hidden',\n            marginBottom: 12,\n          }}\n        >\n          <div\n            style={{\n              height: '100%',\n              width: `${approvalProgress * 100}%`,\n              background: project.is_fully_approved\n                ? 'linear-gradient(90deg, #10b981 0%, #059669 100%)'\n                : 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)',\n              transition: 'width 0.3s',\n            }}\n          />\n        </div>\n\n        {/* Collaborator approval list */}\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {acceptedCollaborators.map((collab) => {\n            const approved = collab.approved_current_version && collab.approved_revenue_split;\n            const isCurrentUser = collab.user === currentUserId;\n\n            return (\n              <div\n                key={collab.id}\n                style={{\n                  padding: 10,\n                  background: approved ? 'rgba(16, 185, 129, 0.1)' : 'rgba(251, 191, 36, 0.1)',\n                  border: `1px solid ${approved ? 'rgba(16, 185, 129, 0.3)' : 'rgba(251, 191, 36, 0.3)'}`,\n                  borderRadius: 8,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 10,\n                }}\n              >\n                <span style={{ fontSize: 16 }}>\n                  {approved ? 'âœ…' : 'â³'}\n                </span>\n                <div style={{ flex: 1 }}>\n                  <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                    @{collab.username}\n                    {isCurrentUser && ' (you)'}\n                  </div>\n                  <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                    {collab.role}\n                  </div>\n                </div>\n                {!approved && isCurrentUser && (\n                  <button\n                    onClick={() => setShowApprovalView(true)}\n                    style={{\n                      padding: '4px 12px',\n                      background: '#3b82f6',\n                      border: 'none',\n                      borderRadius: 6,\n                      color: '#fff',\n                      fontSize: 11,\n                      fontWeight: 600,\n                      cursor: 'pointer',\n                    }}\n                  >\n                    Approve\n                  </button>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Warning */}\n      <div\n        style={{\n          marginBottom: 24,\n          padding: 12,\n          background: 'rgba(251, 191, 36, 0.1)',\n          border: '1px solid #f59e0b',\n          borderRadius: 8,\n          fontSize: 12,\n          color: '#f59e0b',\n          lineHeight: 1.5,\n        }}\n      >\n        âš ï¸ <strong>Note:</strong> Once minting starts, content cannot be changed. Make sure everything is perfect!\n      </div>\n\n      {/* Actions */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {/* Request approval button */}\n        {canRequestApproval && (\n          <button\n            onClick={() => setShowApprovalRequestModal(true)}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)',\n            }}\n          >\n            ðŸ“¨ Request Approval\n          </button>\n        )}\n\n        {/* Approve button (if not approved) */}\n        {!hasUserApproved && checklist.slice(0, 3).every(i => i.checked) && (\n          <button\n            onClick={() => setShowApprovalView(true)}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)',\n            }}\n          >\n            âœ“ Approve Project\n          </button>\n        )}\n\n        {/* Mint button */}\n        {canMint && (\n          <button\n            onClick={handleMint}\n            style={{\n              width: '100%',\n              padding: '16px 20px',\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 16,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 6px 16px rgba(16, 185, 129, 0.4)',\n            }}\n          >\n            ðŸš€ Mint NFT\n          </button>\n        )}\n\n        {/* Force mint button (creator only) */}\n        {!canMint && canForceMint && isProjectCreator && pendingCollaborators.length > 0 && (\n          <button\n            onClick={handleForceMint}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              color: '#ef4444',\n              fontSize: 13,\n              fontWeight: 600,\n              cursor: 'pointer',\n            }}\n          >\n            âš ï¸ Force Mint (Creator Override)\n          </button>\n        )}\n      </div>\n\n      {/* Modals */}\n      {showApprovalRequestModal && (\n        <ApprovalRequestModal\n          project={project}\n          pendingCollaborators={pendingCollaborators}\n          onClose={() => setShowApprovalRequestModal(false)}\n          onSubmit={() => {\n            setShowApprovalRequestModal(false);\n            if (onApprovalRequest) onApprovalRequest();\n          }}\n        />\n      )}\n\n      {showApprovalView && (\n        <IndividualApprovalView\n          project={project}\n          currentUserId={currentUserId}\n          onClose={() => setShowApprovalView(false)}\n          onApprove={() => {\n            setShowApprovalView(false);\n            if (onApprove) onApprove();\n          }}\n        />\n      )}\n\n      {showMintingProgress && (\n        <MintingProgressModal\n          project={project}\n          onClose={() => setShowMintingProgress(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default MintingWorkflow;\n","import React, { useEffect, useState, useCallback } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  CollaboratorRole,\n  collaborationApi,\n  CreateSectionData,\n  CreateCommentData\n} from '../../services/collaborationApi';\nimport { useActivity } from '../../hooks/useActivity';\nimport { useComments } from '../../hooks/useComments';\nimport { CurrentlyEditing } from '../../services/activityService';\nimport { sanitizeHtml } from '../../utils/sanitize';\nimport { OnlineStatus } from './OnlineStatus';\nimport { EditingIndicator, SectionHeaderWithStatus } from './EditingIndicator';\nimport { ActivityFeed, ActivitySummary } from './ActivityFeed';\nimport CommentComposer from './CommentComposer';\nimport CommentThread from './CommentThread';\nimport { MintingWorkflow } from './MintingWorkflow';\n\n// Simple User interface (extend as needed)\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onSectionUpdate?: (section: ProjectSection) => void;\n  onCommentAdd?: (comment: ProjectComment) => void;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nexport default function CollaborativeEditor({\n  project,\n  currentUser,\n  onSectionUpdate,\n  onCommentAdd,\n  onProjectUpdate,\n}: CollaborativeEditorProps) {\n  // State management\n  const [sections, setSections] = useState<ProjectSection[]>(project.sections || []);\n  const [collaborators, setCollaborators] = useState<CollaboratorRole[]>(project.collaborators || []);\n  const [currentlyEditingSection, setCurrentlyEditingSection] = useState<number | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [error, setError] = useState<string>('');\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showInviteModal, setShowInviteModal] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [showActivityFeed, setShowActivityFeed] = useState(false);\n  const [showResolvedComments, setShowResolvedComments] = useState(false);\n  const [activeTab, setActiveTab] = useState<'comments' | 'activity' | 'minting'>('comments');\n\n  // Activity tracking\n  const {\n    activities,\n    onlineUsers,\n    currentlyEditing,\n    isPolling,\n    startEditing,\n    stopEditing,\n    logActivity,\n    startPolling,\n    stopPolling,\n  } = useActivity({\n    projectId: project.id,\n    autoStart: true, // Auto-start polling when component mounts\n  });\n\n  // Enhanced comment system\n  const {\n    comments,\n    commentsBySection,\n    unresolvedCount,\n    totalCount: commentTotalCount,\n    isLoading: commentsLoading,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n    refresh: refreshComments,\n  } = useComments({\n    projectId: project.id,\n    includeResolved: showResolvedComments,\n    pollingInterval: 30000, // Poll every 30 seconds\n  });\n\n  // Find current user's collaborator role\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n\n  // Check if user can edit a specific section type\n  const canEditSectionType = useCallback((sectionType: 'text' | 'image' | 'audio' | 'video'): boolean => {\n    if (!currentUserRole) return false;\n    const permissions = currentUserRole.can_edit || [];\n    return permissions.includes(sectionType);\n  }, [currentUserRole]);\n\n  // Check if user owns a section\n  const ownsSection = useCallback((section: ProjectSection): boolean => {\n    return section.owner === currentUser.id;\n  }, [currentUser.id]);\n\n  // Load sections\n  useEffect(() => {\n    loadSections();\n  }, [project.id]);\n\n  const loadSections = async () => {\n    try {\n      const loadedSections = await collaborationApi.getProjectSections(project.id);\n      setSections(loadedSections);\n    } catch (err: any) {\n      setError(err.message || 'Failed to load sections');\n    }\n  };\n\n  // Add new section\n  const handleAddSection = async (sectionType: 'text' | 'image' | 'audio' | 'video') => {\n    if (!canEditSectionType(sectionType)) {\n      setError(`You don't have permission to create ${sectionType} sections`);\n      return;\n    }\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: sectionType,\n        title: `New ${sectionType} section`,\n        content_html: sectionType === 'text' ? '' : undefined,\n        order: sections.length,\n      });\n      setSections([...sections, newSection]);\n      setCurrentlyEditingSection(newSection.id);\n      onSectionUpdate?.(newSection);\n    } catch (err: any) {\n      setError(err.message || 'Failed to create section');\n    }\n  };\n\n  // Update section\n  const handleUpdateSection = async (\n    sectionId: number,\n    updates: Partial<CreateSectionData>\n  ) => {\n    setSaving(true);\n    try {\n      const updatedSection = await collaborationApi.updateProjectSection(sectionId, updates);\n      setSections(sections.map(s => s.id === sectionId ? updatedSection : s));\n      setLastSaved(new Date());\n      onSectionUpdate?.(updatedSection);\n\n      // Log activity\n      await logActivity(\n        'section_updated',\n        `Updated ${updatedSection.section_type} section: ${updatedSection.title}`,\n        { section_id: sectionId, section_type: updatedSection.section_type }\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to update section');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Delete section\n  const handleDeleteSection = async (sectionId: number) => {\n    if (!confirm('Are you sure you want to delete this section?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(sectionId);\n      setSections(sections.filter(s => s.id !== sectionId));\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete section');\n    }\n  };\n\n  // Upload media file\n  const handleMediaUpload = async (sectionId: number, file: File) => {\n    setSaving(true);\n    try {\n      const updatedSection = await collaborationApi.updateProjectSection(sectionId, {\n        media_file: file,\n      });\n      setSections(sections.map(s => s.id === sectionId ? updatedSection : s));\n      setLastSaved(new Date());\n      onSectionUpdate?.(updatedSection);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload media');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Handle comment submission\n  const handleAddComment = async (content: string, mentions: number[], attachments?: File[]) => {\n    try {\n      const newComment = await addComment(content, mentions, attachments);\n      onCommentAdd?.(newComment);\n\n      // Log activity\n      await logActivity(\n        'comment_added',\n        `Added a comment: ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`,\n        { comment_id: newComment.id }\n      );\n\n      setShowCommentInput(false);\n    } catch (err: any) {\n      setError(err.message || 'Failed to add comment');\n    }\n  };\n\n  // Handle comment reply\n  const handleReplyComment = async (\n    parentId: number,\n    content: string,\n    mentions: number[],\n    attachments?: File[]\n  ) => {\n    try {\n      await addComment(content, mentions, attachments, parentId);\n      await logActivity('comment_added', `Replied to a comment`, { parent_comment_id: parentId });\n    } catch (err: any) {\n      setError(err.message || 'Failed to reply to comment');\n    }\n  };\n\n  // Approve version\n  const handleApproveVersion = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveCurrentVersion(project.id);\n      onProjectUpdate?.(updatedProject);\n      alert('Version approved! ðŸŽ‰');\n\n      // Log activity\n      await logActivity(\n        'approval_given',\n        'Approved current version',\n        { project_status: updatedProject.status }\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve version');\n    }\n  };\n\n  // Handle approval request\n  const handleApprovalRequest = async () => {\n    try {\n      // Refresh project to get updated approval status\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'approval_requested',\n        'Requested approval from collaborators'\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to request approval');\n    }\n  };\n\n  // Handle project approval (full approval)\n  const handleApproveProject = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveProject(project.id, {\n        approve_content: true,\n        approve_revenue: true,\n      });\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'approval_given',\n        'Approved project for minting'\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve project');\n    }\n  };\n\n  // Handle minting\n  const handleMint = async () => {\n    try {\n      const result = await collaborationApi.mintProject(project.id);\n\n      // Refresh project to update status\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'project_minted',\n        `Project minted as NFT (Token ID: ${result.token_id})`\n      );\n\n      alert(`Project successfully minted! NFT Token ID: ${result.token_id}`);\n    } catch (err: any) {\n      setError(err.message || 'Failed to mint project');\n    }\n  };\n\n  // Preview project\n  const handlePreview = async () => {\n    setShowPreview(true);\n  };\n\n  // Get section type badge color\n  const getSectionTypeBadgeColor = (type: string) => {\n    switch (type) {\n      case 'text': return '#3b82f6';\n      case 'image': return '#8b5cf6';\n      case 'audio': return '#f59e0b';\n      case 'video': return '#ef4444';\n      default: return '#64748b';\n    }\n  };\n\n  // Get approval status\n  const approvalStatus = {\n    total: collaborators.filter(c => c.status === 'accepted').length,\n    approved: collaborators.filter(c =>\n      c.status === 'accepted' &&\n      c.approved_current_version &&\n      c.approved_revenue_split\n    ).length,\n  };\n\n  const isFullyApproved = project.is_fully_approved;\n  const userHasApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  return (\n    <div style={{\n      width: '100%',\n      height: '90vh',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: 16,\n    }}>\n      {/* Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: '16px 0',\n      }}>\n        <div style={{ flex: 1 }}>\n          <h2 style={{\n            margin: 0,\n            color: 'var(--text)',\n            fontSize: 24,\n            fontWeight: 700\n          }}>\n            {project.title}\n          </h2>\n          <div style={{\n            marginTop: 4,\n            fontSize: 14,\n            color: '#94a3b8'\n          }}>\n            {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} Project\n            {' â€¢ '}\n            Status: {project.status.replace(/_/g, ' ')}\n          </div>\n        </div>\n\n        {/* Header Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={handlePreview}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '8px 16px',\n              color: 'var(--text)',\n              cursor: 'pointer',\n              fontSize: 14,\n              fontWeight: 600,\n            }}\n          >\n            ðŸ‘ï¸ Preview\n          </button>\n\n          {currentUserRole && !userHasApproved && (\n            <button\n              onClick={handleApproveVersion}\n              style={{\n                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                padding: '8px 20px',\n                color: '#fff',\n                fontWeight: 700,\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              âœ“ Approve Version\n            </button>\n          )}\n\n          {isFullyApproved && project.status === 'ready_for_mint' && (\n            <button\n              style={{\n                background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                border: 'none',\n                borderRadius: 8,\n                padding: '8px 20px',\n                color: '#fff',\n                fontWeight: 700,\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              ðŸš€ Ready to Mint\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div style={{\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 8,\n          padding: 12,\n          color: '#ef4444',\n          fontSize: 14,\n        }}>\n          {error}\n          <button\n            onClick={() => setError('')}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#ef4444',\n              cursor: 'pointer',\n              float: 'right',\n              fontWeight: 700,\n              fontSize: 18,\n            }}\n          >\n            Ã—\n          </button>\n        </div>\n      )}\n\n      {/* Main Layout: Sidebar + Editor */}\n      <div style={{\n        display: 'flex',\n        gap: 16,\n        flex: 1,\n        overflow: 'hidden'\n      }}>\n        {/* Left Sidebar: Collaborators + Comments */}\n        <div style={{\n          width: 280,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 12,\n          overflow: 'auto',\n        }}>\n          {/* Collaborators Panel */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n          }}>\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 12,\n            }}>\n              <h3 style={{\n                margin: 0,\n                fontSize: 14,\n                fontWeight: 700,\n                color: 'var(--text)'\n              }}>\n                Collaborators ({collaborators.length})\n              </h3>\n              {project.created_by === currentUser.id && (\n                <button\n                  onClick={() => setShowInviteModal(true)}\n                  style={{\n                    background: 'transparent',\n                    border: '1px solid var(--panel-border)',\n                    borderRadius: 6,\n                    padding: '4px 8px',\n                    color: '#94a3b8',\n                    cursor: 'pointer',\n                    fontSize: 11,\n                  }}\n                >\n                  + Invite\n                </button>\n              )}\n            </div>\n\n            {/* Collaborator List */}\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              {collaborators.map(collab => (\n                <div\n                  key={collab.id}\n                  style={{\n                    padding: 10,\n                    background: collab.user === currentUser.id ? 'rgba(59, 130, 246, 0.1)' : 'var(--bg)',\n                    border: '1px solid var(--panel-border)',\n                    borderRadius: 8,\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                  }}>\n                    {/* Online Status Indicator */}\n                    <OnlineStatus\n                      userId={collab.user}\n                      onlineUsers={onlineUsers}\n                      size=\"small\"\n                    />\n                    <div style={{ flex: 1 }}>\n                      <div style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: 'var(--text)',\n                      }}>\n                        @{collab.username}\n                        {collab.user === currentUser.id && ' (you)'}\n                      </div>\n                      <div style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                      }}>\n                        {collab.role} â€¢ {collab.revenue_percentage}%\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Approval Status */}\n                  {collab.status === 'accepted' && (\n                    <div style={{ marginTop: 6, fontSize: 10, color: '#94a3b8' }}>\n                      {collab.approved_current_version && collab.approved_revenue_split ? (\n                        <span style={{ color: '#10b981' }}>âœ“ Approved</span>\n                      ) : (\n                        <span>â³ Pending approval</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Approval Status Panel */}\n          <div style={{\n            background: isFullyApproved\n              ? 'rgba(16, 185, 129, 0.1)'\n              : 'rgba(245, 158, 11, 0.1)',\n            border: `1px solid ${isFullyApproved ? '#10b981' : '#f59e0b'}`,\n            borderRadius: 12,\n            padding: 12,\n          }}>\n            <div style={{\n              fontSize: 12,\n              fontWeight: 600,\n              color: isFullyApproved ? '#10b981' : '#f59e0b',\n              marginBottom: 6,\n            }}>\n              {isFullyApproved ? 'âœ“ Fully Approved' : 'â³ Awaiting Approvals'}\n            </div>\n            <div style={{ fontSize: 11, color: '#94a3b8' }}>\n              {approvalStatus.approved} of {approvalStatus.total} collaborators approved\n            </div>\n          </div>\n\n          {/* Activity & Comments & Minting Tabs */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column',\n          }}>\n            {/* Tabs */}\n            <div style={{\n              display: 'flex',\n              gap: 8,\n              marginBottom: 12,\n              borderBottom: '1px solid var(--panel-border)',\n              paddingBottom: 8,\n            }}>\n              <button\n                onClick={() => setActiveTab('comments')}\n                style={{\n                  background: activeTab === 'comments' ? '#3b82f6' : 'transparent',\n                  color: activeTab === 'comments' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 12,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                Comments ({commentTotalCount})\n                {unresolvedCount > 0 && (\n                  <span\n                    style={{\n                      marginLeft: 4,\n                      fontSize: 10,\n                      background: '#f59e0b',\n                      padding: '2px 5px',\n                      borderRadius: 8,\n                    }}\n                  >\n                    {unresolvedCount}\n                  </span>\n                )}\n              </button>\n              <button\n                onClick={() => setActiveTab('activity')}\n                style={{\n                  background: activeTab === 'activity' ? '#3b82f6' : 'transparent',\n                  color: activeTab === 'activity' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 12,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                Activity ({activities.length})\n              </button>\n              <button\n                onClick={() => setActiveTab('minting')}\n                style={{\n                  background: activeTab === 'minting' ? '#10b981' : 'transparent',\n                  color: activeTab === 'minting' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 11,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                {isFullyApproved ? 'âœ“' : 'â³'} Mint\n              </button>\n            </div>\n\n            {/* Comments View */}\n            {activeTab === 'comments' && (\n              <>\n                {/* Comment controls */}\n                <div style={{\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                  marginBottom: 12,\n                  gap: 8,\n                }}>\n                  <button\n                    onClick={() => setShowCommentInput(!showCommentInput)}\n                    style={{\n                      background: '#3b82f6',\n                      border: 'none',\n                      borderRadius: 6,\n                      padding: '6px 12px',\n                      color: '#fff',\n                      cursor: 'pointer',\n                      fontSize: 11,\n                      fontWeight: 600,\n                      flex: 1,\n                    }}\n                  >\n                    + Add Comment\n                  </button>\n                  <button\n                    onClick={() => setShowResolvedComments(!showResolvedComments)}\n                    style={{\n                      background: 'transparent',\n                      border: '1px solid var(--panel-border)',\n                      borderRadius: 6,\n                      padding: '6px 12px',\n                      color: '#94a3b8',\n                      cursor: 'pointer',\n                      fontSize: 10,\n                      fontWeight: 600,\n                    }}\n                  >\n                    {showResolvedComments ? 'Hide' : 'Show'} Resolved\n                  </button>\n                </div>\n\n                {/* Unresolved count */}\n                {unresolvedCount > 0 && (\n                  <div\n                    style={{\n                      marginBottom: 12,\n                      padding: '6px 10px',\n                      background: 'rgba(251, 191, 36, 0.1)',\n                      border: '1px solid #f59e0b',\n                      borderRadius: 6,\n                      fontSize: 11,\n                      color: '#f59e0b',\n                      fontWeight: 600,\n                      textAlign: 'center',\n                    }}\n                  >\n                    {unresolvedCount} unresolved comment{unresolvedCount !== 1 ? 's' : ''}\n                  </div>\n                )}\n\n                {/* Comment Input */}\n                {showCommentInput && (\n                  <div style={{ marginBottom: 12 }}>\n                    <CommentComposer\n                      projectId={project.id}\n                      collaborators={collaborators}\n                      onSubmit={handleAddComment}\n                      onCancel={() => setShowCommentInput(false)}\n                      compact={true}\n                      autoFocus={true}\n                    />\n                  </div>\n                )}\n\n                {/* Comment List */}\n                <div style={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 12,\n                  overflow: 'auto',\n                  flex: 1,\n                }}>\n                  {commentsLoading && comments.length === 0 ? (\n                    <div style={{\n                      padding: 20,\n                      textAlign: 'center',\n                      color: '#94a3b8',\n                      fontSize: 12,\n                    }}>\n                      Loading comments...\n                    </div>\n                  ) : comments.length === 0 ? (\n                    <div style={{\n                      padding: 20,\n                      textAlign: 'center',\n                      color: '#64748b',\n                      fontSize: 12,\n                    }}>\n                      <div style={{ fontSize: 32, marginBottom: 8 }}>ðŸ’¬</div>\n                      <div>No comments yet</div>\n                      <div style={{ fontSize: 11, color: '#64748b', marginTop: 4 }}>\n                        Be the first to comment!\n                      </div>\n                    </div>\n                  ) : (\n                    comments.map(comment => (\n                      <CommentThread\n                        key={comment.id}\n                        comment={comment}\n                        projectId={project.id}\n                        currentUserId={currentUser.id}\n                        collaborators={collaborators}\n                        onReply={handleReplyComment}\n                        onEdit={updateComment}\n                        onDelete={deleteComment}\n                        onResolve={resolveComment}\n                        onUnresolve={unresolveComment}\n                        onReaction={addReaction}\n                        onRemoveReaction={removeReaction}\n                      />\n                    ))\n                  )}\n                </div>\n              </>\n            )}\n\n            {/* Activity Feed View */}\n            {activeTab === 'activity' && (\n              <div style={{\n                overflow: 'auto',\n                flex: 1,\n              }}>\n                <ActivityFeed activities={activities} maxItems={20} compact={true} />\n              </div>\n            )}\n\n            {/* Minting Workflow View */}\n            {activeTab === 'minting' && (\n              <div style={{\n                overflow: 'auto',\n                flex: 1,\n              }}>\n                <MintingWorkflow\n                  project={project}\n                  currentUserId={currentUser.id}\n                  onApprovalRequest={handleApprovalRequest}\n                  onApprove={handleApproveProject}\n                  onMint={handleMint}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Editor Area */}\n        <div style={{\n          flex: 1,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 12,\n          overflow: 'auto',\n        }}>\n          {/* Sections */}\n          {sections.length === 0 ? (\n            <div style={{\n              background: 'var(--panel)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 12,\n              padding: 32,\n              textAlign: 'center',\n              color: '#94a3b8',\n            }}>\n              <div style={{ fontSize: 16, marginBottom: 16 }}>\n                No sections yet. Add your first section to get started!\n              </div>\n            </div>\n          ) : (\n            sections.map((section, index) => (\n              <SectionEditor\n                key={section.id}\n                section={section}\n                sectionNumber={index + 1}\n                canEdit={ownsSection(section) || project.created_by === currentUser.id}\n                isOwner={ownsSection(section)}\n                isEditing={currentlyEditingSection === section.id}\n                onStartEdit={async () => {\n                  setCurrentlyEditingSection(section.id);\n                  await startEditing(section.id);\n                }}\n                onStopEdit={async () => {\n                  if (currentlyEditingSection === section.id) {\n                    await stopEditing(section.id);\n                    setCurrentlyEditingSection(null);\n                  }\n                }}\n                onUpdate={(updates) => handleUpdateSection(section.id, updates)}\n                onDelete={() => handleDeleteSection(section.id)}\n                onMediaUpload={(file) => handleMediaUpload(section.id, file)}\n                saving={saving}\n                currentlyEditing={currentlyEditing}\n                currentUserId={currentUser.id}\n              />\n            ))\n          )}\n\n          {/* Add Section Buttons */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px dashed var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n          }}>\n            <div style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 12,\n            }}>\n              Add Section\n            </div>\n            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n              {(['text', 'image', 'audio', 'video'] as const).map(type => {\n                const canAdd = canEditSectionType(type);\n                return (\n                  <button\n                    key={type}\n                    onClick={() => handleAddSection(type)}\n                    disabled={!canAdd}\n                    style={{\n                      background: canAdd ? getSectionTypeBadgeColor(type) : '#374151',\n                      border: 'none',\n                      borderRadius: 8,\n                      padding: '8px 16px',\n                      color: '#fff',\n                      cursor: canAdd ? 'pointer' : 'not-allowed',\n                      fontSize: 12,\n                      fontWeight: 600,\n                      opacity: canAdd ? 1 : 0.5,\n                    }}\n                  >\n                    {type === 'text' && 'ðŸ“'}\n                    {type === 'image' && 'ðŸ–¼ï¸'}\n                    {type === 'audio' && 'ðŸŽµ'}\n                    {type === 'video' && 'ðŸŽ¬'}\n                    {' '}\n                    {type.charAt(0).toUpperCase() + type.slice(1)}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Saving Status */}\n          {saving && (\n            <div style={{\n              fontSize: 12,\n              color: '#f59e0b',\n              textAlign: 'right',\n            }}>\n              Saving...\n            </div>\n          )}\n          {!saving && lastSaved && (\n            <div style={{\n              fontSize: 12,\n              color: '#10b981',\n              textAlign: 'right',\n            }}>\n              Saved {formatTimeAgo(lastSaved)}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Section Editor Sub-component\ninterface SectionEditorProps {\n  section: ProjectSection;\n  sectionNumber: number;\n  canEdit: boolean;\n  isOwner: boolean;\n  isEditing: boolean;\n  onStartEdit: () => void;\n  onStopEdit?: () => void;\n  onUpdate: (updates: Partial<CreateSectionData>) => void;\n  onDelete: () => void;\n  onMediaUpload: (file: File) => void;\n  saving: boolean;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId: number;\n}\n\nfunction SectionEditor({\n  section,\n  sectionNumber,\n  canEdit,\n  isOwner,\n  isEditing,\n  onStartEdit,\n  onStopEdit,\n  onUpdate,\n  onDelete,\n  onMediaUpload,\n  saving,\n  currentlyEditing,\n  currentUserId,\n}: SectionEditorProps) {\n  const [title, setTitle] = useState(section.title);\n  const [content, setContent] = useState(section.content_html || '');\n\n  // Check if someone else is editing this section\n  const editors = currentlyEditing.filter(\n    e => e.section_id === section.id && e.user_id !== currentUserId\n  );\n  const isBeingEditedByOthers = editors.length > 0;\n\n  // Debounced auto-save for text sections\n  useEffect(() => {\n    if (!canEdit || section.section_type !== 'text') return;\n\n    const timer = setTimeout(() => {\n      if (title !== section.title || content !== section.content_html) {\n        onUpdate({ title, content_html: content });\n      }\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, [title, content, section.id]);\n\n  const getSectionIcon = (type: string) => {\n    switch (type) {\n      case 'text': return 'ðŸ“';\n      case 'image': return 'ðŸ–¼ï¸';\n      case 'audio': return 'ðŸŽµ';\n      case 'video': return 'ðŸŽ¬';\n      default: return 'ðŸ“„';\n    }\n  };\n\n  const getSectionColor = (type: string) => {\n    switch (type) {\n      case 'text': return '#3b82f6';\n      case 'image': return '#8b5cf6';\n      case 'audio': return '#f59e0b';\n      case 'video': return '#ef4444';\n      default: return '#64748b';\n    }\n  };\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: `2px solid ${canEdit ? getSectionColor(section.section_type) : 'var(--panel-border)'}`,\n        borderRadius: 12,\n        padding: 20,\n        position: 'relative',\n      }}\n      onClick={() => canEdit && !isEditing && onStartEdit()}\n    >\n      {/* Section Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'flex-start',\n        marginBottom: 12,\n        flexWrap: 'wrap',\n        gap: 12,\n      }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12, flex: 1 }}>\n          <span style={{ fontSize: 20 }}>{getSectionIcon(section.section_type)}</span>\n          <div>\n            <div style={{\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n            }}>\n              Section {sectionNumber}: {section.section_type}\n              {!canEdit && (\n                <span style={{\n                  marginLeft: 8,\n                  fontSize: 11,\n                  color: '#ef4444',\n                }}>\n                  ðŸ”’ @{section.owner_username}'s section\n                </span>\n              )}\n            </div>\n            <div style={{ fontSize: 11, color: '#94a3b8' }}>\n              Owner: @{section.owner_username}\n            </div>\n          </div>\n        </div>\n\n        {/* Editing Status & Actions */}\n        <div style={{ display: 'flex', gap: 8, alignItems: 'center', flexWrap: 'wrap' }}>\n          {/* Show editing indicator if someone else is editing */}\n          {isBeingEditedByOthers && (\n            <EditingIndicator\n              sectionId={section.id}\n              currentlyEditing={currentlyEditing}\n              currentUserId={currentUserId}\n            />\n          )}\n\n          {/* Delete button */}\n          {canEdit && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                if (onStopEdit) onStopEdit();\n                onDelete();\n              }}\n              style={{\n                background: 'transparent',\n                border: '1px solid #ef4444',\n                borderRadius: 6,\n                padding: '4px 12px',\n                color: '#ef4444',\n                cursor: 'pointer',\n                fontSize: 11,\n              }}\n            >\n              Delete\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Section Content */}\n      {!canEdit ? (\n        // Read-only view for sections user can't edit\n        <div style={{\n          background: 'rgba(100, 100, 100, 0.1)',\n          borderRadius: 8,\n          padding: 16,\n          opacity: 0.6,\n        }}>\n          <div style={{ fontSize: 13, color: '#94a3b8' }}>\n            {section.section_type === 'text' && (\n              <div dangerouslySetInnerHTML={{ __html: sanitizeHtml(section.content_html) || 'No content yet' }} />\n            )}\n            {section.section_type === 'image' && section.media_file && (\n              <img\n                src={section.media_file}\n                alt={section.title}\n                style={{ maxWidth: '100%', borderRadius: 8 }}\n              />\n            )}\n            {section.section_type === 'audio' && section.media_file && (\n              <audio controls style={{ width: '100%' }}>\n                <source src={section.media_file} />\n              </audio>\n            )}\n            {section.section_type === 'video' && section.media_file && (\n              <video controls style={{ maxWidth: '100%', borderRadius: 8 }}>\n                <source src={section.media_file} />\n              </video>\n            )}\n            {!section.media_file && section.section_type !== 'text' && (\n              <div style={{ textAlign: 'center', padding: 20 }}>\n                No media uploaded yet\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        // Editable content\n        <>\n          {/* Title Input */}\n          <input\n            type=\"text\"\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            placeholder=\"Section title\"\n            style={{\n              width: '100%',\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '10px 12px',\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              marginBottom: 12,\n              outline: 'none',\n            }}\n          />\n\n          {/* Content based on type */}\n          {section.section_type === 'text' && (\n            <div style={{ minHeight: 200 }}>\n              <ReactQuill\n                value={content}\n                onChange={setContent}\n                theme=\"snow\"\n                style={{\n                  height: 200,\n                  marginBottom: 50,\n                }}\n                modules={{\n                  toolbar: [\n                    [{ header: [1, 2, 3, false] }],\n                    ['bold', 'italic', 'underline', 'strike'],\n                    [{ list: 'ordered' }, { list: 'bullet' }],\n                    ['blockquote', 'code-block'],\n                    ['link'],\n                    ['clean'],\n                  ],\n                }}\n              />\n            </div>\n          )}\n\n          {/* Media Upload */}\n          {section.section_type !== 'text' && (\n            <div>\n              {section.media_file ? (\n                <div style={{ marginBottom: 12 }}>\n                  {section.section_type === 'image' && (\n                    <img\n                      src={section.media_file}\n                      alt={section.title}\n                      style={{ maxWidth: '100%', borderRadius: 8 }}\n                    />\n                  )}\n                  {section.section_type === 'audio' && (\n                    <audio controls style={{ width: '100%' }}>\n                      <source src={section.media_file} />\n                    </audio>\n                  )}\n                  {section.section_type === 'video' && (\n                    <video controls style={{ maxWidth: '100%', borderRadius: 8 }}>\n                      <source src={section.media_file} />\n                    </video>\n                  )}\n                </div>\n              ) : (\n                <div style={{\n                  border: '2px dashed var(--panel-border)',\n                  borderRadius: 8,\n                  padding: 32,\n                  textAlign: 'center',\n                  marginBottom: 12,\n                }}>\n                  <div style={{ fontSize: 14, color: '#94a3b8', marginBottom: 12 }}>\n                    No {section.section_type} uploaded\n                  </div>\n                </div>\n              )}\n\n              <label style={{\n                display: 'block',\n                background: getSectionColor(section.section_type),\n                border: 'none',\n                borderRadius: 8,\n                padding: '10px 16px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: 'pointer',\n                fontSize: 13,\n                textAlign: 'center',\n              }}>\n                {section.media_file ? 'Replace' : 'Upload'} {section.section_type}\n                <input\n                  type=\"file\"\n                  accept={\n                    section.section_type === 'image' ? 'image/*' :\n                    section.section_type === 'audio' ? 'audio/*' :\n                    section.section_type === 'video' ? 'video/*' : '*'\n                  }\n                  style={{ display: 'none' }}\n                  onChange={(e) => {\n                    const file = e.target.files?.[0];\n                    if (file) {\n                      onMediaUpload(file);\n                    }\n                  }}\n                />\n              </label>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\n// Utility function\nfunction formatTimeAgo(date: Date): string {\n  const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\n  if (seconds < 60) return 'just now';\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours}h ago`;\n  return `${Math.floor(hours / 24)}d ago`;\n}\n","import React, { useState, useEffect } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeBookEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\n// Represent chapters as sections with section_type='text'\ninterface Chapter {\n  id: number;\n  title: string;\n  content_html: string;\n  synopsis: string;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeBookEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeBookEditorProps) {\n  const [chapters, setChapters] = useState<Chapter[]>([]);\n  const [selectedChapterId, setSelectedChapterId] = useState<number | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [error, setError] = useState('');\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditText = currentUserRole?.can_edit?.includes('text') ?? currentUserRole?.can_edit_text ?? false;\n\n  // Load chapters from sections\n  useEffect(() => {\n    loadChapters();\n  }, [project.id]);\n\n  const loadChapters = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const textSections = sections\n        .filter(s => s.section_type === 'text')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          content_html: s.content_html || '',\n          synopsis: s.synopsis || '',\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setChapters(textSections);\n      if (textSections.length > 0 && !selectedChapterId) {\n        setSelectedChapterId(textSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load chapters');\n    }\n  };\n\n  const handleAddChapter = async () => {\n    if (!canEditText) {\n      setError(\"You don't have permission to add chapters\");\n      return;\n    }\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'text',\n        title: `Chapter ${chapters.length + 1}`,\n        content_html: '',\n        order: chapters.length,\n      });\n\n      const newChapter: Chapter = {\n        id: newSection.id,\n        title: newSection.title,\n        content_html: newSection.content_html || '',\n        synopsis: newSection.synopsis || '',\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setChapters([...chapters, newChapter]);\n      setSelectedChapterId(newChapter.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to add chapter');\n    }\n  };\n\n  const handleUpdateChapter = async (chapterId: number, title: string, content: string, synopsis?: string) => {\n    setSaving(true);\n    try {\n      const updateData: { title: string; content_html: string; synopsis?: string } = {\n        title,\n        content_html: content,\n      };\n      if (synopsis !== undefined) {\n        updateData.synopsis = synopsis;\n      }\n      const updated = await collaborationApi.updateProjectSection(chapterId, updateData);\n      setChapters(chapters.map(ch =>\n        ch.id === chapterId\n          ? { ...ch, title: updated.title, content_html: updated.content_html || '', synopsis: updated.synopsis || '' }\n          : ch\n      ));\n      setLastSaved(new Date());\n    } catch (err: any) {\n      setError(err.message || 'Failed to save chapter');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDeleteChapter = async (chapterId: number) => {\n    if (!confirm('Are you sure you want to delete this chapter?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(chapterId);\n      const remaining = chapters.filter(ch => ch.id !== chapterId);\n      setChapters(remaining);\n      if (selectedChapterId === chapterId) {\n        setSelectedChapterId(remaining[0]?.id || null);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete chapter');\n    }\n  };\n\n  const selectedChapter = chapters.find(ch => ch.id === selectedChapterId);\n  const canEditSelectedChapter = selectedChapter && (\n    selectedChapter.owner === currentUser.id || canEditText\n  );\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Chapter Sidebar */}\n      <div style={{\n        width: 280,\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: 16,\n        }}>\n          <h3 style={{ margin: 0, color: 'var(--text)', fontSize: 16 }}>\n            Chapters ({chapters.length})\n          </h3>\n          {canEditText && (\n            <button\n              onClick={handleAddChapter}\n              style={{\n                background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                border: 'none',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              + Add\n            </button>\n          )}\n        </div>\n\n        {/* Chapter List */}\n        <div style={{\n          flex: 1,\n          overflowY: 'auto',\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 8,\n        }}>\n          {chapters.length === 0 ? (\n            <div style={{\n              textAlign: 'center',\n              padding: 24,\n              color: '#64748b',\n              fontSize: 13,\n            }}>\n              No chapters yet.\n              {canEditText && ' Click \"+ Add\" to create one.'}\n            </div>\n          ) : (\n            chapters.map((chapter, index) => {\n              const isSelected = selectedChapterId === chapter.id;\n              const isOwner = chapter.owner === currentUser.id;\n\n              return (\n                <div\n                  key={chapter.id}\n                  onClick={() => setSelectedChapterId(chapter.id)}\n                  style={{\n                    padding: 12,\n                    background: isSelected ? 'rgba(245, 158, 11, 0.1)' : 'var(--bg)',\n                    border: isSelected\n                      ? '1px solid #f59e0b'\n                      : '1px solid var(--panel-border)',\n                    borderRadius: 8,\n                    cursor: 'pointer',\n                    transition: 'all 0.2s',\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'space-between',\n                    gap: 8,\n                  }}>\n                    <div style={{ flex: 1, minWidth: 0 }}>\n                      <div style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: isSelected ? '#f59e0b' : 'var(--text)',\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}>\n                        {chapter.title || `Chapter ${index + 1}`}\n                      </div>\n                      <div style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                        marginTop: 2,\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 4,\n                      }}>\n                        <span style={{\n                          width: 14,\n                          height: 14,\n                          borderRadius: '50%',\n                          background: isOwner\n                            ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'\n                            : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          justifyContent: 'center',\n                          color: '#fff',\n                          fontSize: 8,\n                          fontWeight: 700,\n                        }}>\n                          {chapter.owner_username.charAt(0).toUpperCase()}\n                        </span>\n                        @{chapter.owner_username}\n                        {isOwner && <span style={{ color: '#f59e0b' }}>(you)</span>}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* Chapter Editor */}\n      <div style={{\n        flex: 1,\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        {error && (\n          <div style={{\n            padding: 12,\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            borderRadius: 8,\n            color: '#ef4444',\n            fontSize: 13,\n            marginBottom: 16,\n          }}>\n            {error}\n            <button\n              onClick={() => setError('')}\n              style={{\n                background: 'transparent',\n                border: 'none',\n                color: '#ef4444',\n                cursor: 'pointer',\n                float: 'right',\n                fontWeight: 700,\n              }}\n            >\n              x\n            </button>\n          </div>\n        )}\n\n        {selectedChapter ? (\n          <ChapterEditor\n            chapter={selectedChapter}\n            canEdit={canEditSelectedChapter || false}\n            onUpdate={(title, content, synopsis) => handleUpdateChapter(selectedChapter.id, title, content, synopsis)}\n            onDelete={() => handleDeleteChapter(selectedChapter.id)}\n            saving={saving}\n            lastSaved={lastSaved}\n          />\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {chapters.length > 0\n              ? 'Select a chapter to edit'\n              : 'Add your first chapter to get started'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Chapter Editor Sub-component\ninterface ChapterEditorProps {\n  chapter: Chapter;\n  canEdit: boolean;\n  onUpdate: (title: string, content: string, synopsis?: string) => void;\n  onDelete: () => void;\n  saving: boolean;\n  lastSaved: Date | null;\n}\n\nfunction ChapterEditor({\n  chapter,\n  canEdit,\n  onUpdate,\n  onDelete,\n  saving,\n  lastSaved,\n}: ChapterEditorProps) {\n  const [title, setTitle] = useState(chapter.title);\n  const [content, setContent] = useState(chapter.content_html);\n  const [synopsis, setSynopsis] = useState(chapter.synopsis);\n  const [showSynopsis, setShowSynopsis] = useState(false);\n\n  // Sync when chapter changes\n  useEffect(() => {\n    setTitle(chapter.title);\n    setContent(chapter.content_html);\n    setSynopsis(chapter.synopsis);\n  }, [chapter.id]);\n\n  // Auto-save with debounce\n  useEffect(() => {\n    if (!canEdit) return;\n\n    const timer = setTimeout(() => {\n      if (title !== chapter.title || content !== chapter.content_html || synopsis !== chapter.synopsis) {\n        onUpdate(title, content, synopsis);\n      }\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, content, synopsis]);\n\n  const quillModules = {\n    toolbar: [\n      [{ header: [1, 2, 3, false] }],\n      ['bold', 'italic', 'underline', 'strike'],\n      [{ list: 'ordered' }, { list: 'bullet' }],\n      ['blockquote', 'code-block'],\n      ['link'],\n      ['clean'],\n    ],\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\n      {/* Chapter Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        marginBottom: 16,\n        gap: 16,\n      }}>\n        <input\n          type=\"text\"\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n          disabled={!canEdit}\n          placeholder=\"Chapter Title\"\n          style={{\n            flex: 1,\n            background: 'transparent',\n            border: 'none',\n            borderBottom: '2px solid var(--panel-border)',\n            color: 'var(--text)',\n            fontSize: 20,\n            fontWeight: 700,\n            padding: '8px 0',\n            outline: 'none',\n          }}\n        />\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          {saving && (\n            <span style={{ fontSize: 12, color: '#f59e0b' }}>Saving...</span>\n          )}\n          {!saving && lastSaved && (\n            <span style={{ fontSize: 12, color: '#10b981' }}>\n              Saved {formatTimeAgo(lastSaved)}\n            </span>\n          )}\n          {canEdit && (\n            <button\n              onClick={onDelete}\n              style={{\n                background: 'transparent',\n                border: '1px solid #ef4444',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#ef4444',\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              Delete\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Owner Badge */}\n      <div style={{\n        marginBottom: 12,\n        fontSize: 12,\n        color: '#94a3b8',\n      }}>\n        Written by @{chapter.owner_username}\n        {!canEdit && (\n          <span style={{ color: '#ef4444', marginLeft: 8 }}>\n            (Read-only - you can only edit your own chapters)\n          </span>\n        )}\n      </div>\n\n      {/* Synopsis Toggle */}\n      <div style={{ marginBottom: 12 }}>\n        <button\n          onClick={() => setShowSynopsis(!showSynopsis)}\n          style={{\n            background: 'transparent',\n            border: 'none',\n            color: '#94a3b8',\n            fontSize: 12,\n            cursor: 'pointer',\n            padding: '4px 0',\n            display: 'flex',\n            alignItems: 'center',\n            gap: 4,\n          }}\n        >\n          <span style={{\n            fontSize: 10,\n            transform: showSynopsis ? 'rotate(90deg)' : 'rotate(0)',\n            transition: 'transform 0.2s',\n          }}>\n            â–¶\n          </span>\n          Synopsis {synopsis ? `(${synopsis.split(/\\s+/).filter(w => w).length} words)` : '(optional)'}\n        </button>\n        {showSynopsis && (\n          <div style={{ marginTop: 8 }}>\n            <textarea\n              value={synopsis}\n              onChange={(e) => canEdit && setSynopsis(e.target.value)}\n              placeholder=\"Brief summary of this chapter (optional, max 150 words)...\"\n              disabled={!canEdit}\n              maxLength={1000}\n              style={{\n                width: '100%',\n                minHeight: 80,\n                background: !canEdit ? 'rgba(100,100,100,0.05)' : 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                padding: '10px 14px',\n                color: !canEdit ? '#64748b' : 'var(--text)',\n                fontSize: 13,\n                resize: 'vertical',\n                cursor: !canEdit ? 'not-allowed' : 'text',\n                outline: 'none',\n              }}\n            />\n            <div style={{ fontSize: 10, color: '#64748b', marginTop: 4 }}>\n              {synopsis.split(/\\s+/).filter(w => w).length}/150 words recommended\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Editor */}\n      <div style={{\n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        minHeight: 300,\n      }}>\n        <ReactQuill\n          theme=\"snow\"\n          value={content}\n          onChange={setContent}\n          readOnly={!canEdit}\n          modules={quillModules}\n          style={{\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction formatTimeAgo(date: Date): string {\n  const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\n  if (seconds < 60) return 'just now';\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  return `${hours}h ago`;\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeArtEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface ArtPiece {\n  id: number;\n  title: string;\n  media_file: string;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeArtEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeArtEditorProps) {\n  const [artPieces, setArtPieces] = useState<ArtPiece[]>([]);\n  const [selectedPieceId, setSelectedPieceId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditImages = currentUserRole?.can_edit?.includes('image') ?? currentUserRole?.can_edit_images ?? false;\n\n  useEffect(() => {\n    loadArtPieces();\n  }, [project.id]);\n\n  const loadArtPieces = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const imageSections = sections\n        .filter(s => s.section_type === 'image')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setArtPieces(imageSections);\n      if (imageSections.length > 0 && !selectedPieceId) {\n        setSelectedPieceId(imageSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load art pieces');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditImages) {\n      setError(\"You don't have permission to upload images\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['image/png', 'image/jpeg', 'image/webp', 'image/gif'];\n    if (!validTypes.includes(file.type)) {\n      setError('Please upload a PNG, JPG, WebP, or GIF image');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'image',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Art',\n        order: artPieces.length,\n        media_file: file,\n      });\n\n      const newPiece: ArtPiece = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setArtPieces([...artPieces, newPiece]);\n      setSelectedPieceId(newPiece.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload art');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (pieceId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(pieceId, { title });\n      setArtPieces(artPieces.map(p =>\n        p.id === pieceId ? { ...p, title } : p\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (pieceId: number) => {\n    if (!confirm('Are you sure you want to delete this art piece?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(pieceId);\n      const remaining = artPieces.filter(p => p.id !== pieceId);\n      setArtPieces(remaining);\n      if (selectedPieceId === pieceId) {\n        setSelectedPieceId(remaining[0]?.id || null);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete art piece');\n    }\n  };\n\n  const selectedPiece = artPieces.find(p => p.id === selectedPieceId);\n  const canEditSelectedPiece = selectedPiece && (\n    selectedPiece.owner === currentUser.id || canEditImages\n  );\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Gallery Sidebar */}\n      <div style={{\n        width: 280,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Gallery ({artPieces.length})\n          </span>\n          {canEditImages && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/png,image/jpeg,image/webp,image/gif\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {artPieces.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No art pieces yet.\n              {canEditImages && ' Click \"+ Add\" to upload your first piece.'}\n            </div>\n          ) : (\n            artPieces.map(piece => (\n              <div\n                key={piece.id}\n                onClick={() => setSelectedPieceId(piece.id)}\n                style={{\n                  background: selectedPieceId === piece.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedPieceId === piece.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 8,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 10,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 48,\n                  height: 48,\n                  borderRadius: 6,\n                  background: '#334155',\n                  backgroundImage: piece.media_file ? `url(${piece.media_file})` : undefined,\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center',\n                  flexShrink: 0,\n                }} />\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedPieceId === piece.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {piece.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{piece.owner_username}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Preview Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedPiece ? (\n          <>\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedPiece ? (\n                  <input\n                    type=\"text\"\n                    value={selectedPiece.title}\n                    onChange={(e) => handleUpdateTitle(selectedPiece.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 18,\n                      fontWeight: 600,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 18, fontWeight: 600, margin: 0 }}>\n                    {selectedPiece.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Uploaded by @{selectedPiece.owner_username}\n                </div>\n              </div>\n              {canEditSelectedPiece && (\n                <button\n                  onClick={() => handleDelete(selectedPiece.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Image Display */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              background: '#0f172a',\n              borderRadius: 8,\n              overflow: 'hidden',\n            }}>\n              {selectedPiece.media_file ? (\n                <img\n                  src={selectedPiece.media_file}\n                  alt={selectedPiece.title}\n                  style={{\n                    maxWidth: '100%',\n                    maxHeight: '100%',\n                    objectFit: 'contain',\n                  }}\n                />\n              ) : (\n                <div style={{ color: '#64748b', fontSize: 14 }}>\n                  No image available\n                </div>\n              )}\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {artPieces.length === 0\n              ? 'Upload an image to get started'\n              : 'Select an art piece to view'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeMusicEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface Track {\n  id: number;\n  title: string;\n  media_file: string;\n  duration?: number;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeMusicEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeMusicEditorProps) {\n  const [tracks, setTracks] = useState<Track[]>([]);\n  const [selectedTrackId, setSelectedTrackId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditAudio = currentUserRole?.can_edit?.includes('audio') ?? currentUserRole?.can_edit_audio ?? false;\n\n  useEffect(() => {\n    loadTracks();\n  }, [project.id]);\n\n  const loadTracks = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const audioSections = sections\n        .filter(s => s.section_type === 'audio')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          duration: undefined, // TODO: Parse duration from file if needed\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setTracks(audioSections);\n      if (audioSections.length > 0 && !selectedTrackId) {\n        setSelectedTrackId(audioSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load tracks');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditAudio) {\n      setError(\"You don't have permission to upload audio\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['audio/mpeg', 'audio/mp3', 'audio/wav', 'audio/ogg', 'audio/m4a', 'audio/aac'];\n    if (!validTypes.includes(file.type) && !file.name.match(/\\.(mp3|wav|ogg|m4a|aac)$/i)) {\n      setError('Please upload an MP3, WAV, OGG, M4A, or AAC audio file');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'audio',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Track',\n        order: tracks.length,\n        media_file: file,\n      });\n\n      const newTrack: Track = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        duration: undefined,\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setTracks([...tracks, newTrack]);\n      setSelectedTrackId(newTrack.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload track');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (trackId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(trackId, { title });\n      setTracks(tracks.map(t =>\n        t.id === trackId ? { ...t, title } : t\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (trackId: number) => {\n    if (!confirm('Are you sure you want to delete this track?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(trackId);\n      const remaining = tracks.filter(t => t.id !== trackId);\n      setTracks(remaining);\n      if (selectedTrackId === trackId) {\n        setSelectedTrackId(remaining[0]?.id || null);\n        setPlaying(false);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete track');\n    }\n  };\n\n  const togglePlay = () => {\n    if (!audioRef.current) return;\n    if (playing) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n    setPlaying(!playing);\n  };\n\n  const handleTimeUpdate = () => {\n    if (audioRef.current) {\n      setCurrentTime(audioRef.current.currentTime);\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) {\n      setDuration(audioRef.current.duration);\n    }\n  };\n\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const time = parseFloat(e.target.value);\n    if (audioRef.current) {\n      audioRef.current.currentTime = time;\n      setCurrentTime(time);\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const selectedTrack = tracks.find(t => t.id === selectedTrackId);\n  const canEditSelectedTrack = selectedTrack && (\n    selectedTrack.owner === currentUser.id || canEditAudio\n  );\n\n  // Reset audio when track changes\n  useEffect(() => {\n    setPlaying(false);\n    setCurrentTime(0);\n    setDuration(0);\n  }, [selectedTrackId]);\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Track List Sidebar */}\n      <div style={{\n        width: 320,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Tracks ({tracks.length})\n          </span>\n          {canEditAudio && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add Track'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"audio/*,.mp3,.wav,.ogg,.m4a,.aac\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {tracks.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No tracks yet.\n              {canEditAudio && ' Click \"+ Add Track\" to upload your first track.'}\n            </div>\n          ) : (\n            tracks.map((track, index) => (\n              <div\n                key={track.id}\n                onClick={() => setSelectedTrackId(track.id)}\n                style={{\n                  background: selectedTrackId === track.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedTrackId === track.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 12,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 12,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 32,\n                  height: 32,\n                  borderRadius: 6,\n                  background: selectedTrackId === track.id ? '#f59e0b' : '#334155',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: selectedTrackId === track.id ? '#000' : '#94a3b8',\n                  fontSize: 12,\n                  fontWeight: 700,\n                  flexShrink: 0,\n                }}>\n                  {index + 1}\n                </div>\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedTrackId === track.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {track.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{track.owner_username}\n                    {track.duration && ` - ${formatTime(track.duration)}`}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Player Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedTrack ? (\n          <>\n            {/* Hidden audio element */}\n            <audio\n              ref={audioRef}\n              src={selectedTrack.media_file}\n              onTimeUpdate={handleTimeUpdate}\n              onLoadedMetadata={handleLoadedMetadata}\n              onEnded={() => setPlaying(false)}\n            />\n\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 24,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedTrack ? (\n                  <input\n                    type=\"text\"\n                    value={selectedTrack.title}\n                    onChange={(e) => handleUpdateTitle(selectedTrack.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 24,\n                      fontWeight: 700,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 24, fontWeight: 700, margin: 0 }}>\n                    {selectedTrack.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 13, marginTop: 4 }}>\n                  Uploaded by @{selectedTrack.owner_username}\n                </div>\n              </div>\n              {canEditSelectedTrack && (\n                <button\n                  onClick={() => handleDelete(selectedTrack.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Player UI */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: 32,\n            }}>\n              {/* Album Art Placeholder */}\n              <div style={{\n                width: 200,\n                height: 200,\n                borderRadius: 12,\n                background: 'linear-gradient(135deg, #334155 0%, #1e293b 100%)',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                fontSize: 64,\n              }}>\n                ðŸŽµ\n              </div>\n\n              {/* Play Controls */}\n              <div style={{\n                display: 'flex',\n                flexDirection: 'column',\n                alignItems: 'center',\n                gap: 16,\n                width: '100%',\n                maxWidth: 400,\n              }}>\n                <button\n                  onClick={togglePlay}\n                  disabled={!selectedTrack.media_file}\n                  style={{\n                    width: 64,\n                    height: 64,\n                    borderRadius: '50%',\n                    background: selectedTrack.media_file ? '#f59e0b' : '#334155',\n                    border: 'none',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    cursor: selectedTrack.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 24,\n                  }}\n                >\n                  {playing ? 'â¸ï¸' : 'â–¶ï¸'}\n                </button>\n\n                {/* Progress Bar */}\n                <div style={{ width: '100%', display: 'flex', alignItems: 'center', gap: 12 }}>\n                  <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                    {formatTime(currentTime)}\n                  </span>\n                  <input\n                    type=\"range\"\n                    min={0}\n                    max={duration || 100}\n                    value={currentTime}\n                    onChange={handleSeek}\n                    style={{\n                      flex: 1,\n                      accentColor: '#f59e0b',\n                    }}\n                  />\n                  <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40, textAlign: 'right' }}>\n                    {formatTime(duration)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {tracks.length === 0\n              ? 'Upload an audio track to get started'\n              : 'Select a track to play'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeVideoEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface VideoClip {\n  id: number;\n  title: string;\n  media_file: string;\n  duration?: number;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeVideoEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeVideoEditorProps) {\n  const [clips, setClips] = useState<VideoClip[]>([]);\n  const [selectedClipId, setSelectedClipId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditVideo = currentUserRole?.can_edit?.includes('video') ?? currentUserRole?.can_edit_video ?? false;\n\n  useEffect(() => {\n    loadClips();\n  }, [project.id]);\n\n  const loadClips = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const videoSections = sections\n        .filter(s => s.section_type === 'video')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          duration: undefined, // TODO: Parse duration from file if needed\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setClips(videoSections);\n      if (videoSections.length > 0 && !selectedClipId) {\n        setSelectedClipId(videoSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load video clips');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditVideo) {\n      setError(\"You don't have permission to upload videos\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['video/mp4', 'video/quicktime', 'video/webm', 'video/x-msvideo'];\n    if (!validTypes.includes(file.type) && !file.name.match(/\\.(mp4|mov|webm|avi)$/i)) {\n      setError('Please upload an MP4, MOV, WebM, or AVI video file');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'video',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Clip',\n        order: clips.length,\n        media_file: file,\n      });\n\n      const newClip: VideoClip = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        duration: undefined,\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setClips([...clips, newClip]);\n      setSelectedClipId(newClip.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload video');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (clipId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(clipId, { title });\n      setClips(clips.map(c =>\n        c.id === clipId ? { ...c, title } : c\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (clipId: number) => {\n    if (!confirm('Are you sure you want to delete this video clip?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(clipId);\n      const remaining = clips.filter(c => c.id !== clipId);\n      setClips(remaining);\n      if (selectedClipId === clipId) {\n        setSelectedClipId(remaining[0]?.id || null);\n        setPlaying(false);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete video clip');\n    }\n  };\n\n  const togglePlay = () => {\n    if (!videoRef.current) return;\n    if (playing) {\n      videoRef.current.pause();\n    } else {\n      videoRef.current.play();\n    }\n    setPlaying(!playing);\n  };\n\n  const handleTimeUpdate = () => {\n    if (videoRef.current) {\n      setCurrentTime(videoRef.current.currentTime);\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (videoRef.current) {\n      setDuration(videoRef.current.duration);\n    }\n  };\n\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const time = parseFloat(e.target.value);\n    if (videoRef.current) {\n      videoRef.current.currentTime = time;\n      setCurrentTime(time);\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const toggleFullscreen = () => {\n    if (videoRef.current) {\n      if (document.fullscreenElement) {\n        document.exitFullscreen();\n      } else {\n        videoRef.current.requestFullscreen();\n      }\n    }\n  };\n\n  const selectedClip = clips.find(c => c.id === selectedClipId);\n  const canEditSelectedClip = selectedClip && (\n    selectedClip.owner === currentUser.id || canEditVideo\n  );\n\n  // Reset video when clip changes\n  useEffect(() => {\n    setPlaying(false);\n    setCurrentTime(0);\n    setDuration(0);\n  }, [selectedClipId]);\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Clip List Sidebar */}\n      <div style={{\n        width: 320,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Video Clips ({clips.length})\n          </span>\n          {canEditVideo && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add Clip'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"video/*,.mp4,.mov,.webm,.avi\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {clips.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No video clips yet.\n              {canEditVideo && ' Click \"+ Add Clip\" to upload your first video.'}\n            </div>\n          ) : (\n            clips.map((clip, index) => (\n              <div\n                key={clip.id}\n                onClick={() => setSelectedClipId(clip.id)}\n                style={{\n                  background: selectedClipId === clip.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedClipId === clip.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 8,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 10,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 64,\n                  height: 36,\n                  borderRadius: 4,\n                  background: '#334155',\n                  flexShrink: 0,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                }}>\n                  <span style={{ fontSize: 16 }}>ðŸŽ¬</span>\n                </div>\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedClipId === clip.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {clip.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{clip.owner_username}\n                    {clip.duration && ` - ${formatTime(clip.duration)}`}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Video Player Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedClip ? (\n          <>\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedClip ? (\n                  <input\n                    type=\"text\"\n                    value={selectedClip.title}\n                    onChange={(e) => handleUpdateTitle(selectedClip.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 18,\n                      fontWeight: 600,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 18, fontWeight: 600, margin: 0 }}>\n                    {selectedClip.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Uploaded by @{selectedClip.owner_username}\n                </div>\n              </div>\n              {canEditSelectedClip && (\n                <button\n                  onClick={() => handleDelete(selectedClip.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Video Player */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              gap: 16,\n            }}>\n              <div style={{\n                flex: 1,\n                background: '#0f172a',\n                borderRadius: 8,\n                overflow: 'hidden',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                position: 'relative',\n              }}>\n                {selectedClip.media_file ? (\n                  <video\n                    ref={videoRef}\n                    src={selectedClip.media_file}\n                    onTimeUpdate={handleTimeUpdate}\n                    onLoadedMetadata={handleLoadedMetadata}\n                    onEnded={() => setPlaying(false)}\n                    onClick={togglePlay}\n                    style={{\n                      maxWidth: '100%',\n                      maxHeight: '100%',\n                      cursor: 'pointer',\n                    }}\n                  />\n                ) : (\n                  <div style={{ color: '#64748b', fontSize: 14 }}>\n                    No video available\n                  </div>\n                )}\n              </div>\n\n              {/* Controls */}\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 16,\n                padding: '12px 16px',\n                background: '#0f172a',\n                borderRadius: 8,\n              }}>\n                <button\n                  onClick={togglePlay}\n                  disabled={!selectedClip.media_file}\n                  style={{\n                    width: 40,\n                    height: 40,\n                    borderRadius: '50%',\n                    background: selectedClip.media_file ? '#f59e0b' : '#334155',\n                    border: 'none',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    cursor: selectedClip.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 16,\n                  }}\n                >\n                  {playing ? 'â¸ï¸' : 'â–¶ï¸'}\n                </button>\n\n                <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                  {formatTime(currentTime)}\n                </span>\n\n                <input\n                  type=\"range\"\n                  min={0}\n                  max={duration || 100}\n                  value={currentTime}\n                  onChange={handleSeek}\n                  style={{\n                    flex: 1,\n                    accentColor: '#f59e0b',\n                  }}\n                />\n\n                <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                  {formatTime(duration)}\n                </span>\n\n                <button\n                  onClick={toggleFullscreen}\n                  disabled={!selectedClip.media_file}\n                  style={{\n                    background: 'transparent',\n                    border: '1px solid #334155',\n                    color: '#94a3b8',\n                    padding: '8px 12px',\n                    borderRadius: 6,\n                    cursor: selectedClip.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 12,\n                  }}\n                >\n                  Fullscreen\n                </button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {clips.length === 0\n              ? 'Upload a video clip to get started'\n              : 'Select a clip to play'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  collaborationApi,\n} from '../../services/collaborationApi';\nimport { sanitizeHtml } from '../../utils/sanitize';\nimport { Eye, MessageSquare, Send, FileText, Image, Music, Video, CheckCircle } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ReviewerInterfaceProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  reviewableTypes: string[];\n  onCommentAdd?: (comment: ProjectComment) => void;\n}\n\nexport default function ReviewerInterface({\n  project,\n  currentUser,\n  reviewableTypes,\n  onCommentAdd,\n}: ReviewerInterfaceProps) {\n  const [sections, setSections] = useState<ProjectSection[]>([]);\n  const [comments, setComments] = useState<ProjectComment[]>([]);\n  const [selectedSectionId, setSelectedSectionId] = useState<number | null>(null);\n  const [newComment, setNewComment] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  // Load sections and comments\n  useEffect(() => {\n    loadContent();\n  }, [project.id]);\n\n  const loadContent = async () => {\n    setLoading(true);\n    try {\n      const [sectionsData, commentsData] = await Promise.all([\n        collaborationApi.getProjectSections(project.id),\n        collaborationApi.getComments(project.id),\n      ]);\n\n      // Filter sections to only those the reviewer can see\n      const filteredSections = sectionsData.filter((s: ProjectSection) =>\n        reviewableTypes.includes(s.section_type)\n      );\n      setSections(filteredSections);\n      setComments(commentsData);\n\n      if (filteredSections.length > 0) {\n        setSelectedSectionId(filteredSections[0].id);\n      }\n    } catch (err) {\n      console.error('Failed to load content:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const selectedSection = sections.find(s => s.id === selectedSectionId);\n  const sectionComments = comments.filter(c =>\n    !c.parent_comment // Only top-level comments for now\n  );\n\n  const handleSubmitComment = async () => {\n    if (!newComment.trim()) return;\n\n    setSubmitting(true);\n    try {\n      const comment = await collaborationApi.addComment({\n        project: project.id,\n        content: newComment,\n      });\n      setComments([...comments, comment]);\n      setNewComment('');\n      if (onCommentAdd) {\n        onCommentAdd(comment);\n      }\n    } catch (err) {\n      console.error('Failed to submit comment:', err);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const getSectionIcon = (type: string) => {\n    switch (type) {\n      case 'text': return <FileText size={16} />;\n      case 'image': return <Image size={16} />;\n      case 'audio': return <Music size={16} />;\n      case 'video': return <Video size={16} />;\n      default: return <FileText size={16} />;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div style={{ padding: 40, textAlign: 'center', color: '#94a3b8' }}>\n        Loading content...\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ display: 'grid', gridTemplateColumns: '250px 1fr 300px', gap: 20, height: '100%' }}>\n      {/* Section list */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        overflow: 'auto',\n      }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 16,\n          color: '#f8fafc',\n          fontWeight: 600,\n        }}>\n          <Eye size={18} />\n          Review Content\n        </div>\n\n        <div style={{ fontSize: 11, color: '#64748b', marginBottom: 12 }}>\n          You have read-only access to review the following content types: {reviewableTypes.join(', ')}\n        </div>\n\n        {sections.length === 0 ? (\n          <div style={{ color: '#64748b', fontSize: 13, textAlign: 'center', padding: 20 }}>\n            No content available for review yet.\n          </div>\n        ) : (\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {sections.map(section => (\n              <button\n                key={section.id}\n                onClick={() => setSelectedSectionId(section.id)}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 10,\n                  padding: 12,\n                  background: selectedSectionId === section.id ? 'rgba(245,158,11,0.15)' : '#0f172a',\n                  border: `1px solid ${selectedSectionId === section.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  cursor: 'pointer',\n                  textAlign: 'left',\n                }}\n              >\n                <span style={{ color: selectedSectionId === section.id ? '#f59e0b' : '#94a3b8' }}>\n                  {getSectionIcon(section.section_type)}\n                </span>\n                <div style={{ flex: 1, overflow: 'hidden' }}>\n                  <div style={{\n                    color: selectedSectionId === section.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {section.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    by @{section.owner_username}\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Content viewer */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        overflow: 'auto',\n      }}>\n        {selectedSection ? (\n          <>\n            <div style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div>\n                <h3 style={{ color: '#f8fafc', margin: 0, fontSize: 18 }}>\n                  {selectedSection.title}\n                </h3>\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Written by @{selectedSection.owner_username}\n                </div>\n              </div>\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                padding: '6px 12px',\n                background: 'rgba(16,185,129,0.15)',\n                borderRadius: 6,\n                color: '#10b981',\n                fontSize: 11,\n                fontWeight: 600,\n              }}>\n                <Eye size={14} />\n                Read Only\n              </div>\n            </div>\n\n            {/* Content display based on type */}\n            {selectedSection.section_type === 'text' && (\n              <div\n                style={{\n                  color: '#cbd5e1',\n                  fontSize: 15,\n                  lineHeight: 1.8,\n                }}\n                dangerouslySetInnerHTML={{ __html: sanitizeHtml(selectedSection.content_html) || '<em>No content yet</em>' }}\n              />\n            )}\n\n            {selectedSection.section_type === 'image' && selectedSection.media_file && (\n              <div style={{ textAlign: 'center' }}>\n                <img\n                  src={selectedSection.media_file}\n                  alt={selectedSection.title}\n                  style={{ maxWidth: '100%', borderRadius: 8 }}\n                />\n              </div>\n            )}\n\n            {selectedSection.section_type === 'audio' && selectedSection.media_file && (\n              <audio controls style={{ width: '100%' }}>\n                <source src={selectedSection.media_file} />\n                Your browser does not support the audio element.\n              </audio>\n            )}\n\n            {selectedSection.section_type === 'video' && selectedSection.media_file && (\n              <video controls style={{ width: '100%', borderRadius: 8 }}>\n                <source src={selectedSection.media_file} />\n                Your browser does not support the video element.\n              </video>\n            )}\n          </>\n        ) : (\n          <div style={{ color: '#64748b', textAlign: 'center', padding: 40 }}>\n            Select a section to review\n          </div>\n        )}\n      </div>\n\n      {/* Comments panel */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 16,\n          color: '#f8fafc',\n          fontWeight: 600,\n        }}>\n          <MessageSquare size={18} />\n          Comments ({sectionComments.length})\n        </div>\n\n        {/* Comment list */}\n        <div style={{ flex: 1, overflow: 'auto', marginBottom: 16 }}>\n          {sectionComments.length === 0 ? (\n            <div style={{ color: '#64748b', fontSize: 13, textAlign: 'center', padding: 20 }}>\n              No comments yet. Be the first to leave feedback!\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n              {sectionComments.map(comment => (\n                <div\n                  key={comment.id}\n                  style={{\n                    padding: 12,\n                    background: '#0f172a',\n                    borderRadius: 8,\n                    borderLeft: comment.resolved ? '3px solid #10b981' : '3px solid #334155',\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                    marginBottom: 6,\n                  }}>\n                    <span style={{ color: '#f59e0b', fontWeight: 600, fontSize: 12 }}>\n                      @{comment.author_username}\n                    </span>\n                    {comment.resolved && (\n                      <span style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 4,\n                        color: '#10b981',\n                        fontSize: 10,\n                      }}>\n                        <CheckCircle size={12} />\n                        Resolved\n                      </span>\n                    )}\n                  </div>\n                  <div style={{ color: '#cbd5e1', fontSize: 13, lineHeight: 1.5 }}>\n                    {comment.content}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 10, marginTop: 6 }}>\n                    {new Date(comment.created_at).toLocaleString()}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* New comment input */}\n        <div style={{\n          borderTop: '1px solid #334155',\n          paddingTop: 16,\n        }}>\n          <textarea\n            value={newComment}\n            onChange={(e) => setNewComment(e.target.value)}\n            placeholder=\"Leave feedback or suggestions...\"\n            style={{\n              width: '100%',\n              background: '#0f172a',\n              border: '1px solid #334155',\n              borderRadius: 8,\n              padding: 12,\n              color: '#f8fafc',\n              fontSize: 13,\n              fontFamily: 'inherit',\n              resize: 'none',\n              minHeight: 80,\n            }}\n          />\n          <button\n            onClick={handleSubmitComment}\n            disabled={submitting || !newComment.trim()}\n            style={{\n              width: '100%',\n              marginTop: 8,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: 8,\n              padding: '10px 16px',\n              background: submitting || !newComment.trim() ? '#334155' : '#f59e0b',\n              border: 'none',\n              borderRadius: 8,\n              color: submitting || !newComment.trim() ? '#64748b' : '#000',\n              fontWeight: 600,\n              fontSize: 13,\n              cursor: submitting || !newComment.trim() ? 'not-allowed' : 'pointer',\n            }}\n          >\n            <Send size={14} />\n            {submitting ? 'Submitting...' : 'Submit Comment'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * CommentsPanel Component\n * Collapsible panel for project comments - to be embedded in ContentTab\n */\n\nimport React, { useState } from 'react';\nimport { MessageSquare, ChevronDown, ChevronUp, Eye, EyeOff } from 'lucide-react';\nimport { CollaborativeProject, ProjectComment, CollaboratorRole } from '../../services/collaborationApi';\nimport { useComments } from '../../hooks/useComments';\nimport { CommentThread } from './CommentThread';\nimport CommentComposer from './CommentComposer';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CommentsPanelProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  defaultExpanded?: boolean;\n}\n\nexport function CommentsPanel({\n  project,\n  currentUser,\n  defaultExpanded = false,\n}: CommentsPanelProps) {\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n  const [showResolved, setShowResolved] = useState(false);\n\n  // Comments hook\n  const {\n    comments,\n    unresolvedCount,\n    totalCount,\n    isLoading,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n  } = useComments({\n    projectId: project.id,\n    includeResolved: showResolved,\n    pollingInterval: 30000,\n  });\n\n  const handleAddComment = async (content: string, mentions: number[]) => {\n    try {\n      await addComment(content, mentions);\n    } catch (err) {\n      console.error('Failed to add comment:', err);\n    }\n  };\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        overflow: 'hidden',\n      }}\n    >\n      {/* Header - always visible */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        style={{\n          width: '100%',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          padding: '16px 20px',\n          background: 'transparent',\n          border: 'none',\n          cursor: 'pointer',\n          borderBottom: isExpanded ? '1px solid var(--panel-border)' : 'none',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <MessageSquare size={20} style={{ color: '#06b6d4' }} />\n          <span style={{ fontSize: 16, fontWeight: 600, color: 'var(--text)' }}>\n            Comments\n          </span>\n          {unresolvedCount > 0 && (\n            <span\n              style={{\n                background: '#ef4444',\n                color: '#fff',\n                fontSize: 11,\n                fontWeight: 700,\n                padding: '2px 8px',\n                borderRadius: 10,\n              }}\n            >\n              {unresolvedCount}\n            </span>\n          )}\n          <span style={{ fontSize: 13, color: '#64748b' }}>\n            ({totalCount} total)\n          </span>\n        </div>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          {isExpanded ? (\n            <ChevronUp size={20} style={{ color: '#94a3b8' }} />\n          ) : (\n            <ChevronDown size={20} style={{ color: '#94a3b8' }} />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded content */}\n      {isExpanded && (\n        <div style={{ padding: 20 }}>\n          {/* Comment Composer */}\n          <div style={{ marginBottom: 20 }}>\n            <CommentComposer\n              projectId={project.id}\n              onSubmit={handleAddComment}\n              collaborators={project.collaborators || []}\n              placeholder=\"Add a comment about the content...\"\n            />\n          </div>\n\n          {/* Show resolved toggle */}\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              marginBottom: 16,\n              paddingBottom: 12,\n              borderBottom: '1px solid var(--panel-border)',\n            }}\n          >\n            <span style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)' }}>\n              {showResolved ? 'All Comments' : 'Unresolved Comments'}\n            </span>\n            <button\n              onClick={() => setShowResolved(!showResolved)}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                padding: '6px 12px',\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                cursor: 'pointer',\n                fontSize: 12,\n                color: '#94a3b8',\n              }}\n            >\n              {showResolved ? (\n                <>\n                  <EyeOff size={14} />\n                  Hide resolved\n                </>\n              ) : (\n                <>\n                  <Eye size={14} />\n                  Show resolved\n                </>\n              )}\n            </button>\n          </div>\n\n          {/* Comments list */}\n          {isLoading ? (\n            <div style={{ textAlign: 'center', padding: 20, color: '#94a3b8' }}>\n              Loading comments...\n            </div>\n          ) : comments.length > 0 ? (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n              {comments.map((comment) => (\n                <CommentThread\n                  key={comment.id}\n                  comment={comment}\n                  projectId={project.id}\n                  currentUserId={currentUser.id}\n                  collaborators={project.collaborators || []}\n                  onReply={async (parentId, content, mentions) => {\n                    await addComment(content, mentions, undefined, parentId);\n                  }}\n                  onEdit={async (commentId, content) => {\n                    await updateComment(commentId, content);\n                  }}\n                  onDelete={async (commentId) => {\n                    await deleteComment(commentId);\n                  }}\n                  onResolve={async (commentId) => {\n                    await resolveComment(commentId);\n                  }}\n                  onUnresolve={async (commentId) => {\n                    await unresolveComment(commentId);\n                  }}\n                  onReaction={async (commentId, emoji) => {\n                    await addReaction(commentId, emoji);\n                  }}\n                  onRemoveReaction={async (commentId, reactionId) => {\n                    await removeReaction(commentId, reactionId);\n                  }}\n                />\n              ))}\n            </div>\n          ) : (\n            <div\n              style={{\n                textAlign: 'center',\n                padding: 32,\n                color: '#64748b',\n              }}\n            >\n              <MessageSquare\n                size={32}\n                style={{ color: '#475569', marginBottom: 12 }}\n              />\n              <div style={{ fontSize: 14, fontWeight: 500 }}>\n                {showResolved ? 'No comments yet' : 'No unresolved comments'}\n              </div>\n              <div style={{ fontSize: 13, marginTop: 4 }}>\n                {showResolved\n                  ? 'Start the conversation about this content!'\n                  : 'All comments have been resolved'}\n              </div>\n            </div>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default CommentsPanel;\n","import React from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  CollaboratorRole,\n} from '../../../services/collaborationApi';\nimport CollaborativeEditor from '../CollaborativeEditor';\nimport CollaborativeBookEditor from '../CollaborativeBookEditor';\nimport CollaborativeArtEditor from '../CollaborativeArtEditor';\nimport CollaborativeMusicEditor from '../CollaborativeMusicEditor';\nimport CollaborativeVideoEditor from '../CollaborativeVideoEditor';\nimport CollaborativeComicEditor from '../CollaborativeComicEditor';\nimport ReviewerInterface from '../ReviewerInterface';\nimport { CommentsPanel } from '../CommentsPanel';\nimport { Eye, Palette, Music, Video, FileText, AlertCircle } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ContentTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onSectionUpdate?: (section: ProjectSection) => void;\n  onCommentAdd?: (comment: ProjectComment) => void;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\n// Helper to get user's effective permissions from their role\nfunction getEffectivePermissions(role: CollaboratorRole | undefined) {\n  if (!role) return null;\n\n  // Check new permissions structure first\n  const perms = role.effective_permissions || role.permissions;\n  if (perms && typeof perms === 'object' && Object.keys(perms).length > 0) {\n    return {\n      create: perms.create || [],\n      edit: perms.edit || { scope: 'none', types: [] },\n      review: perms.review || [],\n      ui_components: role.ui_components || [],\n    };\n  }\n\n  // Fallback to legacy boolean flags\n  const create: string[] = [];\n  const editTypes: string[] = [];\n  if (role.can_edit_text) {\n    create.push('text');\n    editTypes.push('text');\n  }\n  if (role.can_edit_images) {\n    create.push('image');\n    editTypes.push('image');\n  }\n  if (role.can_edit_audio) {\n    create.push('audio');\n    editTypes.push('audio');\n  }\n  if (role.can_edit_video) {\n    create.push('video');\n    editTypes.push('video');\n  }\n\n  return {\n    create,\n    edit: { scope: 'own', types: editTypes },\n    review: [],\n    ui_components: role.ui_components || [],\n  };\n}\n\n// Check if user is project owner (has full access)\nfunction isProjectOwner(project: CollaborativeProject, userId: number): boolean {\n  return project.created_by === userId;\n}\n\n// Determine what interface type to show based on permissions\nfunction getInterfaceType(permissions: ReturnType<typeof getEffectivePermissions>): 'creator' | 'reviewer' | 'none' {\n  if (!permissions) return 'none';\n\n  const isCreator =\n    permissions.create.length > 0 ||\n    (permissions.edit.types && permissions.edit.types.length > 0);\n\n  const isReviewer =\n    permissions.review.length > 0 && !isCreator;\n\n  if (isCreator) return 'creator';\n  if (isReviewer) return 'reviewer';\n  return 'none';\n}\n\nexport default function ContentTab({\n  project,\n  currentUser,\n  onSectionUpdate,\n  onCommentAdd,\n  onProjectUpdate,\n}: ContentTabProps) {\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const isOwner = isProjectOwner(project, currentUser.id);\n\n  // Owner sees everything - route by project type\n  if (isOwner) {\n    return (\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>\n        {renderByProjectType(project, currentUser, onSectionUpdate, onCommentAdd, onProjectUpdate)}\n        <CommentsPanel project={project} currentUser={currentUser} />\n      </div>\n    );\n  }\n\n  // Non-owner: check permissions and render appropriate interface\n  const permissions = getEffectivePermissions(currentUserRole);\n  const interfaceType = getInterfaceType(permissions);\n\n  // No permissions - show access denied\n  if (interfaceType === 'none' || !permissions) {\n    return (\n      <div style={{\n        padding: 40,\n        textAlign: 'center',\n        color: '#94a3b8',\n      }}>\n        <AlertCircle size={48} style={{ marginBottom: 16, color: '#f59e0b' }} />\n        <h3 style={{ color: '#f8fafc', marginBottom: 8 }}>No Content Access</h3>\n        <p style={{ fontSize: 14 }}>\n          You don't have permission to view or edit content in this project yet.\n          <br />\n          Contact the project owner to update your permissions.\n        </p>\n      </div>\n    );\n  }\n\n  // Reviewer interface - read-only with commenting\n  if (interfaceType === 'reviewer') {\n    return (\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>\n        <ReviewerInterface\n          project={project}\n          currentUser={currentUser}\n          reviewableTypes={permissions.review}\n          onCommentAdd={onCommentAdd}\n        />\n        <CommentsPanel project={project} currentUser={currentUser} />\n      </div>\n    );\n  }\n\n  // Creator interface - route based on what they can create/edit\n  const uiComponents = permissions.ui_components || [];\n\n  // Check what UI components this role should see\n  const hasChapterEditor = uiComponents.includes('chapter_editor') || permissions.create.includes('text') || permissions.edit.types?.includes('text');\n  const hasImageUploader = uiComponents.includes('image_uploader') || permissions.create.includes('image') || permissions.edit.types?.includes('image');\n  const hasAudioUploader = uiComponents.includes('audio_uploader') || permissions.create.includes('audio') || permissions.edit.types?.includes('audio');\n  const hasVideoUploader = uiComponents.includes('video_uploader') || permissions.create.includes('video') || permissions.edit.types?.includes('video');\n\n  // Route by project type first - all collaborators see the same editor for their project\n  // The individual editors handle permission-based restrictions internally\n  const renderEditorByProjectType = () => {\n    switch (project.content_type) {\n      case 'comic':\n        return (\n          <CollaborativeComicEditor\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n\n      case 'art':\n        return (\n          <CollaborativeArtEditor\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n\n      case 'music':\n        return (\n          <CollaborativeMusicEditor\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n\n      case 'video':\n        return (\n          <CollaborativeVideoEditor\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n\n      case 'book':\n        return (\n          <CollaborativeBookEditor\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n\n      default:\n        // For unknown or mixed project types, use permission-based hybrid interface\n        return (\n          <HybridCreatorInterface\n            project={project}\n            currentUser={currentUser}\n            permissions={permissions}\n            onProjectUpdate={onProjectUpdate}\n          />\n        );\n    }\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 24 }}>\n      {renderEditorByProjectType()}\n      <CommentsPanel project={project} currentUser={currentUser} />\n    </div>\n  );\n}\n\n// Helper: render based on project content type (for owner or fallback)\nfunction renderByProjectType(\n  project: CollaborativeProject,\n  currentUser: { id: number; username: string; display_name?: string },\n  onSectionUpdate?: (section: ProjectSection) => void,\n  onCommentAdd?: (comment: ProjectComment) => void,\n  onProjectUpdate?: (project: CollaborativeProject) => void\n) {\n  switch (project.content_type) {\n    case 'book':\n      return (\n        <CollaborativeBookEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'art':\n      return (\n        <CollaborativeArtEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'music':\n      return (\n        <CollaborativeMusicEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'video':\n      return (\n        <CollaborativeVideoEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'comic':\n      return (\n        <CollaborativeComicEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    default:\n      return (\n        <CollaborativeEditor\n          project={project}\n          currentUser={currentUser}\n          onSectionUpdate={onSectionUpdate}\n          onCommentAdd={onCommentAdd}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n  }\n}\n\n// Hybrid interface for users with multiple content type permissions\ninterface HybridCreatorInterfaceProps {\n  project: CollaborativeProject;\n  currentUser: { id: number; username: string; display_name?: string };\n  permissions: ReturnType<typeof getEffectivePermissions>;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nfunction HybridCreatorInterface({\n  project,\n  currentUser,\n  permissions,\n  onProjectUpdate,\n}: HybridCreatorInterfaceProps) {\n  const [activeTab, setActiveTab] = React.useState<'text' | 'image' | 'audio' | 'video'>('text');\n\n  const hasText = permissions?.create.includes('text') || permissions?.edit.types?.includes('text');\n  const hasImage = permissions?.create.includes('image') || permissions?.edit.types?.includes('image');\n  const hasAudio = permissions?.create.includes('audio') || permissions?.edit.types?.includes('audio');\n  const hasVideo = permissions?.create.includes('video') || permissions?.edit.types?.includes('video');\n\n  // Set initial active tab based on what's available\n  React.useEffect(() => {\n    if (hasText) setActiveTab('text');\n    else if (hasImage) setActiveTab('image');\n    else if (hasAudio) setActiveTab('audio');\n    else if (hasVideo) setActiveTab('video');\n  }, [hasText, hasImage, hasAudio, hasVideo]);\n\n  const tabs = [\n    { key: 'text', label: 'Text', icon: <FileText size={16} />, available: hasText },\n    { key: 'image', label: 'Images', icon: <Palette size={16} />, available: hasImage },\n    { key: 'audio', label: 'Audio', icon: <Music size={16} />, available: hasAudio },\n    { key: 'video', label: 'Video', icon: <Video size={16} />, available: hasVideo },\n  ].filter(t => t.available);\n\n  return (\n    <div>\n      {/* Tab navigation for multiple content types */}\n      {tabs.length > 1 && (\n        <div style={{\n          display: 'flex',\n          gap: 8,\n          marginBottom: 16,\n          borderBottom: '1px solid #334155',\n          paddingBottom: 12,\n        }}>\n          {tabs.map(tab => (\n            <button\n              key={tab.key}\n              onClick={() => setActiveTab(tab.key as any)}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                padding: '8px 16px',\n                background: activeTab === tab.key ? 'rgba(245,158,11,0.15)' : 'transparent',\n                border: `1px solid ${activeTab === tab.key ? '#f59e0b' : '#334155'}`,\n                borderRadius: 8,\n                color: activeTab === tab.key ? '#f59e0b' : '#94a3b8',\n                fontSize: 13,\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              {tab.icon}\n              {tab.label}\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Render appropriate editor based on active tab */}\n      {activeTab === 'text' && hasText && (\n        <CollaborativeBookEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'image' && hasImage && (\n        <CollaborativeArtEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'audio' && hasAudio && (\n        <CollaborativeMusicEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'video' && hasVideo && (\n        <CollaborativeVideoEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport { API_URL } from '../config';\nimport TabNavigation, { TabId } from '../components/collaboration/tabs/TabNavigation';\nimport OverviewTab from '../components/collaboration/tabs/OverviewTab';\nimport TeamTab from '../components/collaboration/tabs/TeamTab';\nimport ActivityTab from '../components/collaboration/tabs/ActivityTab';\nimport PublishTab from '../components/collaboration/tabs/PublishTab';\nimport ContentTab from '../components/collaboration/tabs/ContentTab';\nimport {\n  collaborationApi,\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n} from '../services/collaborationApi';\nimport { AlertTriangle, Pencil } from 'lucide-react';\n\n// Simple User interface - in real app, get from auth context\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\nexport default function CollaborativeProjectPage() {\n  const { projectId } = useParams<{ projectId: string }>();\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const [project, setProject] = useState<CollaborativeProject | null>(null);\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n\n  // Title editing state\n  const [isEditingTitle, setIsEditingTitle] = useState(false);\n  const [editedTitle, setEditedTitle] = useState('');\n  const [savingTitle, setSavingTitle] = useState(false);\n\n  // Tab state from URL or default to 'overview'\n  const activeTab = (searchParams.get('tab') as TabId) || 'overview';\n\n  const setActiveTab = (tab: TabId) => {\n    setSearchParams({ tab });\n  };\n\n  useEffect(() => {\n    loadProjectAndUser();\n  }, [projectId]);\n\n  const loadProjectAndUser = async () => {\n    if (!projectId) {\n      setError('Invalid project ID');\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      // Load project\n      const projectData = await collaborationApi.getCollaborativeProject(parseInt(projectId, 10));\n      setProject(projectData);\n\n      // Get current user from auth status\n      const authResponse = await fetch(`${API_URL}/api/auth/status/`, { credentials: 'include' });\n      const authData = await authResponse.json();\n\n      if (authData.authenticated && authData.user) {\n        setCurrentUser({\n          id: authData.user.id,\n          username: authData.user.username,\n          display_name: authData.user.display_name,\n        });\n      } else {\n        setError('You must be logged in to access this project');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load project');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSectionUpdate = (section: ProjectSection) => {\n    console.log('Section updated:', section);\n    // Optionally refresh project data\n  };\n\n  const handleCommentAdd = (comment: ProjectComment) => {\n    console.log('Comment added:', comment);\n    // Optionally refresh project data\n  };\n\n  const handleProjectUpdate = (updatedProject: CollaborativeProject) => {\n    console.log('Project updated:', updatedProject);\n    setProject(updatedProject);\n  };\n\n  // Save project title\n  const handleSaveTitle = async () => {\n    if (!project || !editedTitle.trim() || editedTitle.trim() === project.title) {\n      setIsEditingTitle(false);\n      return;\n    }\n\n    setSavingTitle(true);\n    try {\n      const csrfRes = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n      const csrfData = await csrfRes.json();\n      const csrf = csrfData?.csrfToken || '';\n\n      const res = await fetch(`${API_URL}/api/collaborative-projects/${project.id}/`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrf,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ title: editedTitle.trim() }),\n      });\n\n      if (res.ok) {\n        const updated = await res.json();\n        setProject(updated);\n        setIsEditingTitle(false);\n      } else {\n        const err = await res.json();\n        console.error('Failed to update title:', err);\n      }\n    } catch (err) {\n      console.error('Failed to update title:', err);\n    } finally {\n      setSavingTitle(false);\n    }\n  };\n\n  const startEditingTitle = () => {\n    setEditedTitle(project?.title || '');\n    setIsEditingTitle(true);\n  };\n\n  const cancelEditingTitle = () => {\n    setIsEditingTitle(false);\n    setEditedTitle('');\n  };\n\n  // Check if title is a placeholder\n  const isPlaceholderTitle = project?.title?.startsWith('Collaboration Invite');\n\n  if (loading) {\n    return (\n      <div className=\"page\" style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          height: '60vh',\n          color: '#94a3b8',\n          fontSize: 16,\n        }}>\n          Loading project...\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"page\" style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>\n        <div style={{\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 12,\n          padding: 24,\n          color: '#ef4444',\n          textAlign: 'center',\n        }}>\n          <div style={{ display: 'flex', justifyContent: 'center', marginBottom: 16 }}>\n            <AlertTriangle size={48} />\n          </div>\n          <div style={{ fontSize: 18, fontWeight: 600, marginBottom: 8 }}>\n            Error Loading Project\n          </div>\n          <div style={{ fontSize: 14, marginBottom: 24 }}>\n            {error}\n          </div>\n          <button\n            onClick={() => navigate('/profile')}\n            style={{\n              background: '#ef4444',\n              border: 'none',\n              borderRadius: 8,\n              padding: '10px 20px',\n              color: '#fff',\n              fontWeight: 600,\n              cursor: 'pointer',\n              fontSize: 14,\n            }}\n          >\n            Back to Dashboard\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!project || !currentUser) {\n    return null;\n  }\n\n  // Calculate badges for tabs\n  const unresolvedComments = project.recent_comments?.filter(c => !c.resolved).length || 0;\n  const pendingApprovals = project.collaborators?.filter(\n    c => c.status === 'accepted' && (!c.approved_current_version || !c.approved_revenue_split)\n  ).length || 0;\n\n  return (\n    <div className=\"page\" style={{\n      maxWidth: activeTab === 'content' ? 'none' : 1400,\n      width: '100%',\n      margin: '0 auto',\n      padding: activeTab === 'content' ? '24px 16px' : 24\n    }}>\n      {/* Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'flex-start',\n        marginBottom: 20,\n      }}>\n        <div>\n          <button\n            onClick={() => navigate('/profile')}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '8px 16px',\n              color: 'var(--text)',\n              cursor: 'pointer',\n              fontSize: 14,\n              marginBottom: 12,\n            }}\n          >\n            &larr; Back to Dashboard\n          </button>\n          {/* Editable Title */}\n          {isEditingTitle ? (\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 8 }}>\n              <input\n                type=\"text\"\n                value={editedTitle}\n                onChange={(e) => setEditedTitle(e.target.value)}\n                placeholder=\"Enter project title...\"\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleSaveTitle();\n                  if (e.key === 'Escape') cancelEditingTitle();\n                }}\n                style={{\n                  fontSize: 28,\n                  fontWeight: 700,\n                  background: 'var(--panel)',\n                  border: '2px solid #f59e0b',\n                  borderRadius: 8,\n                  padding: '8px 16px',\n                  color: 'var(--text)',\n                  minWidth: 400,\n                }}\n              />\n              <button\n                onClick={handleSaveTitle}\n                disabled={savingTitle || !editedTitle.trim()}\n                style={{\n                  background: '#10b981',\n                  border: 'none',\n                  borderRadius: 8,\n                  padding: '10px 20px',\n                  color: '#fff',\n                  fontWeight: 600,\n                  cursor: savingTitle ? 'not-allowed' : 'pointer',\n                  opacity: savingTitle ? 0.6 : 1,\n                }}\n              >\n                {savingTitle ? 'Saving...' : 'Save'}\n              </button>\n              <button\n                onClick={cancelEditingTitle}\n                style={{\n                  background: 'transparent',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 8,\n                  padding: '10px 20px',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          ) : (\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n              <h1 style={{\n                margin: 0,\n                fontSize: 28,\n                fontWeight: 700,\n                color: isPlaceholderTitle ? '#f59e0b' : 'var(--text)',\n              }}>\n                {project.title}\n              </h1>\n              {project.created_by === currentUser.id && (\n                <button\n                  onClick={startEditingTitle}\n                  title=\"Edit project title\"\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    padding: 4,\n                    cursor: 'pointer',\n                    fontSize: 18,\n                    color: '#94a3b8',\n                  }}\n                >\n                  <Pencil size={16} />\n                </button>\n              )}\n            </div>\n          )}\n\n          {/* Placeholder title warning */}\n          {isPlaceholderTitle && !isEditingTitle && (\n            <div style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              marginTop: 8,\n              padding: '8px 12px',\n              background: 'rgba(245, 158, 11, 0.1)',\n              border: '1px solid #f59e0b',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#f59e0b',\n            }}>\n              <AlertTriangle size={16} />\n              <span>\n                {project.created_by === currentUser.id\n                  ? 'This project has a placeholder title. Click the edit button to set a proper title before publishing.'\n                  : 'This project has a placeholder title. Only the owner can change the title.'}\n              </span>\n            </div>\n          )}\n\n          <div style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 12,\n            marginTop: 8,\n          }}>\n            <span style={{\n              background: 'rgba(139, 92, 246, 0.1)',\n              color: '#8b5cf6',\n              padding: '4px 10px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n            }}>\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} Project\n            </span>\n            <span style={{\n              background: project.status === 'ready_for_mint'\n                ? 'rgba(16, 185, 129, 0.1)'\n                : 'rgba(245, 158, 11, 0.1)',\n              color: project.status === 'ready_for_mint' ? '#10b981' : '#f59e0b',\n              padding: '4px 10px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n            }}>\n              {project.status.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase())}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Tab Navigation */}\n      <div style={{ marginBottom: 20 }}>\n        <TabNavigation\n          activeTab={activeTab}\n          onTabChange={setActiveTab}\n          badges={{\n            activity: unresolvedComments,\n            team: pendingApprovals,\n          }}\n          isFullyApproved={project.is_fully_approved}\n        />\n      </div>\n\n      {/* Tab Content */}\n      <div style={{ minHeight: '60vh' }}>\n        {activeTab === 'overview' && (\n          <OverviewTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'content' && (\n          <ContentTab\n            project={project}\n            currentUser={currentUser}\n            onSectionUpdate={handleSectionUpdate}\n            onCommentAdd={handleCommentAdd}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'team' && (\n          <TeamTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'activity' && (\n          <ActivityTab project={project} currentUser={currentUser} />\n        )}\n\n        {activeTab === 'publish' && (\n          <PublishTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n"],"names":["Activity","createLucideIcon","d","key","CircleDot","cx","cy","r","ClipboardList","width","height","x","y","rx","ry","Coins","LayoutDashboard","ListTodo","UserMinus","x1","x2","y1","y2","tabs","id","label","icon","jsx","size","FileText","Users","MessageSquare","Rocket","TabNavigation","activeTab","onTabChange","badges","isFullyApproved","style","display","gap","background","padding","borderRadius","border","children","map","tab","isActive","badge","activity","team","isPublishReady","jsxs","onClick","alignItems","color","cursor","fontSize","fontWeight","transition","position","minWidth","textAlign","COLORS","RevenueSplitChart","collaborators","centerX","centerY","radius","innerRadius","currentAngle","slices","collab","index","percentage","Number","revenue_percentage","startAngle","endAngle","length","polarToCartesian","angle","radians","Math","PI","cos","sin","createArc","outerR","innerR","start","end","startInner","endInner","largeArc","viewBox","slice","fill","stroke","strokeWidth","onMouseEnter","e","target","opacity","onMouseLeave","username","textAnchor","flexDirection","flexShrink","flex","role","toFixed","OverviewTab","project","currentUser","onProjectUpdate","isEditingDescription","setIsEditingDescription","useState","description","setDescription","isProjectLead","created_by","acceptedCollaborators","_a","filter","c","status","totalApproved","approved_current_version","approved_revenue_split","gridTemplateColumns","gridColumn","justifyContent","marginBottom","margin","value","onChange","placeholder","minHeight","lineHeight","resize","marginTop","fontStyle","paddingTop","borderTop","created_by_username","Date","created_at","toLocaleDateString","year","month","day","content_type","charAt","toUpperCase","reduce","sum","is_fully_approved","round","overflow","hasApproved","user","StatCard","_b","sections","_c","recent_comments","_d","progress_percentage","TeamOverview","projectCreatorId","getCollaboratorProgress","collaborator","assignedSections","s","owner","completedSections","content_html","trim","assigned","completed","getStatusBadge","progress","deadline","delivery_deadline","now","daysRemaining","ceil","getTime","days","abs","getDeadlineStatus","XCircle","text","bg","CheckCircle","remaining","AlertTriangle","Clock","statusBadge","isOwner","isLead","is_lead","borderLeft","whiteSpace","title","Check","DollarSign","Fragment","flexWrap","StatusBadge","isOverdue","config","pending","in_progress","complete","signed_off","cancelled","async","fetchCsrf","res","fetch","API_URL","credentials","data","json","csrfToken","TaskTracker","collaboratorRole","currentUserId","isProjectOwner","projectId","onTaskUpdate","expandedTasks","setExpandedTasks","Set","loading","setLoading","error","setError","completionNotes","setCompletionNotes","signoffNotes","setSignoffNotes","rejectionReason","setRejectionReason","isOwnTasks","tasks","contract_tasks","toggleExpand","taskId","prev","next","has","delete","add","all_tasks_complete","tasks_signed_off","tasks_total","has_active_breach","task","isExpanded","canMarkComplete","canSignOff","canReject","isLoadingThis","is_overdue","days_until_deadline","textTransform","completion_notes","marked_complete_by_username","signoff_notes","signed_off_by_username","rejection_notes","csrf","method","headers","body","JSON","stringify","ok","err","message","handleMarkComplete","disabled","handleSignOff","rejection_reason","handleReject","TeamTab","showInviteForm","setShowInviteForm","inviteRole","setInviteRole","invitePercentage","setInvitePercentage","inviteError","setInviteError","inviting","setInviting","respondingToCounterProposal","setRespondingToCounterProposal","counterProposalError","setCounterProposalError","declineMessageFor","setDeclineMessageFor","declineMessage","setDeclineMessage","searchQuery","setSearchQuery","searchResults","setSearchResults","searchLoading","setSearchLoading","selectedUser","setSelectedUser","showDropdown","setShowDropdown","searchDebounceRef","useRef","dropdownRef","leadCollaborator","find","leadPercentage","maxInvitePercentage","max","useEffect","current","clearTimeout","setTimeout","params","URLSearchParams","q","page_size","toString","existingUserIds","filtered","results","u","handleClickOutside","contains","document","addEventListener","removeEventListener","handleCounterProposalResponse","collaboratorId","action","result","collaborationApi","respondToCounterProposal","collaborator_id","updatedProject","getCollaborativeProject","ref","boxSizing","avatar_url","display_name","X","Search","left","top","transform","type","onFocus","right","boxShadow","zIndex","maxHeight","overflowY","handleSelectUser","borderBottom","currentTarget","min","accentColor","inviteCollaborator","user_id","can_edit_text","can_edit_images","can_edit_audio","can_edit_video","some","proposed_percentage","isNaN","isResponding","proposedDiff","textDecoration","counter_message","maxLength","Loader2","animation","projectStates","Map","getProjectState","set","activities","onlineUsers","currentlyEditing","lastUpdated","isPolling","get","CONFIG","pollingIntervals","retryCounts","getFreshCsrfToken","response","API_BASE","apiRequest","url","options","errorData","catch","Error","detail","getProjectActivities","limit","state","events","emit","getOnlineUsers","users","is_online","last_seen","getCurrentlyEditing","editing","sendHeartbeat","pollActivity","Promise","all","retryCount","stopPolling","interval","clearInterval","constructor","__publicField","this","on","event","handler","listeners","off","handlers","forEach","clear","getActivityIcon","section_updated","comment_added","collaborator_joined","collaborator_left","approval_given","approval_requested","ready_for_mint","project_minted","media_uploaded","invitation_sent","getActivityColor","getTimeAgo","dateString","date","seconds","floor","activityService","startEditingSection","sectionId","section_id","stopEditingSection","logActivity","activityType","metadata","activity_type","startPolling","setInterval","getState","getCachedActivities","getCachedOnlineUsers","getCachedCurrentlyEditing","reset","resetAll","isUserEditingSection","userId","getEditorsForSection","useActivity","autoStart","onNewActivity","setActivities","setOnlineUsers","setCurrentlyEditing","isLoading","setIsLoading","setIsPolling","currentEditingSectionRef","refresh","useCallback","activitiesData","onlineUsersData","editingData","startEditing","stopEditing","startPollingCallback","stopPollingCallback","isUserOnline","isSectionBeingEdited","unsubActivities","pid","acts","unsubNew","unsubOnlineUsers","unsubEditing","unsubPollingStarted","unsubPollingStopped","unsubPollingError","getDateGroupLabel","group","groupTimelineByDate","items","groups","item","today","getFullYear","getMonth","getDate","tomorrow","setDate","dayAfterTomorrow","oneWeekFromNow","oneMonthFromNow","setMonth","itemDate","getDateGroup","timestamp","push","groupItems","urgencyStyles","overdue","borderColor","textColor","statusLabel","statusBg","due_today","due_soon","CircleCheck","CheckCircle2","TaskTimelineItem","onViewDetails","urgency","daysUntil","getTaskUrgency","Icon","deadlineDate","formattedDeadline","textOverflow","collaborator_username","collaborator_role","signed_off_at","diffMs","diffMins","diffHours","diffDays","absDays","absHours","absMins","formatRelativeTime","daysOverdue","getTimeIndicator","letterSpacing","activityConfig","FileEdit","MessageCircle","UserPlus","Bell","Sparkles","Upload","Send","ActivityTimelineItem","compact","ActivityIcon","timeAgo","avatar","bottom","section_title","groupStyles","bgColor","this_week","this_month","future","older","UnifiedTimeline","onTaskClick","groupedItems","taskCount","i","activityCount","overdueCount","TimelineGroup","ActivityTab","timelineItems","useMemo","marked_complete_at","sortPriority","sort","a","b","mergeTasksAndActivities","marginRight","PublishTab","step","setStep","minting","setMinting","saving","setSaving","teaserPercent","setTeaserPercent","teaser_percent","watermark","setWatermark","watermark_preview","price","setPrice","parseFloat","String","price_usd","editions","setEditions","authorsNote","setAuthorsNote","authors_note","currentUserRole","titleValid","Boolean","startsWith","hasContentSections","textSections","section_type","hasValidTextContent","replace","mediaSections","hasValidMediaContent","includes","media_file","priceValid","editionsValid","collaboratorsWithTasks","allTasksSignedOff","every","incompleteTaskCount","checklistItems","checked","hint","allChecked","steps","stepIndex","findIndex","userEstimatedEarnings","isCurrent","isCompleted","canClick","placeItems","CustomizeStep","onNext","updateCustomization","authorName","ApproveStep","onApproveVersion","approveCurrentVersion","onApproveRevenue","approveProject","approve_content","approve_revenue","MintStep","onMint","mintProject","ShareStep","wordCount","split","w","isOverLimit","parseInt","fontFamily","CopyrightPreview","userHasApproved","agree","setAgree","gross","platformFee","net","marginLeft","href","rel","projectUrl","window","location","origin","copied","setCopied","PartyPopper","maxWidth","readOnly","navigator","clipboard","writeText","encodeURIComponent","useComments","includeResolved","pollingInterval","flatComments","setFlatComments","comments","setComments","commentsBySection","setCommentsBySection","unresolvedCount","setUnresolvedCount","totalCount","setTotalCount","tree","commentMap","rootComments","comment","replies","commentWithReplies","parent_comment","parent","buildCommentTree","grouped","general","section","groupCommentsBySection","resolved","fetchedComments","getComments","addComment","content","mentions","attachments","parentCommentId","commentSectionId","newComment","updateComment","commentId","updatedComment","deleteComment","resolveComment","unresolveComment","unresolved","addReaction","emoji","reaction","reactions","removeReaction","reactionId","getCommentById","getReplies","OnlineStatus","showLabel","showLastSeen","isOnline","lastSeen","dotSize","small","medium","large","EditingIndicator","editors","editor","othersCount","ActivityFeed","maxItems","showAvatar","displayActivities","ActivityItem","borderLeftColor","CommentComposer","autoFocus","onSubmit","onCancel","initialValue","submitButtonText","setContent","setMentions","setAttachments","isSubmitting","setIsSubmitting","showMentions","setShowMentions","mentionQuery","setMentionQuery","mentionSuggestions","setMentionSuggestions","selectedMentionIndex","setSelectedMentionIndex","mentionStart","setMentionStart","textareaRef","fileInputRef","allSuggestions","displayName","insertMention","suggestion","beforeMention","afterCursor","selectionStart","newContent","newPosition","setSelectionRange","focus","handleSubmit","cursorPosition","textBeforeCursor","lastAtSymbol","lastIndexOf","textAfterAt","query","toLowerCase","onKeyDown","preventDefault","metaKey","ctrlKey","outline","file","name","_","removeAttachment","multiple","files","newFiles","Array","from","click","platform","AVAILABLE_EMOJIS","CommentReactions","onReaction","onRemoveReaction","showPicker","setShowPicker","isAdding","setIsAdding","pickerRef","groupedReactions","hasUserReacted","handleEmojiClick","existingReaction","Object","entries","hasReacted","join","CommentThread","depth","maxDepth","onReply","onEdit","onDelete","onResolve","onUnresolve","showReplyComposer","setShowReplyComposer","showEditComposer","setShowEditComposer","showMenu","setShowMenu","showEditHistory","setShowEditHistory","isAuthor","author","canReply","author_avatar","author_username","edited","edit_history","resolved_by_username","confirm","edit","edited_at","toLocaleString","handleEdit","attachment","file_url","filename","file_size","reply","ApprovalRequestModal","pendingCollaborators","onClose","selectedCollaborators","setSelectedCollaborators","setMessage","setDeadline","stopPropagation","newSelected","handleToggleCollaborator","onBlur","alert","IndividualApprovalView","onApprove","approveContent","setApproveContent","approveRevenue","setApproveRevenue","feedback","setFeedback","currentUserCollab","hasAlreadyApproved","canApprove","totalSections","totalRevenue","revenueSplitsCorrect","_e","_f","isCurrentUser","STAGES","validating","uploading","creating_contract","finalizing","MintingProgressModal","onComplete","currentStage","setCurrentStage","nftData","setNftData","stageOrder","currentStageIndex","indexOf","timer","currentIndex","tokenId","random","contractAddress","ipfsHash","handleClose","stage","isPending","wordBreak","MintingWorkflow","onApprovalRequest","showApprovalRequestModal","setShowApprovalRequestModal","showApprovalView","setShowApprovalView","showMintingProgress","setShowMintingProgress","checklist","setChecklist","isProjectCreator","approvedCollaborators","hasUserApproved","approvalProgress","hasContent","allSectionsComplete","required","allCollaboratorsAccepted","allApproved","allRequiredChecked","canRequestApproval","canMint","canForceMint","backgroundColor","approved","CollaborativeEditor","onSectionUpdate","onCommentAdd","setSections","setCollaborators","currentlyEditingSection","setCurrentlyEditingSection","lastSaved","setLastSaved","showCommentInput","setShowCommentInput","showInviteModal","setShowInviteModal","showPreview","setShowPreview","showActivityFeed","setShowActivityFeed","showResolvedComments","setShowResolvedComments","setActiveTab","commentTotalCount","commentsLoading","canEditSectionType","sectionType","can_edit","ownsSection","loadSections","loadedSections","getProjectSections","handleReplyComment","parentId","parent_comment_id","getSectionTypeBadgeColor","approvalStatus","total","project_status","float","paddingBottom","substring","comment_id","token_id","SectionEditor","sectionNumber","canEdit","isEditing","onStartEdit","onStopEdit","onUpdate","updates","updatedSection","updateProjectSection","handleUpdateSection","deleteProjectSection","handleDeleteSection","onMediaUpload","handleMediaUpload","canAdd","newSection","createProjectSection","order","handleAddSection","formatTimeAgo","setTitle","isBeingEditedByOthers","getSectionColor","getSectionIcon","owner_username","ReactQuill","theme","modules","toolbar","header","list","src","alt","controls","accept","dangerouslySetInnerHTML","__html","sanitizeHtml","minutes","hours","CollaborativeBookEditor","chapters","setChapters","selectedChapterId","setSelectedChapterId","canEditText","loadChapters","synopsis","selectedChapter","ch","canEditSelectedChapter","newChapter","chapter","isSelected","ChapterEditor","chapterId","updateData","updated","handleUpdateChapter","handleDeleteChapter","setSynopsis","showSynopsis","setShowSynopsis","CollaborativeArtEditor","artPieces","setArtPieces","selectedPieceId","setSelectedPieceId","setUploading","canEditImages","loadArtPieces","imageSections","selectedPiece","p","canEditSelectedPiece","newPiece","piece","backgroundImage","backgroundSize","backgroundPosition","pieceId","handleUpdateTitle","handleDelete","objectFit","CollaborativeMusicEditor","tracks","setTracks","selectedTrackId","setSelectedTrackId","playing","setPlaying","currentTime","setCurrentTime","duration","setDuration","audioRef","canEditAudio","loadTracks","audioSections","formatTime","padStart","selectedTrack","t","canEditSelectedTrack","match","newTrack","track","onTimeUpdate","onLoadedMetadata","onEnded","trackId","pause","play","time","CollaborativeVideoEditor","clips","setClips","selectedClipId","setSelectedClipId","videoRef","canEditVideo","loadClips","videoSections","togglePlay","selectedClip","canEditSelectedClip","newClip","clip","clipId","fullscreenElement","exitFullscreen","requestFullscreen","ReviewerInterface","reviewableTypes","selectedSectionId","setSelectedSectionId","setNewComment","submitting","setSubmitting","loadContent","sectionsData","commentsData","filteredSections","selectedSection","sectionComments","Image","Music","Video","Eye","CommentsPanel","defaultExpanded","setIsExpanded","showResolved","setShowResolved","ChevronUp","ChevronDown","EyeOff","ContentTab","renderByProjectType","permissions","perms","effective_permissions","keys","create","scope","types","review","ui_components","editTypes","getEffectivePermissions","interfaceType","isCreator","isReviewer","getInterfaceType","AlertCircle","uiComponents","CollaborativeComicEditor","HybridCreatorInterface","renderEditorByProjectType","React","hasText","hasImage","hasAudio","hasVideo","available","Palette","CollaborativeProjectPage","useParams","navigate","useNavigate","searchParams","setSearchParams","useSearchParams","setProject","setCurrentUser","isEditingTitle","setIsEditingTitle","editedTitle","setEditedTitle","savingTitle","setSavingTitle","loadProjectAndUser","projectData","authResponse","authData","authenticated","handleProjectUpdate","handleSaveTitle","csrfRes","csrfData","cancelEditingTitle","isPlaceholderTitle","className","unresolvedComments","pendingApprovals","Pencil"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6]}