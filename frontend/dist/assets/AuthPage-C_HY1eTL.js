import{C as e,a as t,W as a,O as i,j as n}from"./web3auth-BkZxjmxM.js";import{r,a as o,f as s,L as l}from"./router-cVcvJ1e3.js";import{i as c,A as d}from"./index-wqlrdHmM.js";import"./vendor-Cfs_Iq82.js";function u(){const[u,p]=r.useState(""),[h,g]=r.useState("register"),[y,f]=r.useState(""),[m,x]=r.useState(""),[b,v]=r.useState(""),[w,j]=r.useState(""),[S,k]=r.useState(""),[C,T]=r.useState("account"),[P,W]=r.useState("web3auth"),[R,N]=r.useState(""),[q,A]=r.useState("");o();const[z,I]=r.useState(null),{refreshAuth:X}=c(),[D,E]=r.useState(!1),[F]=s(),[O,_]=r.useState(""),[$,B]=r.useState(null),[L,J]=r.useState(""),[Y,H]=r.useState(!1),[M,U]=r.useState(!1),K=async()=>{try{const e=await fetch(`${d}/api/auth/csrf/`,{credentials:"include"}),t=await e.json(),a=(null==t?void 0:t.csrfToken)||"";return p(a),a}catch{return p(""),""}};r.useEffect(()=>{K()},[]),r.useEffect(()=>{const e=F.get("invite");e&&(_(e),g("register"),G(e))},[F]),r.useEffect(()=>{"wallet"===C&&"web3auth"===P&&D&&(E(!1),setTimeout(()=>{Q()},500))},[C,P,D]);const G=async e=>{if(e&&""!==e.trim()){H(!0);try{const t=await fetch(`${d}/api/beta/validate/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({invite_code:e.trim().toUpperCase()})}),a=await t.json();a.valid?(B(!0),J(a.email||""),a.email&&!m&&x(a.email)):(B(!1),k(a.error||"Invalid invite code"))}catch(t){B(!1),k("Failed to validate invite code")}finally{H(!1)}}else B(null)},V=async()=>{try{const e=await fetch(`${d}/api/auth/status/`,{credentials:"include"}),t=await e.json();if(null==t?void 0:t.authenticated)return!0;if((await fetch(`${d}/api/users/login/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,password:b})})).ok)return await K(),!0}catch(e){}return!1},Q=async()=>{A("Initializing Web3Auth...");try{u||await K();if(!(await V()))return void A("Error: Please sign in again, then retry.");const s="BKECVnfm_tGc5XfDSuwBycgrP0N1sPen30bFwzRxdZFvXSDYzSzJ7tCdYYS3xJ0t_6xU-Qy8Slcr5oBCtK3kNKs",l={chainNamespace:e.SOLANA,chainId:"0x3",rpcTarget:"https://api.devnet.solana.com"},c=new t({config:{chainConfig:l}});A("Connecting to Web3Auth...");const p=new a({clientId:s,web3AuthNetwork:"sapphire_devnet",chainConfig:l,privateKeyProvider:c,uiConfig:{appName:"renaissBlock",mode:"dark",theme:{primary:"#f59e0b"}}}),h=new i({privateKeyProvider:c,adapterSettings:{network:"sapphire_devnet",clientId:s}});p.configureAdapter(h),A("Initializing Web3Auth modal...");try{await p.initModal()}catch(n){return void A(`Error during init: ${n instanceof Error?n.message:String(n)}`)}if(p.connected)try{await p.logout()}catch(r){}A("Opening Web3Auth modal...");try{await p.connect()}catch(o){return void A(`Error: ${o instanceof Error?o.message:String(o)}`)}const g=await p.getUserInfo(),y=(null==g?void 0:g.idToken)||(null==g?void 0:g.id_token);if(!y)return void A("Error: Could not obtain Web3Auth token");A("Linking wallet to your account...");const f=await fetch(`${d}/api/wallet/link/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({web3auth_token:y})});if(f.ok)A("âœ… Wallet created and linked successfully!"),setTimeout(()=>window.location.href="/profile",1500);else{const e=await f.text();A(`Error linking wallet: ${e}`)}}catch(s){A(`Error: ${s instanceof Error?s.message:String(s)}`)}},Z=n.jsxs("div",{className:"page",style:{maxWidth:480,margin:"40px auto"},children:[n.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[n.jsx("button",{className:"login"===h?"chip active":"chip",onClick:()=>g("login"),children:"Sign in"}),n.jsx("button",{className:"register"===h?"chip active":"chip",onClick:()=>g("register"),children:"Create account"})]}),"login"===h?n.jsx("div",{style:{display:"grid",gap:12},children:n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k("");const t=await K();if(t)try{const e=await fetch(`${d}/api/users/login/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,password:b})}),a=await e.json();e.ok?(k("Login successful! Redirecting..."),setTimeout(()=>{window.location.href="/profile"},500)):k(a.error||"Invalid username or password")}catch(a){k("Network error. Please try again.")}else k("Failed to get CSRF token. Please refresh the page.")},style:{display:"grid",gap:12},children:[n.jsx("input",{value:y,onChange:e=>f(e.target.value),placeholder:"Username",required:!0}),n.jsx("input",{type:"password",value:b,onChange:e=>v(e.target.value),placeholder:"Password",required:!0}),n.jsx("button",{type:"submit",style:{marginTop:6},children:"Sign in"})]})}):n.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k(""),!O||""===O.trim())return void k("Beta invite code is required. Please request access from the beta page.");if(!$)return void k("Please provide a valid beta invite code.");const t=await K();if(t)if(b===w)if(!b||b.length<6)k("Password must be at least 6 characters");else if(M)try{const e=await fetch(`${d}/api/users/signup/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,email:m||L,invite_code:O.trim().toUpperCase(),password:b})}),a=await e.json();if(e.ok){await K();if(!(await V()))return k("Signed up successfully! Please sign in with your credentials."),void g("login");X(),"web3auth"===P?(k("Account created! Now let's set up your wallet."),E(!0),T("wallet")):"own"===P?T("wallet"):window.location.href="/"}else a.invite_code?k(Array.isArray(a.invite_code)?a.invite_code[0]:a.invite_code):a.email?k(Array.isArray(a.email)?a.email[0]:a.email):a.username?k(Array.isArray(a.username)?a.username[0]:a.username):a.error?k(a.error):k("Signup failed. Please check your information and try again.")}catch(a){k("Network error. Please try again.")}else k("Please accept the Terms of Service and Privacy Policy to create an account.");else k("Passwords do not match");else k("Failed to get CSRF token. Please refresh the page.")},style:{display:"grid",gap:12},children:[n.jsxs("div",{style:{display:"grid",gap:6},children:[n.jsx("input",{value:O,onChange:e=>{const t=e.target.value;_(t),t.trim().length>=8&&G(t)},placeholder:"Beta Invite Code (required)",required:!0,style:{border:!0===$?"1px solid #10b981":!1===$?"1px solid #ef4444":void 0}}),Y&&n.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:"Validating invite code..."}),!0===$&&n.jsxs("div",{style:{fontSize:12,color:"#10b981"},children:["âœ“ Valid invite code for ",L]}),!1===$&&n.jsx("div",{style:{fontSize:12,color:"#ef4444"},children:"âœ— Invalid or expired invite code"})]}),n.jsx("input",{value:y,onChange:e=>f(e.target.value),placeholder:"Username",required:!0}),n.jsx("input",{type:"email",value:m,onChange:e=>x(e.target.value),placeholder:L?`Email (${L})`:"Email",required:!0}),n.jsx("input",{type:"password",value:b,onChange:e=>v(e.target.value),placeholder:"Password",required:!0}),n.jsx("input",{type:"password",value:w,onChange:e=>j(e.target.value),placeholder:"Confirm password",required:!0}),n.jsx("div",{style:{marginTop:12,padding:12,background:"rgba(255,255,255,0.03)",borderRadius:8,border:"1px solid #334155"},children:n.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,fontSize:13,color:"#cbd5e1",cursor:"pointer"},children:[n.jsx("input",{type:"checkbox",checked:M,onChange:e=>U(e.target.checked),required:!0,style:{marginTop:3}}),n.jsxs("span",{children:["I agree to the"," ",n.jsx("a",{href:"/legal/terms",target:"_blank",rel:"noopener noreferrer",style:{color:"#f59e0b",textDecoration:"none"},children:"Terms of Service"})," ","and"," ",n.jsx("a",{href:"/legal/privacy",target:"_blank",rel:"noopener noreferrer",style:{color:"#f59e0b",textDecoration:"none"},children:"Privacy Policy"})]})]})}),n.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#cbd5e1"},children:[n.jsx("input",{type:"checkbox",checked:"web3auth"===P,onChange:e=>W(e.target.checked?"web3auth":"later")}),"Set up a free Solana wallet for me (automatically created)",n.jsx(l,{to:"/wallet-info",style:{marginLeft:6,color:"#60a5fa"},children:"Learn more"})]}),n.jsxs("div",{style:{display:"flex",gap:12,fontSize:13},children:[n.jsx("button",{type:"button",onClick:()=>W("own"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"I'll use my own wallet"}),n.jsx("button",{type:"button",onClick:()=>W("later"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"I'll set up a wallet later"})]}),"own"===P&&n.jsx("input",{value:R,onChange:e=>N(e.target.value),placeholder:"Your Solana wallet address"})]}),n.jsx("button",{type:"submit",style:{marginTop:6},children:"Create account"})]}),n.jsx("div",{style:{marginTop:10,fontSize:12,color:"#94a3b8"},children:S||"Your session is secured with CSRF & cookies."})]}),ee=n.jsxs("div",{className:"page",style:{maxWidth:480,margin:"40px auto"},children:[n.jsx("div",{style:{fontWeight:700,color:"#e5e7eb",marginBottom:8},children:"Create your wallet"}),"web3auth"===P&&n.jsxs("div",{style:{display:"grid",gap:10},children:[n.jsx("div",{style:{fontSize:13,color:"#94a3b8"},children:"We'll automatically create a Solana wallet for you. No seed phrases needed!"}),n.jsx("button",{onClick:Q,children:"Continue"}),n.jsxs("div",{style:{display:"flex",gap:12},children:[n.jsx("button",{onClick:()=>T("account"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Back to account"}),n.jsx("button",{onClick:()=>T("done"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Skip for now"})]}),n.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:q})]}),"own"===P&&n.jsxs("form",{onSubmit:async e=>{e.preventDefault(),A(""),u||await K();if(!(await V()))return void A("Please sign in again, then retry.");const t=await fetch(`${d}/api/wallet/link/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({wallet_address:R})});if(t.ok)A("Wallet linked"),setTimeout(()=>window.location.href="/profile",500);else{const e=await t.text();A(`Failed: ${e}`)}},style:{display:"grid",gap:10},children:[n.jsx("input",{value:R,onChange:e=>N(e.target.value),placeholder:"Your Solana wallet address"}),n.jsxs("div",{style:{display:"flex",gap:8},children:[n.jsx("button",{type:"submit",children:"Link wallet"}),n.jsx("button",{type:"button",onClick:()=>T("account"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Back"}),n.jsx("button",{type:"button",onClick:()=>T("done"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Skip"})]}),n.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:q})]})]}),te=n.jsx("div",{className:"page",style:{maxWidth:480,margin:"40px auto",textAlign:"center"},children:n.jsxs("div",{children:[n.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#e5e7eb",marginBottom:8},children:"Welcome to renaissBlock! ðŸŽ‰"}),n.jsx("div",{style:{fontSize:13,color:"#94a3b8",marginBottom:16},children:"Your account is ready. You can link a wallet anytime from your profile to receive NFTs and payments."}),n.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[n.jsx("button",{onClick:()=>window.location.href="/",children:"Go to Home"}),n.jsx("button",{onClick:()=>window.location.href="/profile",children:"Go to Profile"})]})]})}),ae="account"===C?0:"wallet"===C?1:2,ie=n.jsx("div",{style:{display:"flex",justifyContent:"center",gap:16,alignItems:"center",maxWidth:800,margin:"24px auto",padding:"0 20px"},children:["Account","Wallet","Done"].map((e,t)=>{const a=t===ae,i=t<ae;return n.jsxs("div",{style:{flex:1,maxWidth:200},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[n.jsx("div",{style:{width:32,height:32,borderRadius:999,border:"2px solid "+(a||i?"#f59e0b":"#334155"),background:a||i?"#f59e0b":"transparent",color:a||i?"#111":"#94a3b8",display:"grid",placeItems:"center",fontSize:14,fontWeight:700,transition:"all 0.3s"},children:t+1}),n.jsx("div",{style:{fontSize:13,color:a?"#f59e0b":i?"#cbd5e1":"#64748b",fontWeight:a?700:500,textAlign:"center"},children:e})]}),n.jsx("div",{style:{height:2,marginTop:8,borderRadius:999,background:a?"linear-gradient(90deg, #f59e0b 0%, rgba(245,158,11,0.3) 100%)":i?"#f59e0b":"#334155",transition:"all 0.3s"}})]},e)})});return n.jsxs("div",{children:["register"===h&&ie,"account"===C&&Z,"wallet"===C&&ee,"done"===C&&te]})}export{u as default};
