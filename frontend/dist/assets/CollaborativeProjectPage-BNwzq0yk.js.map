{"version":3,"file":"CollaborativeProjectPage-BNwzq0yk.js","sources":["../../node_modules/lucide-react/dist/esm/icons/layout-dashboard.js","../../src/components/collaboration/tabs/TabNavigation.tsx","../../src/components/collaboration/RevenueSplitChart.tsx","../../src/components/collaboration/tabs/OverviewTab.tsx","../../src/components/collaboration/TeamOverview.tsx","../../src/components/collaboration/TaskTracker.tsx","../../src/components/collaboration/tabs/TeamTab.tsx","../../src/services/activityService.ts","../../src/hooks/useActivity.ts","../../src/hooks/useComments.ts","../../src/components/collaboration/ActivityFeed.tsx","../../src/components/collaboration/CommentComposer.tsx","../../src/components/collaboration/CommentReactions.tsx","../../src/components/collaboration/CommentThread.tsx","../../src/components/collaboration/tabs/ActivityTab.tsx","../../src/components/collaboration/tabs/PublishTab.tsx","../../src/components/collaboration/OnlineStatus.tsx","../../src/components/collaboration/EditingIndicator.tsx","../../src/components/collaboration/ApprovalRequestModal.tsx","../../src/components/collaboration/IndividualApprovalView.tsx","../../src/components/collaboration/MintingProgressModal.tsx","../../src/components/collaboration/MintingWorkflow.tsx","../../src/components/collaboration/CollaborativeEditor.tsx","../../src/components/collaboration/CollaborativeBookEditor.tsx","../../src/components/collaboration/CollaborativeArtEditor.tsx","../../src/components/collaboration/CollaborativeMusicEditor.tsx","../../src/components/collaboration/CollaborativeVideoEditor.tsx","../../src/components/collaboration/ReviewerInterface.tsx","../../src/components/collaboration/tabs/ContentTab.tsx","../../src/pages/CollaborativeProjectPage.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"7\", height: \"9\", x: \"3\", y: \"3\", rx: \"1\", key: \"10lvy0\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"14\", y: \"3\", rx: \"1\", key: \"16une8\" }],\n  [\"rect\", { width: \"7\", height: \"9\", x: \"14\", y: \"12\", rx: \"1\", key: \"1hutg5\" }],\n  [\"rect\", { width: \"7\", height: \"5\", x: \"3\", y: \"16\", rx: \"1\", key: \"ldoo1y\" }]\n];\nconst LayoutDashboard = createLucideIcon(\"layout-dashboard\", __iconNode);\n\nexport { __iconNode, LayoutDashboard as default };\n//# sourceMappingURL=layout-dashboard.js.map\n","import React from 'react';\nimport { LayoutDashboard, FileText, Users, MessageSquare, Rocket } from 'lucide-react';\n\nexport type TabId = 'overview' | 'content' | 'team' | 'activity' | 'publish';\n\ninterface Tab {\n  id: TabId;\n  label: string;\n  icon: React.ReactNode;\n  badge?: number;\n}\n\ninterface TabNavigationProps {\n  activeTab: TabId;\n  onTabChange: (tab: TabId) => void;\n  badges?: {\n    activity?: number;\n    team?: number;\n  };\n  isFullyApproved?: boolean;\n}\n\nconst tabs: Tab[] = [\n  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={18} /> },\n  { id: 'content', label: 'Content', icon: <FileText size={18} /> },\n  { id: 'team', label: 'Team', icon: <Users size={18} /> },\n  { id: 'activity', label: 'Activity', icon: <MessageSquare size={18} /> },\n  { id: 'publish', label: 'Publish', icon: <Rocket size={18} /> },\n];\n\nexport default function TabNavigation({\n  activeTab,\n  onTabChange,\n  badges = {},\n  isFullyApproved = false,\n}: TabNavigationProps) {\n  return (\n    <div style={{\n      display: 'flex',\n      gap: 4,\n      background: 'var(--panel)',\n      padding: 4,\n      borderRadius: 12,\n      border: '1px solid var(--panel-border)',\n    }}>\n      {tabs.map((tab) => {\n        const isActive = activeTab === tab.id;\n        const badge = tab.id === 'activity' ? badges.activity :\n                     tab.id === 'team' ? badges.team : undefined;\n\n        // Highlight publish tab when ready\n        const isPublishReady = tab.id === 'publish' && isFullyApproved;\n\n        return (\n          <button\n            key={tab.id}\n            onClick={() => onTabChange(tab.id)}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              padding: '10px 16px',\n              background: isActive\n                ? 'var(--bg)'\n                : isPublishReady\n                  ? 'rgba(16, 185, 129, 0.1)'\n                  : 'transparent',\n              border: isActive\n                ? '1px solid var(--panel-border)'\n                : isPublishReady\n                  ? '1px solid rgba(16, 185, 129, 0.3)'\n                  : '1px solid transparent',\n              borderRadius: 8,\n              color: isActive\n                ? 'var(--text)'\n                : isPublishReady\n                  ? '#10b981'\n                  : '#94a3b8',\n              cursor: 'pointer',\n              fontSize: 14,\n              fontWeight: isActive ? 600 : 500,\n              transition: 'all 0.2s ease',\n              position: 'relative',\n            }}\n          >\n            <span style={{ display: 'flex', alignItems: 'center' }}>{tab.icon}</span>\n            <span>{tab.label}</span>\n            {badge !== undefined && badge > 0 && (\n              <span style={{\n                background: '#ef4444',\n                color: '#fff',\n                fontSize: 10,\n                fontWeight: 700,\n                padding: '2px 6px',\n                borderRadius: 10,\n                minWidth: 18,\n                textAlign: 'center',\n              }}>\n                {badge > 99 ? '99+' : badge}\n              </span>\n            )}\n          </button>\n        );\n      })}\n    </div>\n  );\n}\n","import React from 'react';\n\ninterface Collaborator {\n  id: number;\n  username: string;\n  role: string;\n  revenue_percentage: number;\n}\n\ninterface RevenueSplitChartProps {\n  collaborators: Collaborator[];\n  size?: number;\n}\n\n// Color palette for collaborators\nconst COLORS = [\n  '#8b5cf6', // Purple\n  '#f59e0b', // Amber\n  '#10b981', // Green\n  '#3b82f6', // Blue\n  '#ef4444', // Red\n  '#ec4899', // Pink\n  '#06b6d4', // Cyan\n  '#f97316', // Orange\n];\n\nexport default function RevenueSplitChart({\n  collaborators,\n  size = 200,\n}: RevenueSplitChartProps) {\n  const centerX = size / 2;\n  const centerY = size / 2;\n  const radius = size / 2 - 10;\n  const innerRadius = radius * 0.6; // Donut hole\n\n  // Calculate pie slices\n  let currentAngle = -90; // Start at top\n  const slices = collaborators.map((collab, index) => {\n    const percentage = Number(collab.revenue_percentage);\n    const angle = (percentage / 100) * 360;\n    const startAngle = currentAngle;\n    const endAngle = currentAngle + angle;\n    currentAngle = endAngle;\n\n    return {\n      ...collab,\n      color: COLORS[index % COLORS.length],\n      startAngle,\n      endAngle,\n      percentage,\n    };\n  });\n\n  // Convert polar to cartesian coordinates\n  const polarToCartesian = (cx: number, cy: number, r: number, angle: number) => {\n    const radians = (angle * Math.PI) / 180;\n    return {\n      x: cx + r * Math.cos(radians),\n      y: cy + r * Math.sin(radians),\n    };\n  };\n\n  // Create arc path\n  const createArc = (startAngle: number, endAngle: number, outerR: number, innerR: number) => {\n    const start = polarToCartesian(centerX, centerY, outerR, startAngle);\n    const end = polarToCartesian(centerX, centerY, outerR, endAngle);\n    const startInner = polarToCartesian(centerX, centerY, innerR, endAngle);\n    const endInner = polarToCartesian(centerX, centerY, innerR, startAngle);\n\n    const largeArc = endAngle - startAngle > 180 ? 1 : 0;\n\n    return `\n      M ${start.x} ${start.y}\n      A ${outerR} ${outerR} 0 ${largeArc} 1 ${end.x} ${end.y}\n      L ${startInner.x} ${startInner.y}\n      A ${innerR} ${innerR} 0 ${largeArc} 0 ${endInner.x} ${endInner.y}\n      Z\n    `;\n  };\n\n  return (\n    <div style={{ display: 'flex', alignItems: 'center', gap: 24 }}>\n      {/* Donut Chart */}\n      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}>\n        {slices.map((slice, index) => (\n          <path\n            key={slice.id}\n            d={createArc(slice.startAngle, slice.endAngle, radius, innerRadius)}\n            fill={slice.color}\n            stroke=\"var(--panel)\"\n            strokeWidth={2}\n            style={{ transition: 'opacity 0.2s', cursor: 'pointer' }}\n            onMouseEnter={(e) => {\n              (e.target as SVGPathElement).style.opacity = '0.8';\n            }}\n            onMouseLeave={(e) => {\n              (e.target as SVGPathElement).style.opacity = '1';\n            }}\n          >\n            <title>{slice.username}: {slice.percentage}%</title>\n          </path>\n        ))}\n        {/* Center text */}\n        <text\n          x={centerX}\n          y={centerY - 8}\n          textAnchor=\"middle\"\n          fill=\"var(--text)\"\n          fontSize={24}\n          fontWeight={700}\n        >\n          {collaborators.length}\n        </text>\n        <text\n          x={centerX}\n          y={centerY + 14}\n          textAnchor=\"middle\"\n          fill=\"#94a3b8\"\n          fontSize={11}\n        >\n          {collaborators.length === 1 ? 'Creator' : 'Creators'}\n        </text>\n      </svg>\n\n      {/* Legend */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n        {slices.map((slice) => (\n          <div\n            key={slice.id}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 10,\n            }}\n          >\n            <div\n              style={{\n                width: 12,\n                height: 12,\n                borderRadius: 3,\n                background: slice.color,\n                flexShrink: 0,\n              }}\n            />\n            <div style={{ flex: 1 }}>\n              <div style={{\n                fontSize: 13,\n                fontWeight: 600,\n                color: 'var(--text)',\n              }}>\n                @{slice.username}\n              </div>\n              <div style={{\n                fontSize: 11,\n                color: '#94a3b8',\n              }}>\n                {slice.role}\n              </div>\n            </div>\n            <div style={{\n              fontSize: 14,\n              fontWeight: 700,\n              color: slice.color,\n            }}>\n              {Number(slice.percentage).toFixed(2)}%\n            </div>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n","import React, { useState } from 'react';\nimport { CollaborativeProject, CollaboratorRole } from '../../../services/collaborationApi';\nimport RevenueSplitChart from '../RevenueSplitChart';\nimport { FileText, MessageSquare, Users, Rocket } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface OverviewTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nexport default function OverviewTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: OverviewTabProps) {\n  const [isEditingDescription, setIsEditingDescription] = useState(false);\n  const [description, setDescription] = useState(project.description || '');\n\n  const isProjectLead = project.created_by === currentUser.id;\n  const acceptedCollaborators = project.collaborators?.filter(c => c.status === 'accepted') || [];\n  const totalApproved = acceptedCollaborators.filter(\n    c => c.approved_current_version && c.approved_revenue_split\n  ).length;\n\n  return (\n    <div style={{\n      display: 'grid',\n      gridTemplateColumns: 'repeat(12, 1fr)',\n      gap: 20,\n    }}>\n      {/* Proposal Summary - Full width */}\n      <div style={{\n        gridColumn: 'span 12',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'flex-start',\n          marginBottom: 16,\n        }}>\n          <h3 style={{ margin: 0, color: 'var(--text)', fontSize: 18, fontWeight: 600 }}>\n            Project Proposal\n          </h3>\n          {isProjectLead && !isEditingDescription && (\n            <button\n              onClick={() => setIsEditingDescription(true)}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#94a3b8',\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              Edit\n            </button>\n          )}\n        </div>\n\n        {isEditingDescription ? (\n          <div>\n            <textarea\n              value={description}\n              onChange={(e) => setDescription(e.target.value)}\n              placeholder=\"Describe your project proposal, goals, and expectations...\"\n              style={{\n                width: '100%',\n                minHeight: 120,\n                padding: 12,\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                lineHeight: 1.6,\n                resize: 'vertical',\n              }}\n            />\n            <div style={{ display: 'flex', gap: 8, marginTop: 12 }}>\n              <button\n                onClick={() => {\n                  // TODO: Save description via API\n                  setIsEditingDescription(false);\n                }}\n                style={{\n                  background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '8px 16px',\n                  color: '#fff',\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  fontSize: 13,\n                }}\n              >\n                Save\n              </button>\n              <button\n                onClick={() => {\n                  setDescription(project.description || '');\n                  setIsEditingDescription(false);\n                }}\n                style={{\n                  background: 'transparent',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 6,\n                  padding: '8px 16px',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                  fontSize: 13,\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          </div>\n        ) : (\n          <p style={{\n            color: project.description ? '#94a3b8' : '#64748b',\n            fontSize: 14,\n            margin: 0,\n            lineHeight: 1.7,\n            fontStyle: project.description ? 'normal' : 'italic',\n          }}>\n            {project.description || 'No description provided. Click Edit to add one.'}\n          </p>\n        )}\n\n        <div style={{\n          display: 'flex',\n          gap: 24,\n          marginTop: 20,\n          paddingTop: 16,\n          borderTop: '1px solid var(--panel-border)',\n        }}>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Created by</div>\n            <div style={{ fontSize: 13, color: 'var(--text)', fontWeight: 600 }}>\n              @{project.created_by_username}\n            </div>\n          </div>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Created on</div>\n            <div style={{ fontSize: 13, color: 'var(--text)' }}>\n              {new Date(project.created_at).toLocaleDateString('en-US', {\n                year: 'numeric',\n                month: 'long',\n                day: 'numeric',\n              })}\n            </div>\n          </div>\n          <div>\n            <div style={{ fontSize: 11, color: '#64748b', marginBottom: 4 }}>Content Type</div>\n            <div style={{ fontSize: 13, color: 'var(--text)' }}>\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)}\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Revenue Split Chart - Left side */}\n      <div style={{\n        gridColumn: 'span 6',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 16, fontWeight: 600 }}>\n          Revenue Split\n        </h3>\n        {project.collaborators && project.collaborators.length > 0 ? (\n          <RevenueSplitChart\n            collaborators={project.collaborators.map(c => ({\n              id: c.id,\n              username: c.username,\n              role: c.role,\n              revenue_percentage: c.revenue_percentage,\n            }))}\n            size={180}\n          />\n        ) : (\n          <div style={{ color: '#64748b', fontSize: 14 }}>\n            No collaborators yet.\n          </div>\n        )}\n\n        {/* Total check */}\n        {project.collaborators && (\n          <div style={{\n            marginTop: 20,\n            padding: 12,\n            background: 'var(--bg)',\n            borderRadius: 8,\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n          }}>\n            <span style={{ fontSize: 13, color: '#94a3b8' }}>Total</span>\n            <span style={{\n              fontSize: 16,\n              fontWeight: 700,\n              color: project.collaborators.reduce((sum, c) => sum + Number(c.revenue_percentage), 0) === 100\n                ? '#10b981'\n                : '#ef4444',\n            }}>\n              {project.collaborators.reduce((sum, c) => sum + Number(c.revenue_percentage), 0).toFixed(2)}%\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Approval Progress - Right side */}\n      <div style={{\n        gridColumn: 'span 6',\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 16, fontWeight: 600 }}>\n          Approval Progress\n        </h3>\n\n        {/* Progress bar */}\n        <div style={{ marginBottom: 20 }}>\n          <div style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            marginBottom: 8,\n          }}>\n            <span style={{ fontSize: 13, color: '#94a3b8' }}>\n              {totalApproved} of {acceptedCollaborators.length} approved\n            </span>\n            <span style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n            }}>\n              {acceptedCollaborators.length > 0\n                ? Math.round((totalApproved / acceptedCollaborators.length) * 100)\n                : 0}%\n            </span>\n          </div>\n          <div style={{\n            height: 8,\n            background: 'var(--bg)',\n            borderRadius: 4,\n            overflow: 'hidden',\n          }}>\n            <div style={{\n              height: '100%',\n              width: acceptedCollaborators.length > 0\n                ? `${(totalApproved / acceptedCollaborators.length) * 100}%`\n                : '0%',\n              background: project.is_fully_approved\n                ? 'linear-gradient(90deg, #10b981 0%, #059669 100%)'\n                : 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)',\n              borderRadius: 4,\n              transition: 'width 0.3s ease',\n            }} />\n          </div>\n        </div>\n\n        {/* Collaborator approval status */}\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {acceptedCollaborators.map(collab => {\n            const hasApproved = collab.approved_current_version && collab.approved_revenue_split;\n            return (\n              <div\n                key={collab.id}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between',\n                  padding: '10px 12px',\n                  background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg)',\n                  border: `1px solid ${hasApproved ? 'rgba(16, 185, 129, 0.2)' : 'var(--panel-border)'}`,\n                  borderRadius: 8,\n                }}\n              >\n                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                  <div style={{\n                    width: 28,\n                    height: 28,\n                    borderRadius: '50%',\n                    background: hasApproved\n                      ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n                      : 'linear-gradient(135deg, #64748b 0%, #475569 100%)',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 12,\n                    fontWeight: 600,\n                  }}>\n                    {hasApproved ? '‚úì' : collab.username.charAt(0).toUpperCase()}\n                  </div>\n                  <div>\n                    <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                      @{collab.username}\n                      {collab.user === currentUser.id && (\n                        <span style={{ color: '#94a3b8', fontWeight: 400 }}> (you)</span>\n                      )}\n                    </div>\n                    <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                      {collab.role}\n                    </div>\n                  </div>\n                </div>\n                <div style={{\n                  fontSize: 11,\n                  fontWeight: 600,\n                  color: hasApproved ? '#10b981' : '#f59e0b',\n                  background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'rgba(245, 158, 11, 0.1)',\n                  padding: '4px 8px',\n                  borderRadius: 4,\n                }}>\n                  {hasApproved ? 'Approved' : 'Pending'}\n                </div>\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Full approval badge */}\n        {project.is_fully_approved && (\n          <div style={{\n            marginTop: 16,\n            padding: 12,\n            background: 'rgba(16, 185, 129, 0.1)',\n            border: '1px solid #10b981',\n            borderRadius: 8,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            gap: 8,\n          }}>\n            <span style={{ fontSize: 18 }}>&#10003;</span>\n            <span style={{ fontSize: 14, fontWeight: 600, color: '#10b981' }}>\n              Fully Approved - Ready to Mint!\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Quick Stats - Full width */}\n      <div style={{\n        gridColumn: 'span 12',\n        display: 'grid',\n        gridTemplateColumns: 'repeat(4, 1fr)',\n        gap: 16,\n      }}>\n        <StatCard\n          label=\"Sections\"\n          value={project.sections?.length || 0}\n          icon={<FileText size={20} />}\n        />\n        <StatCard\n          label=\"Comments\"\n          value={project.recent_comments?.length || 0}\n          icon={<MessageSquare size={20} />}\n        />\n        <StatCard\n          label=\"Team Members\"\n          value={project.collaborators?.length || 0}\n          icon={<Users size={20} />}\n        />\n        <StatCard\n          label=\"Progress\"\n          value={`${project.progress_percentage || 0}%`}\n          icon={<Rocket size={20} />}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction StatCard({ label, value, icon }: { label: string; value: string | number; icon: React.ReactNode }) {\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 16,\n      display: 'flex',\n      alignItems: 'center',\n      gap: 12,\n    }}>\n      <div style={{\n        width: 40,\n        height: 40,\n        borderRadius: 8,\n        background: 'var(--bg)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        color: '#94a3b8',\n      }}>\n        {icon}\n      </div>\n      <div>\n        <div style={{ fontSize: 20, fontWeight: 700, color: 'var(--text)' }}>\n          {value}\n        </div>\n        <div style={{ fontSize: 12, color: '#94a3b8' }}>\n          {label}\n        </div>\n      </div>\n    </div>\n  );\n}\n","/**\n * TeamOverview Component\n *\n * Dashboard-style view showing all collaborators' status,\n * deadlines, and progress on a collaborative project.\n */\n\nimport React from 'react';\nimport { CollaboratorRole, ProjectSection } from '../../services/collaborationApi';\n\ninterface TeamOverviewProps {\n  collaborators: CollaboratorRole[];\n  sections: ProjectSection[];\n  projectCreatorId: number;\n}\n\nexport function TeamOverview({\n  collaborators,\n  sections,\n  projectCreatorId,\n}: TeamOverviewProps) {\n  // Calculate section completion for each collaborator\n  const getCollaboratorProgress = (collaborator: CollaboratorRole) => {\n    const assignedSections = sections.filter(\n      (s) => s.owner === collaborator.user\n    );\n    const completedSections = assignedSections.filter(\n      (s) => s.content_html && s.content_html.trim().length > 0\n    );\n    return {\n      assigned: assignedSections.length,\n      completed: completedSections.length,\n    };\n  };\n\n  // Check deadline status\n  const getDeadlineStatus = (collaborator: CollaboratorRole) => {\n    if (!collaborator.delivery_deadline) return null;\n\n    const deadline = new Date(collaborator.delivery_deadline);\n    const now = new Date();\n    const daysRemaining = Math.ceil(\n      (deadline.getTime() - now.getTime()) / (1000 * 60 * 60 * 24)\n    );\n\n    if (daysRemaining < 0) {\n      return { status: 'overdue', days: Math.abs(daysRemaining), color: '#ef4444' };\n    } else if (daysRemaining <= 3) {\n      return { status: 'soon', days: daysRemaining, color: '#f59e0b' };\n    } else {\n      return { status: 'ok', days: daysRemaining, color: '#10b981' };\n    }\n  };\n\n  // Get collaborator status badge\n  const getStatusBadge = (collaborator: CollaboratorRole) => {\n    const progress = getCollaboratorProgress(collaborator);\n    const deadline = getDeadlineStatus(collaborator);\n\n    // Overdue\n    if (deadline?.status === 'overdue') {\n      return {\n        icon: '‚ùå',\n        text: `${deadline.days}d overdue`,\n        color: '#ef4444',\n        bg: '#ef444420',\n      };\n    }\n\n    // All sections complete\n    if (progress.assigned > 0 && progress.completed === progress.assigned) {\n      return {\n        icon: '‚úÖ',\n        text: `${progress.completed}/${progress.assigned} complete`,\n        color: '#10b981',\n        bg: '#10b98120',\n      };\n    }\n\n    // Has pending sections\n    if (progress.assigned > 0) {\n      const remaining = progress.assigned - progress.completed;\n      if (deadline?.status === 'soon') {\n        return {\n          icon: 'üî∂',\n          text: `${remaining} section${remaining > 1 ? 's' : ''} due in ${deadline.days}d`,\n          color: '#f59e0b',\n          bg: '#f59e0b20',\n        };\n      }\n      return {\n        icon: '‚è≥',\n        text: `${progress.completed}/${progress.assigned} sections`,\n        color: '#3b82f6',\n        bg: '#3b82f620',\n      };\n    }\n\n    // No sections assigned\n    return {\n      icon: 'üìù',\n      text: 'No sections assigned',\n      color: '#64748b',\n      bg: '#64748b20',\n    };\n  };\n\n  return (\n    <div\n      style={{\n        background: '#0f172a',\n        border: '1px solid #1e293b',\n        borderRadius: 12,\n        padding: 20,\n      }}\n    >\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 20,\n        }}\n      >\n        <span style={{ fontSize: 20 }}>üë•</span>\n        <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 16, fontWeight: 600 }}>\n          Team Overview\n        </h3>\n        <span\n          style={{\n            background: '#334155',\n            color: '#94a3b8',\n            padding: '2px 10px',\n            borderRadius: 12,\n            fontSize: 12,\n            fontWeight: 500,\n          }}\n        >\n          {collaborators.filter((c) => c.status === 'accepted').length} active\n        </span>\n      </div>\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {collaborators\n          .filter((c) => c.status === 'accepted')\n          .map((collaborator) => {\n            const progress = getCollaboratorProgress(collaborator);\n            const statusBadge = getStatusBadge(collaborator);\n            const isOwner = collaborator.user === projectCreatorId;\n            const isLead = collaborator.is_lead;\n\n            return (\n              <div\n                key={collaborator.id}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 12,\n                  padding: 12,\n                  background: '#1e293b',\n                  borderRadius: 10,\n                  borderLeft: `3px solid ${statusBadge.color}`,\n                }}\n              >\n                {/* Avatar placeholder */}\n                <div\n                  style={{\n                    width: 40,\n                    height: 40,\n                    borderRadius: '50%',\n                    background: `linear-gradient(135deg, ${\n                      isOwner ? '#f59e0b' : '#3b82f6'\n                    } 0%, ${isOwner ? '#d97706' : '#2563eb'} 100%)`,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontWeight: 700,\n                    fontSize: 14,\n                    flexShrink: 0,\n                  }}\n                >\n                  {collaborator.username.charAt(0).toUpperCase()}\n                </div>\n\n                {/* Info */}\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                    <span\n                      style={{\n                        color: '#f8fafc',\n                        fontWeight: 600,\n                        fontSize: 14,\n                      }}\n                    >\n                      @{collaborator.username}\n                    </span>\n                    {isOwner && (\n                      <span\n                        style={{\n                          background: '#f59e0b',\n                          color: '#000',\n                          padding: '2px 8px',\n                          borderRadius: 4,\n                          fontSize: 10,\n                          fontWeight: 700,\n                        }}\n                      >\n                        OWNER\n                      </span>\n                    )}\n                    {isLead && !isOwner && (\n                      <span\n                        style={{\n                          background: '#8b5cf6',\n                          color: '#fff',\n                          padding: '2px 8px',\n                          borderRadius: 4,\n                          fontSize: 10,\n                          fontWeight: 700,\n                        }}\n                      >\n                        LEAD\n                      </span>\n                    )}\n                  </div>\n                  <div\n                    style={{\n                      color: '#94a3b8',\n                      fontSize: 12,\n                      marginTop: 2,\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: 8,\n                    }}\n                  >\n                    <span>{collaborator.role}</span>\n                    <span style={{ color: '#64748b' }}>‚Ä¢</span>\n                    <span style={{ color: '#10b981' }}>\n                      {collaborator.revenue_percentage}%\n                    </span>\n                  </div>\n                </div>\n\n                {/* Progress bar for sections */}\n                {progress.assigned > 0 && (\n                  <div style={{ width: 80 }}>\n                    <div\n                      style={{\n                        height: 6,\n                        background: '#334155',\n                        borderRadius: 3,\n                        overflow: 'hidden',\n                      }}\n                    >\n                      <div\n                        style={{\n                          width: `${(progress.completed / progress.assigned) * 100}%`,\n                          height: '100%',\n                          background:\n                            progress.completed === progress.assigned\n                              ? '#10b981'\n                              : '#3b82f6',\n                          transition: 'width 0.3s ease',\n                        }}\n                      />\n                    </div>\n                  </div>\n                )}\n\n                {/* Status badge */}\n                <div\n                  style={{\n                    background: statusBadge.bg,\n                    color: statusBadge.color,\n                    padding: '6px 12px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 500,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 6,\n                    whiteSpace: 'nowrap',\n                  }}\n                >\n                  <span>{statusBadge.icon}</span>\n                  {statusBadge.text}\n                </div>\n\n                {/* Approval status */}\n                <div\n                  style={{\n                    display: 'flex',\n                    gap: 4,\n                    flexShrink: 0,\n                  }}\n                  title={`Content: ${\n                    collaborator.approved_current_version ? 'Approved' : 'Pending'\n                  }, Revenue: ${collaborator.approved_revenue_split ? 'Approved' : 'Pending'}`}\n                >\n                  <div\n                    style={{\n                      width: 24,\n                      height: 24,\n                      borderRadius: 4,\n                      background: collaborator.approved_current_version\n                        ? '#10b98120'\n                        : '#64748b20',\n                      color: collaborator.approved_current_version\n                        ? '#10b981'\n                        : '#64748b',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      fontSize: 12,\n                    }}\n                  >\n                    {collaborator.approved_current_version ? '‚úì' : '‚óã'}\n                  </div>\n                  <div\n                    style={{\n                      width: 24,\n                      height: 24,\n                      borderRadius: 4,\n                      background: collaborator.approved_revenue_split\n                        ? '#10b98120'\n                        : '#64748b20',\n                      color: collaborator.approved_revenue_split\n                        ? '#10b981'\n                        : '#64748b',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      fontSize: 12,\n                    }}\n                  >\n                    {collaborator.approved_revenue_split ? 'üí∞' : '‚óã'}\n                  </div>\n                </div>\n              </div>\n            );\n          })}\n\n        {/* Pending invites */}\n        {collaborators.filter((c) => c.status === 'invited').length > 0 && (\n          <>\n            <div\n              style={{\n                borderTop: '1px solid #334155',\n                margin: '8px 0',\n                paddingTop: 12,\n              }}\n            >\n              <span style={{ color: '#64748b', fontSize: 12, fontWeight: 600 }}>\n                PENDING INVITES\n              </span>\n            </div>\n            {collaborators\n              .filter((c) => c.status === 'invited')\n              .map((collaborator) => (\n                <div\n                  key={collaborator.id}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 12,\n                    padding: 12,\n                    background: '#1e293b',\n                    borderRadius: 10,\n                    borderLeft: '3px solid #f59e0b',\n                    opacity: 0.7,\n                  }}\n                >\n                  <div\n                    style={{\n                      width: 40,\n                      height: 40,\n                      borderRadius: '50%',\n                      background: '#334155',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      color: '#94a3b8',\n                      fontWeight: 700,\n                      fontSize: 14,\n                      flexShrink: 0,\n                    }}\n                  >\n                    {collaborator.username.charAt(0).toUpperCase()}\n                  </div>\n                  <div style={{ flex: 1 }}>\n                    <div style={{ color: '#94a3b8', fontWeight: 500, fontSize: 14 }}>\n                      @{collaborator.username}\n                    </div>\n                    <div style={{ color: '#64748b', fontSize: 12 }}>\n                      {collaborator.role} ‚Ä¢ {collaborator.revenue_percentage}%\n                    </div>\n                  </div>\n                  <span\n                    style={{\n                      background: '#f59e0b20',\n                      color: '#f59e0b',\n                      padding: '6px 12px',\n                      borderRadius: 6,\n                      fontSize: 12,\n                      fontWeight: 500,\n                    }}\n                  >\n                    Awaiting response\n                  </span>\n                </div>\n              ))}\n          </>\n        )}\n      </div>\n\n      {/* Summary footer */}\n      <div\n        style={{\n          marginTop: 16,\n          paddingTop: 16,\n          borderTop: '1px solid #334155',\n          display: 'flex',\n          gap: 16,\n          flexWrap: 'wrap',\n        }}\n      >\n        <div style={{ fontSize: 12, color: '#64748b' }}>\n          <span style={{ color: '#10b981' }}>‚úì</span> Content Approved\n        </div>\n        <div style={{ fontSize: 12, color: '#64748b' }}>\n          <span style={{ color: '#10b981' }}>üí∞</span> Revenue Approved\n        </div>\n        <div style={{ fontSize: 12, color: '#64748b' }}>\n          <span>‚óã</span> Pending\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default TeamOverview;\n","/**\n * TaskTracker Component\n *\n * Displays and manages contract tasks for a collaborator.\n * - Collaborators can mark tasks as complete\n * - Owners can sign off or reject completed tasks\n * - Shows task status, deadlines, and overdue warnings\n */\n\nimport React, { useState } from 'react';\nimport { API_URL } from '../../config';\n\n// Task status type\ntype TaskStatus = 'pending' | 'in_progress' | 'complete' | 'signed_off' | 'cancelled';\n\n// Contract task interface\ninterface ContractTask {\n  id: number;\n  title: string;\n  description: string;\n  deadline: string;\n  status: TaskStatus;\n  order: number;\n  marked_complete_at?: string;\n  marked_complete_by_username?: string;\n  completion_notes?: string;\n  signed_off_at?: string;\n  signed_off_by_username?: string;\n  signoff_notes?: string;\n  rejection_notes?: string;\n  rejected_at?: string;\n  is_overdue: boolean;\n  days_until_deadline?: number;\n}\n\n// Collaborator role interface (partial)\ninterface CollaboratorRole {\n  id: number;\n  user: number;\n  username: string;\n  display_name?: string;\n  role: string;\n  revenue_percentage: number;\n  tasks_total: number;\n  tasks_signed_off: number;\n  all_tasks_complete: boolean;\n  has_active_breach: boolean;\n  cancellation_eligible: boolean;\n  contract_tasks: ContractTask[];\n}\n\ninterface TaskTrackerProps {\n  collaboratorRole: CollaboratorRole;\n  currentUserId: number;\n  isProjectOwner: boolean;\n  projectId: number;\n  onTaskUpdate: () => void;\n}\n\n// Status badge component\nfunction StatusBadge({ status, isOverdue }: { status: TaskStatus; isOverdue: boolean }) {\n  const statusConfig: Record<TaskStatus, { bg: string; color: string; label: string }> = {\n    pending: { bg: '#64748b20', color: '#94a3b8', label: 'Pending' },\n    in_progress: { bg: '#3b82f620', color: '#60a5fa', label: 'In Progress' },\n    complete: { bg: '#f59e0b20', color: '#fbbf24', label: 'Awaiting Sign-off' },\n    signed_off: { bg: '#10b98120', color: '#34d399', label: 'Signed Off' },\n    cancelled: { bg: '#ef444420', color: '#f87171', label: 'Cancelled' },\n  };\n\n  if (isOverdue && status !== 'signed_off' && status !== 'cancelled') {\n    return (\n      <span\n        style={{\n          background: '#ef444430',\n          color: '#f87171',\n          padding: '4px 10px',\n          borderRadius: 6,\n          fontSize: 11,\n          fontWeight: 600,\n          display: 'flex',\n          alignItems: 'center',\n          gap: 4,\n        }}\n      >\n        <span>üö®</span> Overdue\n      </span>\n    );\n  }\n\n  const config = statusConfig[status];\n  return (\n    <span\n      style={{\n        background: config.bg,\n        color: config.color,\n        padding: '4px 10px',\n        borderRadius: 6,\n        fontSize: 11,\n        fontWeight: 600,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// Helper to fetch CSRF token\nasync function fetchCsrf(): Promise<string> {\n  try {\n    const res = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n    const data = await res.json();\n    return data?.csrfToken || '';\n  } catch {\n    return '';\n  }\n}\n\nexport function TaskTracker({\n  collaboratorRole,\n  currentUserId,\n  isProjectOwner,\n  projectId,\n  onTaskUpdate,\n}: TaskTrackerProps) {\n  const [expandedTasks, setExpandedTasks] = useState<Set<number>>(new Set());\n  const [loading, setLoading] = useState<number | null>(null);\n  const [error, setError] = useState<string>('');\n  const [completionNotes, setCompletionNotes] = useState<Record<number, string>>({});\n  const [signoffNotes, setSignoffNotes] = useState<Record<number, string>>({});\n  const [rejectionReason, setRejectionReason] = useState<Record<number, string>>({});\n\n  const isOwnTasks = collaboratorRole.user === currentUserId;\n  const tasks = collaboratorRole.contract_tasks || [];\n\n  const toggleExpand = (taskId: number) => {\n    setExpandedTasks((prev) => {\n      const next = new Set(prev);\n      if (next.has(taskId)) {\n        next.delete(taskId);\n      } else {\n        next.add(taskId);\n      }\n      return next;\n    });\n  };\n\n  // Mark task as complete\n  const handleMarkComplete = async (taskId: number) => {\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/mark-complete/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            completion_notes: completionNotes[taskId] || '',\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to mark task complete');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to mark task complete');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  // Sign off on task\n  const handleSignOff = async (taskId: number) => {\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/sign-off/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            signoff_notes: signoffNotes[taskId] || '',\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to sign off on task');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to sign off on task');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  // Reject completion\n  const handleReject = async (taskId: number) => {\n    if (!rejectionReason[taskId]?.trim()) {\n      setError('Please provide a reason for rejection');\n      return;\n    }\n\n    setLoading(taskId);\n    setError('');\n    try {\n      const csrf = await fetchCsrf();\n      const res = await fetch(\n        `/api/collaborative-projects/${projectId}/tasks/${taskId}/reject-completion/`,\n        {\n          method: 'POST',\n          headers: {\n            'Content-Type': 'application/json',\n            'X-CSRFToken': csrf,\n            'X-Requested-With': 'XMLHttpRequest',\n          },\n          credentials: 'include',\n          body: JSON.stringify({\n            rejection_reason: rejectionReason[taskId],\n          }),\n        }\n      );\n\n      if (res.ok) {\n        onTaskUpdate();\n        setRejectionReason((prev) => ({ ...prev, [taskId]: '' }));\n      } else {\n        const data = await res.json();\n        setError(data.error || 'Failed to reject task');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to reject task');\n    } finally {\n      setLoading(null);\n    }\n  };\n\n  if (tasks.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 20,\n          background: '#1e293b',\n          borderRadius: 12,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 13,\n        }}\n      >\n        No contract tasks defined for this collaborator.\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: 16,\n        }}\n      >\n        <div>\n          <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n            <span style={{ fontSize: 20 }}>üìã</span>\n            <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 16, fontWeight: 600 }}>\n              Contract Tasks for @{collaboratorRole.username}\n            </h3>\n          </div>\n          <div style={{ marginTop: 6, color: '#94a3b8', fontSize: 12 }}>\n            {collaboratorRole.role} ‚Ä¢ {collaboratorRole.revenue_percentage}% revenue share\n          </div>\n        </div>\n\n        {/* Progress */}\n        <div style={{ textAlign: 'right' }}>\n          <div\n            style={{\n              color: collaboratorRole.all_tasks_complete ? '#10b981' : '#f59e0b',\n              fontSize: 18,\n              fontWeight: 700,\n            }}\n          >\n            {collaboratorRole.tasks_signed_off}/{collaboratorRole.tasks_total}\n          </div>\n          <div style={{ color: '#64748b', fontSize: 11 }}>signed off</div>\n        </div>\n      </div>\n\n      {/* Progress bar */}\n      <div\n        style={{\n          height: 6,\n          background: '#0f172a',\n          borderRadius: 3,\n          marginBottom: 20,\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          style={{\n            height: '100%',\n            width: `${(collaboratorRole.tasks_signed_off / collaboratorRole.tasks_total) * 100}%`,\n            background: collaboratorRole.all_tasks_complete\n              ? '#10b981'\n              : 'linear-gradient(90deg, #f59e0b, #fbbf24)',\n            borderRadius: 3,\n            transition: 'width 0.3s ease',\n          }}\n        />\n      </div>\n\n      {/* Breach warning */}\n      {collaboratorRole.has_active_breach && (\n        <div\n          style={{\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            borderRadius: 8,\n            padding: 12,\n            marginBottom: 16,\n            display: 'flex',\n            alignItems: 'center',\n            gap: 10,\n          }}\n        >\n          <span style={{ fontSize: 18 }}>üö®</span>\n          <div style={{ color: '#f87171', fontSize: 13 }}>\n            <strong>Deadline Breach:</strong> One or more tasks are past their deadline.\n            {isProjectOwner && ' You may cancel, extend deadlines, or waive the breach.'}\n          </div>\n        </div>\n      )}\n\n      {/* Error message */}\n      {error && (\n        <div\n          style={{\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            color: '#f87171',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}\n        >\n          {error}\n        </div>\n      )}\n\n      {/* Task list */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {tasks.map((task) => {\n          const isExpanded = expandedTasks.has(task.id);\n          const canMarkComplete = isOwnTasks && task.status === 'in_progress';\n          const canSignOff = isProjectOwner && task.status === 'complete';\n          const canReject = isProjectOwner && task.status === 'complete';\n          const isLoadingThis = loading === task.id;\n\n          return (\n            <div\n              key={task.id}\n              style={{\n                background: '#0f172a',\n                border: `1px solid ${task.is_overdue ? '#ef4444' : '#334155'}`,\n                borderRadius: 10,\n                overflow: 'hidden',\n              }}\n            >\n              {/* Task header */}\n              <div\n                onClick={() => toggleExpand(task.id)}\n                style={{\n                  padding: 16,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'flex-start',\n                  gap: 12,\n                }}\n              >\n                <div style={{ flex: 1 }}>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 10, marginBottom: 6 }}>\n                    <StatusBadge status={task.status} isOverdue={task.is_overdue} />\n                    <span\n                      style={{\n                        color: '#f8fafc',\n                        fontSize: 14,\n                        fontWeight: 600,\n                      }}\n                    >\n                      {task.title}\n                    </span>\n                  </div>\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 12, color: '#64748b', fontSize: 12 }}>\n                    <span>\n                      Due: {new Date(task.deadline).toLocaleDateString('en-US', {\n                        month: 'short',\n                        day: 'numeric',\n                        year: 'numeric',\n                      })}\n                    </span>\n                    {task.days_until_deadline !== undefined && task.status !== 'signed_off' && (\n                      <span\n                        style={{\n                          color: task.days_until_deadline < 0 ? '#f87171' : task.days_until_deadline < 3 ? '#fbbf24' : '#64748b',\n                        }}\n                      >\n                        {task.days_until_deadline < 0\n                          ? `${Math.abs(task.days_until_deadline)} days overdue`\n                          : task.days_until_deadline === 0\n                          ? 'Due today'\n                          : `${task.days_until_deadline} days left`}\n                      </span>\n                    )}\n                  </div>\n                </div>\n                <span style={{ color: '#64748b', fontSize: 18 }}>{isExpanded ? '‚ñº' : '‚ñ∂'}</span>\n              </div>\n\n              {/* Expanded details */}\n              {isExpanded && (\n                <div style={{ padding: '0 16px 16px', borderTop: '1px solid #334155' }}>\n                  {/* Description */}\n                  {task.description && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#94a3b8', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Description\n                      </div>\n                      <div style={{ color: '#cbd5e1', fontSize: 13, lineHeight: 1.6 }}>\n                        {task.description}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Completion notes */}\n                  {task.completion_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#94a3b8', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Completion Notes from @{task.marked_complete_by_username}\n                      </div>\n                      <div\n                        style={{\n                          color: '#cbd5e1',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#1e293b',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.completion_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Sign-off notes */}\n                  {task.signoff_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#10b981', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Signed Off by @{task.signed_off_by_username}\n                      </div>\n                      <div\n                        style={{\n                          color: '#34d399',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#10b98120',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.signoff_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Rejection notes */}\n                  {task.rejection_notes && (\n                    <div style={{ marginTop: 12 }}>\n                      <div style={{ color: '#f87171', fontSize: 11, marginBottom: 4, textTransform: 'uppercase' }}>\n                        Revision Requested\n                      </div>\n                      <div\n                        style={{\n                          color: '#fca5a5',\n                          fontSize: 13,\n                          lineHeight: 1.6,\n                          background: '#ef444420',\n                          padding: 10,\n                          borderRadius: 6,\n                        }}\n                      >\n                        {task.rejection_notes}\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Actions for collaborator */}\n                  {canMarkComplete && (\n                    <div style={{ marginTop: 16 }}>\n                      <textarea\n                        placeholder=\"Add notes about what you completed (optional)...\"\n                        value={completionNotes[task.id] || ''}\n                        onChange={(e) => setCompletionNotes((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #334155',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 60,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <button\n                        onClick={() => handleMarkComplete(task.id)}\n                        disabled={isLoadingThis}\n                        style={{\n                          width: '100%',\n                          padding: '12px 20px',\n                          borderRadius: 8,\n                          border: 'none',\n                          background: '#10b981',\n                          color: '#fff',\n                          fontSize: 14,\n                          fontWeight: 600,\n                          cursor: isLoadingThis ? 'not-allowed' : 'pointer',\n                          opacity: isLoadingThis ? 0.6 : 1,\n                        }}\n                      >\n                        {isLoadingThis ? 'Submitting...' : 'Mark as Complete'}\n                      </button>\n                    </div>\n                  )}\n\n                  {/* Actions for owner */}\n                  {canSignOff && (\n                    <div style={{ marginTop: 16 }}>\n                      <textarea\n                        placeholder=\"Add feedback or approval notes (optional)...\"\n                        value={signoffNotes[task.id] || ''}\n                        onChange={(e) => setSignoffNotes((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #334155',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 60,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <div style={{ display: 'flex', gap: 10 }}>\n                        <button\n                          onClick={() => handleSignOff(task.id)}\n                          disabled={isLoadingThis}\n                          style={{\n                            flex: 2,\n                            padding: '12px 20px',\n                            borderRadius: 8,\n                            border: 'none',\n                            background: '#10b981',\n                            color: '#fff',\n                            fontSize: 14,\n                            fontWeight: 600,\n                            cursor: isLoadingThis ? 'not-allowed' : 'pointer',\n                            opacity: isLoadingThis ? 0.6 : 1,\n                          }}\n                        >\n                          {isLoadingThis ? 'Processing...' : 'Sign Off'}\n                        </button>\n                        <button\n                          onClick={() => toggleExpand(task.id)}\n                          style={{\n                            flex: 1,\n                            padding: '12px 20px',\n                            borderRadius: 8,\n                            border: '1px solid #ef4444',\n                            background: 'transparent',\n                            color: '#ef4444',\n                            fontSize: 14,\n                            fontWeight: 600,\n                            cursor: 'pointer',\n                          }}\n                        >\n                          Request Changes\n                        </button>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Rejection form (shown when Request Changes clicked) */}\n                  {canReject && rejectionReason[task.id] !== undefined && (\n                    <div style={{ marginTop: 12 }}>\n                      <textarea\n                        placeholder=\"Explain what needs to be revised...\"\n                        value={rejectionReason[task.id] || ''}\n                        onChange={(e) => setRejectionReason((prev) => ({ ...prev, [task.id]: e.target.value }))}\n                        style={{\n                          width: '100%',\n                          background: '#1e293b',\n                          border: '1px solid #ef4444',\n                          borderRadius: 6,\n                          padding: 10,\n                          color: '#f8fafc',\n                          fontSize: 13,\n                          resize: 'vertical',\n                          minHeight: 80,\n                          marginBottom: 10,\n                        }}\n                      />\n                      <button\n                        onClick={() => handleReject(task.id)}\n                        disabled={isLoadingThis || !rejectionReason[task.id]?.trim()}\n                        style={{\n                          width: '100%',\n                          padding: '12px 20px',\n                          borderRadius: 8,\n                          border: 'none',\n                          background: '#ef4444',\n                          color: '#fff',\n                          fontSize: 14,\n                          fontWeight: 600,\n                          cursor: isLoadingThis || !rejectionReason[task.id]?.trim() ? 'not-allowed' : 'pointer',\n                          opacity: isLoadingThis || !rejectionReason[task.id]?.trim() ? 0.6 : 1,\n                        }}\n                      >\n                        {isLoadingThis ? 'Sending...' : 'Request Changes'}\n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nexport default TaskTracker;\n","import React, { useState } from 'react';\nimport {\n  CollaborativeProject,\n  CollaboratorRole,\n  collaborationApi,\n} from '../../../services/collaborationApi';\nimport { TeamOverview } from '../TeamOverview';\nimport { TaskTracker } from '../TaskTracker';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface TeamTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nexport default function TeamTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: TeamTabProps) {\n  const [showInviteForm, setShowInviteForm] = useState(false);\n  const [inviteUserId, setInviteUserId] = useState('');\n  const [inviteRole, setInviteRole] = useState('');\n  const [invitePercentage, setInvitePercentage] = useState(10);\n  const [inviteError, setInviteError] = useState('');\n  const [inviting, setInviting] = useState(false);\n\n  const isProjectLead = project.created_by === currentUser.id;\n  const sections = project.sections || [];\n  const collaborators = project.collaborators || [];\n\n  // Calculate remaining percentage available\n  const usedPercentage = collaborators.reduce((sum, c) => sum + c.revenue_percentage, 0);\n  const availablePercentage = 100 - usedPercentage;\n\n  const handleInvite = async () => {\n    const userId = parseInt(inviteUserId.trim(), 10);\n    if (!userId || isNaN(userId)) {\n      setInviteError('Please enter a valid user ID');\n      return;\n    }\n    if (!inviteRole.trim()) {\n      setInviteError('Please enter a role');\n      return;\n    }\n    if (invitePercentage <= 0 || invitePercentage > availablePercentage) {\n      setInviteError(`Percentage must be between 1 and ${availablePercentage}%`);\n      return;\n    }\n\n    setInviting(true);\n    setInviteError('');\n\n    try {\n      await collaborationApi.inviteCollaborator(project.id, {\n        user_id: userId,\n        role: inviteRole.trim(),\n        revenue_percentage: invitePercentage,\n        can_edit_text: true,\n        can_edit_images: true,\n        can_edit_audio: true,\n        can_edit_video: true,\n      });\n\n      // Refresh project data\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n      setShowInviteForm(false);\n      setInviteUserId('');\n      setInviteRole('');\n      setInvitePercentage(10);\n    } catch (err: any) {\n      setInviteError(err.message || 'Failed to invite collaborator');\n    } finally {\n      setInviting(false);\n    }\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Header with Invite Button */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n      }}>\n        <h2 style={{ margin: 0, color: 'var(--text)', fontSize: 20 }}>\n          Team Members\n        </h2>\n        {isProjectLead && (\n          <button\n            onClick={() => setShowInviteForm(!showInviteForm)}\n            style={{\n              background: showInviteForm\n                ? 'transparent'\n                : 'linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)',\n              border: showInviteForm ? '1px solid var(--panel-border)' : 'none',\n              borderRadius: 8,\n              padding: '10px 20px',\n              color: showInviteForm ? '#94a3b8' : '#fff',\n              fontWeight: 600,\n              cursor: 'pointer',\n              fontSize: 14,\n            }}\n          >\n            {showInviteForm ? 'Cancel' : '+ Invite Collaborator'}\n          </button>\n        )}\n      </div>\n\n      {/* Invite Form */}\n      {showInviteForm && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Invite New Collaborator\n          </h3>\n\n          <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>\n            <div>\n              <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n                User ID\n              </label>\n              <input\n                type=\"text\"\n                value={inviteUserId}\n                onChange={(e) => setInviteUserId(e.target.value)}\n                placeholder=\"Enter user ID\"\n                style={{\n                  width: '100%',\n                  padding: '10px 12px',\n                  background: 'var(--bg)',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 8,\n                  color: 'var(--text)',\n                  fontSize: 14,\n                }}\n              />\n            </div>\n            <div>\n              <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n                Role\n              </label>\n              <input\n                type=\"text\"\n                value={inviteRole}\n                onChange={(e) => setInviteRole(e.target.value)}\n                placeholder=\"e.g. Illustrator, Editor, Co-Author\"\n                style={{\n                  width: '100%',\n                  padding: '10px 12px',\n                  background: 'var(--bg)',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 8,\n                  color: 'var(--text)',\n                  fontSize: 14,\n                }}\n              />\n            </div>\n          </div>\n\n          <div style={{ marginTop: 16 }}>\n            <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 6 }}>\n              Revenue Split: {invitePercentage}%\n              <span style={{ color: '#64748b', marginLeft: 8 }}>\n                (Available: {availablePercentage}%)\n              </span>\n            </label>\n            <input\n              type=\"range\"\n              min={1}\n              max={availablePercentage}\n              value={invitePercentage}\n              onChange={(e) => setInvitePercentage(Number(e.target.value))}\n              style={{ width: '100%' }}\n            />\n          </div>\n\n          {/* Permissions */}\n          <div style={{ marginTop: 16 }}>\n            <label style={{ display: 'block', fontSize: 12, color: '#94a3b8', marginBottom: 8 }}>\n              Permissions\n            </label>\n            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n              {['Text', 'Images', 'Audio', 'Video'].map((perm) => (\n                <span\n                  key={perm}\n                  style={{\n                    background: 'rgba(139, 92, 246, 0.1)',\n                    color: '#8b5cf6',\n                    padding: '4px 10px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 500,\n                  }}\n                >\n                  {perm}\n                </span>\n              ))}\n            </div>\n            <div style={{ fontSize: 11, color: '#64748b', marginTop: 6 }}>\n              Default: All content types. You can customize permissions after inviting.\n            </div>\n          </div>\n\n          {inviteError && (\n            <div style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              color: '#ef4444',\n              fontSize: 13,\n            }}>\n              {inviteError}\n            </div>\n          )}\n\n          <div style={{ marginTop: 20, display: 'flex', gap: 12 }}>\n            <button\n              onClick={handleInvite}\n              disabled={inviting}\n              style={{\n                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                padding: '10px 24px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: inviting ? 'not-allowed' : 'pointer',\n                fontSize: 14,\n                opacity: inviting ? 0.7 : 1,\n              }}\n            >\n              {inviting ? 'Inviting...' : 'Send Invitation'}\n            </button>\n            <button\n              onClick={() => setShowInviteForm(false)}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                padding: '10px 24px',\n                color: '#94a3b8',\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              Cancel\n            </button>\n          </div>\n        </div>\n      )}\n\n      {/* Team Overview Component */}\n      <TeamOverview\n        collaborators={collaborators}\n        sections={sections}\n        projectCreatorId={project.created_by}\n      />\n\n      {/* Contract Tasks Section */}\n      {collaborators.filter(c => c.status === 'accepted' && c.tasks_total > 0).length > 0 && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18, display: 'flex', alignItems: 'center', gap: 10 }}>\n            <span>üìã</span> Contract Tasks\n          </h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n            {collaborators\n              .filter(c => c.status === 'accepted' && c.tasks_total > 0)\n              .map((collab) => (\n                <TaskTracker\n                  key={collab.id}\n                  collaboratorRole={collab}\n                  currentUserId={currentUser.id}\n                  isProjectOwner={isProjectLead}\n                  projectId={project.id}\n                  onTaskUpdate={async () => {\n                    const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n                    onProjectUpdate?.(updatedProject);\n                  }}\n                />\n              ))}\n          </div>\n        </div>\n      )}\n\n      {/* Permission Matrix */}\n      <div style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}>\n        <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n          Permission Matrix\n        </h3>\n        <div style={{ overflowX: 'auto' }}>\n          <table style={{\n            width: '100%',\n            borderCollapse: 'collapse',\n            fontSize: 13,\n          }}>\n            <thead>\n              <tr style={{ borderBottom: '1px solid var(--panel-border)' }}>\n                <th style={{ textAlign: 'left', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Collaborator\n                </th>\n                <th style={{ textAlign: 'center', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Text\n                </th>\n                <th style={{ textAlign: 'center', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Images\n                </th>\n                <th style={{ textAlign: 'center', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Audio\n                </th>\n                <th style={{ textAlign: 'center', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Video\n                </th>\n                <th style={{ textAlign: 'center', padding: '12px 8px', color: '#94a3b8', fontWeight: 600 }}>\n                  Invite Others\n                </th>\n              </tr>\n            </thead>\n            <tbody>\n              {collaborators.filter(c => c.status === 'accepted').map((collab) => (\n                <tr\n                  key={collab.id}\n                  style={{\n                    borderBottom: '1px solid var(--panel-border)',\n                    background: collab.user === currentUser.id ? 'rgba(59, 130, 246, 0.05)' : 'transparent',\n                  }}\n                >\n                  <td style={{ padding: '12px 8px', color: 'var(--text)' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                      <div style={{\n                        width: 28,\n                        height: 28,\n                        borderRadius: '50%',\n                        background: collab.is_lead\n                          ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'\n                          : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                        color: '#fff',\n                        fontSize: 11,\n                        fontWeight: 600,\n                      }}>\n                        {collab.username.charAt(0).toUpperCase()}\n                      </div>\n                      <span>\n                        @{collab.username}\n                        {collab.user === currentUser.id && (\n                          <span style={{ color: '#94a3b8', marginLeft: 4 }}>(you)</span>\n                        )}\n                      </span>\n                    </div>\n                  </td>\n                  <td style={{ textAlign: 'center', padding: '12px 8px' }}>\n                    <PermissionBadge allowed={collab.can_edit?.includes('text') ?? collab.can_edit_text} />\n                  </td>\n                  <td style={{ textAlign: 'center', padding: '12px 8px' }}>\n                    <PermissionBadge allowed={collab.can_edit?.includes('image') ?? collab.can_edit_images} />\n                  </td>\n                  <td style={{ textAlign: 'center', padding: '12px 8px' }}>\n                    <PermissionBadge allowed={collab.can_edit?.includes('audio') ?? collab.can_edit_audio} />\n                  </td>\n                  <td style={{ textAlign: 'center', padding: '12px 8px' }}>\n                    <PermissionBadge allowed={collab.can_edit?.includes('video') ?? collab.can_edit_video} />\n                  </td>\n                  <td style={{ textAlign: 'center', padding: '12px 8px' }}>\n                    <PermissionBadge allowed={collab.can_invite_others || collab.is_lead} />\n                  </td>\n                </tr>\n              ))}\n            </tbody>\n          </table>\n        </div>\n      </div>\n\n      {/* Counter-proposals / History (if any) */}\n      {collaborators.some(c => c.proposed_percentage !== undefined) && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Counter-Proposals\n          </h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {collaborators\n              .filter(c => c.proposed_percentage !== undefined)\n              .map((collab) => (\n                <div\n                  key={collab.id}\n                  style={{\n                    padding: 16,\n                    background: 'var(--bg)',\n                    borderRadius: 8,\n                    border: '1px solid rgba(245, 158, 11, 0.3)',\n                  }}\n                >\n                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                      <span style={{ fontSize: 14, color: 'var(--text)', fontWeight: 600 }}>\n                        @{collab.username}\n                      </span>\n                      <span style={{ fontSize: 12, color: '#94a3b8' }}>\n                        proposes\n                      </span>\n                    </div>\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                      <span style={{ fontSize: 13, color: '#94a3b8', textDecoration: 'line-through' }}>\n                        {collab.revenue_percentage}%\n                      </span>\n                      <span style={{ fontSize: 16, color: '#f59e0b', fontWeight: 700 }}>\n                        {collab.proposed_percentage}%\n                      </span>\n                    </div>\n                  </div>\n                  {collab.counter_message && (\n                    <div style={{\n                      marginTop: 8,\n                      fontSize: 13,\n                      color: '#94a3b8',\n                      fontStyle: 'italic',\n                    }}>\n                      \"{collab.counter_message}\"\n                    </div>\n                  )}\n                </div>\n              ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nfunction PermissionBadge({ allowed }: { allowed?: boolean }) {\n  return (\n    <span style={{\n      display: 'inline-flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      width: 24,\n      height: 24,\n      borderRadius: 4,\n      background: allowed ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.1)',\n      color: allowed ? '#10b981' : '#ef4444',\n      fontSize: 12,\n    }}>\n      {allowed ? '‚úì' : '√ó'}\n    </span>\n  );\n}\n","/**\n * Real-time Activity Service\n * Handles activity tracking, online status, and currently editing indicators\n */\n\nimport { API_URL as API_BASE } from '../config';\n\n// ============================================================================\n// TypeScript Interfaces\n// ============================================================================\n\nexport type ActivityType =\n  | 'section_updated'\n  | 'comment_added'\n  | 'collaborator_joined'\n  | 'collaborator_left'\n  | 'approval_given'\n  | 'approval_requested'\n  | 'ready_for_mint'\n  | 'project_minted'\n  | 'media_uploaded'\n  | 'invitation_sent';\n\nexport interface Activity {\n  id: number;\n  project_id: number;\n  user_id: number;\n  username: string;\n  avatar?: string;\n  activity_type: ActivityType;\n  description: string;\n  section_id?: number;\n  section_title?: string;\n  created_at: string;\n  metadata?: Record<string, any>;\n}\n\nexport interface OnlineUser {\n  user_id: number;\n  username: string;\n  avatar?: string;\n  last_seen: string;\n  is_online: boolean;\n}\n\nexport interface CurrentlyEditing {\n  user_id: number;\n  username: string;\n  section_id: number;\n  section_title: string;\n  started_at: string;\n}\n\nexport interface ActivityState {\n  activities: Activity[];\n  onlineUsers: OnlineUser[];\n  currentlyEditing: CurrentlyEditing[];\n  lastUpdated: Date | null;\n  isPolling: boolean;\n  error: Error | null;\n}\n\n// ============================================================================\n// Event System for Real-time Updates\n// ============================================================================\n\ntype ActivityEventHandler = (data: any) => void;\n\nclass ActivityEventEmitter {\n  private listeners: Map<string, Set<ActivityEventHandler>> = new Map();\n\n  on(event: string, handler: ActivityEventHandler): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(handler);\n\n    return () => this.off(event, handler);\n  }\n\n  off(event: string, handler: ActivityEventHandler): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.delete(handler);\n    }\n  }\n\n  emit(event: string, data: any): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (error) {\n          console.error(`Error in activity event handler for ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  clear(): void {\n    this.listeners.clear();\n  }\n}\n\n// ============================================================================\n// Local State Management\n// ============================================================================\n\nconst projectStates = new Map<number, ActivityState>();\n\nfunction getProjectState(projectId: number): ActivityState {\n  if (!projectStates.has(projectId)) {\n    projectStates.set(projectId, {\n      activities: [],\n      onlineUsers: [],\n      currentlyEditing: [],\n      lastUpdated: null,\n      isPolling: false,\n      error: null,\n    });\n  }\n  return projectStates.get(projectId)!;\n}\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nconst CONFIG = {\n  POLLING_INTERVAL: 15000, // 15 seconds\n  ONLINE_THRESHOLD: 60000, // 1 minute - consider user offline after this\n  MAX_ACTIVITIES: 50, // Keep last 50 activities\n  MAX_RETRIES: 3,\n  RETRY_DELAY: 5000,\n};\n\n// Polling intervals per project\nconst pollingIntervals = new Map<number, NodeJS.Timeout>();\nconst retryCounts = new Map<number, number>();\n\n// ============================================================================\n// API Helper Functions\n// ============================================================================\n\n/**\n * Get fresh CSRF token from API\n * This is more reliable than reading from cookies\n */\nasync function getFreshCsrfToken(): Promise<string> {\n  try {\n    const response = await fetch(`${API_BASE}/api/auth/csrf/`, {\n      credentials: 'include',\n    });\n    const data = await response.json();\n    return data?.csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    return '';\n  }\n}\n\nasync function apiRequest<T>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> {\n  const response = await fetch(url, {\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    },\n    ...options,\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData?.error || errorData?.detail || `API request failed: ${response.status}`);\n  }\n\n  return response.json();\n}\n\n// ============================================================================\n// Core API Functions\n// ============================================================================\n\n/**\n * Get recent activities for a project\n */\nexport async function getProjectActivities(\n  projectId: number,\n  limit: number = 20\n): Promise<Activity[]> {\n  try {\n    const activities = await apiRequest<Activity[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/activities/?limit=${limit}`\n    );\n\n    const state = getProjectState(projectId);\n    state.activities = activities.slice(0, CONFIG.MAX_ACTIVITIES);\n    state.lastUpdated = new Date();\n    state.error = null;\n\n    events.emit('activity:updated', { projectId, activities });\n\n    return activities;\n  } catch (error) {\n    const state = getProjectState(projectId);\n    state.error = error as Error;\n\n    // Graceful degradation - return cached activities\n    console.warn('Failed to fetch activities, using cached data:', error);\n    return state.activities;\n  }\n}\n\n/**\n * Get online users for a project\n */\nexport async function getOnlineUsers(projectId: number): Promise<OnlineUser[]> {\n  try {\n    const users = await apiRequest<OnlineUser[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/online-users/`\n    );\n\n    const state = getProjectState(projectId);\n\n    // Determine online status based on last_seen\n    const now = Date.now();\n    const onlineUsers = users.map(user => ({\n      ...user,\n      is_online: new Date(user.last_seen).getTime() + CONFIG.ONLINE_THRESHOLD > now,\n    }));\n\n    state.onlineUsers = onlineUsers;\n    events.emit('activity:online-users', { projectId, onlineUsers });\n\n    return onlineUsers;\n  } catch (error) {\n    const state = getProjectState(projectId);\n\n    // Graceful degradation\n    console.warn('Failed to fetch online users, using cached data:', error);\n    return state.onlineUsers;\n  }\n}\n\n/**\n * Get currently editing users\n */\nexport async function getCurrentlyEditing(projectId: number): Promise<CurrentlyEditing[]> {\n  try {\n    const editing = await apiRequest<CurrentlyEditing[]>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/currently-editing/`\n    );\n\n    const state = getProjectState(projectId);\n    state.currentlyEditing = editing;\n    events.emit('activity:currently-editing', { projectId, editing });\n\n    return editing;\n  } catch (error) {\n    const state = getProjectState(projectId);\n\n    // Graceful degradation\n    console.warn('Failed to fetch currently editing, using cached data:', error);\n    return state.currentlyEditing;\n  }\n}\n\n/**\n * Update user's heartbeat (indicate they're active)\n */\nexport async function sendHeartbeat(projectId: number): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(`${API_BASE}/api/collaborative-projects/${projectId}/heartbeat/`, {\n      method: 'POST',\n      headers: {\n        'X-CSRFToken': csrfToken,\n      },\n    });\n  } catch (error) {\n    // Fail silently for heartbeat\n    console.debug('Heartbeat failed:', error);\n  }\n}\n\n/**\n * Notify that user is editing a section\n */\nexport async function startEditingSection(\n  projectId: number,\n  sectionId: number\n): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(\n      `${API_BASE}/api/collaborative-projects/${projectId}/start-editing/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({ section_id: sectionId }),\n      }\n    );\n\n    // Immediately refresh currently editing\n    await getCurrentlyEditing(projectId);\n  } catch (error) {\n    console.warn('Failed to notify start editing:', error);\n  }\n}\n\n/**\n * Notify that user stopped editing a section\n */\nexport async function stopEditingSection(\n  projectId: number,\n  sectionId: number\n): Promise<void> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    await apiRequest(\n      `${API_BASE}/api/collaborative-projects/${projectId}/stop-editing/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({ section_id: sectionId }),\n      }\n    );\n\n    // Immediately refresh currently editing\n    await getCurrentlyEditing(projectId);\n  } catch (error) {\n    console.warn('Failed to notify stop editing:', error);\n  }\n}\n\n/**\n * Log a new activity\n */\nexport async function logActivity(\n  projectId: number,\n  activityType: ActivityType,\n  description: string,\n  metadata?: Record<string, any>\n): Promise<Activity | null> {\n  try {\n    const csrfToken = await getFreshCsrfToken();\n    const activity = await apiRequest<Activity>(\n      `${API_BASE}/api/collaborative-projects/${projectId}/log-activity/`,\n      {\n        method: 'POST',\n        headers: {\n          'X-CSRFToken': csrfToken,\n        },\n        body: JSON.stringify({\n          activity_type: activityType,\n          description,\n          metadata,\n        }),\n      }\n    );\n\n    // Add to local state\n    const state = getProjectState(projectId);\n    state.activities = [activity, ...state.activities].slice(0, CONFIG.MAX_ACTIVITIES);\n\n    events.emit('activity:new', { projectId, activity });\n    events.emit('activity:updated', { projectId, activities: state.activities });\n\n    return activity;\n  } catch (error) {\n    console.warn('Failed to log activity:', error);\n    return null;\n  }\n}\n\n// ============================================================================\n// Real-time Polling System\n// ============================================================================\n\n/**\n * Poll for activity updates\n */\nasync function pollActivity(projectId: number): Promise<void> {\n  const state = getProjectState(projectId);\n  if (!state.isPolling) return;\n\n  try {\n    // Fetch all activity data in parallel\n    await Promise.all([\n      getProjectActivities(projectId, 20),\n      getOnlineUsers(projectId),\n      getCurrentlyEditing(projectId),\n    ]);\n\n    // Also send heartbeat\n    await sendHeartbeat(projectId);\n\n    // Reset retry count on success\n    retryCounts.set(projectId, 0);\n  } catch (error) {\n    console.error('Activity polling error:', error);\n\n    const retryCount = (retryCounts.get(projectId) || 0) + 1;\n    retryCounts.set(projectId, retryCount);\n\n    if (retryCount >= CONFIG.MAX_RETRIES) {\n      console.error('Max retries reached for activity polling');\n      stopPolling(projectId);\n      events.emit('activity:polling-error', { projectId, error, retryCount });\n    }\n  }\n}\n\n/**\n * Start polling for a project\n */\nexport function startPolling(projectId: number): void {\n  const state = getProjectState(projectId);\n\n  if (state.isPolling) {\n    console.warn(`Activity polling already started for project ${projectId}`);\n    return;\n  }\n\n  console.log(`Starting activity polling for project ${projectId}...`);\n  state.isPolling = true;\n  retryCounts.set(projectId, 0);\n\n  // Initial fetch\n  pollActivity(projectId);\n\n  // Set up polling interval\n  const interval = setInterval(\n    () => pollActivity(projectId),\n    CONFIG.POLLING_INTERVAL\n  );\n  pollingIntervals.set(projectId, interval);\n\n  events.emit('activity:polling-started', { projectId });\n}\n\n/**\n * Stop polling for a project\n */\nexport function stopPolling(projectId: number): void {\n  const state = getProjectState(projectId);\n\n  if (!state.isPolling) {\n    return;\n  }\n\n  console.log(`Stopping activity polling for project ${projectId}...`);\n  state.isPolling = false;\n\n  const interval = pollingIntervals.get(projectId);\n  if (interval) {\n    clearInterval(interval);\n    pollingIntervals.delete(projectId);\n  }\n\n  events.emit('activity:polling-stopped', { projectId });\n}\n\n/**\n * Check if polling is active for a project\n */\nexport function isPolling(projectId: number): boolean {\n  const state = getProjectState(projectId);\n  return state.isPolling;\n}\n\n// ============================================================================\n// Event System Export\n// ============================================================================\n\nexport const events = new ActivityEventEmitter();\n\n/**\n * Available events:\n * - 'activity:updated' - Fired when activities list is updated\n * - 'activity:new' - Fired when a new activity is logged\n * - 'activity:online-users' - Fired when online users list is updated\n * - 'activity:currently-editing' - Fired when editing status changes\n * - 'activity:polling-started' - Fired when polling starts\n * - 'activity:polling-stopped' - Fired when polling stops\n * - 'activity:polling-error' - Fired when polling encounters errors\n */\n\n// ============================================================================\n// State Access Functions\n// ============================================================================\n\n/**\n * Get current activity state for a project\n */\nexport function getState(projectId: number): Readonly<ActivityState> {\n  return { ...getProjectState(projectId) };\n}\n\n/**\n * Get cached activities (without API call)\n */\nexport function getCachedActivities(projectId: number): Activity[] {\n  return [...getProjectState(projectId).activities];\n}\n\n/**\n * Get cached online users (without API call)\n */\nexport function getCachedOnlineUsers(projectId: number): OnlineUser[] {\n  return [...getProjectState(projectId).onlineUsers];\n}\n\n/**\n * Get cached currently editing (without API call)\n */\nexport function getCachedCurrentlyEditing(projectId: number): CurrentlyEditing[] {\n  return [...getProjectState(projectId).currentlyEditing];\n}\n\n/**\n * Clear state and stop polling for a project\n */\nexport function reset(projectId: number): void {\n  stopPolling(projectId);\n  projectStates.delete(projectId);\n}\n\n/**\n * Clear all states and stop all polling\n */\nexport function resetAll(): void {\n  pollingIntervals.forEach((interval, projectId) => {\n    stopPolling(projectId);\n  });\n  projectStates.clear();\n  events.clear();\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Get activity icon based on type\n */\nexport function getActivityIcon(type: ActivityType): string {\n  const icons: Record<ActivityType, string> = {\n    section_updated: 'üìù',\n    comment_added: 'üí¨',\n    collaborator_joined: 'üëã',\n    collaborator_left: 'üëã',\n    approval_given: '‚úÖ',\n    approval_requested: 'üîî',\n    ready_for_mint: 'üéâ',\n    project_minted: 'ü™ô',\n    media_uploaded: 'üìÅ',\n    invitation_sent: 'üì¨',\n  };\n  return icons[type] || 'üìå';\n}\n\n/**\n * Get activity color based on type\n */\nexport function getActivityColor(type: ActivityType): string {\n  const colors: Record<ActivityType, string> = {\n    section_updated: '#3b82f6',\n    comment_added: '#06b6d4',\n    collaborator_joined: '#10b981',\n    collaborator_left: '#64748b',\n    approval_given: '#10b981',\n    approval_requested: '#f59e0b',\n    ready_for_mint: '#ec4899',\n    project_minted: '#fbbf24',\n    media_uploaded: '#8b5cf6',\n    invitation_sent: '#f59e0b',\n  };\n  return colors[type] || '#64748b';\n}\n\n/**\n * Get human-readable time ago string\n */\nexport function getTimeAgo(dateString: string): string {\n  const date = new Date(dateString);\n  const now = new Date();\n  const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n  if (seconds < 60) return 'just now';\n  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n  if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n  return date.toLocaleDateString();\n}\n\n/**\n * Check if a user is currently editing a specific section\n */\nexport function isUserEditingSection(\n  projectId: number,\n  userId: number,\n  sectionId: number\n): boolean {\n  const state = getProjectState(projectId);\n  return state.currentlyEditing.some(\n    e => e.user_id === userId && e.section_id === sectionId\n  );\n}\n\n/**\n * Get who is editing a specific section\n */\nexport function getEditorsForSection(\n  projectId: number,\n  sectionId: number\n): CurrentlyEditing[] {\n  const state = getProjectState(projectId);\n  return state.currentlyEditing.filter(e => e.section_id === sectionId);\n}\n\n// ============================================================================\n// Export Default Service\n// ============================================================================\n\nexport default {\n  // API Functions\n  getProjectActivities,\n  getOnlineUsers,\n  getCurrentlyEditing,\n  sendHeartbeat,\n  startEditingSection,\n  stopEditingSection,\n  logActivity,\n\n  // Polling Functions\n  startPolling,\n  stopPolling,\n  isPolling,\n\n  // State Functions\n  getState,\n  getCachedActivities,\n  getCachedOnlineUsers,\n  getCachedCurrentlyEditing,\n  reset,\n  resetAll,\n\n  // Event System\n  events,\n\n  // Utilities\n  getActivityIcon,\n  getActivityColor,\n  getTimeAgo,\n  isUserEditingSection,\n  getEditorsForSection,\n};\n","/**\n * React Hook for Activity System\n * Provides easy integration with activityService in React components\n */\n\nimport { useEffect, useState, useCallback, useRef } from 'react';\nimport activityService, {\n  Activity,\n  OnlineUser,\n  CurrentlyEditing,\n  ActivityType,\n  events,\n} from '../services/activityService';\n\ninterface UseActivityOptions {\n  projectId: number;\n  autoStart?: boolean; // Auto-start polling when hook mounts\n  onNewActivity?: (activity: Activity) => void; // Callback for new activities\n}\n\ninterface UseActivityReturn {\n  activities: Activity[];\n  onlineUsers: OnlineUser[];\n  currentlyEditing: CurrentlyEditing[];\n  isLoading: boolean;\n  isPolling: boolean;\n  error: Error | null;\n\n  // Actions\n  refresh: () => Promise<void>;\n  startEditing: (sectionId: number) => Promise<void>;\n  stopEditing: (sectionId: number) => Promise<void>;\n  logActivity: (\n    activityType: ActivityType,\n    description: string,\n    metadata?: Record<string, any>\n  ) => Promise<void>;\n  startPolling: () => void;\n  stopPolling: () => void;\n\n  // Utility functions\n  isUserOnline: (userId: number) => boolean;\n  isSectionBeingEdited: (sectionId: number) => boolean;\n  getEditorsForSection: (sectionId: number) => CurrentlyEditing[];\n}\n\n/**\n * Custom hook for managing project activity\n */\nexport function useActivity(options: UseActivityOptions): UseActivityReturn {\n  const { projectId, autoStart = false, onNewActivity } = options;\n\n  // State\n  const [activities, setActivities] = useState<Activity[]>([]);\n  const [onlineUsers, setOnlineUsers] = useState<OnlineUser[]>([]);\n  const [currentlyEditing, setCurrentlyEditing] = useState<CurrentlyEditing[]>([]);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [isPolling, setIsPolling] = useState<boolean>(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Track current editing section\n  const currentEditingSectionRef = useRef<number | null>(null);\n\n  // Refresh all activity data\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const [activitiesData, onlineUsersData, editingData] = await Promise.all([\n        activityService.getProjectActivities(projectId),\n        activityService.getOnlineUsers(projectId),\n        activityService.getCurrentlyEditing(projectId),\n      ]);\n\n      setActivities(activitiesData);\n      setOnlineUsers(onlineUsersData);\n      setCurrentlyEditing(editingData);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to refresh activity:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [projectId]);\n\n  // Start editing a section\n  const startEditing = useCallback(\n    async (sectionId: number) => {\n      try {\n        await activityService.startEditingSection(projectId, sectionId);\n        currentEditingSectionRef.current = sectionId;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to start editing:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Stop editing a section\n  const stopEditing = useCallback(\n    async (sectionId: number) => {\n      try {\n        await activityService.stopEditingSection(projectId, sectionId);\n        if (currentEditingSectionRef.current === sectionId) {\n          currentEditingSectionRef.current = null;\n        }\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to stop editing:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Log an activity\n  const logActivity = useCallback(\n    async (\n      activityType: ActivityType,\n      description: string,\n      metadata?: Record<string, any>\n    ) => {\n      try {\n        await activityService.logActivity(\n          projectId,\n          activityType,\n          description,\n          metadata\n        );\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to log activity:', err);\n        throw err;\n      }\n    },\n    [projectId]\n  );\n\n  // Start polling\n  const startPollingCallback = useCallback(() => {\n    activityService.startPolling(projectId);\n    setIsPolling(true);\n  }, [projectId]);\n\n  // Stop polling\n  const stopPollingCallback = useCallback(() => {\n    activityService.stopPolling(projectId);\n    setIsPolling(false);\n  }, [projectId]);\n\n  // Utility: Check if user is online\n  const isUserOnline = useCallback(\n    (userId: number): boolean => {\n      return onlineUsers.some(u => u.user_id === userId && u.is_online);\n    },\n    [onlineUsers]\n  );\n\n  // Utility: Check if section is being edited\n  const isSectionBeingEdited = useCallback(\n    (sectionId: number): boolean => {\n      return currentlyEditing.some(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  // Utility: Get editors for a section\n  const getEditorsForSection = useCallback(\n    (sectionId: number): CurrentlyEditing[] => {\n      return currentlyEditing.filter(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  // Subscribe to activity events\n  useEffect(() => {\n    // Handle activities updated\n    const unsubActivities = events.on('activity:updated', ({ projectId: pid, activities: acts }) => {\n      if (pid === projectId) {\n        setActivities(acts);\n      }\n    });\n\n    // Handle new activity\n    const unsubNew = events.on('activity:new', ({ projectId: pid, activity }) => {\n      if (pid === projectId) {\n        if (onNewActivity) {\n          onNewActivity(activity);\n        }\n      }\n    });\n\n    // Handle online users updated\n    const unsubOnlineUsers = events.on('activity:online-users', ({ projectId: pid, onlineUsers: users }) => {\n      if (pid === projectId) {\n        setOnlineUsers(users);\n      }\n    });\n\n    // Handle currently editing updated\n    const unsubEditing = events.on('activity:currently-editing', ({ projectId: pid, editing }) => {\n      if (pid === projectId) {\n        setCurrentlyEditing(editing);\n      }\n    });\n\n    // Handle polling state changes\n    const unsubPollingStarted = events.on('activity:polling-started', ({ projectId: pid }) => {\n      if (pid === projectId) {\n        setIsPolling(true);\n      }\n    });\n\n    const unsubPollingStopped = events.on('activity:polling-stopped', ({ projectId: pid }) => {\n      if (pid === projectId) {\n        setIsPolling(false);\n      }\n    });\n\n    // Handle polling errors\n    const unsubPollingError = events.on('activity:polling-error', ({ projectId: pid, error: err }) => {\n      if (pid === projectId) {\n        setError(err);\n        setIsPolling(false);\n      }\n    });\n\n    // Cleanup subscriptions\n    return () => {\n      unsubActivities();\n      unsubNew();\n      unsubOnlineUsers();\n      unsubEditing();\n      unsubPollingStarted();\n      unsubPollingStopped();\n      unsubPollingError();\n    };\n  }, [projectId, onNewActivity]);\n\n  // Auto-start polling if enabled\n  useEffect(() => {\n    if (autoStart) {\n      startPollingCallback();\n      refresh();\n    }\n\n    return () => {\n      if (autoStart) {\n        stopPollingCallback();\n\n        // Stop editing current section on unmount\n        if (currentEditingSectionRef.current !== null) {\n          activityService.stopEditingSection(projectId, currentEditingSectionRef.current);\n        }\n      }\n    };\n  }, [autoStart, startPollingCallback, stopPollingCallback, refresh, projectId]);\n\n  return {\n    activities,\n    onlineUsers,\n    currentlyEditing,\n    isLoading,\n    isPolling,\n    error,\n\n    refresh,\n    startEditing,\n    stopEditing,\n    logActivity,\n    startPolling: startPollingCallback,\n    stopPolling: stopPollingCallback,\n\n    isUserOnline,\n    isSectionBeingEdited,\n    getEditorsForSection,\n  };\n}\n\n/**\n * Simple hook to just get online status\n */\nexport function useOnlineStatus(\n  projectId: number,\n  autoStart = false\n): {\n  onlineUsers: OnlineUser[];\n  isUserOnline: (userId: number) => boolean;\n  refresh: () => Promise<void>;\n} {\n  const [onlineUsers, setOnlineUsers] = useState<OnlineUser[]>([]);\n\n  const refresh = useCallback(async () => {\n    try {\n      const users = await activityService.getOnlineUsers(projectId);\n      setOnlineUsers(users);\n    } catch (err) {\n      console.error('Failed to get online users:', err);\n    }\n  }, [projectId]);\n\n  const isUserOnline = useCallback(\n    (userId: number): boolean => {\n      return onlineUsers.some(u => u.user_id === userId && u.is_online);\n    },\n    [onlineUsers]\n  );\n\n  useEffect(() => {\n    const unsubOnlineUsers = events.on('activity:online-users', ({ projectId: pid, onlineUsers: users }) => {\n      if (pid === projectId) {\n        setOnlineUsers(users);\n      }\n    });\n\n    if (autoStart) {\n      refresh();\n    }\n\n    return () => {\n      unsubOnlineUsers();\n    };\n  }, [autoStart, refresh, projectId]);\n\n  return { onlineUsers, isUserOnline, refresh };\n}\n\n/**\n * Simple hook for editing indicators\n */\nexport function useEditingIndicators(\n  projectId: number,\n  autoStart = false\n): {\n  currentlyEditing: CurrentlyEditing[];\n  isSectionBeingEdited: (sectionId: number) => boolean;\n  getEditorsForSection: (sectionId: number) => CurrentlyEditing[];\n  refresh: () => Promise<void>;\n} {\n  const [currentlyEditing, setCurrentlyEditing] = useState<CurrentlyEditing[]>([]);\n\n  const refresh = useCallback(async () => {\n    try {\n      const editing = await activityService.getCurrentlyEditing(projectId);\n      setCurrentlyEditing(editing);\n    } catch (err) {\n      console.error('Failed to get editing indicators:', err);\n    }\n  }, [projectId]);\n\n  const isSectionBeingEdited = useCallback(\n    (sectionId: number): boolean => {\n      return currentlyEditing.some(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  const getEditorsForSection = useCallback(\n    (sectionId: number): CurrentlyEditing[] => {\n      return currentlyEditing.filter(e => e.section_id === sectionId);\n    },\n    [currentlyEditing]\n  );\n\n  useEffect(() => {\n    const unsubEditing = events.on('activity:currently-editing', ({ projectId: pid, editing }) => {\n      if (pid === projectId) {\n        setCurrentlyEditing(editing);\n      }\n    });\n\n    if (autoStart) {\n      refresh();\n    }\n\n    return () => {\n      unsubEditing();\n    };\n  }, [autoStart, refresh, projectId]);\n\n  return {\n    currentlyEditing,\n    isSectionBeingEdited,\n    getEditorsForSection,\n    refresh,\n  };\n}\n\nexport default useActivity;\n","/**\n * useComments Hook\n * Manages comments with real-time updates, threading, and optimistic updates\n */\n\nimport { useState, useCallback, useEffect } from 'react';\nimport {\n  ProjectComment,\n  collaborationApi,\n  CreateCommentData,\n} from '../services/collaborationApi';\n\ninterface UseCommentsOptions {\n  projectId: number;\n  sectionId?: number;\n  includeResolved?: boolean;\n  pollingInterval?: number; // Auto-refresh interval in ms\n}\n\ninterface UseCommentsReturn {\n  comments: ProjectComment[];\n  commentsBySection: { [sectionId: string]: ProjectComment[] };\n  unresolvedCount: number;\n  totalCount: number;\n  isLoading: boolean;\n  error: Error | null;\n\n  // Actions\n  refresh: () => Promise<void>;\n  addComment: (\n    content: string,\n    mentions: number[],\n    attachments?: File[],\n    parentCommentId?: number,\n    sectionId?: number\n  ) => Promise<ProjectComment>;\n  updateComment: (commentId: number, content: string) => Promise<ProjectComment>;\n  deleteComment: (commentId: number) => Promise<void>;\n  resolveComment: (commentId: number) => Promise<ProjectComment>;\n  unresolveComment: (commentId: number) => Promise<ProjectComment>;\n  addReaction: (commentId: number, emoji: string) => Promise<void>;\n  removeReaction: (commentId: number, reactionId: number) => Promise<void>;\n\n  // Utilities\n  getCommentById: (commentId: number) => ProjectComment | undefined;\n  getReplies: (parentCommentId: number) => ProjectComment[];\n}\n\n/**\n * Build threaded comment structure\n */\nfunction buildCommentTree(flatComments: ProjectComment[]): ProjectComment[] {\n  const commentMap = new Map<number, ProjectComment>();\n  const rootComments: ProjectComment[] = [];\n\n  // First pass: create map and initialize replies arrays\n  flatComments.forEach((comment) => {\n    commentMap.set(comment.id, { ...comment, replies: [] });\n  });\n\n  // Second pass: build tree structure\n  flatComments.forEach((comment) => {\n    const commentWithReplies = commentMap.get(comment.id)!;\n\n    if (comment.parent_comment) {\n      // Add to parent's replies\n      const parent = commentMap.get(comment.parent_comment);\n      if (parent) {\n        parent.replies!.push(commentWithReplies);\n      } else {\n        // Parent not found, treat as root\n        rootComments.push(commentWithReplies);\n      }\n    } else {\n      // Root comment\n      rootComments.push(commentWithReplies);\n    }\n  });\n\n  return rootComments;\n}\n\n/**\n * Group comments by section\n */\nfunction groupCommentsBySection(comments: ProjectComment[]): {\n  [sectionId: string]: ProjectComment[];\n} {\n  const grouped: { [sectionId: string]: ProjectComment[] } = {\n    general: [], // Comments without a section\n  };\n\n  comments.forEach((comment) => {\n    if (comment.section) {\n      const key = comment.section.toString();\n      if (!grouped[key]) {\n        grouped[key] = [];\n      }\n      grouped[key].push(comment);\n    } else {\n      grouped.general.push(comment);\n    }\n  });\n\n  return grouped;\n}\n\n/**\n * Custom hook for managing comments\n */\nexport function useComments(options: UseCommentsOptions): UseCommentsReturn {\n  const {\n    projectId,\n    sectionId,\n    includeResolved = false,\n    pollingInterval = 0, // 0 means no polling\n  } = options;\n\n  // State\n  const [flatComments, setFlatComments] = useState<ProjectComment[]>([]);\n  const [comments, setComments] = useState<ProjectComment[]>([]);\n  const [commentsBySection, setCommentsBySection] = useState<{\n    [sectionId: string]: ProjectComment[];\n  }>({});\n  const [unresolvedCount, setUnresolvedCount] = useState(0);\n  const [totalCount, setTotalCount] = useState(0);\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Process flat comments into tree structure\n  useEffect(() => {\n    const tree = buildCommentTree(flatComments);\n    const grouped = groupCommentsBySection(flatComments);\n\n    setComments(tree);\n    setCommentsBySection(grouped);\n    setUnresolvedCount(flatComments.filter((c) => !c.resolved).length);\n    setTotalCount(flatComments.length);\n  }, [flatComments]);\n\n  // Refresh comments from API\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      let fetchedComments: ProjectComment[];\n\n      if (sectionId) {\n        // Get comments for specific section\n        fetchedComments = await collaborationApi.getComments(projectId, sectionId);\n      } else {\n        // Get all comments\n        fetchedComments = await collaborationApi.getComments(projectId);\n      }\n\n      // Filter out resolved comments if needed\n      if (!includeResolved) {\n        fetchedComments = fetchedComments.filter((c) => !c.resolved);\n      }\n\n      setFlatComments(fetchedComments);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to fetch comments:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, [projectId, sectionId, includeResolved]);\n\n  // Add comment with optimistic update\n  const addComment = useCallback(\n    async (\n      content: string,\n      mentions: number[],\n      attachments?: File[],\n      parentCommentId?: number,\n      commentSectionId?: number\n    ): Promise<ProjectComment> => {\n      const data: CreateCommentData = {\n        project: projectId,\n        content,\n        mentions,\n        attachments,\n        parent_comment: parentCommentId,\n        section: commentSectionId || sectionId,\n      };\n\n      try {\n        const newComment = await collaborationApi.addComment(data);\n\n        // Optimistic update\n        setFlatComments((prev) => [...prev, newComment]);\n\n        return newComment;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to add comment:', err);\n        throw err;\n      }\n    },\n    [projectId, sectionId]\n  );\n\n  // Update comment\n  const updateComment = useCallback(\n    async (commentId: number, content: string): Promise<ProjectComment> => {\n      try {\n        const updatedComment = await collaborationApi.updateComment(commentId, content);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? updatedComment : c))\n        );\n\n        return updatedComment;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to update comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Delete comment with optimistic update\n  const deleteComment = useCallback(async (commentId: number): Promise<void> => {\n    try {\n      // Optimistic update\n      setFlatComments((prev) => prev.filter((c) => c.id !== commentId));\n\n      await collaborationApi.deleteComment(commentId);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to delete comment:', err);\n      // Revert optimistic update\n      await refresh();\n      throw err;\n    }\n  }, [refresh]);\n\n  // Resolve comment\n  const resolveComment = useCallback(\n    async (commentId: number): Promise<ProjectComment> => {\n      try {\n        const resolved = await collaborationApi.resolveComment(commentId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? resolved : c))\n        );\n\n        return resolved;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to resolve comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Unresolve comment\n  const unresolveComment = useCallback(\n    async (commentId: number): Promise<ProjectComment> => {\n      try {\n        const unresolved = await collaborationApi.unresolveComment(commentId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => (c.id === commentId ? unresolved : c))\n        );\n\n        return unresolved;\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to unresolve comment:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Add reaction\n  const addReaction = useCallback(async (commentId: number, emoji: string): Promise<void> => {\n    try {\n      const reaction = await collaborationApi.addReaction(commentId, emoji);\n\n      // Update in state\n      setFlatComments((prev) =>\n        prev.map((c) => {\n          if (c.id === commentId) {\n            return {\n              ...c,\n              reactions: [...(c.reactions || []), reaction],\n            };\n          }\n          return c;\n        })\n      );\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to add reaction:', err);\n      throw err;\n    }\n  }, []);\n\n  // Remove reaction\n  const removeReaction = useCallback(\n    async (commentId: number, reactionId: number): Promise<void> => {\n      try {\n        await collaborationApi.removeReaction(commentId, reactionId);\n\n        // Update in state\n        setFlatComments((prev) =>\n          prev.map((c) => {\n            if (c.id === commentId) {\n              return {\n                ...c,\n                reactions: (c.reactions || []).filter((r) => r.id !== reactionId),\n              };\n            }\n            return c;\n          })\n        );\n      } catch (err) {\n        setError(err as Error);\n        console.error('Failed to remove reaction:', err);\n        throw err;\n      }\n    },\n    []\n  );\n\n  // Get comment by ID\n  const getCommentById = useCallback(\n    (commentId: number): ProjectComment | undefined => {\n      return flatComments.find((c) => c.id === commentId);\n    },\n    [flatComments]\n  );\n\n  // Get replies for a comment\n  const getReplies = useCallback(\n    (parentCommentId: number): ProjectComment[] => {\n      return flatComments.filter((c) => c.parent_comment === parentCommentId);\n    },\n    [flatComments]\n  );\n\n  // Initial load\n  useEffect(() => {\n    refresh();\n  }, [refresh]);\n\n  // Polling for real-time updates\n  useEffect(() => {\n    if (pollingInterval <= 0) return;\n\n    const interval = setInterval(() => {\n      refresh();\n    }, pollingInterval);\n\n    return () => clearInterval(interval);\n  }, [pollingInterval, refresh]);\n\n  return {\n    comments,\n    commentsBySection,\n    unresolvedCount,\n    totalCount,\n    isLoading,\n    error,\n\n    refresh,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n\n    getCommentById,\n    getReplies,\n  };\n}\n\nexport default useComments;\n","/**\n * ActivityFeed Component\n * Shows recent project activities\n */\n\nimport React from 'react';\nimport {\n  Activity,\n  ActivityType,\n  getActivityIcon,\n  getActivityColor,\n  getTimeAgo,\n} from '../../services/activityService';\n\ninterface ActivityFeedProps {\n  activities: Activity[];\n  maxItems?: number;\n  showAvatar?: boolean;\n  compact?: boolean;\n}\n\n/**\n * Activity Feed - shows list of recent activities\n */\nexport function ActivityFeed({\n  activities,\n  maxItems = 20,\n  showAvatar = true,\n  compact = false,\n}: ActivityFeedProps) {\n  const displayActivities = activities.slice(0, maxItems);\n\n  if (displayActivities.length === 0) {\n    return (\n      <div\n        style={{\n          padding: compact ? 16 : 32,\n          textAlign: 'center',\n          color: '#64748b',\n        }}\n      >\n        <div style={{ fontSize: compact ? 32 : 48, marginBottom: 8 }}>üìã</div>\n        <div style={{ fontSize: compact ? 12 : 14, fontWeight: 600, marginBottom: 4 }}>\n          No activity yet\n        </div>\n        <div style={{ fontSize: compact ? 11 : 12, color: '#64748b' }}>\n          Project activities will appear here\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: compact ? 6 : 8,\n      }}\n    >\n      {displayActivities.map((activity) => (\n        <ActivityItem\n          key={activity.id}\n          activity={activity}\n          showAvatar={showAvatar}\n          compact={compact}\n        />\n      ))}\n    </div>\n  );\n}\n\n/**\n * Single Activity Item\n */\ninterface ActivityItemProps {\n  activity: Activity;\n  showAvatar?: boolean;\n  compact?: boolean;\n}\n\nfunction ActivityItem({ activity, showAvatar = true, compact = false }: ActivityItemProps) {\n  const icon = getActivityIcon(activity.activity_type);\n  const color = getActivityColor(activity.activity_type);\n  const timeAgo = getTimeAgo(activity.created_at);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: compact ? 'center' : 'flex-start',\n        gap: compact ? 8 : 12,\n        padding: compact ? '8px 12px' : '12px 16px',\n        background: 'var(--bg)',\n        border: '1px solid var(--panel-border)',\n        borderLeft: `3px solid ${color}`,\n        borderRadius: 8,\n        transition: 'all 0.2s',\n        cursor: 'pointer',\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = 'var(--panel)';\n        e.currentTarget.style.borderLeftColor = color;\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = 'var(--bg)';\n        e.currentTarget.style.borderLeftColor = color;\n      }}\n    >\n      {/* Icon or Avatar */}\n      {showAvatar ? (\n        <div\n          style={{\n            position: 'relative',\n            width: compact ? 28 : 36,\n            height: compact ? 28 : 36,\n            borderRadius: '50%',\n            background: activity.avatar\n              ? `url(${activity.avatar}) center/cover`\n              : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#fff',\n            fontSize: compact ? 12 : 14,\n            fontWeight: 700,\n            flexShrink: 0,\n          }}\n        >\n          {!activity.avatar && activity.username.charAt(0).toUpperCase()}\n\n          {/* Activity type badge */}\n          <div\n            style={{\n              position: 'absolute',\n              bottom: -2,\n              right: -2,\n              width: compact ? 14 : 16,\n              height: compact ? 14 : 16,\n              borderRadius: '50%',\n              background: `${color}`,\n              border: '2px solid var(--bg)',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              fontSize: compact ? 8 : 9,\n            }}\n          >\n            {icon}\n          </div>\n        </div>\n      ) : (\n        <div\n          style={{\n            width: compact ? 24 : 32,\n            height: compact ? 24 : 32,\n            borderRadius: 8,\n            background: `${color}20`,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            fontSize: compact ? 14 : 16,\n            flexShrink: 0,\n          }}\n        >\n          {icon}\n        </div>\n      )}\n\n      {/* Content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            fontSize: compact ? 12 : 13,\n            fontWeight: 600,\n            color: 'var(--text)',\n            marginBottom: compact ? 2 : 4,\n            lineHeight: 1.4,\n          }}\n        >\n          {activity.description}\n        </div>\n\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 8,\n            fontSize: compact ? 10 : 11,\n            color: '#64748b',\n          }}\n        >\n          <span>@{activity.username}</span>\n          {activity.section_title && (\n            <>\n              <span>‚Ä¢</span>\n              <span style={{ color: '#94a3b8' }}>{activity.section_title}</span>\n            </>\n          )}\n          <span>‚Ä¢</span>\n          <span>{timeAgo}</span>\n        </div>\n      </div>\n\n      {/* Activity type badge (for non-avatar mode) */}\n      {!showAvatar && !compact && (\n        <div\n          style={{\n            padding: '2px 8px',\n            background: `${color}20`,\n            color: color,\n            fontSize: 10,\n            fontWeight: 700,\n            borderRadius: 4,\n            textTransform: 'uppercase',\n            flexShrink: 0,\n          }}\n        >\n          {activity.activity_type.replace(/_/g, ' ')}\n        </div>\n      )}\n    </div>\n  );\n}\n\n/**\n * Activity Feed Panel - with header and filters\n */\ninterface ActivityFeedPanelProps {\n  activities: Activity[];\n  isLoading?: boolean;\n  onRefresh?: () => void;\n  filterType?: ActivityType | 'all';\n  onFilterChange?: (type: ActivityType | 'all') => void;\n}\n\nexport function ActivityFeedPanel({\n  activities,\n  isLoading = false,\n  onRefresh,\n  filterType = 'all',\n  onFilterChange,\n}: ActivityFeedPanelProps) {\n  // Filter activities by type\n  const filteredActivities =\n    filterType === 'all'\n      ? activities\n      : activities.filter(a => a.activity_type === filterType);\n\n  const activityTypes: Array<ActivityType | 'all'> = [\n    'all',\n    'section_updated',\n    'comment_added',\n    'collaborator_joined',\n    'approval_given',\n  ];\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        height: '100%',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          marginBottom: 16,\n          paddingBottom: 12,\n          borderBottom: '1px solid var(--panel-border)',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <h3\n            style={{\n              margin: 0,\n              fontSize: 16,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            Recent Activity\n          </h3>\n          {isLoading && (\n            <div\n              style={{\n                fontSize: 12,\n                color: '#f59e0b',\n                fontWeight: 600,\n              }}\n            >\n              Updating...\n            </div>\n          )}\n        </div>\n\n        {onRefresh && (\n          <button\n            onClick={onRefresh}\n            disabled={isLoading}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 6,\n              padding: '4px 12px',\n              color: '#94a3b8',\n              cursor: isLoading ? 'not-allowed' : 'pointer',\n              fontSize: 11,\n              fontWeight: 600,\n              opacity: isLoading ? 0.5 : 1,\n            }}\n          >\n            üîÑ Refresh\n          </button>\n        )}\n      </div>\n\n      {/* Filters */}\n      {onFilterChange && (\n        <div\n          style={{\n            display: 'flex',\n            gap: 6,\n            marginBottom: 12,\n            flexWrap: 'wrap',\n          }}\n        >\n          {activityTypes.map((type) => {\n            const isActive = filterType === type;\n            return (\n              <button\n                key={type}\n                onClick={() => onFilterChange(type)}\n                style={{\n                  background: isActive ? '#3b82f6' : 'transparent',\n                  color: isActive ? '#fff' : '#94a3b8',\n                  border: `1px solid ${isActive ? '#3b82f6' : 'var(--panel-border)'}`,\n                  borderRadius: 6,\n                  padding: '4px 10px',\n                  fontSize: 10,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  textTransform: 'capitalize',\n                  transition: 'all 0.2s',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isActive) {\n                    e.currentTarget.style.borderColor = '#3b82f6';\n                    e.currentTarget.style.color = '#3b82f6';\n                  }\n                }}\n                onMouseLeave={(e) => {\n                  if (!isActive) {\n                    e.currentTarget.style.borderColor = 'var(--panel-border)';\n                    e.currentTarget.style.color = '#94a3b8';\n                  }\n                }}\n              >\n                {type === 'all' ? 'All' : type.replace(/_/g, ' ')}\n              </button>\n            );\n          })}\n        </div>\n      )}\n\n      {/* Activity List */}\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n        }}\n      >\n        <ActivityFeed activities={filteredActivities} maxItems={50} />\n      </div>\n    </div>\n  );\n}\n\n/**\n * Compact Activity Summary - for sidebar\n */\ninterface ActivitySummaryProps {\n  activities: Activity[];\n  maxItems?: number;\n}\n\nexport function ActivitySummary({ activities, maxItems = 5 }: ActivitySummaryProps) {\n  const recentActivities = activities.slice(0, maxItems);\n\n  if (recentActivities.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 12,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 11,\n        }}\n      >\n        No recent activity\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 6,\n      }}\n    >\n      {recentActivities.map((activity) => {\n        const icon = getActivityIcon(activity.activity_type);\n        const color = getActivityColor(activity.activity_type);\n        const timeAgo = getTimeAgo(activity.created_at);\n\n        return (\n          <div\n            key={activity.id}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              fontSize: 11,\n              color: '#cbd5e1',\n              lineHeight: 1.4,\n            }}\n          >\n            <span style={{ fontSize: 12 }}>{icon}</span>\n            <div style={{ flex: 1, minWidth: 0 }}>\n              <span style={{ fontWeight: 600, color: color }}>\n                @{activity.username}\n              </span>{' '}\n              <span style={{ color: '#94a3b8' }}>\n                {activity.description.toLowerCase()}\n              </span>\n              <div style={{ fontSize: 10, color: '#64748b', marginTop: 2 }}>\n                {timeAgo}\n              </div>\n            </div>\n          </div>\n        );\n      })}\n    </div>\n  );\n}\n\nexport default ActivityFeed;\n","/**\n * CommentComposer Component\n * Rich text composer for adding comments with @mentions and file attachments\n */\n\nimport React, { useState, useRef, useEffect, KeyboardEvent } from 'react';\nimport { CollaboratorRole } from '../../services/collaborationApi';\n\ninterface CommentComposerProps {\n  projectId: number;\n  sectionId?: number;\n  parentCommentId?: number;\n  collaborators: CollaboratorRole[];\n  placeholder?: string;\n  autoFocus?: boolean;\n  onSubmit: (content: string, mentions: number[], attachments?: File[]) => Promise<void>;\n  onCancel?: () => void;\n  initialValue?: string;\n  submitButtonText?: string;\n  compact?: boolean;\n}\n\ninterface MentionSuggestion {\n  userId: number;\n  username: string;\n  displayName: string;\n  avatar?: string;\n}\n\nexport function CommentComposer({\n  projectId,\n  sectionId,\n  parentCommentId,\n  collaborators,\n  placeholder = 'Add a comment...',\n  autoFocus = false,\n  onSubmit,\n  onCancel,\n  initialValue = '',\n  submitButtonText = 'Comment',\n  compact = false,\n}: CommentComposerProps) {\n  const [content, setContent] = useState(initialValue);\n  const [mentions, setMentions] = useState<number[]>([]);\n  const [attachments, setAttachments] = useState<File[]>([]);\n  const [isSubmitting, setIsSubmitting] = useState(false);\n\n  // @mention autocomplete\n  const [showMentions, setShowMentions] = useState(false);\n  const [mentionQuery, setMentionQuery] = useState('');\n  const [mentionSuggestions, setMentionSuggestions] = useState<MentionSuggestion[]>([]);\n  const [selectedMentionIndex, setSelectedMentionIndex] = useState(0);\n  const [mentionStart, setMentionStart] = useState<number | null>(null);\n\n  const textareaRef = useRef<HTMLTextAreaElement>(null);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  // Convert collaborators to mention suggestions\n  const allSuggestions: MentionSuggestion[] = collaborators\n    .filter(c => c.status === 'accepted')\n    .map(c => ({\n      userId: c.user,\n      username: c.username,\n      displayName: c.display_name || c.username,\n      avatar: undefined, // Add avatar support if available\n    }));\n\n  // Handle content change and detect @mentions\n  const handleContentChange = (e: React.ChangeEvent<HTMLTextAreaElement>) => {\n    const newContent = e.target.value;\n    setContent(newContent);\n\n    const cursorPosition = e.target.selectionStart;\n    const textBeforeCursor = newContent.slice(0, cursorPosition);\n\n    // Check if we're typing an @mention\n    const lastAtSymbol = textBeforeCursor.lastIndexOf('@');\n    if (lastAtSymbol !== -1) {\n      const textAfterAt = textBeforeCursor.slice(lastAtSymbol + 1);\n\n      // Check if there's a space after @ (which ends the mention)\n      if (!textAfterAt.includes(' ') && !textAfterAt.includes('\\n')) {\n        const query = textAfterAt.toLowerCase();\n        setMentionQuery(query);\n        setMentionStart(lastAtSymbol);\n\n        // Filter suggestions\n        const filtered = allSuggestions.filter(\n          s =>\n            s.username.toLowerCase().includes(query) ||\n            s.displayName.toLowerCase().includes(query)\n        );\n\n        setMentionSuggestions(filtered);\n        setShowMentions(filtered.length > 0);\n        setSelectedMentionIndex(0);\n        return;\n      }\n    }\n\n    // Hide mentions if not in mention mode\n    setShowMentions(false);\n  };\n\n  // Handle keyboard navigation in mention dropdown\n  const handleKeyDown = (e: KeyboardEvent<HTMLTextAreaElement>) => {\n    if (showMentions) {\n      if (e.key === 'ArrowDown') {\n        e.preventDefault();\n        setSelectedMentionIndex(prev =>\n          prev < mentionSuggestions.length - 1 ? prev + 1 : prev\n        );\n      } else if (e.key === 'ArrowUp') {\n        e.preventDefault();\n        setSelectedMentionIndex(prev => (prev > 0 ? prev - 1 : prev));\n      } else if (e.key === 'Enter' || e.key === 'Tab') {\n        e.preventDefault();\n        if (mentionSuggestions[selectedMentionIndex]) {\n          insertMention(mentionSuggestions[selectedMentionIndex]);\n        }\n      } else if (e.key === 'Escape') {\n        setShowMentions(false);\n      }\n    } else if (e.key === 'Enter' && (e.metaKey || e.ctrlKey)) {\n      // Cmd+Enter or Ctrl+Enter to submit\n      e.preventDefault();\n      handleSubmit();\n    }\n  };\n\n  // Insert mention into text\n  const insertMention = (suggestion: MentionSuggestion) => {\n    if (mentionStart === null) return;\n\n    const beforeMention = content.slice(0, mentionStart);\n    const afterCursor = content.slice(textareaRef.current?.selectionStart || content.length);\n    const newContent = `${beforeMention}@${suggestion.username} ${afterCursor}`;\n\n    setContent(newContent);\n    setShowMentions(false);\n\n    // Add to mentions list\n    if (!mentions.includes(suggestion.userId)) {\n      setMentions([...mentions, suggestion.userId]);\n    }\n\n    // Move cursor after mention\n    setTimeout(() => {\n      const newPosition = mentionStart + suggestion.username.length + 2;\n      textareaRef.current?.setSelectionRange(newPosition, newPosition);\n      textareaRef.current?.focus();\n    }, 0);\n  };\n\n  // Handle file attachment\n  const handleFileSelect = (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (e.target.files) {\n      const newFiles = Array.from(e.target.files);\n      setAttachments([...attachments, ...newFiles]);\n    }\n  };\n\n  // Remove attachment\n  const removeAttachment = (index: number) => {\n    setAttachments(attachments.filter((_, i) => i !== index));\n  };\n\n  // Submit comment\n  const handleSubmit = async () => {\n    if (!content.trim() && attachments.length === 0) return;\n\n    setIsSubmitting(true);\n    try {\n      await onSubmit(content, mentions, attachments.length > 0 ? attachments : undefined);\n\n      // Clear form\n      setContent('');\n      setMentions([]);\n      setAttachments([]);\n    } catch (error) {\n      console.error('Failed to submit comment:', error);\n    } finally {\n      setIsSubmitting(false);\n    }\n  };\n\n  // Auto-focus\n  useEffect(() => {\n    if (autoFocus && textareaRef.current) {\n      textareaRef.current.focus();\n    }\n  }, [autoFocus]);\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: compact ? 8 : 12,\n        padding: compact ? 12 : 16,\n        position: 'relative',\n      }}\n    >\n      {/* Textarea */}\n      <div style={{ position: 'relative' }}>\n        <textarea\n          ref={textareaRef}\n          value={content}\n          onChange={handleContentChange}\n          onKeyDown={handleKeyDown}\n          placeholder={placeholder}\n          style={{\n            width: '100%',\n            minHeight: compact ? 60 : 80,\n            maxHeight: 200,\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n            padding: 10,\n            color: 'var(--text)',\n            fontSize: compact ? 12 : 13,\n            lineHeight: 1.5,\n            resize: 'vertical',\n            outline: 'none',\n            fontFamily: 'inherit',\n          }}\n        />\n\n        {/* @mention autocomplete dropdown */}\n        {showMentions && (\n          <div\n            style={{\n              position: 'absolute',\n              bottom: '100%',\n              left: 0,\n              marginBottom: 4,\n              minWidth: 200,\n              maxWidth: 300,\n              background: '#1e293b',\n              border: '1px solid #334155',\n              borderRadius: 8,\n              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n              maxHeight: 200,\n              overflowY: 'auto',\n              zIndex: 1000,\n            }}\n          >\n            {mentionSuggestions.map((suggestion, index) => (\n              <div\n                key={suggestion.userId}\n                onClick={() => insertMention(suggestion)}\n                style={{\n                  padding: '8px 12px',\n                  cursor: 'pointer',\n                  background: index === selectedMentionIndex ? '#334155' : 'transparent',\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 8,\n                  transition: 'background 0.2s',\n                }}\n                onMouseEnter={() => setSelectedMentionIndex(index)}\n              >\n                {/* Avatar placeholder */}\n                <div\n                  style={{\n                    width: 24,\n                    height: 24,\n                    borderRadius: '50%',\n                    background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 11,\n                    fontWeight: 700,\n                  }}\n                >\n                  {suggestion.username.charAt(0).toUpperCase()}\n                </div>\n\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div\n                    style={{\n                      fontSize: 13,\n                      fontWeight: 600,\n                      color: '#e5e7eb',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                      whiteSpace: 'nowrap',\n                    }}\n                  >\n                    @{suggestion.username}\n                  </div>\n                  {suggestion.displayName !== suggestion.username && (\n                    <div\n                      style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}\n                    >\n                      {suggestion.displayName}\n                    </div>\n                  )}\n                </div>\n              </div>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Attachments */}\n      {attachments.length > 0 && (\n        <div\n          style={{\n            marginTop: 8,\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 6,\n          }}\n        >\n          {attachments.map((file, index) => (\n            <div\n              key={`${file.name}-${file.size}`}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                padding: '6px 10px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                fontSize: 12,\n              }}\n            >\n              <span>üìé</span>\n              <span\n                style={{\n                  flex: 1,\n                  color: 'var(--text)',\n                  overflow: 'hidden',\n                  textOverflow: 'ellipsis',\n                  whiteSpace: 'nowrap',\n                }}\n              >\n                {file.name}\n              </span>\n              <span style={{ color: '#64748b', fontSize: 11 }}>\n                {(file.size / 1024).toFixed(1)} KB\n              </span>\n              <button\n                onClick={() => removeAttachment(index)}\n                style={{\n                  background: 'transparent',\n                  border: 'none',\n                  color: '#ef4444',\n                  cursor: 'pointer',\n                  fontSize: 16,\n                  padding: 0,\n                  lineHeight: 1,\n                }}\n              >\n                √ó\n              </button>\n            </div>\n          ))}\n        </div>\n      )}\n\n      {/* Actions */}\n      <div\n        style={{\n          marginTop: 12,\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          gap: 8,\n        }}\n      >\n        {/* Left actions */}\n        <div>\n          <input\n            ref={fileInputRef}\n            type=\"file\"\n            multiple\n            style={{ display: 'none' }}\n            onChange={handleFileSelect}\n          />\n          <button\n            onClick={() => fileInputRef.current?.click()}\n            disabled={isSubmitting}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 6,\n              padding: compact ? '4px 10px' : '6px 12px',\n              color: '#94a3b8',\n              cursor: isSubmitting ? 'not-allowed' : 'pointer',\n              fontSize: compact ? 11 : 12,\n              fontWeight: 600,\n              display: 'flex',\n              alignItems: 'center',\n              gap: 6,\n            }}\n          >\n            üìé Attach\n          </button>\n        </div>\n\n        {/* Right actions */}\n        <div style={{ display: 'flex', gap: 8 }}>\n          {onCancel && (\n            <button\n              onClick={onCancel}\n              disabled={isSubmitting}\n              style={{\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 6,\n                padding: compact ? '4px 12px' : '6px 16px',\n                color: '#94a3b8',\n                cursor: isSubmitting ? 'not-allowed' : 'pointer',\n                fontSize: compact ? 11 : 12,\n                fontWeight: 600,\n              }}\n            >\n              Cancel\n            </button>\n          )}\n          <button\n            onClick={handleSubmit}\n            disabled={isSubmitting || (!content.trim() && attachments.length === 0)}\n            style={{\n              background: isSubmitting || (!content.trim() && attachments.length === 0)\n                ? '#374151'\n                : '#3b82f6',\n              border: 'none',\n              borderRadius: 6,\n              padding: compact ? '4px 12px' : '6px 16px',\n              color: '#fff',\n              cursor: isSubmitting || (!content.trim() && attachments.length === 0)\n                ? 'not-allowed'\n                : 'pointer',\n              fontSize: compact ? 11 : 12,\n              fontWeight: 700,\n            }}\n          >\n            {isSubmitting ? 'Posting...' : submitButtonText}\n          </button>\n        </div>\n      </div>\n\n      {/* Hint */}\n      {!compact && (\n        <div\n          style={{\n            marginTop: 8,\n            fontSize: 10,\n            color: '#64748b',\n          }}\n        >\n          Tip: Use @ to mention collaborators ‚Ä¢ {navigator.platform.includes('Mac') ? 'Cmd' : 'Ctrl'}+Enter to submit\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default CommentComposer;\n","/**\n * CommentReactions Component\n * Displays and manages emoji reactions on comments\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { ProjectComment, CommentReaction } from '../../services/collaborationApi';\n\ninterface CommentReactionsProps {\n  comment: ProjectComment;\n  currentUserId: number;\n  onReaction: (emoji: string) => Promise<void>;\n  onRemoveReaction: (reactionId: number) => Promise<void>;\n}\n\nconst AVAILABLE_EMOJIS = ['üëç', 'üëé', '‚ù§Ô∏è', 'üòä', 'üéâ', 'üî•', 'üëÄ', 'ü§î'];\n\nexport function CommentReactions({\n  comment,\n  currentUserId,\n  onReaction,\n  onRemoveReaction,\n}: CommentReactionsProps) {\n  const [showPicker, setShowPicker] = useState(false);\n  const [isAdding, setIsAdding] = useState(false);\n  const pickerRef = useRef<HTMLDivElement>(null);\n\n  // Group reactions by emoji\n  const groupedReactions: { [emoji: string]: CommentReaction[] } = {};\n  if (comment.reactions) {\n    comment.reactions.forEach((reaction) => {\n      if (!groupedReactions[reaction.emoji]) {\n        groupedReactions[reaction.emoji] = [];\n      }\n      groupedReactions[reaction.emoji].push(reaction);\n    });\n  }\n\n  // Check if current user has reacted with specific emoji\n  const hasUserReacted = (emoji: string): CommentReaction | undefined => {\n    return groupedReactions[emoji]?.find(r => r.user_id === currentUserId);\n  };\n\n  // Handle emoji click\n  const handleEmojiClick = async (emoji: string) => {\n    const existingReaction = hasUserReacted(emoji);\n\n    setIsAdding(true);\n    try {\n      if (existingReaction) {\n        // Remove reaction if already exists\n        await onRemoveReaction(existingReaction.id);\n      } else {\n        // Add new reaction\n        await onReaction(emoji);\n      }\n    } catch (error) {\n      console.error('Failed to toggle reaction:', error);\n    } finally {\n      setIsAdding(false);\n      setShowPicker(false);\n    }\n  };\n\n  // Close picker when clicking outside\n  useEffect(() => {\n    if (!showPicker) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (pickerRef.current && !pickerRef.current.contains(event.target as Node)) {\n        setShowPicker(false);\n      }\n    };\n\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, [showPicker]);\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        flexWrap: 'wrap',\n        gap: 6,\n        marginTop: 8,\n      }}\n    >\n      {/* Existing reactions */}\n      {Object.entries(groupedReactions).map(([emoji, reactions]) => {\n        const userReaction = hasUserReacted(emoji);\n        const hasReacted = !!userReaction;\n\n        return (\n          <button\n            key={emoji}\n            onClick={() => handleEmojiClick(emoji)}\n            disabled={isAdding}\n            title={reactions.map(r => r.username).join(', ')}\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 4,\n              padding: '4px 8px',\n              background: hasReacted ? 'rgba(59, 130, 246, 0.2)' : 'rgba(100, 116, 139, 0.1)',\n              border: `1px solid ${hasReacted ? '#3b82f6' : '#334155'}`,\n              borderRadius: 12,\n              cursor: isAdding ? 'not-allowed' : 'pointer',\n              fontSize: 14,\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              if (!isAdding) {\n                e.currentTarget.style.transform = 'scale(1.05)';\n              }\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.transform = 'scale(1)';\n            }}\n          >\n            <span>{emoji}</span>\n            <span\n              style={{\n                fontSize: 11,\n                fontWeight: 600,\n                color: hasReacted ? '#3b82f6' : '#94a3b8',\n              }}\n            >\n              {reactions.length}\n            </span>\n          </button>\n        );\n      })}\n\n      {/* Add reaction button */}\n      <div style={{ position: 'relative' }}>\n        <button\n          onClick={() => setShowPicker(!showPicker)}\n          disabled={isAdding}\n          style={{\n            padding: '4px 8px',\n            background: 'transparent',\n            border: '1px solid #334155',\n            borderRadius: 12,\n            cursor: isAdding ? 'not-allowed' : 'pointer',\n            fontSize: 14,\n            color: '#94a3b8',\n            transition: 'all 0.2s',\n          }}\n          onMouseEnter={(e) => {\n            if (!isAdding) {\n              e.currentTarget.style.borderColor = '#3b82f6';\n              e.currentTarget.style.color = '#3b82f6';\n            }\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.borderColor = '#334155';\n            e.currentTarget.style.color = '#94a3b8';\n          }}\n        >\n          +\n        </button>\n\n        {/* Emoji picker */}\n        {showPicker && (\n          <div\n            ref={pickerRef}\n            style={{\n              position: 'absolute',\n              bottom: '100%',\n              left: 0,\n              marginBottom: 4,\n              background: '#1e293b',\n              border: '1px solid #334155',\n              borderRadius: 12,\n              padding: 8,\n              boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n              display: 'grid',\n              gridTemplateColumns: 'repeat(4, 1fr)',\n              gap: 4,\n              zIndex: 100,\n            }}\n          >\n            {AVAILABLE_EMOJIS.map((emoji) => (\n              <button\n                key={emoji}\n                onClick={() => handleEmojiClick(emoji)}\n                disabled={isAdding}\n                style={{\n                  width: 40,\n                  height: 40,\n                  padding: 0,\n                  background: hasUserReacted(emoji) ? 'rgba(59, 130, 246, 0.2)' : 'transparent',\n                  border: hasUserReacted(emoji) ? '1px solid #3b82f6' : '1px solid transparent',\n                  borderRadius: 8,\n                  cursor: isAdding ? 'not-allowed' : 'pointer',\n                  fontSize: 20,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  transition: 'all 0.2s',\n                }}\n                onMouseEnter={(e) => {\n                  if (!isAdding) {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.1)';\n                    e.currentTarget.style.transform = 'scale(1.1)';\n                  }\n                }}\n                onMouseLeave={(e) => {\n                  e.currentTarget.style.background = hasUserReacted(emoji)\n                    ? 'rgba(59, 130, 246, 0.2)'\n                    : 'transparent';\n                  e.currentTarget.style.transform = 'scale(1)';\n                }}\n              >\n                {emoji}\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CommentReactions;\n","/**\n * CommentThread Component\n * Displays threaded comments with replies, reactions, and actions\n */\n\nimport React, { useState } from 'react';\nimport { ProjectComment, CollaboratorRole } from '../../services/collaborationApi';\nimport { getTimeAgo } from '../../services/activityService';\nimport CommentComposer from './CommentComposer';\nimport CommentReactions from './CommentReactions';\n\ninterface CommentThreadProps {\n  comment: ProjectComment;\n  projectId: number;\n  currentUserId: number;\n  collaborators: CollaboratorRole[];\n  depth?: number;\n  maxDepth?: number;\n  onReply: (parentId: number, content: string, mentions: number[], attachments?: File[]) => Promise<void>;\n  onEdit: (commentId: number, content: string) => Promise<ProjectComment | void>;\n  onDelete: (commentId: number) => Promise<ProjectComment | void>;\n  onResolve: (commentId: number) => Promise<ProjectComment | void>;\n  onUnresolve: (commentId: number) => Promise<ProjectComment | void>;\n  onReaction: (commentId: number, emoji: string) => Promise<void>;\n  onRemoveReaction: (commentId: number, reactionId: number) => Promise<void>;\n}\n\nexport function CommentThread({\n  comment,\n  projectId,\n  currentUserId,\n  collaborators,\n  depth = 0,\n  maxDepth = 3,\n  onReply,\n  onEdit,\n  onDelete,\n  onResolve,\n  onUnresolve,\n  onReaction,\n  onRemoveReaction,\n}: CommentThreadProps) {\n  const [showReplyComposer, setShowReplyComposer] = useState(false);\n  const [showEditComposer, setShowEditComposer] = useState(false);\n  const [showMenu, setShowMenu] = useState(false);\n  const [showEditHistory, setShowEditHistory] = useState(false);\n\n  const isAuthor = comment.author === currentUserId;\n  const canReply = depth < maxDepth;\n\n  // Handle reply\n  const handleReply = async (content: string, mentions: number[], attachments?: File[]) => {\n    await onReply(comment.id, content, mentions, attachments);\n    setShowReplyComposer(false);\n  };\n\n  // Handle edit\n  const handleEdit = async (content: string) => {\n    await onEdit(comment.id, content);\n    setShowEditComposer(false);\n  };\n\n  // Handle delete\n  const handleDelete = async () => {\n    if (confirm('Are you sure you want to delete this comment?')) {\n      await onDelete(comment.id);\n    }\n    setShowMenu(false);\n  };\n\n  // Handle resolve/unresolve\n  const handleResolve = async () => {\n    if (comment.resolved) {\n      await onUnresolve(comment.id);\n    } else {\n      await onResolve(comment.id);\n    }\n    setShowMenu(false);\n  };\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        gap: 12,\n        opacity: comment.resolved ? 0.6 : 1,\n        transition: 'opacity 0.2s',\n      }}\n    >\n      {/* Indent line for replies */}\n      {depth > 0 && (\n        <div\n          style={{\n            width: 2,\n            background: '#334155',\n            flexShrink: 0,\n            marginLeft: 16,\n          }}\n        />\n      )}\n\n      {/* Comment content */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            background: 'var(--bg)',\n            border: `1px solid ${comment.resolved ? '#10b981' : 'var(--panel-border)'}`,\n            borderRadius: 8,\n            padding: 12,\n          }}\n        >\n          {/* Header */}\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              marginBottom: 8,\n            }}\n          >\n            <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n              {/* Avatar */}\n              <div\n                style={{\n                  width: 28,\n                  height: 28,\n                  borderRadius: '50%',\n                  background: comment.author_avatar\n                    ? `url(${comment.author_avatar}) center/cover`\n                    : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: '#fff',\n                  fontSize: 12,\n                  fontWeight: 700,\n                }}\n              >\n                {!comment.author_avatar && comment.author_username.charAt(0).toUpperCase()}\n              </div>\n\n              {/* Author & timestamp */}\n              <div>\n                <span\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                  }}\n                >\n                  @{comment.author_username}\n                </span>\n                {comment.edited && (\n                  <span\n                    style={{\n                      marginLeft: 6,\n                      fontSize: 11,\n                      color: '#64748b',\n                      cursor: comment.edit_history ? 'pointer' : 'default',\n                    }}\n                    onClick={() => comment.edit_history && setShowEditHistory(!showEditHistory)}\n                    title={comment.edit_history ? 'Click to see edit history' : undefined}\n                  >\n                    (edited)\n                  </span>\n                )}\n              </div>\n\n              <span style={{ fontSize: 11, color: '#64748b' }}>‚Ä¢</span>\n              <span style={{ fontSize: 11, color: '#64748b' }}>\n                {getTimeAgo(comment.created_at)}\n              </span>\n\n              {/* Section indicator */}\n              {comment.section_title && (\n                <>\n                  <span style={{ fontSize: 11, color: '#64748b' }}>‚Ä¢</span>\n                  <span\n                    style={{\n                      fontSize: 10,\n                      color: '#94a3b8',\n                      background: 'rgba(59, 130, 246, 0.1)',\n                      padding: '2px 6px',\n                      borderRadius: 4,\n                    }}\n                  >\n                    {comment.section_title}\n                  </span>\n                </>\n              )}\n\n              {/* Resolved badge */}\n              {comment.resolved && (\n                <span\n                  style={{\n                    fontSize: 10,\n                    color: '#10b981',\n                    background: 'rgba(16, 185, 129, 0.1)',\n                    padding: '2px 6px',\n                    borderRadius: 4,\n                    fontWeight: 600,\n                  }}\n                  title={\n                    comment.resolved_by_username\n                      ? `Resolved by @${comment.resolved_by_username}`\n                      : 'Resolved'\n                  }\n                >\n                  ‚úì Resolved\n                </span>\n              )}\n            </div>\n\n            {/* Menu button */}\n            <div style={{ position: 'relative' }}>\n              <button\n                onClick={() => setShowMenu(!showMenu)}\n                style={{\n                  background: 'transparent',\n                  border: 'none',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                  fontSize: 18,\n                  padding: '2px 6px',\n                  lineHeight: 1,\n                }}\n              >\n                ‚ãÆ\n              </button>\n\n              {/* Dropdown menu */}\n              {showMenu && (\n                <div\n                  style={{\n                    position: 'absolute',\n                    top: '100%',\n                    right: 0,\n                    marginTop: 4,\n                    background: '#1e293b',\n                    border: '1px solid #334155',\n                    borderRadius: 8,\n                    boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n                    minWidth: 150,\n                    zIndex: 100,\n                  }}\n                >\n                  {isAuthor && (\n                    <>\n                      <button\n                        onClick={() => {\n                          setShowEditComposer(true);\n                          setShowMenu(false);\n                        }}\n                        style={{\n                          width: '100%',\n                          background: 'transparent',\n                          border: 'none',\n                          color: '#e5e7eb',\n                          padding: '8px 12px',\n                          textAlign: 'left',\n                          cursor: 'pointer',\n                          fontSize: 13,\n                        }}\n                        onMouseEnter={(e) => {\n                          e.currentTarget.style.background = '#334155';\n                        }}\n                        onMouseLeave={(e) => {\n                          e.currentTarget.style.background = 'transparent';\n                        }}\n                      >\n                        ‚úèÔ∏è Edit\n                      </button>\n                      <button\n                        onClick={handleDelete}\n                        style={{\n                          width: '100%',\n                          background: 'transparent',\n                          border: 'none',\n                          color: '#ef4444',\n                          padding: '8px 12px',\n                          textAlign: 'left',\n                          cursor: 'pointer',\n                          fontSize: 13,\n                        }}\n                        onMouseEnter={(e) => {\n                          e.currentTarget.style.background = '#334155';\n                        }}\n                        onMouseLeave={(e) => {\n                          e.currentTarget.style.background = 'transparent';\n                        }}\n                      >\n                        üóëÔ∏è Delete\n                      </button>\n                    </>\n                  )}\n                  <button\n                    onClick={handleResolve}\n                    style={{\n                      width: '100%',\n                      background: 'transparent',\n                      border: 'none',\n                      color: comment.resolved ? '#94a3b8' : '#10b981',\n                      padding: '8px 12px',\n                      textAlign: 'left',\n                      cursor: 'pointer',\n                      fontSize: 13,\n                    }}\n                    onMouseEnter={(e) => {\n                      e.currentTarget.style.background = '#334155';\n                    }}\n                    onMouseLeave={(e) => {\n                      e.currentTarget.style.background = 'transparent';\n                    }}\n                  >\n                    {comment.resolved ? '‚Ü©Ô∏è Unresolve' : '‚úì Resolve'}\n                  </button>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Edit history */}\n          {showEditHistory && comment.edit_history && comment.edit_history.length > 0 && (\n            <div\n              style={{\n                marginBottom: 8,\n                padding: 8,\n                background: 'rgba(100, 116, 139, 0.1)',\n                border: '1px solid #334155',\n                borderRadius: 6,\n                fontSize: 11,\n                color: '#94a3b8',\n              }}\n            >\n              <div style={{ fontWeight: 600, marginBottom: 4 }}>Edit History:</div>\n              {comment.edit_history.map((edit) => (\n                <div key={edit.edited_at} style={{ marginBottom: 4 }}>\n                  <span style={{ color: '#64748b' }}>\n                    {new Date(edit.edited_at).toLocaleString()}:\n                  </span>{' '}\n                  {edit.content}\n                </div>\n              ))}\n            </div>\n          )}\n\n          {/* Content */}\n          {showEditComposer ? (\n            <CommentComposer\n              projectId={projectId}\n              collaborators={collaborators}\n              onSubmit={async (content) => {\n                await handleEdit(content);\n              }}\n              onCancel={() => setShowEditComposer(false)}\n              initialValue={comment.content}\n              submitButtonText=\"Save\"\n              compact={true}\n            />\n          ) : (\n            <div\n              style={{\n                fontSize: 13,\n                color: '#cbd5e1',\n                lineHeight: 1.6,\n                marginBottom: 8,\n                whiteSpace: 'pre-wrap',\n              }}\n            >\n              {comment.content}\n            </div>\n          )}\n\n          {/* Attachments */}\n          {comment.attachments && comment.attachments.length > 0 && (\n            <div\n              style={{\n                marginTop: 8,\n                marginBottom: 8,\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 6,\n              }}\n            >\n              {comment.attachments.map((attachment) => (\n                <a\n                  key={attachment.id}\n                  href={attachment.file_url}\n                  target=\"_blank\"\n                  rel=\"noopener noreferrer\"\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                    padding: '6px 10px',\n                    background: 'rgba(59, 130, 246, 0.1)',\n                    border: '1px solid rgba(59, 130, 246, 0.3)',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    color: '#3b82f6',\n                    textDecoration: 'none',\n                    transition: 'all 0.2s',\n                  }}\n                  onMouseEnter={(e) => {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.2)';\n                  }}\n                  onMouseLeave={(e) => {\n                    e.currentTarget.style.background = 'rgba(59, 130, 246, 0.1)';\n                  }}\n                >\n                  <span>üìé</span>\n                  <span style={{ flex: 1 }}>{attachment.filename}</span>\n                  <span style={{ fontSize: 11, color: '#94a3b8' }}>\n                    {(attachment.file_size / 1024).toFixed(1)} KB\n                  </span>\n                </a>\n              ))}\n            </div>\n          )}\n\n          {/* Reactions */}\n          <CommentReactions\n            comment={comment}\n            currentUserId={currentUserId}\n            onReaction={(emoji) => onReaction(comment.id, emoji)}\n            onRemoveReaction={(reactionId) => onRemoveReaction(comment.id, reactionId)}\n          />\n\n          {/* Actions */}\n          {!showEditComposer && (\n            <div\n              style={{\n                marginTop: 8,\n                display: 'flex',\n                gap: 12,\n                fontSize: 12,\n              }}\n            >\n              {canReply && (\n                <button\n                  onClick={() => setShowReplyComposer(!showReplyComposer)}\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    color: '#3b82f6',\n                    cursor: 'pointer',\n                    fontSize: 12,\n                    fontWeight: 600,\n                    padding: 0,\n                  }}\n                >\n                  Reply\n                </button>\n              )}\n            </div>\n          )}\n        </div>\n\n        {/* Reply composer */}\n        {showReplyComposer && (\n          <div style={{ marginTop: 12 }}>\n            <CommentComposer\n              projectId={projectId}\n              parentCommentId={comment.id}\n              collaborators={collaborators}\n              placeholder={`Reply to @${comment.author_username}...`}\n              onSubmit={handleReply}\n              onCancel={() => setShowReplyComposer(false)}\n              submitButtonText=\"Reply\"\n              compact={true}\n              autoFocus={true}\n            />\n          </div>\n        )}\n\n        {/* Replies */}\n        {comment.replies && comment.replies.length > 0 && (\n          <div style={{ marginTop: 12, display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {comment.replies.map((reply) => (\n              <CommentThread\n                key={reply.id}\n                comment={reply}\n                projectId={projectId}\n                currentUserId={currentUserId}\n                collaborators={collaborators}\n                depth={depth + 1}\n                maxDepth={maxDepth}\n                onReply={onReply}\n                onEdit={onEdit}\n                onDelete={onDelete}\n                onResolve={onResolve}\n                onUnresolve={onUnresolve}\n                onReaction={onReaction}\n                onRemoveReaction={onRemoveReaction}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CommentThread;\n","import React, { useState } from 'react';\nimport { CollaborativeProject } from '../../../services/collaborationApi';\nimport { useActivity } from '../../../hooks/useActivity';\nimport { useComments } from '../../../hooks/useComments';\nimport { ActivityFeed } from '../ActivityFeed';\nimport { CommentThread } from '../CommentThread';\nimport CommentComposer from '../CommentComposer';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ActivityTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n}\n\nexport default function ActivityTab({\n  project,\n  currentUser,\n}: ActivityTabProps) {\n  const [activeView, setActiveView] = useState<'activity' | 'comments'>('activity');\n  const [showResolvedComments, setShowResolvedComments] = useState(false);\n\n  // Activity tracking\n  const {\n    activities,\n    onlineUsers,\n    isPolling,\n  } = useActivity({\n    projectId: project.id,\n    autoStart: true,\n  });\n\n  // Comments\n  const {\n    comments,\n    unresolvedCount,\n    totalCount,\n    isLoading: commentsLoading,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n    refresh: refreshComments,\n  } = useComments({\n    projectId: project.id,\n    includeResolved: showResolvedComments,\n    pollingInterval: 30000,\n  });\n\n  const handleAddComment = async (content: string, mentions: number[]) => {\n    try {\n      await addComment(content, mentions);\n    } catch (err) {\n      console.error('Failed to add comment:', err);\n    }\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* View Toggle */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n      }}>\n        <div style={{\n          display: 'flex',\n          gap: 4,\n          background: 'var(--panel)',\n          padding: 4,\n          borderRadius: 8,\n          border: '1px solid var(--panel-border)',\n        }}>\n          <button\n            onClick={() => setActiveView('activity')}\n            style={{\n              padding: '8px 16px',\n              background: activeView === 'activity' ? 'var(--bg)' : 'transparent',\n              border: activeView === 'activity' ? '1px solid var(--panel-border)' : '1px solid transparent',\n              borderRadius: 6,\n              color: activeView === 'activity' ? 'var(--text)' : '#94a3b8',\n              cursor: 'pointer',\n              fontSize: 13,\n              fontWeight: activeView === 'activity' ? 600 : 500,\n            }}\n          >\n            Activity Feed\n          </button>\n          <button\n            onClick={() => setActiveView('comments')}\n            style={{\n              padding: '8px 16px',\n              background: activeView === 'comments' ? 'var(--bg)' : 'transparent',\n              border: activeView === 'comments' ? '1px solid var(--panel-border)' : '1px solid transparent',\n              borderRadius: 6,\n              color: activeView === 'comments' ? 'var(--text)' : '#94a3b8',\n              cursor: 'pointer',\n              fontSize: 13,\n              fontWeight: activeView === 'comments' ? 600 : 500,\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n            }}\n          >\n            Comments\n            {unresolvedCount > 0 && (\n              <span style={{\n                background: '#ef4444',\n                color: '#fff',\n                fontSize: 10,\n                fontWeight: 700,\n                padding: '2px 6px',\n                borderRadius: 10,\n              }}>\n                {unresolvedCount}\n              </span>\n            )}\n          </button>\n        </div>\n\n        {/* Online Status */}\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n        }}>\n          <div style={{\n            width: 8,\n            height: 8,\n            borderRadius: '50%',\n            background: isPolling ? '#10b981' : '#64748b',\n          }} />\n          <span style={{ fontSize: 12, color: '#94a3b8' }}>\n            {onlineUsers.length} online\n          </span>\n        </div>\n      </div>\n\n      {/* Activity View */}\n      {activeView === 'activity' && (\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 16 }}>\n            Recent Activity\n          </h3>\n          {activities.length > 0 ? (\n            <ActivityFeed activities={activities} maxItems={50} />\n          ) : (\n            <div style={{\n              textAlign: 'center',\n              padding: 40,\n              color: '#64748b',\n              fontSize: 14,\n            }}>\n              No activity yet. Activity will appear here as collaborators work on the project.\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Comments View */}\n      {activeView === 'comments' && (\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n          {/* Add Comment */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 20,\n          }}>\n            <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n              Add Comment\n            </h3>\n            <CommentComposer\n              projectId={project.id}\n              onSubmit={handleAddComment}\n              collaborators={project.collaborators || []}\n              placeholder=\"Share your thoughts with the team...\"\n            />\n          </div>\n\n          {/* Comments List */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 20,\n          }}>\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n            }}>\n              <h3 style={{ margin: 0, color: 'var(--text)', fontSize: 16 }}>\n                Comments ({totalCount})\n              </h3>\n              <label style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                fontSize: 12,\n                color: '#94a3b8',\n                cursor: 'pointer',\n              }}>\n                <input\n                  type=\"checkbox\"\n                  checked={showResolvedComments}\n                  onChange={(e) => setShowResolvedComments(e.target.checked)}\n                />\n                Show resolved\n              </label>\n            </div>\n\n            {commentsLoading ? (\n              <div style={{ textAlign: 'center', padding: 20, color: '#94a3b8' }}>\n                Loading comments...\n              </div>\n            ) : comments.length > 0 ? (\n              <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n                {comments.map((comment) => (\n                  <CommentThread\n                    key={comment.id}\n                    comment={comment}\n                    projectId={project.id}\n                    currentUserId={currentUser.id}\n                    collaborators={project.collaborators || []}\n                    onReply={async (parentId, content, mentions) => {\n                      await addComment(content, mentions, undefined, parentId);\n                    }}\n                    onEdit={async (commentId, content) => {\n                      await updateComment(commentId, content);\n                    }}\n                    onDelete={async (commentId) => {\n                      await deleteComment(commentId);\n                    }}\n                    onResolve={async (commentId) => {\n                      await resolveComment(commentId);\n                    }}\n                    onUnresolve={async (commentId) => {\n                      await unresolveComment(commentId);\n                    }}\n                    onReaction={async (commentId, emoji) => {\n                      await addReaction(commentId, emoji);\n                    }}\n                    onRemoveReaction={async (commentId, reactionId) => {\n                      await removeReaction(commentId, reactionId);\n                    }}\n                  />\n                ))}\n              </div>\n            ) : (\n              <div style={{\n                textAlign: 'center',\n                padding: 40,\n                color: '#64748b',\n                fontSize: 14,\n              }}>\n                No comments yet. Start the conversation!\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport { CollaborativeProject, collaborationApi } from '../../../services/collaborationApi';\nimport CopyrightPreview from '../../BookEditor/CopyrightPreview';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface PublishTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ntype PublishStep = 'customize' | 'approve' | 'mint' | 'share';\n\nexport default function PublishTab({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: PublishTabProps) {\n  const [step, setStep] = useState<PublishStep>('customize');\n  const [minting, setMinting] = useState(false);\n  const [error, setError] = useState('');\n  const [saving, setSaving] = useState(false);\n\n  // Customization state\n  const [teaserPercent, setTeaserPercent] = useState(project.teaser_percent || 10);\n  const [watermark, setWatermark] = useState(project.watermark_preview || false);\n  const [price, setPrice] = useState(parseFloat(String(project.price_usd)) || 1);\n  const [editions, setEditions] = useState(project.editions || 1);\n  const [authorsNote, setAuthorsNote] = useState(project.authors_note || '');\n\n  const collaborators = project.collaborators || [];\n  const acceptedCollaborators = collaborators.filter(c => c.status === 'accepted');\n  const sections = project.sections || [];\n\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const isProjectLead = project.created_by === currentUser.id;\n\n  // Helper function to strip HTML tags and check content length\n  const getTextContentLength = (html: string): number => {\n    const stripped = (html || '')\n      .replace(/<[^>]*>/g, '')  // Remove HTML tags\n      .replace(/&nbsp;/g, ' ')  // Replace &nbsp;\n      .trim();\n    return stripped.length;\n  };\n\n  // Validation checks for minimum publishing criteria\n  const titleValid = Boolean(\n    project.title &&\n    project.title.trim().length >= 3 &&\n    !project.title.startsWith('Collaboration Invite')\n  );\n\n  const hasContentSections = sections.length > 0;\n\n  // For books: check text content has at least 50 characters\n  const textSections = sections.filter(s => s.section_type === 'text');\n  const hasValidTextContent = project.content_type === 'book'\n    ? textSections.some(s => getTextContentLength(s.content_html || '') >= 50)\n    : true;\n\n  // For art/music/video: check media files exist\n  const mediaSections = sections.filter(s => s.section_type !== 'text');\n  const hasValidMediaContent = ['art', 'music', 'video'].includes(project.content_type)\n    ? mediaSections.some(s => s.media_file)\n    : true;\n\n  const priceValid = price > 0;\n  const editionsValid = editions >= 1;\n\n  // Check if all contract tasks are signed off\n  const collaboratorsWithTasks = acceptedCollaborators.filter(c => (c.tasks_total || 0) > 0);\n  const allTasksSignedOff = collaboratorsWithTasks.length === 0 ||\n    collaboratorsWithTasks.every(c => c.all_tasks_complete);\n  const incompleteTaskCount = collaboratorsWithTasks.reduce(\n    (sum, c) => sum + ((c.tasks_total || 0) - (c.tasks_signed_off || 0)),\n    0\n  );\n\n  // Check if all requirements are met\n  const checklistItems = [\n    {\n      id: 'title',\n      label: 'Valid project title',\n      checked: titleValid,\n      hint: !titleValid ? 'Set a title (min 3 characters, not a placeholder)' : undefined,\n    },\n    {\n      id: 'content',\n      label: project.content_type === 'book'\n        ? 'Book has text content (min 50 characters)'\n        : `${project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} has media files`,\n      checked: hasContentSections && (project.content_type === 'book' ? hasValidTextContent : hasValidMediaContent),\n      hint: !hasContentSections\n        ? 'Add at least one section'\n        : (project.content_type === 'book' && !hasValidTextContent)\n          ? 'Add at least 50 characters of text'\n          : undefined,\n    },\n    {\n      id: 'price',\n      label: 'Price set (greater than $0)',\n      checked: priceValid,\n      hint: !priceValid ? 'Set a price for your NFT' : undefined,\n    },\n    {\n      id: 'editions',\n      label: 'Edition count set',\n      checked: editionsValid,\n      hint: !editionsValid ? 'Set at least 1 edition' : undefined,\n    },\n    {\n      id: 'splits',\n      label: 'Revenue splits total 100%',\n      checked: Math.abs(collaborators.reduce((sum, c) => sum + parseFloat(String(c.revenue_percentage)), 0) - 100) < 0.01,\n    },\n    {\n      id: 'tasks',\n      label: 'All contract tasks signed off',\n      checked: allTasksSignedOff,\n      hint: !allTasksSignedOff\n        ? `${incompleteTaskCount} task${incompleteTaskCount === 1 ? '' : 's'} still need sign-off`\n        : undefined,\n    },\n    {\n      id: 'invited',\n      label: 'All collaborators responded',\n      checked: collaborators.every(c => c.status === 'accepted' || c.status === 'declined'),\n    },\n    {\n      id: 'approved',\n      label: 'All collaborators approved',\n      checked: project.is_fully_approved,\n    },\n  ];\n\n  const allChecked = checklistItems.every(item => item.checked);\n\n  // Determine current step based on project state\n  useEffect(() => {\n    if (project.status === 'minted') {\n      setStep('share');\n    } else if (project.is_fully_approved) {\n      setStep('mint');\n    }\n  }, [project.status, project.is_fully_approved]);\n\n  const handleSaveCustomization = async () => {\n    if (!isProjectLead) return;\n\n    setSaving(true);\n    setError('');\n\n    try {\n      const updatedProject = await collaborationApi.updateCustomization(project.id, {\n        price_usd: price,\n        editions: editions,\n        teaser_percent: teaserPercent,\n        watermark_preview: watermark,\n        authors_note: authorsNote,\n      });\n      onProjectUpdate?.(updatedProject);\n      setStep('approve');\n    } catch (err: any) {\n      setError(err.message || 'Failed to save customization');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleApproveVersion = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveCurrentVersion(project.id);\n      onProjectUpdate?.(updatedProject);\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve');\n    }\n  };\n\n  const handleApproveRevenue = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveProject(project.id, {\n        approve_content: currentUserRole?.approved_current_version || false,\n        approve_revenue: true,\n      });\n      onProjectUpdate?.(updatedProject);\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve revenue split');\n    }\n  };\n\n  const handleMint = async () => {\n    if (!allChecked || !isProjectLead) return;\n\n    setMinting(true);\n    setError('');\n\n    try {\n      const result = await collaborationApi.mintProject(project.id);\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n      setStep('share');\n    } catch (err: any) {\n      setError(err.message || 'Failed to mint project');\n    } finally {\n      setMinting(false);\n    }\n  };\n\n  const steps: { id: PublishStep; label: string }[] = [\n    { id: 'customize', label: 'Customize' },\n    { id: 'approve', label: 'Approve' },\n    { id: 'mint', label: 'Mint' },\n    { id: 'share', label: 'Share' },\n  ];\n\n  const stepIndex = steps.findIndex(s => s.id === step);\n\n  // Calculate user's estimated earnings\n  const creatorPool = price * 0.9 * editions;\n  const userEstimatedEarnings = creatorPool * (currentUserRole?.revenue_percentage || 0) / 100;\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Step Progress Bar */}\n      <div style={{\n        display: 'grid',\n        gridTemplateColumns: `repeat(${steps.length}, 1fr)`,\n        gap: 8,\n        alignItems: 'end',\n      }}>\n        {steps.map((s, i) => {\n          const isCurrent = s.id === step;\n          const isCompleted = i < stepIndex || project.status === 'minted';\n          const canClick = i <= stepIndex || project.status === 'minted';\n\n          return (\n            <div\n              key={s.id}\n              onClick={() => canClick && setStep(s.id)}\n              style={{ cursor: canClick ? 'pointer' : 'default' }}\n            >\n              <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n                <div style={{\n                  width: 24,\n                  height: 24,\n                  borderRadius: 999,\n                  border: '1px solid var(--panel-border)',\n                  background: isCurrent ? 'var(--accent)' : isCompleted ? '#10b981' : 'var(--panel)',\n                  color: isCurrent || isCompleted ? '#111' : 'var(--text-dim)',\n                  display: 'grid',\n                  placeItems: 'center',\n                  fontSize: 12,\n                  fontWeight: 700,\n                }}>\n                  {isCompleted ? '‚úì' : i + 1}\n                </div>\n                <div style={{\n                  fontSize: 13,\n                  color: isCurrent ? 'var(--text)' : 'var(--text-dim)',\n                  fontWeight: isCurrent ? 700 : 600,\n                }}>\n                  {s.label}\n                </div>\n              </div>\n              <div style={{\n                height: 3,\n                marginTop: 6,\n                borderRadius: 999,\n                background: isCurrent\n                  ? 'radial-gradient(60% 100% at 50% 100%, rgba(245,158,11,0.9), rgba(245,158,11,0.2))'\n                  : isCompleted ? '#10b981' : 'transparent',\n                boxShadow: isCurrent ? '0 0 8px rgba(245,158,11,0.7)' : 'none',\n              }} />\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Back button */}\n      {stepIndex > 0 && step !== 'share' && (\n        <div style={{ display: 'flex', justifyContent: 'flex-start' }}>\n          <button\n            onClick={() => setStep(steps[stepIndex - 1].id)}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              color: 'var(--text-dim)',\n              borderRadius: 8,\n              padding: '6px 12px',\n              cursor: 'pointer',\n              fontSize: 13,\n            }}\n          >\n            Back\n          </button>\n        </div>\n      )}\n\n      {/* Error display */}\n      {error && (\n        <div style={{\n          padding: 12,\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 8,\n          color: '#ef4444',\n          fontSize: 13,\n        }}>\n          {error}\n        </div>\n      )}\n\n      {/* Step Content */}\n      {step === 'customize' && (\n        <CustomizeStep\n          isProjectLead={isProjectLead}\n          teaserPercent={teaserPercent}\n          setTeaserPercent={setTeaserPercent}\n          watermark={watermark}\n          setWatermark={setWatermark}\n          price={price}\n          setPrice={setPrice}\n          editions={editions}\n          setEditions={setEditions}\n          authorsNote={authorsNote}\n          setAuthorsNote={setAuthorsNote}\n          onNext={isProjectLead ? handleSaveCustomization : () => setStep('approve')}\n          saving={saving}\n          authorName={project.created_by_username || 'Creator'}\n        />\n      )}\n\n      {step === 'approve' && (\n        <ApproveStep\n          project={project}\n          currentUser={currentUser}\n          currentUserRole={currentUserRole}\n          acceptedCollaborators={acceptedCollaborators}\n          checklistItems={checklistItems}\n          price={price}\n          editions={editions}\n          userEstimatedEarnings={userEstimatedEarnings}\n          onApproveVersion={handleApproveVersion}\n          onApproveRevenue={handleApproveRevenue}\n          onNext={() => setStep('mint')}\n        />\n      )}\n\n      {step === 'mint' && (\n        <MintStep\n          project={project}\n          isProjectLead={isProjectLead}\n          allChecked={allChecked}\n          checklistItems={checklistItems}\n          price={price}\n          editions={editions}\n          minting={minting}\n          onMint={handleMint}\n        />\n      )}\n\n      {step === 'share' && (\n        <ShareStep project={project} />\n      )}\n    </div>\n  );\n}\n\n// ===== Step Components =====\n\ninterface CustomizeStepProps {\n  isProjectLead: boolean;\n  teaserPercent: number;\n  setTeaserPercent: (v: number) => void;\n  watermark: boolean;\n  setWatermark: (v: boolean) => void;\n  price: number;\n  setPrice: (v: number) => void;\n  editions: number;\n  setEditions: (v: number) => void;\n  authorsNote: string;\n  setAuthorsNote: (v: string) => void;\n  onNext: () => void;\n  saving: boolean;\n  authorName: string;\n}\n\n// Helper to count words\nfunction countWords(text: string): number {\n  return text.trim().split(/\\s+/).filter(w => w.length > 0).length;\n}\n\nfunction CustomizeStep({\n  isProjectLead,\n  teaserPercent,\n  setTeaserPercent,\n  watermark,\n  setWatermark,\n  price,\n  setPrice,\n  editions,\n  setEditions,\n  authorsNote,\n  setAuthorsNote,\n  onNext,\n  saving,\n  authorName,\n}: CustomizeStepProps) {\n  const wordCount = countWords(authorsNote);\n  const maxWords = 100;\n  const isOverLimit = wordCount > maxWords;\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n    }}>\n      <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18 }}>\n        Customize Your NFT\n      </h3>\n\n      {!isProjectLead && (\n        <div style={{\n          padding: 16,\n          background: 'rgba(245, 158, 11, 0.1)',\n          borderRadius: 8,\n          marginBottom: 20,\n          color: '#f59e0b',\n          fontSize: 13,\n        }}>\n          Only the project owner can modify these settings.\n        </div>\n      )}\n\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n        {/* Teaser Slider */}\n        <div>\n          <label style={{ fontSize: 13, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n            Teaser shown to public: {teaserPercent}%\n          </label>\n          <input\n            type=\"range\"\n            min={0}\n            max={100}\n            value={teaserPercent}\n            onChange={(e) => setTeaserPercent(parseInt(e.target.value))}\n            disabled={!isProjectLead}\n            style={{ width: '100%' }}\n          />\n        </div>\n\n        {/* Watermark Checkbox */}\n        <label style={{ display: 'flex', alignItems: 'center', gap: 8, cursor: isProjectLead ? 'pointer' : 'not-allowed' }}>\n          <input\n            type=\"checkbox\"\n            checked={watermark}\n            onChange={(e) => setWatermark(e.target.checked)}\n            disabled={!isProjectLead}\n          />\n          <span style={{ fontSize: 13, color: 'var(--text)' }}>Show watermark on teaser</span>\n        </label>\n\n        {/* Price and Editions */}\n        <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 16 }}>\n          <div>\n            <label style={{ fontSize: 12, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n              Price per edition (USD)\n            </label>\n            <input\n              type=\"number\"\n              min={0.01}\n              step={0.01}\n              value={price}\n              onChange={(e) => setPrice(parseFloat(e.target.value) || 0)}\n              disabled={!isProjectLead}\n              style={{\n                width: '100%',\n                padding: '10px 14px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 16,\n              }}\n            />\n          </div>\n          <div>\n            <label style={{ fontSize: 12, color: '#94a3b8', display: 'block', marginBottom: 8 }}>\n              Number of editions\n            </label>\n            <input\n              type=\"number\"\n              min={1}\n              value={editions}\n              onChange={(e) => setEditions(parseInt(e.target.value) || 1)}\n              disabled={!isProjectLead}\n              style={{\n                width: '100%',\n                padding: '10px 14px',\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 16,\n              }}\n            />\n          </div>\n        </div>\n\n        {/* Author's Note */}\n        <div>\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 8 }}>\n            <label style={{ fontSize: 13, color: '#94a3b8' }}>\n              Author's Note (optional)\n            </label>\n            <span style={{ fontSize: 11, color: isOverLimit ? '#ef4444' : '#64748b' }}>\n              {wordCount}/{maxWords} words\n            </span>\n          </div>\n          <textarea\n            value={authorsNote}\n            onChange={(e) => setAuthorsNote(e.target.value)}\n            placeholder=\"Share a brief note about this work with your audience...\"\n            disabled={!isProjectLead}\n            style={{\n              width: '100%',\n              minHeight: 80,\n              padding: '10px 14px',\n              background: 'var(--bg)',\n              border: `1px solid ${isOverLimit ? '#ef4444' : 'var(--panel-border)'}`,\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              resize: 'vertical',\n              fontFamily: 'inherit',\n              cursor: isProjectLead ? 'text' : 'not-allowed',\n              opacity: isProjectLead ? 1 : 0.6,\n            }}\n          />\n          {isOverLimit && (\n            <div style={{ fontSize: 11, color: '#ef4444', marginTop: 4 }}>\n              Please keep your note under {maxWords} words.\n            </div>\n          )}\n        </div>\n\n        <div style={{ fontSize: 12, color: '#64748b' }}>\n          Platform fee applies per terms. Changing price or editions will reset all revenue split approvals.\n        </div>\n\n        {/* Copyright Preview */}\n        <CopyrightPreview authorName={authorName} />\n      </div>\n\n      {/* Next Button */}\n      <div style={{ marginTop: 24, display: 'flex', justifyContent: 'flex-end' }}>\n        <button\n          onClick={onNext}\n          disabled={isProjectLead && saving}\n          style={{\n            padding: '12px 32px',\n            background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n            border: 'none',\n            borderRadius: 8,\n            color: '#111',\n            fontWeight: 700,\n            fontSize: 14,\n            cursor: (isProjectLead && saving) ? 'not-allowed' : 'pointer',\n            opacity: (isProjectLead && saving) ? 0.7 : 1,\n          }}\n        >\n          {isProjectLead ? (saving ? 'Saving...' : 'Save & Continue') : 'Continue to Approve'}\n        </button>\n      </div>\n    </div>\n  );\n}\n\ninterface ApproveStepProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  currentUserRole: any;\n  acceptedCollaborators: any[];\n  checklistItems: { id: string; label: string; checked: boolean; hint?: string }[];\n  price: number;\n  editions: number;\n  userEstimatedEarnings: number;\n  onApproveVersion: () => void;\n  onApproveRevenue: () => void;\n  onNext: () => void;\n}\n\nfunction ApproveStep({\n  project,\n  currentUser,\n  currentUserRole,\n  acceptedCollaborators,\n  checklistItems,\n  price,\n  editions,\n  userEstimatedEarnings,\n  onApproveVersion,\n  onApproveRevenue,\n  onNext,\n}: ApproveStepProps) {\n  const userHasApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', gap: 20 }}>\n      {/* Status Banner */}\n      <div style={{\n        background: project.is_fully_approved\n          ? 'rgba(16, 185, 129, 0.1)'\n          : 'rgba(245, 158, 11, 0.1)',\n        border: `1px solid ${project.is_fully_approved ? '#10b981' : '#f59e0b'}`,\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        alignItems: 'center',\n        gap: 16,\n      }}>\n        <div style={{\n          width: 48,\n          height: 48,\n          borderRadius: '50%',\n          background: project.is_fully_approved\n            ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n            : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          fontSize: 24,\n        }}>\n          {project.is_fully_approved ? '‚úì' : '...'}\n        </div>\n        <div>\n          <div style={{\n            fontSize: 18,\n            fontWeight: 700,\n            color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n          }}>\n            {project.is_fully_approved ? 'All Approved!' : 'Awaiting Approvals'}\n          </div>\n          <div style={{ fontSize: 14, color: '#94a3b8', marginTop: 4 }}>\n            {project.is_fully_approved\n              ? 'All collaborators have approved. Proceed to mint.'\n              : 'Waiting for all collaborators to approve content and revenue split.'}\n          </div>\n        </div>\n      </div>\n\n      <div style={{ display: 'grid', gridTemplateColumns: '1fr 1fr', gap: 20 }}>\n        {/* Your Approval Actions */}\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Your Approval\n          </h3>\n\n          {userHasApproved ? (\n            <div style={{\n              textAlign: 'center',\n              padding: 24,\n              background: 'rgba(16, 185, 129, 0.1)',\n              borderRadius: 8,\n            }}>\n              <div style={{ fontSize: 48, marginBottom: 12 }}>‚úì</div>\n              <div style={{ fontSize: 16, fontWeight: 600, color: '#10b981' }}>\n                You've approved this project\n              </div>\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 16 }}>\n              <div style={{ padding: 16, background: 'var(--bg)', borderRadius: 8 }}>\n                <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)', marginBottom: 8 }}>\n                  Content Approval\n                </div>\n                <div style={{ fontSize: 12, color: '#94a3b8', marginBottom: 12 }}>\n                  Confirm you're happy with all content in this project.\n                </div>\n                <button\n                  onClick={onApproveVersion}\n                  disabled={currentUserRole?.approved_current_version}\n                  style={{\n                    width: '100%',\n                    padding: '10px 16px',\n                    background: currentUserRole?.approved_current_version\n                      ? '#374151'\n                      : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                    border: 'none',\n                    borderRadius: 8,\n                    color: '#fff',\n                    fontWeight: 600,\n                    cursor: currentUserRole?.approved_current_version ? 'not-allowed' : 'pointer',\n                    fontSize: 13,\n                  }}\n                >\n                  {currentUserRole?.approved_current_version ? '‚úì Content Approved' : 'Approve Content'}\n                </button>\n              </div>\n\n              <div style={{ padding: 16, background: 'var(--bg)', borderRadius: 8 }}>\n                <div style={{ fontSize: 14, fontWeight: 600, color: 'var(--text)', marginBottom: 8 }}>\n                  Revenue Split Approval\n                </div>\n                <div style={{ fontSize: 12, color: '#94a3b8', marginBottom: 12 }}>\n                  ${price.toFixed(2)} x {editions} editions = ${(price * editions).toFixed(2)} gross.\n                  Your share: {currentUserRole?.revenue_percentage || 0}% = ${userEstimatedEarnings.toFixed(2)} (after 10% platform fee)\n                </div>\n                <button\n                  onClick={onApproveRevenue}\n                  disabled={currentUserRole?.approved_revenue_split}\n                  style={{\n                    width: '100%',\n                    padding: '10px 16px',\n                    background: currentUserRole?.approved_revenue_split\n                      ? '#374151'\n                      : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                    border: 'none',\n                    borderRadius: 8,\n                    color: '#fff',\n                    fontWeight: 600,\n                    cursor: currentUserRole?.approved_revenue_split ? 'not-allowed' : 'pointer',\n                    fontSize: 13,\n                  }}\n                >\n                  {currentUserRole?.approved_revenue_split ? '‚úì Revenue Approved' : 'Approve Revenue Split'}\n                </button>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Approval Progress */}\n        <div style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n        }}>\n          <h3 style={{ margin: '0 0 16px', color: 'var(--text)', fontSize: 16 }}>\n            Team Approval Status\n          </h3>\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {acceptedCollaborators.map((collab) => {\n              const hasApproved = collab.approved_current_version && collab.approved_revenue_split;\n              return (\n                <div\n                  key={collab.id}\n                  style={{\n                    padding: 12,\n                    background: hasApproved ? 'rgba(16, 185, 129, 0.1)' : 'var(--bg)',\n                    border: `1px solid ${hasApproved ? '#10b981' : 'var(--panel-border)'}`,\n                    borderRadius: 8,\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'space-between',\n                  }}\n                >\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                    <div style={{\n                      width: 32,\n                      height: 32,\n                      borderRadius: '50%',\n                      background: hasApproved\n                        ? 'linear-gradient(135deg, #10b981 0%, #059669 100%)'\n                        : 'linear-gradient(135deg, #64748b 0%, #475569 100%)',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      color: '#fff',\n                      fontSize: 12,\n                      fontWeight: 600,\n                    }}>\n                      {hasApproved ? '‚úì' : collab.username.charAt(0).toUpperCase()}\n                    </div>\n                    <div>\n                      <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                        @{collab.username}\n                      </div>\n                      <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                        {collab.role} - {collab.revenue_percentage}%\n                      </div>\n                    </div>\n                  </div>\n                  <div style={{ display: 'flex', gap: 6 }}>\n                    <span style={{\n                      fontSize: 10,\n                      padding: '3px 6px',\n                      borderRadius: 4,\n                      background: collab.approved_current_version ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                      color: collab.approved_current_version ? '#10b981' : '#64748b',\n                    }}>\n                      {collab.approved_current_version ? '‚úì' : '‚óã'} Content\n                    </span>\n                    <span style={{\n                      fontSize: 10,\n                      padding: '3px 6px',\n                      borderRadius: 4,\n                      background: collab.approved_revenue_split ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                      color: collab.approved_revenue_split ? '#10b981' : '#64748b',\n                    }}>\n                      {collab.approved_revenue_split ? '‚úì' : '‚óã'} Revenue\n                    </span>\n                  </div>\n                </div>\n              );\n            })}\n          </div>\n        </div>\n      </div>\n\n      {/* Next Button */}\n      {project.is_fully_approved && (\n        <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\n          <button\n            onClick={onNext}\n            style={{\n              padding: '12px 32px',\n              background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#111',\n              fontWeight: 700,\n              fontSize: 14,\n              cursor: 'pointer',\n            }}\n          >\n            Next\n          </button>\n        </div>\n      )}\n    </div>\n  );\n}\n\ninterface MintStepProps {\n  project: CollaborativeProject;\n  isProjectLead: boolean;\n  allChecked: boolean;\n  checklistItems: { id: string; label: string; checked: boolean; hint?: string }[];\n  price: number;\n  editions: number;\n  minting: boolean;\n  onMint: () => void;\n}\n\nfunction MintStep({\n  project,\n  isProjectLead,\n  allChecked,\n  checklistItems,\n  price,\n  editions,\n  minting,\n  onMint,\n}: MintStepProps) {\n  const [agree, setAgree] = useState(false);\n\n  const gross = price * editions;\n  const platformFee = gross * 0.1;\n  const net = gross - platformFee;\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n    }}>\n      <h3 style={{ margin: '0 0 20px', color: 'var(--text)', fontSize: 18 }}>\n        Review & Mint\n      </h3>\n\n      {/* Checklist */}\n      <div style={{ marginBottom: 24 }}>\n        <h4 style={{ margin: '0 0 12px', color: 'var(--text)', fontSize: 14 }}>Pre-mint Checklist</h4>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {checklistItems.map((item) => (\n            <div\n              key={item.id}\n              style={{\n                display: 'flex',\n                flexDirection: 'column',\n                gap: 4,\n                padding: 10,\n                background: item.checked ? 'rgba(16, 185, 129, 0.1)' : 'rgba(239, 68, 68, 0.05)',\n                borderRadius: 6,\n                border: item.checked ? 'none' : '1px solid rgba(239, 68, 68, 0.2)',\n              }}\n            >\n              <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                <div style={{\n                  width: 20,\n                  height: 20,\n                  borderRadius: '50%',\n                  background: item.checked ? '#10b981' : '#ef4444',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: '#fff',\n                  fontSize: 10,\n                }}>\n                  {item.checked ? '‚úì' : '!'}\n                </div>\n                <span style={{ fontSize: 13, color: item.checked ? '#10b981' : 'var(--text)' }}>\n                  {item.label}\n                </span>\n              </div>\n              {!item.checked && item.hint && (\n                <span style={{ fontSize: 11, color: '#ef4444', marginLeft: 30 }}>\n                  {item.hint}\n                </span>\n              )}\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Financial Summary */}\n      <div style={{\n        padding: 16,\n        background: 'var(--bg)',\n        borderRadius: 8,\n        marginBottom: 24,\n      }}>\n        <h4 style={{ margin: '0 0 12px', color: 'var(--text)', fontSize: 14 }}>Financial Summary</h4>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8, fontSize: 13, color: '#94a3b8' }}>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Price per edition:</span>\n            <span style={{ color: 'var(--text)' }}>${price.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Editions:</span>\n            <span style={{ color: 'var(--text)' }}>{editions}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Gross Revenue (if all sold):</span>\n            <span style={{ color: 'var(--text)' }}>${gross.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n            <span>Platform Fee (10%):</span>\n            <span style={{ color: '#ef4444' }}>-${platformFee.toFixed(2)}</span>\n          </div>\n          <div style={{ display: 'flex', justifyContent: 'space-between', borderTop: '1px solid var(--panel-border)', paddingTop: 8 }}>\n            <span style={{ fontWeight: 600 }}>Creator Pool:</span>\n            <span style={{ color: '#10b981', fontWeight: 600 }}>${net.toFixed(2)}</span>\n          </div>\n        </div>\n      </div>\n\n      {/* Terms Agreement */}\n      <div style={{ marginBottom: 24 }}>\n        <div style={{ display: 'flex', gap: 12, marginBottom: 12 }}>\n          <a href=\"/legal/terms\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Terms of Service\n          </a>\n          <a href=\"/legal/creator-agreement\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Creator Agreement\n          </a>\n          <a href=\"/legal/content-policy\" target=\"_blank\" rel=\"noreferrer\" style={{ fontSize: 12, color: 'var(--accent)' }}>\n            Content Policy\n          </a>\n        </div>\n        <label style={{ display: 'flex', alignItems: 'center', gap: 8, marginTop: 12, cursor: 'pointer' }}>\n          <input\n            type=\"checkbox\"\n            checked={agree}\n            onChange={(e) => setAgree(e.target.checked)}\n          />\n          <span style={{ fontSize: 13, color: 'var(--text)' }}>\n            I agree to the Terms and understand fees\n          </span>\n        </label>\n      </div>\n\n      {/* Mint Button */}\n      {isProjectLead ? (\n        <button\n          onClick={onMint}\n          disabled={!allChecked || !agree || minting}\n          style={{\n            width: '100%',\n            padding: '14px 24px',\n            background: allChecked && agree\n              ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'\n              : '#374151',\n            border: 'none',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 700,\n            fontSize: 16,\n            cursor: allChecked && agree && !minting ? 'pointer' : 'not-allowed',\n            opacity: allChecked && agree ? 1 : 0.5,\n          }}\n        >\n          {minting ? 'Minting...' : 'Mint & Publish NFT'}\n        </button>\n      ) : (\n        <div style={{\n          textAlign: 'center',\n          padding: 16,\n          background: 'rgba(245, 158, 11, 0.1)',\n          borderRadius: 8,\n          color: '#f59e0b',\n          fontSize: 14,\n        }}>\n          Waiting for project owner to mint the NFT.\n        </div>\n      )}\n\n      <div style={{ fontSize: 11, color: '#64748b', marginTop: 12, textAlign: 'center' }}>\n        Once minted, content cannot be changed.\n      </div>\n    </div>\n  );\n}\n\nfunction ShareStep({ project }: { project: CollaborativeProject }) {\n  // Use /collaborations/ route since collaborative projects don't have a Content entry yet\n  // TODO: Once backend creates Content on mint, switch to /content/${content_id}\n  const projectUrl = `${window.location.origin}/collaborations/${project.id}`;\n  const [copied, setCopied] = useState(false);\n\n  const handleCopy = () => {\n    navigator.clipboard.writeText(projectUrl);\n    setCopied(true);\n    setTimeout(() => setCopied(false), 2000);\n  };\n\n  return (\n    <div style={{\n      background: 'var(--panel)',\n      border: '1px solid var(--panel-border)',\n      borderRadius: 12,\n      padding: 24,\n      textAlign: 'center',\n    }}>\n      <div style={{ fontSize: 64, marginBottom: 16 }}>üéâ</div>\n      <h3 style={{ margin: '0 0 8px', color: 'var(--text)', fontSize: 24 }}>\n        Successfully Minted!\n      </h3>\n      <p style={{ fontSize: 14, color: '#94a3b8', marginBottom: 24 }}>\n        Your collaborative NFT is now live. Share it with the world!\n      </p>\n\n      <div style={{\n        display: 'flex',\n        gap: 8,\n        maxWidth: 500,\n        margin: '0 auto 24px',\n      }}>\n        <input\n          value={projectUrl}\n          readOnly\n          style={{\n            flex: 1,\n            padding: '10px 14px',\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n            color: 'var(--text)',\n            fontSize: 13,\n          }}\n        />\n        <button\n          onClick={handleCopy}\n          style={{\n            padding: '10px 20px',\n            background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n            border: 'none',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 600,\n            cursor: 'pointer',\n            fontSize: 13,\n          }}\n        >\n          {copied ? 'Copied!' : 'Copy Link'}\n        </button>\n      </div>\n\n      <div style={{\n        display: 'flex',\n        justifyContent: 'center',\n        gap: 16,\n      }}>\n        <a\n          href={`https://twitter.com/intent/tweet?text=Check out our collaborative NFT!&url=${encodeURIComponent(projectUrl)}`}\n          target=\"_blank\"\n          rel=\"noreferrer\"\n          style={{\n            padding: '10px 20px',\n            background: '#1DA1F2',\n            borderRadius: 8,\n            color: '#fff',\n            fontWeight: 600,\n            textDecoration: 'none',\n            fontSize: 13,\n          }}\n        >\n          Share on X\n        </a>\n      </div>\n    </div>\n  );\n}\n","/**\n * OnlineStatus Component\n * Shows online/offline indicator with last seen timestamp\n */\n\nimport React from 'react';\nimport { OnlineUser, getTimeAgo } from '../../services/activityService';\n\ninterface OnlineStatusProps {\n  userId: number;\n  onlineUsers: OnlineUser[];\n  size?: 'small' | 'medium' | 'large';\n  showLabel?: boolean;\n  showLastSeen?: boolean;\n}\n\nexport function OnlineStatus({\n  userId,\n  onlineUsers,\n  size = 'medium',\n  showLabel = false,\n  showLastSeen = false,\n}: OnlineStatusProps) {\n  const user = onlineUsers.find(u => u.user_id === userId);\n  const isOnline = user?.is_online ?? false;\n  const lastSeen = user?.last_seen;\n\n  // Sizes for the indicator dot\n  const dotSizes = {\n    small: 6,\n    medium: 8,\n    large: 10,\n  };\n\n  const dotSize = dotSizes[size];\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n      }}\n      title={\n        isOnline\n          ? 'Online'\n          : lastSeen\n          ? `Last seen ${getTimeAgo(lastSeen)}`\n          : 'Offline'\n      }\n    >\n      {/* Status Indicator Dot */}\n      <div\n        aria-label={isOnline ? 'Online' : 'Offline'}\n        style={{\n          width: dotSize,\n          height: dotSize,\n          borderRadius: '50%',\n          background: isOnline ? '#10b981' : '#64748b',\n          boxShadow: isOnline ? '0 0 8px rgba(16, 185, 129, 0.5)' : 'none',\n          transition: 'all 0.3s',\n        }}\n      />\n\n      {/* Optional Label */}\n      {showLabel && (\n        <span\n          style={{\n            fontSize: size === 'small' ? 10 : size === 'medium' ? 11 : 12,\n            color: isOnline ? '#10b981' : '#64748b',\n            fontWeight: 600,\n          }}\n        >\n          {isOnline ? 'Online' : 'Offline'}\n        </span>\n      )}\n\n      {/* Optional Last Seen */}\n      {!isOnline && showLastSeen && lastSeen && (\n        <span\n          style={{\n            fontSize: size === 'small' ? 9 : size === 'medium' ? 10 : 11,\n            color: '#64748b',\n          }}\n        >\n          {getTimeAgo(lastSeen)}\n        </span>\n      )}\n    </div>\n  );\n}\n\n/**\n * Online Status Badge (for larger display)\n */\ninterface OnlineStatusBadgeProps {\n  userId: number;\n  username: string;\n  onlineUsers: OnlineUser[];\n  avatar?: string;\n}\n\nexport function OnlineStatusBadge({\n  userId,\n  username,\n  onlineUsers,\n  avatar,\n}: OnlineStatusBadgeProps) {\n  const user = onlineUsers.find(u => u.user_id === userId);\n  const isOnline = user?.is_online ?? false;\n  const lastSeen = user?.last_seen;\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        gap: 10,\n        padding: '8px 12px',\n        background: 'var(--bg)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 8,\n      }}\n    >\n      {/* Avatar or placeholder */}\n      <div\n        style={{\n          position: 'relative',\n          width: 32,\n          height: 32,\n          borderRadius: '50%',\n          background: avatar\n            ? `url(${avatar}) center/cover`\n            : 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          color: '#fff',\n          fontSize: 14,\n          fontWeight: 700,\n        }}\n      >\n        {!avatar && username.charAt(0).toUpperCase()}\n\n        {/* Online indicator on avatar */}\n        <div\n          aria-label={isOnline ? 'Online' : 'Offline'}\n          style={{\n            position: 'absolute',\n            bottom: 0,\n            right: 0,\n            width: 10,\n            height: 10,\n            borderRadius: '50%',\n            background: isOnline ? '#10b981' : '#64748b',\n            border: '2px solid var(--bg)',\n            boxShadow: isOnline ? '0 0 8px rgba(16, 185, 129, 0.5)' : 'none',\n          }}\n        />\n      </div>\n\n      {/* User info */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <div\n          style={{\n            fontSize: 13,\n            fontWeight: 600,\n            color: 'var(--text)',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          @{username}\n        </div>\n        <div\n          style={{\n            fontSize: 11,\n            color: isOnline ? '#10b981' : '#64748b',\n          }}\n        >\n          {isOnline ? (\n            'Online now'\n          ) : lastSeen ? (\n            `Last seen ${getTimeAgo(lastSeen)}`\n          ) : (\n            'Offline'\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n/**\n * Online Users Summary (shows count)\n */\ninterface OnlineUsersSummaryProps {\n  onlineUsers: OnlineUser[];\n  totalUsers: number;\n}\n\nexport function OnlineUsersSummary({\n  onlineUsers,\n  totalUsers,\n}: OnlineUsersSummaryProps) {\n  const onlineCount = onlineUsers.filter(u => u.is_online).length;\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n        padding: '4px 10px',\n        background: onlineCount > 0 ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n        border: `1px solid ${onlineCount > 0 ? '#10b981' : '#64748b'}`,\n        borderRadius: 12,\n        fontSize: 11,\n        fontWeight: 600,\n      }}\n      title={`${onlineCount} online, ${totalUsers - onlineCount} offline`}\n    >\n      <div\n        style={{\n          width: 6,\n          height: 6,\n          borderRadius: '50%',\n          background: onlineCount > 0 ? '#10b981' : '#64748b',\n        }}\n      />\n      <span style={{ color: onlineCount > 0 ? '#10b981' : '#64748b' }}>\n        {onlineCount} / {totalUsers} online\n      </span>\n    </div>\n  );\n}\n\nexport default OnlineStatus;\n","/**\n * EditingIndicator Component\n * Shows when users are currently editing a section\n */\n\nimport React from 'react';\nimport { CurrentlyEditing, getTimeAgo } from '../../services/activityService';\n\ninterface EditingIndicatorProps {\n  sectionId: number;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number; // To exclude current user from display\n}\n\n/**\n * Show editing indicator for a specific section\n */\nexport function EditingIndicator({\n  sectionId,\n  currentlyEditing,\n  currentUserId,\n}: EditingIndicatorProps) {\n  // Filter editors for this section (excluding current user)\n  const editors = currentlyEditing.filter(\n    e => e.section_id === sectionId && e.user_id !== currentUserId\n  );\n\n  if (editors.length === 0) {\n    return null;\n  }\n\n  const editor = editors[0]; // Show first editor\n  const othersCount = editors.length - 1;\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 8,\n        padding: '6px 12px',\n        background: 'rgba(251, 191, 36, 0.1)',\n        border: '1px solid #f59e0b',\n        borderRadius: 8,\n        fontSize: 12,\n        color: '#f59e0b',\n        fontWeight: 600,\n      }}\n      role=\"status\"\n      aria-live=\"polite\"\n    >\n      <span\n        style={{\n          display: 'inline-block',\n          animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n        }}\n      >\n        ‚è≥\n      </span>\n      <span>\n        @{editor.username} is editing\n        {othersCount > 0 && ` +${othersCount} other${othersCount > 1 ? 's' : ''}`}\n      </span>\n\n      <style>{`\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      `}</style>\n    </div>\n  );\n}\n\n/**\n * Show available to edit indicator\n */\ninterface AvailableToEditProps {\n  canEdit: boolean;\n}\n\nexport function AvailableToEdit({ canEdit }: AvailableToEditProps) {\n  if (!canEdit) {\n    return (\n      <div\n        style={{\n          display: 'inline-flex',\n          alignItems: 'center',\n          gap: 6,\n          padding: '6px 12px',\n          background: 'rgba(100, 116, 139, 0.1)',\n          border: '1px solid #64748b',\n          borderRadius: 8,\n          fontSize: 12,\n          color: '#64748b',\n          fontWeight: 600,\n        }}\n      >\n        üîí Read only\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 6,\n        padding: '6px 12px',\n        background: 'rgba(16, 185, 129, 0.1)',\n        border: '1px solid #10b981',\n        borderRadius: 8,\n        fontSize: 12,\n        color: '#10b981',\n        fontWeight: 600,\n      }}\n    >\n      ‚úèÔ∏è Available to edit\n    </div>\n  );\n}\n\n/**\n * Section Header with Editing Indicator\n * Combines section info with real-time editing status\n */\ninterface SectionHeaderWithStatusProps {\n  sectionNumber: number;\n  sectionTitle: string;\n  sectionId: number;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number;\n  canEdit: boolean;\n}\n\nexport function SectionHeaderWithStatus({\n  sectionNumber,\n  sectionTitle,\n  sectionId,\n  currentlyEditing,\n  currentUserId,\n  canEdit,\n}: SectionHeaderWithStatusProps) {\n  const editors = currentlyEditing.filter(\n    e => e.section_id === sectionId && e.user_id !== currentUserId\n  );\n\n  const isBeingEdited = editors.length > 0;\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        marginBottom: 12,\n        flexWrap: 'wrap',\n        gap: 12,\n      }}\n    >\n      {/* Section Title */}\n      <div style={{ flex: 1, minWidth: 0 }}>\n        <h4\n          style={{\n            margin: 0,\n            fontSize: 16,\n            fontWeight: 700,\n            color: 'var(--text)',\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          Section {sectionNumber}: {sectionTitle}\n        </h4>\n      </div>\n\n      {/* Status Indicators */}\n      <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\n        {isBeingEdited ? (\n          <EditingIndicator\n            sectionId={sectionId}\n            currentlyEditing={currentlyEditing}\n            currentUserId={currentUserId}\n          />\n        ) : (\n          <AvailableToEdit canEdit={canEdit} />\n        )}\n      </div>\n    </div>\n  );\n}\n\n/**\n * Typing indicator with animated dots\n */\ninterface TypingIndicatorProps {\n  username: string;\n}\n\nexport function TypingIndicator({ username }: TypingIndicatorProps) {\n  return (\n    <div\n      style={{\n        display: 'inline-flex',\n        alignItems: 'center',\n        gap: 8,\n        padding: '4px 10px',\n        background: 'rgba(59, 130, 246, 0.1)',\n        border: '1px solid #3b82f6',\n        borderRadius: 12,\n        fontSize: 11,\n        color: '#3b82f6',\n        fontWeight: 600,\n      }}\n      role=\"status\"\n      aria-live=\"polite\"\n    >\n      <span>@{username} is typing</span>\n      <span\n        style={{\n          display: 'inline-flex',\n          gap: 2,\n        }}\n      >\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot1 1.4s infinite',\n          }}\n        />\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot2 1.4s infinite',\n          }}\n        />\n        <span\n          style={{\n            width: 4,\n            height: 4,\n            borderRadius: '50%',\n            background: '#3b82f6',\n            animation: 'dot3 1.4s infinite',\n          }}\n        />\n      </span>\n\n      <style>{`\n        @keyframes dot1 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          30% { opacity: 1; transform: translateY(-4px); }\n        }\n        @keyframes dot2 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          40% { opacity: 1; transform: translateY(-4px); }\n        }\n        @keyframes dot3 {\n          0%, 60%, 100% { opacity: 0.3; transform: translateY(0); }\n          50% { opacity: 1; transform: translateY(-4px); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\n/**\n * List of all currently editing users\n */\ninterface CurrentlyEditingListProps {\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId?: number;\n}\n\nexport function CurrentlyEditingList({\n  currentlyEditing,\n  currentUserId,\n}: CurrentlyEditingListProps) {\n  // Filter out current user\n  const editors = currentlyEditing.filter(e => e.user_id !== currentUserId);\n\n  if (editors.length === 0) {\n    return (\n      <div\n        style={{\n          padding: 16,\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 12,\n        }}\n      >\n        No one is currently editing\n      </div>\n    );\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 8,\n      }}\n    >\n      {editors.map((editor, index) => (\n        <div\n          key={`${editor.user_id}-${editor.section_id}-${index}`}\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 10,\n            padding: '8px 12px',\n            background: 'rgba(251, 191, 36, 0.05)',\n            border: '1px solid rgba(251, 191, 36, 0.2)',\n            borderRadius: 8,\n          }}\n        >\n          <span\n            style={{\n              fontSize: 16,\n              animation: 'pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite',\n            }}\n          >\n            ‚è≥\n          </span>\n\n          <div style={{ flex: 1, minWidth: 0 }}>\n            <div\n              style={{\n                fontSize: 12,\n                fontWeight: 600,\n                color: 'var(--text)',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              @{editor.username}\n            </div>\n            <div\n              style={{\n                fontSize: 11,\n                color: '#94a3b8',\n                overflow: 'hidden',\n                textOverflow: 'ellipsis',\n                whiteSpace: 'nowrap',\n              }}\n            >\n              Editing: {editor.section_title}\n            </div>\n          </div>\n\n          <div\n            style={{\n              fontSize: 10,\n              color: '#64748b',\n            }}\n          >\n            {getTimeAgo(editor.started_at)}\n          </div>\n        </div>\n      ))}\n\n      <style>{`\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default EditingIndicator;\n","/**\n * ApprovalRequestModal Component\n * Modal for requesting approval from collaborators\n */\n\nimport React, { useState } from 'react';\nimport { CollaborativeProject, CollaboratorRole } from '../../services/collaborationApi';\n\ninterface ApprovalRequestModalProps {\n  project: CollaborativeProject;\n  pendingCollaborators: CollaboratorRole[];\n  onClose: () => void;\n  onSubmit: (selectedCollaboratorIds: number[], message: string, deadline: number) => void;\n}\n\nexport function ApprovalRequestModal({\n  project,\n  pendingCollaborators,\n  onClose,\n  onSubmit,\n}: ApprovalRequestModalProps) {\n  const [selectedCollaborators, setSelectedCollaborators] = useState<Set<number>>(\n    new Set(pendingCollaborators.map(c => c.user))\n  );\n  const [message, setMessage] = useState('');\n  const [deadline, setDeadline] = useState(7); // days\n\n  const handleToggleCollaborator = (userId: number) => {\n    const newSelected = new Set(selectedCollaborators);\n    if (newSelected.has(userId)) {\n      newSelected.delete(userId);\n    } else {\n      newSelected.add(userId);\n    }\n    setSelectedCollaborators(newSelected);\n  };\n\n  const handleSubmit = () => {\n    if (selectedCollaborators.size === 0) {\n      alert('Please select at least one collaborator to request approval from.');\n      return;\n    }\n    onSubmit(Array.from(selectedCollaborators), message, deadline);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.7)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n          maxWidth: 500,\n          width: '90%',\n          maxHeight: '80vh',\n          overflow: 'auto',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <h2\n          style={{\n            margin: 0,\n            marginBottom: 20,\n            fontSize: 20,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          Request Approval from Team\n        </h2>\n\n        {/* Collaborator selection */}\n        <div style={{ marginBottom: 20 }}>\n          <div\n            style={{\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 12,\n            }}\n          >\n            Send approval request to:\n          </div>\n\n          {pendingCollaborators.length === 0 ? (\n            <div\n              style={{\n                padding: 16,\n                background: 'rgba(16, 185, 129, 0.1)',\n                border: '1px solid rgba(16, 185, 129, 0.3)',\n                borderRadius: 8,\n                fontSize: 13,\n                color: '#10b981',\n                textAlign: 'center',\n              }}\n            >\n              All collaborators have already approved!\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              {pendingCollaborators.map((collab) => (\n                <label\n                  key={collab.user}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 10,\n                    padding: 12,\n                    background: selectedCollaborators.has(collab.user)\n                      ? 'rgba(59, 130, 246, 0.1)'\n                      : 'var(--bg)',\n                    border: `1px solid ${\n                      selectedCollaborators.has(collab.user)\n                        ? '#3b82f6'\n                        : 'var(--panel-border)'\n                    }`,\n                    borderRadius: 8,\n                    cursor: 'pointer',\n                    transition: 'all 0.2s',\n                  }}\n                  onMouseEnter={(e) => {\n                    if (!selectedCollaborators.has(collab.user)) {\n                      e.currentTarget.style.background = 'rgba(59, 130, 246, 0.05)';\n                    }\n                  }}\n                  onMouseLeave={(e) => {\n                    if (!selectedCollaborators.has(collab.user)) {\n                      e.currentTarget.style.background = 'var(--bg)';\n                    }\n                  }}\n                >\n                  <input\n                    type=\"checkbox\"\n                    checked={selectedCollaborators.has(collab.user)}\n                    onChange={() => handleToggleCollaborator(collab.user)}\n                    style={{ cursor: 'pointer' }}\n                  />\n                  <div style={{ flex: 1 }}>\n                    <div\n                      style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: 'var(--text)',\n                      }}\n                    >\n                      @{collab.username}\n                    </div>\n                    <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                      {collab.role}\n                    </div>\n                  </div>\n                </label>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* Optional message */}\n        <div style={{ marginBottom: 20 }}>\n          <label\n            style={{\n              display: 'block',\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 8,\n            }}\n          >\n            Message (optional):\n          </label>\n          <textarea\n            value={message}\n            onChange={(e) => setMessage(e.target.value)}\n            placeholder=\"Hi team! I think we're ready to mint this. Please review and approve if you're satisfied.\"\n            style={{\n              width: '100%',\n              minHeight: 100,\n              padding: 12,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 13,\n              fontFamily: 'inherit',\n              resize: 'vertical',\n              outline: 'none',\n            }}\n            onFocus={(e) => {\n              e.currentTarget.style.borderColor = '#3b82f6';\n            }}\n            onBlur={(e) => {\n              e.currentTarget.style.borderColor = 'var(--panel-border)';\n            }}\n          />\n        </div>\n\n        {/* Deadline */}\n        <div style={{ marginBottom: 24 }}>\n          <label\n            style={{\n              display: 'block',\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 8,\n            }}\n          >\n            Approval deadline:\n          </label>\n          <select\n            value={deadline}\n            onChange={(e) => setDeadline(Number(e.target.value))}\n            style={{\n              width: '100%',\n              padding: 12,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 13,\n              cursor: 'pointer',\n              outline: 'none',\n            }}\n            onFocus={(e) => {\n              e.currentTarget.style.borderColor = '#3b82f6';\n            }}\n            onBlur={(e) => {\n              e.currentTarget.style.borderColor = 'var(--panel-border)';\n            }}\n          >\n            <option value={1}>1 day</option>\n            <option value={3}>3 days</option>\n            <option value={7}>7 days</option>\n            <option value={14}>14 days</option>\n            <option value={30}>30 days</option>\n          </select>\n        </div>\n\n        {/* Info note */}\n        <div\n          style={{\n            marginBottom: 20,\n            padding: 12,\n            background: 'rgba(59, 130, 246, 0.1)',\n            border: '1px solid rgba(59, 130, 246, 0.3)',\n            borderRadius: 8,\n            fontSize: 12,\n            color: '#94a3b8',\n            lineHeight: 1.5,\n          }}\n        >\n          Selected collaborators will receive a notification and email with your message. They\n          can approve anytime before the deadline.\n        </div>\n\n        {/* Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={onClose}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = 'var(--bg)';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n            }}\n          >\n            Cancel\n          </button>\n          <button\n            onClick={handleSubmit}\n            disabled={pendingCollaborators.length === 0 || selectedCollaborators.size === 0}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? '#374151'\n                  : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'not-allowed'\n                  : 'pointer',\n              boxShadow:\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'none'\n                  : '0 4px 12px rgba(59, 130, 246, 0.3)',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              if (pendingCollaborators.length > 0 && selectedCollaborators.size > 0) {\n                e.currentTarget.style.transform = 'translateY(-1px)';\n                e.currentTarget.style.boxShadow = '0 6px 16px rgba(59, 130, 246, 0.4)';\n              }\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.transform = 'translateY(0)';\n              e.currentTarget.style.boxShadow =\n                pendingCollaborators.length === 0 || selectedCollaborators.size === 0\n                  ? 'none'\n                  : '0 4px 12px rgba(59, 130, 246, 0.3)';\n            }}\n          >\n            Send Approval Request\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default ApprovalRequestModal;\n","/**\n * IndividualApprovalView Component\n * Interface for individual collaborators to approve a project\n */\n\nimport React, { useState } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\n\ninterface IndividualApprovalViewProps {\n  project: CollaborativeProject;\n  currentUserId: number;\n  onClose: () => void;\n  onApprove: (feedback?: string) => void;\n}\n\nexport function IndividualApprovalView({\n  project,\n  currentUserId,\n  onClose,\n  onApprove,\n}: IndividualApprovalViewProps) {\n  const [approveContent, setApproveContent] = useState(false);\n  const [approveRevenue, setApproveRevenue] = useState(false);\n  const [feedback, setFeedback] = useState('');\n\n  const currentUserCollab = project.collaborators?.find(c => c.user === currentUserId);\n  const hasAlreadyApproved =\n    currentUserCollab?.approved_current_version && currentUserCollab?.approved_revenue_split;\n\n  const canApprove = approveContent && approveRevenue;\n\n  // Calculate project stats\n  const totalSections = project.sections?.length || 0;\n  const completedSections =\n    project.sections?.filter(s => {\n      if (s.section_type === 'text') {\n        return s.content_html && s.content_html.trim() !== '';\n      }\n      return !!s.media_file;\n    }).length || 0;\n\n  const totalRevenue =\n    project.collaborators?.reduce((sum, c) => sum + c.revenue_percentage, 0) || 0;\n  const revenueSplitsCorrect = Math.abs(totalRevenue - 100) < 0.01;\n\n  const handleApprove = () => {\n    if (!canApprove) {\n      alert('Please check both approval boxes before proceeding.');\n      return;\n    }\n    onApprove(feedback.trim() || undefined);\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.7)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n        padding: 20,\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 24,\n          maxWidth: 600,\n          width: '100%',\n          maxHeight: '90vh',\n          overflow: 'auto',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <h2\n          style={{\n            margin: 0,\n            marginBottom: 8,\n            fontSize: 22,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          {hasAlreadyApproved ? 'Review Your Approval' : 'Approve Project'}\n        </h2>\n        <p\n          style={{\n            margin: 0,\n            marginBottom: 24,\n            fontSize: 14,\n            color: '#94a3b8',\n          }}\n        >\n          {hasAlreadyApproved\n            ? \"You've already approved this project. Review the details below.\"\n            : 'Review the project details and approve if everything looks good.'}\n        </p>\n\n        {/* Project overview */}\n        <div\n          style={{\n            marginBottom: 24,\n            padding: 16,\n            background: 'var(--bg)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 8,\n          }}\n        >\n          <h3\n            style={{\n              margin: 0,\n              marginBottom: 12,\n              fontSize: 16,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            {project.title}\n          </h3>\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {/* Content type */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Type:</span>{' '}\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)}\n            </div>\n\n            {/* Sections */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Sections:</span> {completedSections} / {totalSections} completed\n              {completedSections === totalSections && totalSections > 0 && (\n                <span style={{ color: '#10b981', marginLeft: 8 }}>‚úì</span>\n              )}\n            </div>\n\n            {/* Collaborators */}\n            <div style={{ fontSize: 13, color: '#94a3b8' }}>\n              <span style={{ fontWeight: 600 }}>Collaborators:</span>{' '}\n              {project.collaborators?.filter(c => c.status === 'accepted').length || 0}\n            </div>\n          </div>\n        </div>\n\n        {/* Revenue split */}\n        <div\n          style={{\n            marginBottom: 24,\n            padding: 16,\n            background: revenueSplitsCorrect\n              ? 'rgba(16, 185, 129, 0.1)'\n              : 'rgba(239, 68, 68, 0.1)',\n            border: `1px solid ${revenueSplitsCorrect ? '#10b981' : '#ef4444'}`,\n            borderRadius: 8,\n          }}\n        >\n          <h3\n            style={{\n              margin: 0,\n              marginBottom: 12,\n              fontSize: 14,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            Revenue Split\n          </h3>\n\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {project.collaborators\n              ?.filter(c => c.status === 'accepted')\n              .map((collab) => {\n                const isCurrentUser = collab.user === currentUserId;\n                return (\n                  <div\n                    key={collab.id}\n                    style={{\n                      display: 'flex',\n                      justifyContent: 'space-between',\n                      alignItems: 'center',\n                      padding: 10,\n                      background: isCurrentUser ? 'rgba(59, 130, 246, 0.1)' : 'transparent',\n                      border: isCurrentUser ? '1px solid #3b82f6' : 'none',\n                      borderRadius: 6,\n                    }}\n                  >\n                    <div>\n                      <span\n                        style={{\n                          fontSize: 13,\n                          fontWeight: 600,\n                          color: 'var(--text)',\n                        }}\n                      >\n                        @{collab.username}\n                        {isCurrentUser && ' (you)'}\n                      </span>\n                      <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                        {collab.role}\n                      </div>\n                    </div>\n                    <div\n                      style={{\n                        fontSize: 16,\n                        fontWeight: 700,\n                        color: isCurrentUser ? '#3b82f6' : '#10b981',\n                      }}\n                    >\n                      {collab.revenue_percentage}%\n                    </div>\n                  </div>\n                );\n              })}\n          </div>\n\n          <div\n            style={{\n              marginTop: 12,\n              paddingTop: 12,\n              borderTop: '1px solid var(--panel-border)',\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n            }}\n          >\n            <span style={{ fontSize: 13, fontWeight: 700, color: 'var(--text)' }}>\n              Total:\n            </span>\n            <span\n              style={{\n                fontSize: 16,\n                fontWeight: 700,\n                color: revenueSplitsCorrect ? '#10b981' : '#ef4444',\n              }}\n            >\n              {totalRevenue.toFixed(1)}%\n            </span>\n          </div>\n\n          {!revenueSplitsCorrect && (\n            <div\n              style={{\n                marginTop: 12,\n                fontSize: 12,\n                color: '#ef4444',\n                fontWeight: 600,\n              }}\n            >\n              Revenue splits must total 100%\n            </div>\n          )}\n        </div>\n\n        {/* Approval checkboxes */}\n        {!hasAlreadyApproved && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n            }}\n          >\n            <h3\n              style={{\n                margin: 0,\n                marginBottom: 12,\n                fontSize: 14,\n                fontWeight: 700,\n                color: 'var(--text)',\n              }}\n            >\n              Approval Checklist\n            </h3>\n\n            <label\n              style={{\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: 10,\n                marginBottom: 12,\n                cursor: 'pointer',\n              }}\n            >\n              <input\n                type=\"checkbox\"\n                checked={approveContent}\n                onChange={(e) => setApproveContent(e.target.checked)}\n                style={{\n                  marginTop: 2,\n                  cursor: 'pointer',\n                }}\n              />\n              <div>\n                <div\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                    marginBottom: 4,\n                  }}\n                >\n                  I approve the current version of the content\n                </div>\n                <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                  I have reviewed all sections and am satisfied with the quality and content.\n                </div>\n              </div>\n            </label>\n\n            <label\n              style={{\n                display: 'flex',\n                alignItems: 'flex-start',\n                gap: 10,\n                cursor: 'pointer',\n              }}\n            >\n              <input\n                type=\"checkbox\"\n                checked={approveRevenue}\n                onChange={(e) => setApproveRevenue(e.target.checked)}\n                style={{\n                  marginTop: 2,\n                  cursor: 'pointer',\n                }}\n              />\n              <div>\n                <div\n                  style={{\n                    fontSize: 13,\n                    fontWeight: 600,\n                    color: 'var(--text)',\n                    marginBottom: 4,\n                  }}\n                >\n                  I approve the revenue split\n                </div>\n                <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                  I agree to the revenue distribution shown above ({currentUserCollab?.revenue_percentage}% for me).\n                </div>\n              </div>\n            </label>\n          </div>\n        )}\n\n        {/* Optional feedback */}\n        {!hasAlreadyApproved && (\n          <div style={{ marginBottom: 24 }}>\n            <label\n              style={{\n                display: 'block',\n                fontSize: 14,\n                fontWeight: 600,\n                color: 'var(--text)',\n                marginBottom: 8,\n              }}\n            >\n              Feedback (optional):\n            </label>\n            <textarea\n              value={feedback}\n              onChange={(e) => setFeedback(e.target.value)}\n              placeholder=\"Any comments or suggestions for the team...\"\n              style={{\n                width: '100%',\n                minHeight: 80,\n                padding: 12,\n                background: 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 13,\n                fontFamily: 'inherit',\n                resize: 'vertical',\n                outline: 'none',\n              }}\n              onFocus={(e) => {\n                e.currentTarget.style.borderColor = '#3b82f6';\n              }}\n              onBlur={(e) => {\n                e.currentTarget.style.borderColor = 'var(--panel-border)';\n              }}\n            />\n          </div>\n        )}\n\n        {/* Warning */}\n        {!hasAlreadyApproved && (\n          <div\n            style={{\n              marginBottom: 20,\n              padding: 12,\n              background: 'rgba(251, 191, 36, 0.1)',\n              border: '1px solid #f59e0b',\n              borderRadius: 8,\n              fontSize: 12,\n              color: '#f59e0b',\n              lineHeight: 1.5,\n            }}\n          >\n            By approving, you confirm that you're ready for this project to be minted as an NFT.\n            This approval cannot be undone.\n          </div>\n        )}\n\n        {/* Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={onClose}\n            style={{\n              flex: 1,\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = 'var(--bg)';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n            }}\n          >\n            {hasAlreadyApproved ? 'Close' : 'Cancel'}\n          </button>\n\n          {!hasAlreadyApproved && (\n            <button\n              onClick={handleApprove}\n              disabled={!canApprove || !revenueSplitsCorrect}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background:\n                  !canApprove || !revenueSplitsCorrect\n                    ? '#374151'\n                    : 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: !canApprove || !revenueSplitsCorrect ? 'not-allowed' : 'pointer',\n                boxShadow:\n                  !canApprove || !revenueSplitsCorrect\n                    ? 'none'\n                    : '0 4px 12px rgba(16, 185, 129, 0.3)',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                if (canApprove && revenueSplitsCorrect) {\n                  e.currentTarget.style.transform = 'translateY(-1px)';\n                  e.currentTarget.style.boxShadow = '0 6px 16px rgba(16, 185, 129, 0.4)';\n                }\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'translateY(0)';\n                e.currentTarget.style.boxShadow =\n                  !canApprove || !revenueSplitsCorrect\n                    ? 'none'\n                    : '0 4px 12px rgba(16, 185, 129, 0.3)';\n              }}\n            >\n              Approve Project\n            </button>\n          )}\n        </div>\n\n        {/* Already approved message */}\n        {hasAlreadyApproved && (\n          <div\n            style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(16, 185, 129, 0.1)',\n              border: '1px solid rgba(16, 185, 129, 0.3)',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#10b981',\n              textAlign: 'center',\n              fontWeight: 600,\n            }}\n          >\n            You have already approved this project\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default IndividualApprovalView;\n","/**\n * MintingProgressModal Component\n * Shows minting progress with multi-stage status updates\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\n\ninterface MintingProgressModalProps {\n  project: CollaborativeProject;\n  onClose: () => void;\n  onComplete?: (nftId: string) => void;\n}\n\ntype MintingStage =\n  | 'validating'\n  | 'uploading'\n  | 'creating_contract'\n  | 'minting'\n  | 'finalizing'\n  | 'completed'\n  | 'error';\n\ninterface StageInfo {\n  label: string;\n  description: string;\n  icon: string;\n}\n\nconst STAGES: Record<MintingStage, StageInfo> = {\n  validating: {\n    label: 'Validating Project',\n    description: 'Checking project data and approvals...',\n    icon: 'üîç',\n  },\n  uploading: {\n    label: 'Uploading to IPFS',\n    description: 'Storing content on decentralized storage...',\n    icon: '‚òÅÔ∏è',\n  },\n  creating_contract: {\n    label: 'Creating Smart Contract',\n    description: 'Deploying NFT contract on blockchain...',\n    icon: 'üìú',\n  },\n  minting: {\n    label: 'Minting NFT',\n    description: 'Creating your unique NFT token...',\n    icon: '‚ú®',\n  },\n  finalizing: {\n    label: 'Finalizing',\n    description: 'Completing the process and updating records...',\n    icon: 'üéØ',\n  },\n  completed: {\n    label: 'Minting Complete!',\n    description: 'Your NFT has been successfully created.',\n    icon: 'üéâ',\n  },\n  error: {\n    label: 'Minting Failed',\n    description: 'An error occurred during the minting process.',\n    icon: '‚ùå',\n  },\n};\n\nexport function MintingProgressModal({\n  project,\n  onClose,\n  onComplete,\n}: MintingProgressModalProps) {\n  const [currentStage, setCurrentStage] = useState<MintingStage>('validating');\n  const [error, setError] = useState<string | null>(null);\n  const [nftData, setNftData] = useState<{\n    id: string;\n    tokenId: string;\n    contractAddress: string;\n    ipfsHash: string;\n  } | null>(null);\n\n  const stageOrder: MintingStage[] = [\n    'validating',\n    'uploading',\n    'creating_contract',\n    'minting',\n    'finalizing',\n  ];\n\n  const currentStageIndex = stageOrder.indexOf(currentStage);\n  const progress = currentStage === 'completed' ? 100 : ((currentStageIndex + 1) / stageOrder.length) * 100;\n\n  // Simulate minting process\n  useEffect(() => {\n    if (currentStage === 'error' || currentStage === 'completed') {\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      const currentIndex = stageOrder.indexOf(currentStage);\n      if (currentIndex < stageOrder.length - 1) {\n        setCurrentStage(stageOrder[currentIndex + 1]);\n      } else {\n        // Completed!\n        setCurrentStage('completed');\n        setNftData({\n          id: `nft-${project.id}`,\n          tokenId: `${Math.floor(Math.random() * 10000)}`,\n          contractAddress: '0x' + Array(40).fill(0).map(() =>\n            Math.floor(Math.random() * 16).toString(16)\n          ).join(''),\n          ipfsHash: 'Qm' + Array(44).fill(0).map(() =>\n            'abcdefghijklmnopqrstuvwxyz0123456789'[Math.floor(Math.random() * 36)]\n          ).join(''),\n        });\n        if (onComplete) {\n          onComplete(`nft-${project.id}`);\n        }\n      }\n    }, 2000 + Math.random() * 1000); // 2-3 seconds per stage\n\n    return () => clearTimeout(timer);\n  }, [currentStage]);\n\n  const handleClose = () => {\n    if (currentStage !== 'completed' && currentStage !== 'error') {\n      const confirmed = confirm(\n        'Minting is still in progress. Are you sure you want to close this window?'\n      );\n      if (!confirmed) return;\n    }\n    onClose();\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.8)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n      }}\n      onClick={(e) => {\n        if (e.target === e.currentTarget) {\n          handleClose();\n        }\n      }}\n    >\n      <div\n        style={{\n          background: 'var(--panel)',\n          border: '1px solid var(--panel-border)',\n          borderRadius: 12,\n          padding: 32,\n          maxWidth: 500,\n          width: '90%',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div style={{ textAlign: 'center', marginBottom: 32 }}>\n          <div style={{ fontSize: 48, marginBottom: 16 }}>\n            {STAGES[currentStage].icon}\n          </div>\n          <h2\n            style={{\n              margin: 0,\n              marginBottom: 8,\n              fontSize: 24,\n              fontWeight: 700,\n              color: 'var(--text)',\n            }}\n          >\n            {STAGES[currentStage].label}\n          </h2>\n          <p\n            style={{\n              margin: 0,\n              fontSize: 14,\n              color: '#94a3b8',\n            }}\n          >\n            {STAGES[currentStage].description}\n          </p>\n        </div>\n\n        {/* Progress bar */}\n        {currentStage !== 'completed' && currentStage !== 'error' && (\n          <div style={{ marginBottom: 32 }}>\n            <div\n              style={{\n                height: 8,\n                background: '#1e293b',\n                borderRadius: 4,\n                overflow: 'hidden',\n                marginBottom: 8,\n              }}\n            >\n              <div\n                style={{\n                  height: '100%',\n                  width: `${progress}%`,\n                  background: 'linear-gradient(90deg, #3b82f6 0%, #2563eb 100%)',\n                  transition: 'width 0.5s ease',\n                }}\n              />\n            </div>\n            <div\n              style={{\n                fontSize: 12,\n                color: '#94a3b8',\n                textAlign: 'center',\n              }}\n            >\n              {Math.round(progress)}% complete\n            </div>\n          </div>\n        )}\n\n        {/* Stage list */}\n        <div style={{ marginBottom: 24 }}>\n          {stageOrder.map((stage, index) => {\n            const isCompleted = index < currentStageIndex;\n            const isCurrent = stage === currentStage;\n            const isPending = index > currentStageIndex;\n\n            return (\n              <div\n                key={stage}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 12,\n                  padding: 12,\n                  marginBottom: 8,\n                  background: isCurrent\n                    ? 'rgba(59, 130, 246, 0.1)'\n                    : isCompleted\n                    ? 'rgba(16, 185, 129, 0.1)'\n                    : 'transparent',\n                  border: `1px solid ${\n                    isCurrent\n                      ? '#3b82f6'\n                      : isCompleted\n                      ? '#10b981'\n                      : 'var(--panel-border)'\n                  }`,\n                  borderRadius: 8,\n                  opacity: isPending ? 0.5 : 1,\n                  transition: 'all 0.3s',\n                }}\n              >\n                <div\n                  style={{\n                    width: 24,\n                    height: 24,\n                    borderRadius: '50%',\n                    background: isCompleted\n                      ? '#10b981'\n                      : isCurrent\n                      ? '#3b82f6'\n                      : '#334155',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    color: '#fff',\n                    fontSize: 12,\n                    fontWeight: 700,\n                    flexShrink: 0,\n                  }}\n                >\n                  {isCompleted ? '‚úì' : index + 1}\n                </div>\n                <div style={{ flex: 1 }}>\n                  <div\n                    style={{\n                      fontSize: 13,\n                      fontWeight: 600,\n                      color: 'var(--text)',\n                    }}\n                  >\n                    {STAGES[stage].label}\n                  </div>\n                </div>\n                {isCurrent && (\n                  <div\n                    style={{\n                      fontSize: 16,\n                      animation: 'spin 1s linear infinite',\n                    }}\n                  >\n                    ‚è≥\n                  </div>\n                )}\n              </div>\n            );\n          })}\n        </div>\n\n        {/* Error message */}\n        {currentStage === 'error' && error && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'rgba(239, 68, 68, 0.1)',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#ef4444',\n              lineHeight: 1.5,\n            }}\n          >\n            {error}\n          </div>\n        )}\n\n        {/* Success details */}\n        {currentStage === 'completed' && nftData && (\n          <div\n            style={{\n              marginBottom: 24,\n              padding: 16,\n              background: 'rgba(16, 185, 129, 0.1)',\n              border: '1px solid rgba(16, 185, 129, 0.3)',\n              borderRadius: 8,\n            }}\n          >\n            <h3\n              style={{\n                margin: 0,\n                marginBottom: 12,\n                fontSize: 14,\n                fontWeight: 700,\n                color: '#10b981',\n              }}\n            >\n              NFT Details\n            </h3>\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>Token ID:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontWeight: 600,\n                  }}\n                >\n                  {nftData.tokenId}\n                </span>\n              </div>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>Contract:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontSize: 10,\n                    wordBreak: 'break-all',\n                  }}\n                >\n                  {nftData.contractAddress}\n                </span>\n              </div>\n              <div style={{ fontSize: 12 }}>\n                <span style={{ color: '#94a3b8' }}>IPFS:</span>{' '}\n                <span\n                  style={{\n                    color: 'var(--text)',\n                    fontFamily: 'monospace',\n                    fontSize: 10,\n                    wordBreak: 'break-all',\n                  }}\n                >\n                  {nftData.ipfsHash}\n                </span>\n              </div>\n            </div>\n          </div>\n        )}\n\n        {/* Actions */}\n        {currentStage === 'completed' && (\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            <button\n              onClick={() => {\n                // TODO: Navigate to NFT view\n                alert('Navigate to NFT view');\n              }}\n              style={{\n                width: '100%',\n                padding: '14px 20px',\n                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: 'pointer',\n                boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.transform = 'translateY(-1px)';\n                e.currentTarget.style.boxShadow = '0 6px 16px rgba(16, 185, 129, 0.4)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.transform = 'translateY(0)';\n                e.currentTarget.style.boxShadow = '0 4px 12px rgba(16, 185, 129, 0.3)';\n              }}\n            >\n              View NFT\n            </button>\n            <button\n              onClick={onClose}\n              style={{\n                width: '100%',\n                padding: '12px 20px',\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                fontWeight: 600,\n                cursor: 'pointer',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.background = 'var(--bg)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'transparent';\n              }}\n            >\n              Close\n            </button>\n          </div>\n        )}\n\n        {currentStage === 'error' && (\n          <div style={{ display: 'flex', gap: 12 }}>\n            <button\n              onClick={() => {\n                setCurrentStage('validating');\n                setError(null);\n              }}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                border: 'none',\n                borderRadius: 8,\n                color: '#fff',\n                fontSize: 14,\n                fontWeight: 700,\n                cursor: 'pointer',\n                boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)',\n              }}\n            >\n              Retry\n            </button>\n            <button\n              onClick={onClose}\n              style={{\n                flex: 1,\n                padding: '12px 20px',\n                background: 'transparent',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                color: 'var(--text)',\n                fontSize: 14,\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              Close\n            </button>\n          </div>\n        )}\n\n        {/* Progress indicator */}\n        {currentStage !== 'completed' && currentStage !== 'error' && (\n          <div\n            style={{\n              marginTop: 16,\n              padding: 12,\n              background: 'rgba(59, 130, 246, 0.1)',\n              border: '1px solid rgba(59, 130, 246, 0.3)',\n              borderRadius: 8,\n              fontSize: 12,\n              color: '#94a3b8',\n              textAlign: 'center',\n              lineHeight: 1.5,\n            }}\n          >\n            This process may take a few minutes. Please don't close this window.\n          </div>\n        )}\n      </div>\n\n      <style>{`\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default MintingProgressModal;\n","/**\n * MintingWorkflow Component\n * Democratic approval and minting workflow for collaborative projects\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { CollaborativeProject } from '../../services/collaborationApi';\nimport ApprovalRequestModal from './ApprovalRequestModal';\nimport IndividualApprovalView from './IndividualApprovalView';\nimport MintingProgressModal from './MintingProgressModal';\nimport { useBetaMode } from '../../hooks/useBetaMode';\n\ninterface MintingWorkflowProps {\n  project: CollaborativeProject;\n  currentUserId: number;\n  onApprovalRequest?: () => void;\n  onApprove?: () => void;\n  onMint?: () => Promise<void>;\n}\n\ninterface ChecklistItem {\n  id: string;\n  label: string;\n  checked: boolean;\n  required: boolean;\n}\n\nexport function MintingWorkflow({\n  project,\n  currentUserId,\n  onApprovalRequest,\n  onApprove,\n  onMint,\n}: MintingWorkflowProps) {\n  const [showApprovalRequestModal, setShowApprovalRequestModal] = useState(false);\n  const [showApprovalView, setShowApprovalView] = useState(false);\n  const [showMintingProgress, setShowMintingProgress] = useState(false);\n  const [checklist, setChecklist] = useState<ChecklistItem[]>([]);\n  const { isSolanaDevnet } = useBetaMode();\n\n  const isProjectCreator = project.created_by === currentUserId;\n  const acceptedCollaborators = project.collaborators?.filter(c => c.status === 'accepted') || [];\n  const approvedCollaborators = acceptedCollaborators.filter(\n    c => c.approved_current_version && c.approved_revenue_split\n  );\n  const pendingCollaborators = acceptedCollaborators.filter(\n    c => !c.approved_current_version || !c.approved_revenue_split\n  );\n\n  const currentUserRole = acceptedCollaborators.find(c => c.user === currentUserId);\n  const hasUserApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  const approvalProgress = acceptedCollaborators.length > 0\n    ? approvedCollaborators.length / acceptedCollaborators.length\n    : 0;\n\n  // Build checklist\n  useEffect(() => {\n    const items: ChecklistItem[] = [];\n\n    // Check sections\n    const hasContent = project.sections && project.sections.length > 0;\n    const allSectionsComplete = project.sections?.every(s => {\n      if (s.section_type === 'text') {\n        return s.content_html && s.content_html.trim() !== '';\n      }\n      return !!s.media_file;\n    }) ?? false;\n\n    items.push({\n      id: 'sections',\n      label: 'All sections completed',\n      checked: hasContent && allSectionsComplete,\n      required: true,\n    });\n\n    // Check revenue splits\n    const totalRevenue = project.collaborators?.reduce((sum, c) => sum + c.revenue_percentage, 0) || 0;\n    const revenueSplitsCorrect = Math.abs(totalRevenue - 100) < 0.01;\n\n    items.push({\n      id: 'revenue',\n      label: 'Revenue splits agreed (totals 100%)',\n      checked: revenueSplitsCorrect,\n      required: true,\n    });\n\n    // Check collaborators\n    const allCollaboratorsAccepted = project.collaborators?.every(c => c.status === 'accepted') ?? true;\n\n    items.push({\n      id: 'collaborators',\n      label: 'All collaborators invited/accepted',\n      checked: allCollaboratorsAccepted,\n      required: true,\n    });\n\n    // Check approvals\n    const allApproved = project.is_fully_approved;\n\n    items.push({\n      id: 'approvals',\n      label: 'Approval from all collaborators',\n      checked: allApproved,\n      required: true,\n    });\n\n    setChecklist(items);\n  }, [project]);\n\n  const allRequiredChecked = checklist.filter(i => i.required).every(i => i.checked);\n  const canRequestApproval = checklist.slice(0, 3).every(i => i.checked) && !hasUserApproved;\n  const canMint = allRequiredChecked && project.is_fully_approved;\n  const canForceMint = isProjectCreator && checklist.slice(0, 3).every(i => i.checked);\n\n  // Handle minting\n  const handleMint = async () => {\n    if (!canMint) return;\n\n    const confirmed = confirm(\n      'Are you sure you want to mint this project as an NFT? This action cannot be undone.'\n    );\n\n    if (!confirmed) return;\n\n    setShowMintingProgress(true);\n    try {\n      if (onMint) {\n        await onMint();\n      }\n    } catch (error) {\n      console.error('Minting failed:', error);\n    }\n  };\n\n  // Handle force mint (creator only)\n  const handleForceMint = async () => {\n    if (!canForceMint) return;\n\n    const confirmed = confirm(\n      `WARNING: Force minting will proceed without approval from all collaborators.\\n\\n` +\n      `${pendingCollaborators.length} collaborator(s) haven't approved yet.\\n\\n` +\n      `Are you sure you want to continue?`\n    );\n\n    if (!confirmed) return;\n\n    setShowMintingProgress(true);\n    try {\n      if (onMint) {\n        await onMint();\n      }\n    } catch (error) {\n      console.error('Force minting failed:', error);\n    }\n  };\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 24,\n      }}\n    >\n      {isSolanaDevnet && (\n        <div style={{\n          padding: '12px 16px',\n          backgroundColor: '#dbeafe',\n          color: '#1e40af',\n          borderRadius: '8px',\n          fontSize: '13px',\n          marginBottom: '20px',\n          border: '1px solid #3b82f6',\n        }}>\n          üåê <strong>Devnet Mode:</strong> This NFT will be minted on Solana devnet for testing. Not a real NFT.\n        </div>\n      )}\n\n      <h2\n        style={{\n          margin: 0,\n          marginBottom: 20,\n          fontSize: 20,\n          fontWeight: 700,\n          color: 'var(--text)',\n        }}\n      >\n        Ready to Mint?\n      </h2>\n\n      {/* Pre-mint checklist */}\n      <div style={{ marginBottom: 24 }}>\n        <h3\n          style={{\n            margin: 0,\n            marginBottom: 12,\n            fontSize: 14,\n            fontWeight: 700,\n            color: 'var(--text)',\n          }}\n        >\n          Pre-mint Checklist:\n        </h3>\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {checklist.map((item) => (\n            <div\n              key={item.id}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 8,\n                padding: 10,\n                background: item.checked ? 'rgba(16, 185, 129, 0.1)' : 'rgba(100, 116, 139, 0.1)',\n                border: `1px solid ${item.checked ? '#10b981' : '#334155'}`,\n                borderRadius: 8,\n              }}\n            >\n              <span style={{ fontSize: 16 }}>\n                {item.checked ? '‚úÖ' : '‚è≥'}\n              </span>\n              <span\n                style={{\n                  fontSize: 13,\n                  color: item.checked ? '#10b981' : '#94a3b8',\n                  fontWeight: 600,\n                }}\n              >\n                {item.label}\n              </span>\n            </div>\n          ))}\n        </div>\n      </div>\n\n      {/* Approval progress */}\n      <div style={{ marginBottom: 24 }}>\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            marginBottom: 8,\n          }}\n        >\n          <span style={{ fontSize: 14, fontWeight: 700, color: 'var(--text)' }}>\n            Approval Progress:\n          </span>\n          <span\n            style={{\n              fontSize: 14,\n              fontWeight: 700,\n              color: project.is_fully_approved ? '#10b981' : '#f59e0b',\n            }}\n          >\n            {approvedCollaborators.length} / {acceptedCollaborators.length}\n          </span>\n        </div>\n\n        {/* Progress bar */}\n        <div\n          style={{\n            height: 8,\n            background: '#1e293b',\n            borderRadius: 4,\n            overflow: 'hidden',\n            marginBottom: 12,\n          }}\n        >\n          <div\n            style={{\n              height: '100%',\n              width: `${approvalProgress * 100}%`,\n              background: project.is_fully_approved\n                ? 'linear-gradient(90deg, #10b981 0%, #059669 100%)'\n                : 'linear-gradient(90deg, #f59e0b 0%, #d97706 100%)',\n              transition: 'width 0.3s',\n            }}\n          />\n        </div>\n\n        {/* Collaborator approval list */}\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {acceptedCollaborators.map((collab) => {\n            const approved = collab.approved_current_version && collab.approved_revenue_split;\n            const isCurrentUser = collab.user === currentUserId;\n\n            return (\n              <div\n                key={collab.id}\n                style={{\n                  padding: 10,\n                  background: approved ? 'rgba(16, 185, 129, 0.1)' : 'rgba(251, 191, 36, 0.1)',\n                  border: `1px solid ${approved ? 'rgba(16, 185, 129, 0.3)' : 'rgba(251, 191, 36, 0.3)'}`,\n                  borderRadius: 8,\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 10,\n                }}\n              >\n                <span style={{ fontSize: 16 }}>\n                  {approved ? '‚úÖ' : '‚è≥'}\n                </span>\n                <div style={{ flex: 1 }}>\n                  <div style={{ fontSize: 13, fontWeight: 600, color: 'var(--text)' }}>\n                    @{collab.username}\n                    {isCurrentUser && ' (you)'}\n                  </div>\n                  <div style={{ fontSize: 11, color: '#94a3b8' }}>\n                    {collab.role}\n                  </div>\n                </div>\n                {!approved && isCurrentUser && (\n                  <button\n                    onClick={() => setShowApprovalView(true)}\n                    style={{\n                      padding: '4px 12px',\n                      background: '#3b82f6',\n                      border: 'none',\n                      borderRadius: 6,\n                      color: '#fff',\n                      fontSize: 11,\n                      fontWeight: 600,\n                      cursor: 'pointer',\n                    }}\n                  >\n                    Approve\n                  </button>\n                )}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n\n      {/* Warning */}\n      <div\n        style={{\n          marginBottom: 24,\n          padding: 12,\n          background: 'rgba(251, 191, 36, 0.1)',\n          border: '1px solid #f59e0b',\n          borderRadius: 8,\n          fontSize: 12,\n          color: '#f59e0b',\n          lineHeight: 1.5,\n        }}\n      >\n        ‚ö†Ô∏è <strong>Note:</strong> Once minting starts, content cannot be changed. Make sure everything is perfect!\n      </div>\n\n      {/* Actions */}\n      <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n        {/* Request approval button */}\n        {canRequestApproval && (\n          <button\n            onClick={() => setShowApprovalRequestModal(true)}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 4px 12px rgba(59, 130, 246, 0.3)',\n            }}\n          >\n            üì® Request Approval\n          </button>\n        )}\n\n        {/* Approve button (if not approved) */}\n        {!hasUserApproved && checklist.slice(0, 3).every(i => i.checked) && (\n          <button\n            onClick={() => setShowApprovalView(true)}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 14,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 4px 12px rgba(16, 185, 129, 0.3)',\n            }}\n          >\n            ‚úì Approve Project\n          </button>\n        )}\n\n        {/* Mint button */}\n        {canMint && (\n          <button\n            onClick={handleMint}\n            style={{\n              width: '100%',\n              padding: '16px 20px',\n              background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n              border: 'none',\n              borderRadius: 8,\n              color: '#fff',\n              fontSize: 16,\n              fontWeight: 700,\n              cursor: 'pointer',\n              boxShadow: '0 6px 16px rgba(16, 185, 129, 0.4)',\n            }}\n          >\n            üöÄ Mint NFT\n          </button>\n        )}\n\n        {/* Force mint button (creator only) */}\n        {!canMint && canForceMint && isProjectCreator && pendingCollaborators.length > 0 && (\n          <button\n            onClick={handleForceMint}\n            style={{\n              width: '100%',\n              padding: '12px 20px',\n              background: 'transparent',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              color: '#ef4444',\n              fontSize: 13,\n              fontWeight: 600,\n              cursor: 'pointer',\n            }}\n          >\n            ‚ö†Ô∏è Force Mint (Creator Override)\n          </button>\n        )}\n      </div>\n\n      {/* Modals */}\n      {showApprovalRequestModal && (\n        <ApprovalRequestModal\n          project={project}\n          pendingCollaborators={pendingCollaborators}\n          onClose={() => setShowApprovalRequestModal(false)}\n          onSubmit={() => {\n            setShowApprovalRequestModal(false);\n            if (onApprovalRequest) onApprovalRequest();\n          }}\n        />\n      )}\n\n      {showApprovalView && (\n        <IndividualApprovalView\n          project={project}\n          currentUserId={currentUserId}\n          onClose={() => setShowApprovalView(false)}\n          onApprove={() => {\n            setShowApprovalView(false);\n            if (onApprove) onApprove();\n          }}\n        />\n      )}\n\n      {showMintingProgress && (\n        <MintingProgressModal\n          project={project}\n          onClose={() => setShowMintingProgress(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default MintingWorkflow;\n","import React, { useEffect, useState, useCallback } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  CollaboratorRole,\n  collaborationApi,\n  CreateSectionData,\n  CreateCommentData\n} from '../../services/collaborationApi';\nimport { useActivity } from '../../hooks/useActivity';\nimport { useComments } from '../../hooks/useComments';\nimport { CurrentlyEditing } from '../../services/activityService';\nimport { sanitizeHtml } from '../../utils/sanitize';\nimport { OnlineStatus } from './OnlineStatus';\nimport { EditingIndicator, SectionHeaderWithStatus } from './EditingIndicator';\nimport { ActivityFeed, ActivitySummary } from './ActivityFeed';\nimport CommentComposer from './CommentComposer';\nimport CommentThread from './CommentThread';\nimport { MintingWorkflow } from './MintingWorkflow';\n\n// Simple User interface (extend as needed)\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onSectionUpdate?: (section: ProjectSection) => void;\n  onCommentAdd?: (comment: ProjectComment) => void;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nexport default function CollaborativeEditor({\n  project,\n  currentUser,\n  onSectionUpdate,\n  onCommentAdd,\n  onProjectUpdate,\n}: CollaborativeEditorProps) {\n  // State management\n  const [sections, setSections] = useState<ProjectSection[]>(project.sections || []);\n  const [collaborators, setCollaborators] = useState<CollaboratorRole[]>(project.collaborators || []);\n  const [currentlyEditingSection, setCurrentlyEditingSection] = useState<number | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [error, setError] = useState<string>('');\n  const [showCommentInput, setShowCommentInput] = useState(false);\n  const [showInviteModal, setShowInviteModal] = useState(false);\n  const [showPreview, setShowPreview] = useState(false);\n  const [showActivityFeed, setShowActivityFeed] = useState(false);\n  const [showResolvedComments, setShowResolvedComments] = useState(false);\n  const [activeTab, setActiveTab] = useState<'comments' | 'activity' | 'minting'>('comments');\n\n  // Activity tracking\n  const {\n    activities,\n    onlineUsers,\n    currentlyEditing,\n    isPolling,\n    startEditing,\n    stopEditing,\n    logActivity,\n    startPolling,\n    stopPolling,\n  } = useActivity({\n    projectId: project.id,\n    autoStart: true, // Auto-start polling when component mounts\n  });\n\n  // Enhanced comment system\n  const {\n    comments,\n    commentsBySection,\n    unresolvedCount,\n    totalCount: commentTotalCount,\n    isLoading: commentsLoading,\n    addComment,\n    updateComment,\n    deleteComment,\n    resolveComment,\n    unresolveComment,\n    addReaction,\n    removeReaction,\n    refresh: refreshComments,\n  } = useComments({\n    projectId: project.id,\n    includeResolved: showResolvedComments,\n    pollingInterval: 30000, // Poll every 30 seconds\n  });\n\n  // Find current user's collaborator role\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n\n  // Check if user can edit a specific section type\n  const canEditSectionType = useCallback((sectionType: 'text' | 'image' | 'audio' | 'video'): boolean => {\n    if (!currentUserRole) return false;\n    const permissions = currentUserRole.can_edit || [];\n    return permissions.includes(sectionType);\n  }, [currentUserRole]);\n\n  // Check if user owns a section\n  const ownsSection = useCallback((section: ProjectSection): boolean => {\n    return section.owner === currentUser.id;\n  }, [currentUser.id]);\n\n  // Load sections\n  useEffect(() => {\n    loadSections();\n  }, [project.id]);\n\n  const loadSections = async () => {\n    try {\n      const loadedSections = await collaborationApi.getProjectSections(project.id);\n      setSections(loadedSections);\n    } catch (err: any) {\n      setError(err.message || 'Failed to load sections');\n    }\n  };\n\n  // Add new section\n  const handleAddSection = async (sectionType: 'text' | 'image' | 'audio' | 'video') => {\n    if (!canEditSectionType(sectionType)) {\n      setError(`You don't have permission to create ${sectionType} sections`);\n      return;\n    }\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: sectionType,\n        title: `New ${sectionType} section`,\n        content_html: sectionType === 'text' ? '' : undefined,\n        order: sections.length,\n      });\n      setSections([...sections, newSection]);\n      setCurrentlyEditingSection(newSection.id);\n      onSectionUpdate?.(newSection);\n    } catch (err: any) {\n      setError(err.message || 'Failed to create section');\n    }\n  };\n\n  // Update section\n  const handleUpdateSection = async (\n    sectionId: number,\n    updates: Partial<CreateSectionData>\n  ) => {\n    setSaving(true);\n    try {\n      const updatedSection = await collaborationApi.updateProjectSection(sectionId, updates);\n      setSections(sections.map(s => s.id === sectionId ? updatedSection : s));\n      setLastSaved(new Date());\n      onSectionUpdate?.(updatedSection);\n\n      // Log activity\n      await logActivity(\n        'section_updated',\n        `Updated ${updatedSection.section_type} section: ${updatedSection.title}`,\n        { section_id: sectionId, section_type: updatedSection.section_type }\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to update section');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Delete section\n  const handleDeleteSection = async (sectionId: number) => {\n    if (!confirm('Are you sure you want to delete this section?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(sectionId);\n      setSections(sections.filter(s => s.id !== sectionId));\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete section');\n    }\n  };\n\n  // Upload media file\n  const handleMediaUpload = async (sectionId: number, file: File) => {\n    setSaving(true);\n    try {\n      const updatedSection = await collaborationApi.updateProjectSection(sectionId, {\n        media_file: file,\n      });\n      setSections(sections.map(s => s.id === sectionId ? updatedSection : s));\n      setLastSaved(new Date());\n      onSectionUpdate?.(updatedSection);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload media');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  // Handle comment submission\n  const handleAddComment = async (content: string, mentions: number[], attachments?: File[]) => {\n    try {\n      const newComment = await addComment(content, mentions, attachments);\n      onCommentAdd?.(newComment);\n\n      // Log activity\n      await logActivity(\n        'comment_added',\n        `Added a comment: ${content.substring(0, 50)}${content.length > 50 ? '...' : ''}`,\n        { comment_id: newComment.id }\n      );\n\n      setShowCommentInput(false);\n    } catch (err: any) {\n      setError(err.message || 'Failed to add comment');\n    }\n  };\n\n  // Handle comment reply\n  const handleReplyComment = async (\n    parentId: number,\n    content: string,\n    mentions: number[],\n    attachments?: File[]\n  ) => {\n    try {\n      await addComment(content, mentions, attachments, parentId);\n      await logActivity('comment_added', `Replied to a comment`, { parent_comment_id: parentId });\n    } catch (err: any) {\n      setError(err.message || 'Failed to reply to comment');\n    }\n  };\n\n  // Approve version\n  const handleApproveVersion = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveCurrentVersion(project.id);\n      onProjectUpdate?.(updatedProject);\n      alert('Version approved! üéâ');\n\n      // Log activity\n      await logActivity(\n        'approval_given',\n        'Approved current version',\n        { project_status: updatedProject.status }\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve version');\n    }\n  };\n\n  // Handle approval request\n  const handleApprovalRequest = async () => {\n    try {\n      // Refresh project to get updated approval status\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'approval_requested',\n        'Requested approval from collaborators'\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to request approval');\n    }\n  };\n\n  // Handle project approval (full approval)\n  const handleApproveProject = async () => {\n    try {\n      const updatedProject = await collaborationApi.approveProject(project.id, {\n        approve_content: true,\n        approve_revenue: true,\n      });\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'approval_given',\n        'Approved project for minting'\n      );\n    } catch (err: any) {\n      setError(err.message || 'Failed to approve project');\n    }\n  };\n\n  // Handle minting\n  const handleMint = async () => {\n    try {\n      const result = await collaborationApi.mintProject(project.id);\n\n      // Refresh project to update status\n      const updatedProject = await collaborationApi.getCollaborativeProject(project.id);\n      onProjectUpdate?.(updatedProject);\n\n      // Log activity\n      await logActivity(\n        'project_minted',\n        `Project minted as NFT (Token ID: ${result.token_id})`\n      );\n\n      alert(`Project successfully minted! NFT Token ID: ${result.token_id}`);\n    } catch (err: any) {\n      setError(err.message || 'Failed to mint project');\n    }\n  };\n\n  // Preview project\n  const handlePreview = async () => {\n    setShowPreview(true);\n  };\n\n  // Get section type badge color\n  const getSectionTypeBadgeColor = (type: string) => {\n    switch (type) {\n      case 'text': return '#3b82f6';\n      case 'image': return '#8b5cf6';\n      case 'audio': return '#f59e0b';\n      case 'video': return '#ef4444';\n      default: return '#64748b';\n    }\n  };\n\n  // Get approval status\n  const approvalStatus = {\n    total: collaborators.filter(c => c.status === 'accepted').length,\n    approved: collaborators.filter(c =>\n      c.status === 'accepted' &&\n      c.approved_current_version &&\n      c.approved_revenue_split\n    ).length,\n  };\n\n  const isFullyApproved = project.is_fully_approved;\n  const userHasApproved = currentUserRole?.approved_current_version && currentUserRole?.approved_revenue_split;\n\n  return (\n    <div style={{\n      width: '100%',\n      height: '90vh',\n      display: 'flex',\n      flexDirection: 'column',\n      gap: 16,\n    }}>\n      {/* Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        padding: '16px 0',\n      }}>\n        <div style={{ flex: 1 }}>\n          <h2 style={{\n            margin: 0,\n            color: 'var(--text)',\n            fontSize: 24,\n            fontWeight: 700\n          }}>\n            {project.title}\n          </h2>\n          <div style={{\n            marginTop: 4,\n            fontSize: 14,\n            color: '#94a3b8'\n          }}>\n            {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} Project\n            {' ‚Ä¢ '}\n            Status: {project.status.replace(/_/g, ' ')}\n          </div>\n        </div>\n\n        {/* Header Actions */}\n        <div style={{ display: 'flex', gap: 12 }}>\n          <button\n            onClick={handlePreview}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '8px 16px',\n              color: 'var(--text)',\n              cursor: 'pointer',\n              fontSize: 14,\n              fontWeight: 600,\n            }}\n          >\n            üëÅÔ∏è Preview\n          </button>\n\n          {currentUserRole && !userHasApproved && (\n            <button\n              onClick={handleApproveVersion}\n              style={{\n                background: 'linear-gradient(135deg, #10b981 0%, #059669 100%)',\n                border: 'none',\n                borderRadius: 8,\n                padding: '8px 20px',\n                color: '#fff',\n                fontWeight: 700,\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              ‚úì Approve Version\n            </button>\n          )}\n\n          {isFullyApproved && project.status === 'ready_for_mint' && (\n            <button\n              style={{\n                background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                border: 'none',\n                borderRadius: 8,\n                padding: '8px 20px',\n                color: '#fff',\n                fontWeight: 700,\n                cursor: 'pointer',\n                fontSize: 14,\n              }}\n            >\n              üöÄ Ready to Mint\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Error Message */}\n      {error && (\n        <div style={{\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 8,\n          padding: 12,\n          color: '#ef4444',\n          fontSize: 14,\n        }}>\n          {error}\n          <button\n            onClick={() => setError('')}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#ef4444',\n              cursor: 'pointer',\n              float: 'right',\n              fontWeight: 700,\n              fontSize: 18,\n            }}\n          >\n            √ó\n          </button>\n        </div>\n      )}\n\n      {/* Main Layout: Sidebar + Editor */}\n      <div style={{\n        display: 'flex',\n        gap: 16,\n        flex: 1,\n        overflow: 'hidden'\n      }}>\n        {/* Left Sidebar: Collaborators + Comments */}\n        <div style={{\n          width: 280,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 12,\n          overflow: 'auto',\n        }}>\n          {/* Collaborators Panel */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n          }}>\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 12,\n            }}>\n              <h3 style={{\n                margin: 0,\n                fontSize: 14,\n                fontWeight: 700,\n                color: 'var(--text)'\n              }}>\n                Collaborators ({collaborators.length})\n              </h3>\n              {project.created_by === currentUser.id && (\n                <button\n                  onClick={() => setShowInviteModal(true)}\n                  style={{\n                    background: 'transparent',\n                    border: '1px solid var(--panel-border)',\n                    borderRadius: 6,\n                    padding: '4px 8px',\n                    color: '#94a3b8',\n                    cursor: 'pointer',\n                    fontSize: 11,\n                  }}\n                >\n                  + Invite\n                </button>\n              )}\n            </div>\n\n            {/* Collaborator List */}\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n              {collaborators.map(collab => (\n                <div\n                  key={collab.id}\n                  style={{\n                    padding: 10,\n                    background: collab.user === currentUser.id ? 'rgba(59, 130, 246, 0.1)' : 'var(--bg)',\n                    border: '1px solid var(--panel-border)',\n                    borderRadius: 8,\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                  }}>\n                    {/* Online Status Indicator */}\n                    <OnlineStatus\n                      userId={collab.user}\n                      onlineUsers={onlineUsers}\n                      size=\"small\"\n                    />\n                    <div style={{ flex: 1 }}>\n                      <div style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: 'var(--text)',\n                      }}>\n                        @{collab.username}\n                        {collab.user === currentUser.id && ' (you)'}\n                      </div>\n                      <div style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                      }}>\n                        {collab.role} ‚Ä¢ {collab.revenue_percentage}%\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* Approval Status */}\n                  {collab.status === 'accepted' && (\n                    <div style={{ marginTop: 6, fontSize: 10, color: '#94a3b8' }}>\n                      {collab.approved_current_version && collab.approved_revenue_split ? (\n                        <span style={{ color: '#10b981' }}>‚úì Approved</span>\n                      ) : (\n                        <span>‚è≥ Pending approval</span>\n                      )}\n                    </div>\n                  )}\n                </div>\n              ))}\n            </div>\n          </div>\n\n          {/* Approval Status Panel */}\n          <div style={{\n            background: isFullyApproved\n              ? 'rgba(16, 185, 129, 0.1)'\n              : 'rgba(245, 158, 11, 0.1)',\n            border: `1px solid ${isFullyApproved ? '#10b981' : '#f59e0b'}`,\n            borderRadius: 12,\n            padding: 12,\n          }}>\n            <div style={{\n              fontSize: 12,\n              fontWeight: 600,\n              color: isFullyApproved ? '#10b981' : '#f59e0b',\n              marginBottom: 6,\n            }}>\n              {isFullyApproved ? '‚úì Fully Approved' : '‚è≥ Awaiting Approvals'}\n            </div>\n            <div style={{ fontSize: 11, color: '#94a3b8' }}>\n              {approvalStatus.approved} of {approvalStatus.total} collaborators approved\n            </div>\n          </div>\n\n          {/* Activity & Comments & Minting Tabs */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px solid var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column',\n          }}>\n            {/* Tabs */}\n            <div style={{\n              display: 'flex',\n              gap: 8,\n              marginBottom: 12,\n              borderBottom: '1px solid var(--panel-border)',\n              paddingBottom: 8,\n            }}>\n              <button\n                onClick={() => setActiveTab('comments')}\n                style={{\n                  background: activeTab === 'comments' ? '#3b82f6' : 'transparent',\n                  color: activeTab === 'comments' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 12,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                Comments ({commentTotalCount})\n                {unresolvedCount > 0 && (\n                  <span\n                    style={{\n                      marginLeft: 4,\n                      fontSize: 10,\n                      background: '#f59e0b',\n                      padding: '2px 5px',\n                      borderRadius: 8,\n                    }}\n                  >\n                    {unresolvedCount}\n                  </span>\n                )}\n              </button>\n              <button\n                onClick={() => setActiveTab('activity')}\n                style={{\n                  background: activeTab === 'activity' ? '#3b82f6' : 'transparent',\n                  color: activeTab === 'activity' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 12,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                Activity ({activities.length})\n              </button>\n              <button\n                onClick={() => setActiveTab('minting')}\n                style={{\n                  background: activeTab === 'minting' ? '#10b981' : 'transparent',\n                  color: activeTab === 'minting' ? '#fff' : '#94a3b8',\n                  border: 'none',\n                  borderRadius: 6,\n                  padding: '6px 12px',\n                  fontSize: 11,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                  flex: 1,\n                }}\n              >\n                {isFullyApproved ? '‚úì' : '‚è≥'} Mint\n              </button>\n            </div>\n\n            {/* Comments View */}\n            {activeTab === 'comments' && (\n              <>\n                {/* Comment controls */}\n                <div style={{\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                  marginBottom: 12,\n                  gap: 8,\n                }}>\n                  <button\n                    onClick={() => setShowCommentInput(!showCommentInput)}\n                    style={{\n                      background: '#3b82f6',\n                      border: 'none',\n                      borderRadius: 6,\n                      padding: '6px 12px',\n                      color: '#fff',\n                      cursor: 'pointer',\n                      fontSize: 11,\n                      fontWeight: 600,\n                      flex: 1,\n                    }}\n                  >\n                    + Add Comment\n                  </button>\n                  <button\n                    onClick={() => setShowResolvedComments(!showResolvedComments)}\n                    style={{\n                      background: 'transparent',\n                      border: '1px solid var(--panel-border)',\n                      borderRadius: 6,\n                      padding: '6px 12px',\n                      color: '#94a3b8',\n                      cursor: 'pointer',\n                      fontSize: 10,\n                      fontWeight: 600,\n                    }}\n                  >\n                    {showResolvedComments ? 'Hide' : 'Show'} Resolved\n                  </button>\n                </div>\n\n                {/* Unresolved count */}\n                {unresolvedCount > 0 && (\n                  <div\n                    style={{\n                      marginBottom: 12,\n                      padding: '6px 10px',\n                      background: 'rgba(251, 191, 36, 0.1)',\n                      border: '1px solid #f59e0b',\n                      borderRadius: 6,\n                      fontSize: 11,\n                      color: '#f59e0b',\n                      fontWeight: 600,\n                      textAlign: 'center',\n                    }}\n                  >\n                    {unresolvedCount} unresolved comment{unresolvedCount !== 1 ? 's' : ''}\n                  </div>\n                )}\n\n                {/* Comment Input */}\n                {showCommentInput && (\n                  <div style={{ marginBottom: 12 }}>\n                    <CommentComposer\n                      projectId={project.id}\n                      collaborators={collaborators}\n                      onSubmit={handleAddComment}\n                      onCancel={() => setShowCommentInput(false)}\n                      compact={true}\n                      autoFocus={true}\n                    />\n                  </div>\n                )}\n\n                {/* Comment List */}\n                <div style={{\n                  display: 'flex',\n                  flexDirection: 'column',\n                  gap: 12,\n                  overflow: 'auto',\n                  flex: 1,\n                }}>\n                  {commentsLoading && comments.length === 0 ? (\n                    <div style={{\n                      padding: 20,\n                      textAlign: 'center',\n                      color: '#94a3b8',\n                      fontSize: 12,\n                    }}>\n                      Loading comments...\n                    </div>\n                  ) : comments.length === 0 ? (\n                    <div style={{\n                      padding: 20,\n                      textAlign: 'center',\n                      color: '#64748b',\n                      fontSize: 12,\n                    }}>\n                      <div style={{ fontSize: 32, marginBottom: 8 }}>üí¨</div>\n                      <div>No comments yet</div>\n                      <div style={{ fontSize: 11, color: '#64748b', marginTop: 4 }}>\n                        Be the first to comment!\n                      </div>\n                    </div>\n                  ) : (\n                    comments.map(comment => (\n                      <CommentThread\n                        key={comment.id}\n                        comment={comment}\n                        projectId={project.id}\n                        currentUserId={currentUser.id}\n                        collaborators={collaborators}\n                        onReply={handleReplyComment}\n                        onEdit={updateComment}\n                        onDelete={deleteComment}\n                        onResolve={resolveComment}\n                        onUnresolve={unresolveComment}\n                        onReaction={addReaction}\n                        onRemoveReaction={removeReaction}\n                      />\n                    ))\n                  )}\n                </div>\n              </>\n            )}\n\n            {/* Activity Feed View */}\n            {activeTab === 'activity' && (\n              <div style={{\n                overflow: 'auto',\n                flex: 1,\n              }}>\n                <ActivityFeed activities={activities} maxItems={20} compact={true} />\n              </div>\n            )}\n\n            {/* Minting Workflow View */}\n            {activeTab === 'minting' && (\n              <div style={{\n                overflow: 'auto',\n                flex: 1,\n              }}>\n                <MintingWorkflow\n                  project={project}\n                  currentUserId={currentUser.id}\n                  onApprovalRequest={handleApprovalRequest}\n                  onApprove={handleApproveProject}\n                  onMint={handleMint}\n                />\n              </div>\n            )}\n          </div>\n        </div>\n\n        {/* Right: Editor Area */}\n        <div style={{\n          flex: 1,\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 12,\n          overflow: 'auto',\n        }}>\n          {/* Sections */}\n          {sections.length === 0 ? (\n            <div style={{\n              background: 'var(--panel)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 12,\n              padding: 32,\n              textAlign: 'center',\n              color: '#94a3b8',\n            }}>\n              <div style={{ fontSize: 16, marginBottom: 16 }}>\n                No sections yet. Add your first section to get started!\n              </div>\n            </div>\n          ) : (\n            sections.map((section, index) => (\n              <SectionEditor\n                key={section.id}\n                section={section}\n                sectionNumber={index + 1}\n                canEdit={ownsSection(section) || project.created_by === currentUser.id}\n                isOwner={ownsSection(section)}\n                isEditing={currentlyEditingSection === section.id}\n                onStartEdit={async () => {\n                  setCurrentlyEditingSection(section.id);\n                  await startEditing(section.id);\n                }}\n                onStopEdit={async () => {\n                  if (currentlyEditingSection === section.id) {\n                    await stopEditing(section.id);\n                    setCurrentlyEditingSection(null);\n                  }\n                }}\n                onUpdate={(updates) => handleUpdateSection(section.id, updates)}\n                onDelete={() => handleDeleteSection(section.id)}\n                onMediaUpload={(file) => handleMediaUpload(section.id, file)}\n                saving={saving}\n                currentlyEditing={currentlyEditing}\n                currentUserId={currentUser.id}\n              />\n            ))\n          )}\n\n          {/* Add Section Buttons */}\n          <div style={{\n            background: 'var(--panel)',\n            border: '1px dashed var(--panel-border)',\n            borderRadius: 12,\n            padding: 16,\n          }}>\n            <div style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: 'var(--text)',\n              marginBottom: 12,\n            }}>\n              Add Section\n            </div>\n            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap' }}>\n              {(['text', 'image', 'audio', 'video'] as const).map(type => {\n                const canAdd = canEditSectionType(type);\n                return (\n                  <button\n                    key={type}\n                    onClick={() => handleAddSection(type)}\n                    disabled={!canAdd}\n                    style={{\n                      background: canAdd ? getSectionTypeBadgeColor(type) : '#374151',\n                      border: 'none',\n                      borderRadius: 8,\n                      padding: '8px 16px',\n                      color: '#fff',\n                      cursor: canAdd ? 'pointer' : 'not-allowed',\n                      fontSize: 12,\n                      fontWeight: 600,\n                      opacity: canAdd ? 1 : 0.5,\n                    }}\n                  >\n                    {type === 'text' && 'üìù'}\n                    {type === 'image' && 'üñºÔ∏è'}\n                    {type === 'audio' && 'üéµ'}\n                    {type === 'video' && 'üé¨'}\n                    {' '}\n                    {type.charAt(0).toUpperCase() + type.slice(1)}\n                  </button>\n                );\n              })}\n            </div>\n          </div>\n\n          {/* Saving Status */}\n          {saving && (\n            <div style={{\n              fontSize: 12,\n              color: '#f59e0b',\n              textAlign: 'right',\n            }}>\n              Saving...\n            </div>\n          )}\n          {!saving && lastSaved && (\n            <div style={{\n              fontSize: 12,\n              color: '#10b981',\n              textAlign: 'right',\n            }}>\n              Saved {formatTimeAgo(lastSaved)}\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// Section Editor Sub-component\ninterface SectionEditorProps {\n  section: ProjectSection;\n  sectionNumber: number;\n  canEdit: boolean;\n  isOwner: boolean;\n  isEditing: boolean;\n  onStartEdit: () => void;\n  onStopEdit?: () => void;\n  onUpdate: (updates: Partial<CreateSectionData>) => void;\n  onDelete: () => void;\n  onMediaUpload: (file: File) => void;\n  saving: boolean;\n  currentlyEditing: CurrentlyEditing[];\n  currentUserId: number;\n}\n\nfunction SectionEditor({\n  section,\n  sectionNumber,\n  canEdit,\n  isOwner,\n  isEditing,\n  onStartEdit,\n  onStopEdit,\n  onUpdate,\n  onDelete,\n  onMediaUpload,\n  saving,\n  currentlyEditing,\n  currentUserId,\n}: SectionEditorProps) {\n  const [title, setTitle] = useState(section.title);\n  const [content, setContent] = useState(section.content_html || '');\n\n  // Check if someone else is editing this section\n  const editors = currentlyEditing.filter(\n    e => e.section_id === section.id && e.user_id !== currentUserId\n  );\n  const isBeingEditedByOthers = editors.length > 0;\n\n  // Debounced auto-save for text sections\n  useEffect(() => {\n    if (!canEdit || section.section_type !== 'text') return;\n\n    const timer = setTimeout(() => {\n      if (title !== section.title || content !== section.content_html) {\n        onUpdate({ title, content_html: content });\n      }\n    }, 3000);\n\n    return () => clearTimeout(timer);\n  }, [title, content, section.id]);\n\n  const getSectionIcon = (type: string) => {\n    switch (type) {\n      case 'text': return 'üìù';\n      case 'image': return 'üñºÔ∏è';\n      case 'audio': return 'üéµ';\n      case 'video': return 'üé¨';\n      default: return 'üìÑ';\n    }\n  };\n\n  const getSectionColor = (type: string) => {\n    switch (type) {\n      case 'text': return '#3b82f6';\n      case 'image': return '#8b5cf6';\n      case 'audio': return '#f59e0b';\n      case 'video': return '#ef4444';\n      default: return '#64748b';\n    }\n  };\n\n  return (\n    <div\n      style={{\n        background: 'var(--panel)',\n        border: `2px solid ${canEdit ? getSectionColor(section.section_type) : 'var(--panel-border)'}`,\n        borderRadius: 12,\n        padding: 20,\n        position: 'relative',\n      }}\n      onClick={() => canEdit && !isEditing && onStartEdit()}\n    >\n      {/* Section Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'flex-start',\n        marginBottom: 12,\n        flexWrap: 'wrap',\n        gap: 12,\n      }}>\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12, flex: 1 }}>\n          <span style={{ fontSize: 20 }}>{getSectionIcon(section.section_type)}</span>\n          <div>\n            <div style={{\n              fontSize: 14,\n              fontWeight: 600,\n              color: 'var(--text)',\n            }}>\n              Section {sectionNumber}: {section.section_type}\n              {!canEdit && (\n                <span style={{\n                  marginLeft: 8,\n                  fontSize: 11,\n                  color: '#ef4444',\n                }}>\n                  üîí @{section.owner_username}'s section\n                </span>\n              )}\n            </div>\n            <div style={{ fontSize: 11, color: '#94a3b8' }}>\n              Owner: @{section.owner_username}\n            </div>\n          </div>\n        </div>\n\n        {/* Editing Status & Actions */}\n        <div style={{ display: 'flex', gap: 8, alignItems: 'center', flexWrap: 'wrap' }}>\n          {/* Show editing indicator if someone else is editing */}\n          {isBeingEditedByOthers && (\n            <EditingIndicator\n              sectionId={section.id}\n              currentlyEditing={currentlyEditing}\n              currentUserId={currentUserId}\n            />\n          )}\n\n          {/* Delete button */}\n          {canEdit && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                if (onStopEdit) onStopEdit();\n                onDelete();\n              }}\n              style={{\n                background: 'transparent',\n                border: '1px solid #ef4444',\n                borderRadius: 6,\n                padding: '4px 12px',\n                color: '#ef4444',\n                cursor: 'pointer',\n                fontSize: 11,\n              }}\n            >\n              Delete\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Section Content */}\n      {!canEdit ? (\n        // Read-only view for sections user can't edit\n        <div style={{\n          background: 'rgba(100, 100, 100, 0.1)',\n          borderRadius: 8,\n          padding: 16,\n          opacity: 0.6,\n        }}>\n          <div style={{ fontSize: 13, color: '#94a3b8' }}>\n            {section.section_type === 'text' && (\n              <div dangerouslySetInnerHTML={{ __html: sanitizeHtml(section.content_html) || 'No content yet' }} />\n            )}\n            {section.section_type === 'image' && section.media_file && (\n              <img\n                src={section.media_file}\n                alt={section.title}\n                style={{ maxWidth: '100%', borderRadius: 8 }}\n              />\n            )}\n            {section.section_type === 'audio' && section.media_file && (\n              <audio controls style={{ width: '100%' }}>\n                <source src={section.media_file} />\n              </audio>\n            )}\n            {section.section_type === 'video' && section.media_file && (\n              <video controls style={{ maxWidth: '100%', borderRadius: 8 }}>\n                <source src={section.media_file} />\n              </video>\n            )}\n            {!section.media_file && section.section_type !== 'text' && (\n              <div style={{ textAlign: 'center', padding: 20 }}>\n                No media uploaded yet\n              </div>\n            )}\n          </div>\n        </div>\n      ) : (\n        // Editable content\n        <>\n          {/* Title Input */}\n          <input\n            type=\"text\"\n            value={title}\n            onChange={(e) => setTitle(e.target.value)}\n            placeholder=\"Section title\"\n            style={{\n              width: '100%',\n              background: 'var(--bg)',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '10px 12px',\n              color: 'var(--text)',\n              fontSize: 14,\n              fontWeight: 600,\n              marginBottom: 12,\n              outline: 'none',\n            }}\n          />\n\n          {/* Content based on type */}\n          {section.section_type === 'text' && (\n            <div style={{ minHeight: 200 }}>\n              <ReactQuill\n                value={content}\n                onChange={setContent}\n                theme=\"snow\"\n                style={{\n                  height: 200,\n                  marginBottom: 50,\n                }}\n                modules={{\n                  toolbar: [\n                    [{ header: [1, 2, 3, false] }],\n                    ['bold', 'italic', 'underline', 'strike'],\n                    [{ list: 'ordered' }, { list: 'bullet' }],\n                    ['blockquote', 'code-block'],\n                    ['link'],\n                    ['clean'],\n                  ],\n                }}\n              />\n            </div>\n          )}\n\n          {/* Media Upload */}\n          {section.section_type !== 'text' && (\n            <div>\n              {section.media_file ? (\n                <div style={{ marginBottom: 12 }}>\n                  {section.section_type === 'image' && (\n                    <img\n                      src={section.media_file}\n                      alt={section.title}\n                      style={{ maxWidth: '100%', borderRadius: 8 }}\n                    />\n                  )}\n                  {section.section_type === 'audio' && (\n                    <audio controls style={{ width: '100%' }}>\n                      <source src={section.media_file} />\n                    </audio>\n                  )}\n                  {section.section_type === 'video' && (\n                    <video controls style={{ maxWidth: '100%', borderRadius: 8 }}>\n                      <source src={section.media_file} />\n                    </video>\n                  )}\n                </div>\n              ) : (\n                <div style={{\n                  border: '2px dashed var(--panel-border)',\n                  borderRadius: 8,\n                  padding: 32,\n                  textAlign: 'center',\n                  marginBottom: 12,\n                }}>\n                  <div style={{ fontSize: 14, color: '#94a3b8', marginBottom: 12 }}>\n                    No {section.section_type} uploaded\n                  </div>\n                </div>\n              )}\n\n              <label style={{\n                display: 'block',\n                background: getSectionColor(section.section_type),\n                border: 'none',\n                borderRadius: 8,\n                padding: '10px 16px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: 'pointer',\n                fontSize: 13,\n                textAlign: 'center',\n              }}>\n                {section.media_file ? 'Replace' : 'Upload'} {section.section_type}\n                <input\n                  type=\"file\"\n                  accept={\n                    section.section_type === 'image' ? 'image/*' :\n                    section.section_type === 'audio' ? 'audio/*' :\n                    section.section_type === 'video' ? 'video/*' : '*'\n                  }\n                  style={{ display: 'none' }}\n                  onChange={(e) => {\n                    const file = e.target.files?.[0];\n                    if (file) {\n                      onMediaUpload(file);\n                    }\n                  }}\n                />\n              </label>\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\n// Utility function\nfunction formatTimeAgo(date: Date): string {\n  const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\n  if (seconds < 60) return 'just now';\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  if (hours < 24) return `${hours}h ago`;\n  return `${Math.floor(hours / 24)}d ago`;\n}\n","import React, { useState, useEffect } from 'react';\nimport ReactQuill from 'react-quill';\nimport 'react-quill/dist/quill.snow.css';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeBookEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\n// Represent chapters as sections with section_type='text'\ninterface Chapter {\n  id: number;\n  title: string;\n  content_html: string;\n  synopsis: string;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeBookEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeBookEditorProps) {\n  const [chapters, setChapters] = useState<Chapter[]>([]);\n  const [selectedChapterId, setSelectedChapterId] = useState<number | null>(null);\n  const [saving, setSaving] = useState(false);\n  const [lastSaved, setLastSaved] = useState<Date | null>(null);\n  const [error, setError] = useState('');\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditText = currentUserRole?.can_edit?.includes('text') ?? currentUserRole?.can_edit_text ?? false;\n\n  // Load chapters from sections\n  useEffect(() => {\n    loadChapters();\n  }, [project.id]);\n\n  const loadChapters = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const textSections = sections\n        .filter(s => s.section_type === 'text')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          content_html: s.content_html || '',\n          synopsis: s.synopsis || '',\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setChapters(textSections);\n      if (textSections.length > 0 && !selectedChapterId) {\n        setSelectedChapterId(textSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load chapters');\n    }\n  };\n\n  const handleAddChapter = async () => {\n    if (!canEditText) {\n      setError(\"You don't have permission to add chapters\");\n      return;\n    }\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'text',\n        title: `Chapter ${chapters.length + 1}`,\n        content_html: '',\n        order: chapters.length,\n      });\n\n      const newChapter: Chapter = {\n        id: newSection.id,\n        title: newSection.title,\n        content_html: newSection.content_html || '',\n        synopsis: newSection.synopsis || '',\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setChapters([...chapters, newChapter]);\n      setSelectedChapterId(newChapter.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to add chapter');\n    }\n  };\n\n  const handleUpdateChapter = async (chapterId: number, title: string, content: string, synopsis?: string) => {\n    setSaving(true);\n    try {\n      const updateData: { title: string; content_html: string; synopsis?: string } = {\n        title,\n        content_html: content,\n      };\n      if (synopsis !== undefined) {\n        updateData.synopsis = synopsis;\n      }\n      const updated = await collaborationApi.updateProjectSection(chapterId, updateData);\n      setChapters(chapters.map(ch =>\n        ch.id === chapterId\n          ? { ...ch, title: updated.title, content_html: updated.content_html || '', synopsis: updated.synopsis || '' }\n          : ch\n      ));\n      setLastSaved(new Date());\n    } catch (err: any) {\n      setError(err.message || 'Failed to save chapter');\n    } finally {\n      setSaving(false);\n    }\n  };\n\n  const handleDeleteChapter = async (chapterId: number) => {\n    if (!confirm('Are you sure you want to delete this chapter?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(chapterId);\n      const remaining = chapters.filter(ch => ch.id !== chapterId);\n      setChapters(remaining);\n      if (selectedChapterId === chapterId) {\n        setSelectedChapterId(remaining[0]?.id || null);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete chapter');\n    }\n  };\n\n  const selectedChapter = chapters.find(ch => ch.id === selectedChapterId);\n  const canEditSelectedChapter = selectedChapter && (\n    selectedChapter.owner === currentUser.id || canEditText\n  );\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Chapter Sidebar */}\n      <div style={{\n        width: 280,\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        <div style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: 16,\n        }}>\n          <h3 style={{ margin: 0, color: 'var(--text)', fontSize: 16 }}>\n            Chapters ({chapters.length})\n          </h3>\n          {canEditText && (\n            <button\n              onClick={handleAddChapter}\n              style={{\n                background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                border: 'none',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#fff',\n                fontWeight: 600,\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              + Add\n            </button>\n          )}\n        </div>\n\n        {/* Chapter List */}\n        <div style={{\n          flex: 1,\n          overflowY: 'auto',\n          display: 'flex',\n          flexDirection: 'column',\n          gap: 8,\n        }}>\n          {chapters.length === 0 ? (\n            <div style={{\n              textAlign: 'center',\n              padding: 24,\n              color: '#64748b',\n              fontSize: 13,\n            }}>\n              No chapters yet.\n              {canEditText && ' Click \"+ Add\" to create one.'}\n            </div>\n          ) : (\n            chapters.map((chapter, index) => {\n              const isSelected = selectedChapterId === chapter.id;\n              const isOwner = chapter.owner === currentUser.id;\n\n              return (\n                <div\n                  key={chapter.id}\n                  onClick={() => setSelectedChapterId(chapter.id)}\n                  style={{\n                    padding: 12,\n                    background: isSelected ? 'rgba(245, 158, 11, 0.1)' : 'var(--bg)',\n                    border: isSelected\n                      ? '1px solid #f59e0b'\n                      : '1px solid var(--panel-border)',\n                    borderRadius: 8,\n                    cursor: 'pointer',\n                    transition: 'all 0.2s',\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'space-between',\n                    gap: 8,\n                  }}>\n                    <div style={{ flex: 1, minWidth: 0 }}>\n                      <div style={{\n                        fontSize: 13,\n                        fontWeight: 600,\n                        color: isSelected ? '#f59e0b' : 'var(--text)',\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}>\n                        {chapter.title || `Chapter ${index + 1}`}\n                      </div>\n                      <div style={{\n                        fontSize: 11,\n                        color: '#94a3b8',\n                        marginTop: 2,\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 4,\n                      }}>\n                        <span style={{\n                          width: 14,\n                          height: 14,\n                          borderRadius: '50%',\n                          background: isOwner\n                            ? 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'\n                            : 'linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)',\n                          display: 'inline-flex',\n                          alignItems: 'center',\n                          justifyContent: 'center',\n                          color: '#fff',\n                          fontSize: 8,\n                          fontWeight: 700,\n                        }}>\n                          {chapter.owner_username.charAt(0).toUpperCase()}\n                        </span>\n                        @{chapter.owner_username}\n                        {isOwner && <span style={{ color: '#f59e0b' }}>(you)</span>}\n                      </div>\n                    </div>\n                  </div>\n                </div>\n              );\n            })\n          )}\n        </div>\n      </div>\n\n      {/* Chapter Editor */}\n      <div style={{\n        flex: 1,\n        background: 'var(--panel)',\n        border: '1px solid var(--panel-border)',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        {error && (\n          <div style={{\n            padding: 12,\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            borderRadius: 8,\n            color: '#ef4444',\n            fontSize: 13,\n            marginBottom: 16,\n          }}>\n            {error}\n            <button\n              onClick={() => setError('')}\n              style={{\n                background: 'transparent',\n                border: 'none',\n                color: '#ef4444',\n                cursor: 'pointer',\n                float: 'right',\n                fontWeight: 700,\n              }}\n            >\n              x\n            </button>\n          </div>\n        )}\n\n        {selectedChapter ? (\n          <ChapterEditor\n            chapter={selectedChapter}\n            canEdit={canEditSelectedChapter || false}\n            onUpdate={(title, content, synopsis) => handleUpdateChapter(selectedChapter.id, title, content, synopsis)}\n            onDelete={() => handleDeleteChapter(selectedChapter.id)}\n            saving={saving}\n            lastSaved={lastSaved}\n          />\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {chapters.length > 0\n              ? 'Select a chapter to edit'\n              : 'Add your first chapter to get started'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\n// Chapter Editor Sub-component\ninterface ChapterEditorProps {\n  chapter: Chapter;\n  canEdit: boolean;\n  onUpdate: (title: string, content: string, synopsis?: string) => void;\n  onDelete: () => void;\n  saving: boolean;\n  lastSaved: Date | null;\n}\n\nfunction ChapterEditor({\n  chapter,\n  canEdit,\n  onUpdate,\n  onDelete,\n  saving,\n  lastSaved,\n}: ChapterEditorProps) {\n  const [title, setTitle] = useState(chapter.title);\n  const [content, setContent] = useState(chapter.content_html);\n  const [synopsis, setSynopsis] = useState(chapter.synopsis);\n  const [showSynopsis, setShowSynopsis] = useState(false);\n\n  // Sync when chapter changes\n  useEffect(() => {\n    setTitle(chapter.title);\n    setContent(chapter.content_html);\n    setSynopsis(chapter.synopsis);\n  }, [chapter.id]);\n\n  // Auto-save with debounce\n  useEffect(() => {\n    if (!canEdit) return;\n\n    const timer = setTimeout(() => {\n      if (title !== chapter.title || content !== chapter.content_html || synopsis !== chapter.synopsis) {\n        onUpdate(title, content, synopsis);\n      }\n    }, 2000);\n\n    return () => clearTimeout(timer);\n  }, [title, content, synopsis]);\n\n  const quillModules = {\n    toolbar: [\n      [{ header: [1, 2, 3, false] }],\n      ['bold', 'italic', 'underline', 'strike'],\n      [{ list: 'ordered' }, { list: 'bullet' }],\n      ['blockquote', 'code-block'],\n      ['link'],\n      ['clean'],\n    ],\n  };\n\n  return (\n    <div style={{ display: 'flex', flexDirection: 'column', height: '100%' }}>\n      {/* Chapter Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'center',\n        marginBottom: 16,\n        gap: 16,\n      }}>\n        <input\n          type=\"text\"\n          value={title}\n          onChange={(e) => setTitle(e.target.value)}\n          disabled={!canEdit}\n          placeholder=\"Chapter Title\"\n          style={{\n            flex: 1,\n            background: 'transparent',\n            border: 'none',\n            borderBottom: '2px solid var(--panel-border)',\n            color: 'var(--text)',\n            fontSize: 20,\n            fontWeight: 700,\n            padding: '8px 0',\n            outline: 'none',\n          }}\n        />\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          {saving && (\n            <span style={{ fontSize: 12, color: '#f59e0b' }}>Saving...</span>\n          )}\n          {!saving && lastSaved && (\n            <span style={{ fontSize: 12, color: '#10b981' }}>\n              Saved {formatTimeAgo(lastSaved)}\n            </span>\n          )}\n          {canEdit && (\n            <button\n              onClick={onDelete}\n              style={{\n                background: 'transparent',\n                border: '1px solid #ef4444',\n                borderRadius: 6,\n                padding: '6px 12px',\n                color: '#ef4444',\n                cursor: 'pointer',\n                fontSize: 12,\n              }}\n            >\n              Delete\n            </button>\n          )}\n        </div>\n      </div>\n\n      {/* Owner Badge */}\n      <div style={{\n        marginBottom: 12,\n        fontSize: 12,\n        color: '#94a3b8',\n      }}>\n        Written by @{chapter.owner_username}\n        {!canEdit && (\n          <span style={{ color: '#ef4444', marginLeft: 8 }}>\n            (Read-only - you can only edit your own chapters)\n          </span>\n        )}\n      </div>\n\n      {/* Synopsis Toggle */}\n      <div style={{ marginBottom: 12 }}>\n        <button\n          onClick={() => setShowSynopsis(!showSynopsis)}\n          style={{\n            background: 'transparent',\n            border: 'none',\n            color: '#94a3b8',\n            fontSize: 12,\n            cursor: 'pointer',\n            padding: '4px 0',\n            display: 'flex',\n            alignItems: 'center',\n            gap: 4,\n          }}\n        >\n          <span style={{\n            fontSize: 10,\n            transform: showSynopsis ? 'rotate(90deg)' : 'rotate(0)',\n            transition: 'transform 0.2s',\n          }}>\n            ‚ñ∂\n          </span>\n          Synopsis {synopsis ? `(${synopsis.split(/\\s+/).filter(w => w).length} words)` : '(optional)'}\n        </button>\n        {showSynopsis && (\n          <div style={{ marginTop: 8 }}>\n            <textarea\n              value={synopsis}\n              onChange={(e) => canEdit && setSynopsis(e.target.value)}\n              placeholder=\"Brief summary of this chapter (optional, max 150 words)...\"\n              disabled={!canEdit}\n              maxLength={1000}\n              style={{\n                width: '100%',\n                minHeight: 80,\n                background: !canEdit ? 'rgba(100,100,100,0.05)' : 'var(--bg)',\n                border: '1px solid var(--panel-border)',\n                borderRadius: 8,\n                padding: '10px 14px',\n                color: !canEdit ? '#64748b' : 'var(--text)',\n                fontSize: 13,\n                resize: 'vertical',\n                cursor: !canEdit ? 'not-allowed' : 'text',\n                outline: 'none',\n              }}\n            />\n            <div style={{ fontSize: 10, color: '#64748b', marginTop: 4 }}>\n              {synopsis.split(/\\s+/).filter(w => w).length}/150 words recommended\n            </div>\n          </div>\n        )}\n      </div>\n\n      {/* Editor */}\n      <div style={{\n        flex: 1,\n        display: 'flex',\n        flexDirection: 'column',\n        minHeight: 300,\n      }}>\n        <ReactQuill\n          theme=\"snow\"\n          value={content}\n          onChange={setContent}\n          readOnly={!canEdit}\n          modules={quillModules}\n          style={{\n            flex: 1,\n            display: 'flex',\n            flexDirection: 'column',\n          }}\n        />\n      </div>\n    </div>\n  );\n}\n\nfunction formatTimeAgo(date: Date): string {\n  const seconds = Math.floor((new Date().getTime() - date.getTime()) / 1000);\n  if (seconds < 60) return 'just now';\n  const minutes = Math.floor(seconds / 60);\n  if (minutes < 60) return `${minutes}m ago`;\n  const hours = Math.floor(minutes / 60);\n  return `${hours}h ago`;\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeArtEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface ArtPiece {\n  id: number;\n  title: string;\n  media_file: string;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeArtEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeArtEditorProps) {\n  const [artPieces, setArtPieces] = useState<ArtPiece[]>([]);\n  const [selectedPieceId, setSelectedPieceId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditImages = currentUserRole?.can_edit?.includes('image') ?? currentUserRole?.can_edit_images ?? false;\n\n  useEffect(() => {\n    loadArtPieces();\n  }, [project.id]);\n\n  const loadArtPieces = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const imageSections = sections\n        .filter(s => s.section_type === 'image')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setArtPieces(imageSections);\n      if (imageSections.length > 0 && !selectedPieceId) {\n        setSelectedPieceId(imageSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load art pieces');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditImages) {\n      setError(\"You don't have permission to upload images\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['image/png', 'image/jpeg', 'image/webp', 'image/gif'];\n    if (!validTypes.includes(file.type)) {\n      setError('Please upload a PNG, JPG, WebP, or GIF image');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'image',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Art',\n        order: artPieces.length,\n        media_file: file,\n      });\n\n      const newPiece: ArtPiece = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setArtPieces([...artPieces, newPiece]);\n      setSelectedPieceId(newPiece.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload art');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (pieceId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(pieceId, { title });\n      setArtPieces(artPieces.map(p =>\n        p.id === pieceId ? { ...p, title } : p\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (pieceId: number) => {\n    if (!confirm('Are you sure you want to delete this art piece?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(pieceId);\n      const remaining = artPieces.filter(p => p.id !== pieceId);\n      setArtPieces(remaining);\n      if (selectedPieceId === pieceId) {\n        setSelectedPieceId(remaining[0]?.id || null);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete art piece');\n    }\n  };\n\n  const selectedPiece = artPieces.find(p => p.id === selectedPieceId);\n  const canEditSelectedPiece = selectedPiece && (\n    selectedPiece.owner === currentUser.id || canEditImages\n  );\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Gallery Sidebar */}\n      <div style={{\n        width: 280,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Gallery ({artPieces.length})\n          </span>\n          {canEditImages && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"image/png,image/jpeg,image/webp,image/gif\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {artPieces.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No art pieces yet.\n              {canEditImages && ' Click \"+ Add\" to upload your first piece.'}\n            </div>\n          ) : (\n            artPieces.map(piece => (\n              <div\n                key={piece.id}\n                onClick={() => setSelectedPieceId(piece.id)}\n                style={{\n                  background: selectedPieceId === piece.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedPieceId === piece.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 8,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 10,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 48,\n                  height: 48,\n                  borderRadius: 6,\n                  background: '#334155',\n                  backgroundImage: piece.media_file ? `url(${piece.media_file})` : undefined,\n                  backgroundSize: 'cover',\n                  backgroundPosition: 'center',\n                  flexShrink: 0,\n                }} />\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedPieceId === piece.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {piece.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{piece.owner_username}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Preview Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedPiece ? (\n          <>\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedPiece ? (\n                  <input\n                    type=\"text\"\n                    value={selectedPiece.title}\n                    onChange={(e) => handleUpdateTitle(selectedPiece.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 18,\n                      fontWeight: 600,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 18, fontWeight: 600, margin: 0 }}>\n                    {selectedPiece.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Uploaded by @{selectedPiece.owner_username}\n                </div>\n              </div>\n              {canEditSelectedPiece && (\n                <button\n                  onClick={() => handleDelete(selectedPiece.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Image Display */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              background: '#0f172a',\n              borderRadius: 8,\n              overflow: 'hidden',\n            }}>\n              {selectedPiece.media_file ? (\n                <img\n                  src={selectedPiece.media_file}\n                  alt={selectedPiece.title}\n                  style={{\n                    maxWidth: '100%',\n                    maxHeight: '100%',\n                    objectFit: 'contain',\n                  }}\n                />\n              ) : (\n                <div style={{ color: '#64748b', fontSize: 14 }}>\n                  No image available\n                </div>\n              )}\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {artPieces.length === 0\n              ? 'Upload an image to get started'\n              : 'Select an art piece to view'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeMusicEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface Track {\n  id: number;\n  title: string;\n  media_file: string;\n  duration?: number;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeMusicEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeMusicEditorProps) {\n  const [tracks, setTracks] = useState<Track[]>([]);\n  const [selectedTrackId, setSelectedTrackId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const audioRef = useRef<HTMLAudioElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditAudio = currentUserRole?.can_edit?.includes('audio') ?? currentUserRole?.can_edit_audio ?? false;\n\n  useEffect(() => {\n    loadTracks();\n  }, [project.id]);\n\n  const loadTracks = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const audioSections = sections\n        .filter(s => s.section_type === 'audio')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          duration: undefined, // TODO: Parse duration from file if needed\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setTracks(audioSections);\n      if (audioSections.length > 0 && !selectedTrackId) {\n        setSelectedTrackId(audioSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load tracks');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditAudio) {\n      setError(\"You don't have permission to upload audio\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['audio/mpeg', 'audio/mp3', 'audio/wav', 'audio/ogg', 'audio/m4a', 'audio/aac'];\n    if (!validTypes.includes(file.type) && !file.name.match(/\\.(mp3|wav|ogg|m4a|aac)$/i)) {\n      setError('Please upload an MP3, WAV, OGG, M4A, or AAC audio file');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'audio',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Track',\n        order: tracks.length,\n        media_file: file,\n      });\n\n      const newTrack: Track = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        duration: undefined,\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setTracks([...tracks, newTrack]);\n      setSelectedTrackId(newTrack.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload track');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (trackId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(trackId, { title });\n      setTracks(tracks.map(t =>\n        t.id === trackId ? { ...t, title } : t\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (trackId: number) => {\n    if (!confirm('Are you sure you want to delete this track?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(trackId);\n      const remaining = tracks.filter(t => t.id !== trackId);\n      setTracks(remaining);\n      if (selectedTrackId === trackId) {\n        setSelectedTrackId(remaining[0]?.id || null);\n        setPlaying(false);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete track');\n    }\n  };\n\n  const togglePlay = () => {\n    if (!audioRef.current) return;\n    if (playing) {\n      audioRef.current.pause();\n    } else {\n      audioRef.current.play();\n    }\n    setPlaying(!playing);\n  };\n\n  const handleTimeUpdate = () => {\n    if (audioRef.current) {\n      setCurrentTime(audioRef.current.currentTime);\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (audioRef.current) {\n      setDuration(audioRef.current.duration);\n    }\n  };\n\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const time = parseFloat(e.target.value);\n    if (audioRef.current) {\n      audioRef.current.currentTime = time;\n      setCurrentTime(time);\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const selectedTrack = tracks.find(t => t.id === selectedTrackId);\n  const canEditSelectedTrack = selectedTrack && (\n    selectedTrack.owner === currentUser.id || canEditAudio\n  );\n\n  // Reset audio when track changes\n  useEffect(() => {\n    setPlaying(false);\n    setCurrentTime(0);\n    setDuration(0);\n  }, [selectedTrackId]);\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Track List Sidebar */}\n      <div style={{\n        width: 320,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Tracks ({tracks.length})\n          </span>\n          {canEditAudio && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add Track'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"audio/*,.mp3,.wav,.ogg,.m4a,.aac\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {tracks.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No tracks yet.\n              {canEditAudio && ' Click \"+ Add Track\" to upload your first track.'}\n            </div>\n          ) : (\n            tracks.map((track, index) => (\n              <div\n                key={track.id}\n                onClick={() => setSelectedTrackId(track.id)}\n                style={{\n                  background: selectedTrackId === track.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedTrackId === track.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 12,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 12,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 32,\n                  height: 32,\n                  borderRadius: 6,\n                  background: selectedTrackId === track.id ? '#f59e0b' : '#334155',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  color: selectedTrackId === track.id ? '#000' : '#94a3b8',\n                  fontSize: 12,\n                  fontWeight: 700,\n                  flexShrink: 0,\n                }}>\n                  {index + 1}\n                </div>\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedTrackId === track.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {track.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{track.owner_username}\n                    {track.duration && ` - ${formatTime(track.duration)}`}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Player Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedTrack ? (\n          <>\n            {/* Hidden audio element */}\n            <audio\n              ref={audioRef}\n              src={selectedTrack.media_file}\n              onTimeUpdate={handleTimeUpdate}\n              onLoadedMetadata={handleLoadedMetadata}\n              onEnded={() => setPlaying(false)}\n            />\n\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 24,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedTrack ? (\n                  <input\n                    type=\"text\"\n                    value={selectedTrack.title}\n                    onChange={(e) => handleUpdateTitle(selectedTrack.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 24,\n                      fontWeight: 700,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 24, fontWeight: 700, margin: 0 }}>\n                    {selectedTrack.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 13, marginTop: 4 }}>\n                  Uploaded by @{selectedTrack.owner_username}\n                </div>\n              </div>\n              {canEditSelectedTrack && (\n                <button\n                  onClick={() => handleDelete(selectedTrack.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Player UI */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: 32,\n            }}>\n              {/* Album Art Placeholder */}\n              <div style={{\n                width: 200,\n                height: 200,\n                borderRadius: 12,\n                background: 'linear-gradient(135deg, #334155 0%, #1e293b 100%)',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                fontSize: 64,\n              }}>\n                üéµ\n              </div>\n\n              {/* Play Controls */}\n              <div style={{\n                display: 'flex',\n                flexDirection: 'column',\n                alignItems: 'center',\n                gap: 16,\n                width: '100%',\n                maxWidth: 400,\n              }}>\n                <button\n                  onClick={togglePlay}\n                  disabled={!selectedTrack.media_file}\n                  style={{\n                    width: 64,\n                    height: 64,\n                    borderRadius: '50%',\n                    background: selectedTrack.media_file ? '#f59e0b' : '#334155',\n                    border: 'none',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    cursor: selectedTrack.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 24,\n                  }}\n                >\n                  {playing ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}\n                </button>\n\n                {/* Progress Bar */}\n                <div style={{ width: '100%', display: 'flex', alignItems: 'center', gap: 12 }}>\n                  <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                    {formatTime(currentTime)}\n                  </span>\n                  <input\n                    type=\"range\"\n                    min={0}\n                    max={duration || 100}\n                    value={currentTime}\n                    onChange={handleSeek}\n                    style={{\n                      flex: 1,\n                      accentColor: '#f59e0b',\n                    }}\n                  />\n                  <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40, textAlign: 'right' }}>\n                    {formatTime(duration)}\n                  </span>\n                </div>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {tracks.length === 0\n              ? 'Upload an audio track to get started'\n              : 'Select a track to play'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect, useRef } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  collaborationApi,\n} from '../../services/collaborationApi';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface CollaborativeVideoEditorProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\ninterface VideoClip {\n  id: number;\n  title: string;\n  media_file: string;\n  duration?: number;\n  order: number;\n  owner: number;\n  owner_username: string;\n}\n\nexport default function CollaborativeVideoEditor({\n  project,\n  currentUser,\n  onProjectUpdate,\n}: CollaborativeVideoEditorProps) {\n  const [clips, setClips] = useState<VideoClip[]>([]);\n  const [selectedClipId, setSelectedClipId] = useState<number | null>(null);\n  const [uploading, setUploading] = useState(false);\n  const [playing, setPlaying] = useState(false);\n  const [currentTime, setCurrentTime] = useState(0);\n  const [duration, setDuration] = useState(0);\n  const [error, setError] = useState('');\n  const fileInputRef = useRef<HTMLInputElement>(null);\n  const videoRef = useRef<HTMLVideoElement>(null);\n\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const canEditVideo = currentUserRole?.can_edit?.includes('video') ?? currentUserRole?.can_edit_video ?? false;\n\n  useEffect(() => {\n    loadClips();\n  }, [project.id]);\n\n  const loadClips = async () => {\n    try {\n      const sections = await collaborationApi.getProjectSections(project.id);\n      const videoSections = sections\n        .filter(s => s.section_type === 'video')\n        .sort((a, b) => a.order - b.order)\n        .map(s => ({\n          id: s.id,\n          title: s.title,\n          media_file: s.media_file || '',\n          duration: undefined, // TODO: Parse duration from file if needed\n          order: s.order,\n          owner: s.owner,\n          owner_username: s.owner_username,\n        }));\n      setClips(videoSections);\n      if (videoSections.length > 0 && !selectedClipId) {\n        setSelectedClipId(videoSections[0].id);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load video clips');\n    }\n  };\n\n  const handleUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {\n    if (!canEditVideo) {\n      setError(\"You don't have permission to upload videos\");\n      return;\n    }\n\n    const file = e.target.files?.[0];\n    if (!file) return;\n\n    // Validate file type\n    const validTypes = ['video/mp4', 'video/quicktime', 'video/webm', 'video/x-msvideo'];\n    if (!validTypes.includes(file.type) && !file.name.match(/\\.(mp4|mov|webm|avi)$/i)) {\n      setError('Please upload an MP4, MOV, WebM, or AVI video file');\n      return;\n    }\n\n    // Validate file size (50MB max)\n    if (file.size > 50 * 1024 * 1024) {\n      setError('File size must be under 50MB');\n      return;\n    }\n\n    setUploading(true);\n    setError('');\n\n    try {\n      const newSection = await collaborationApi.createProjectSection({\n        project: project.id,\n        section_type: 'video',\n        title: file.name.replace(/\\.[^/.]+$/, '') || 'Untitled Clip',\n        order: clips.length,\n        media_file: file,\n      });\n\n      const newClip: VideoClip = {\n        id: newSection.id,\n        title: newSection.title,\n        media_file: newSection.media_file || '',\n        duration: undefined,\n        order: newSection.order,\n        owner: newSection.owner,\n        owner_username: newSection.owner_username,\n      };\n\n      setClips([...clips, newClip]);\n      setSelectedClipId(newClip.id);\n    } catch (err: any) {\n      setError(err.message || 'Failed to upload video');\n    } finally {\n      setUploading(false);\n      if (fileInputRef.current) {\n        fileInputRef.current.value = '';\n      }\n    }\n  };\n\n  const handleUpdateTitle = async (clipId: number, title: string) => {\n    try {\n      await collaborationApi.updateProjectSection(clipId, { title });\n      setClips(clips.map(c =>\n        c.id === clipId ? { ...c, title } : c\n      ));\n    } catch (err: any) {\n      setError(err.message || 'Failed to update title');\n    }\n  };\n\n  const handleDelete = async (clipId: number) => {\n    if (!confirm('Are you sure you want to delete this video clip?')) return;\n\n    try {\n      await collaborationApi.deleteProjectSection(clipId);\n      const remaining = clips.filter(c => c.id !== clipId);\n      setClips(remaining);\n      if (selectedClipId === clipId) {\n        setSelectedClipId(remaining[0]?.id || null);\n        setPlaying(false);\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to delete video clip');\n    }\n  };\n\n  const togglePlay = () => {\n    if (!videoRef.current) return;\n    if (playing) {\n      videoRef.current.pause();\n    } else {\n      videoRef.current.play();\n    }\n    setPlaying(!playing);\n  };\n\n  const handleTimeUpdate = () => {\n    if (videoRef.current) {\n      setCurrentTime(videoRef.current.currentTime);\n    }\n  };\n\n  const handleLoadedMetadata = () => {\n    if (videoRef.current) {\n      setDuration(videoRef.current.duration);\n    }\n  };\n\n  const handleSeek = (e: React.ChangeEvent<HTMLInputElement>) => {\n    const time = parseFloat(e.target.value);\n    if (videoRef.current) {\n      videoRef.current.currentTime = time;\n      setCurrentTime(time);\n    }\n  };\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = Math.floor(seconds % 60);\n    return `${mins}:${secs.toString().padStart(2, '0')}`;\n  };\n\n  const toggleFullscreen = () => {\n    if (videoRef.current) {\n      if (document.fullscreenElement) {\n        document.exitFullscreen();\n      } else {\n        videoRef.current.requestFullscreen();\n      }\n    }\n  };\n\n  const selectedClip = clips.find(c => c.id === selectedClipId);\n  const canEditSelectedClip = selectedClip && (\n    selectedClip.owner === currentUser.id || canEditVideo\n  );\n\n  // Reset video when clip changes\n  useEffect(() => {\n    setPlaying(false);\n    setCurrentTime(0);\n    setDuration(0);\n  }, [selectedClipId]);\n\n  return (\n    <div style={{ display: 'flex', gap: 20, height: 'calc(100vh - 300px)', minHeight: 500 }}>\n      {/* Clip List Sidebar */}\n      <div style={{\n        width: 320,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n        gap: 12,\n        overflow: 'hidden',\n      }}>\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\n          <span style={{ color: '#f8fafc', fontWeight: 600, fontSize: 14 }}>\n            Video Clips ({clips.length})\n          </span>\n          {canEditVideo && (\n            <label style={{\n              background: '#f59e0b',\n              color: '#000',\n              padding: '6px 12px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: uploading ? 'not-allowed' : 'pointer',\n              opacity: uploading ? 0.5 : 1,\n            }}>\n              {uploading ? 'Uploading...' : '+ Add Clip'}\n              <input\n                ref={fileInputRef}\n                type=\"file\"\n                accept=\"video/*,.mp4,.mov,.webm,.avi\"\n                onChange={handleUpload}\n                disabled={uploading}\n                style={{ display: 'none' }}\n              />\n            </label>\n          )}\n        </div>\n\n        <div style={{ flex: 1, overflow: 'auto', display: 'flex', flexDirection: 'column', gap: 8 }}>\n          {clips.length === 0 ? (\n            <div style={{\n              padding: 24,\n              textAlign: 'center',\n              color: '#64748b',\n              fontSize: 13,\n              border: '1px dashed #334155',\n              borderRadius: 8,\n            }}>\n              No video clips yet.\n              {canEditVideo && ' Click \"+ Add Clip\" to upload your first video.'}\n            </div>\n          ) : (\n            clips.map((clip, index) => (\n              <div\n                key={clip.id}\n                onClick={() => setSelectedClipId(clip.id)}\n                style={{\n                  background: selectedClipId === clip.id ? 'rgba(245, 158, 11, 0.15)' : '#0f172a',\n                  border: `1px solid ${selectedClipId === clip.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  padding: 8,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  gap: 10,\n                  alignItems: 'center',\n                }}\n              >\n                <div style={{\n                  width: 64,\n                  height: 36,\n                  borderRadius: 4,\n                  background: '#334155',\n                  flexShrink: 0,\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                }}>\n                  <span style={{ fontSize: 16 }}>üé¨</span>\n                </div>\n                <div style={{ flex: 1, minWidth: 0 }}>\n                  <div style={{\n                    color: selectedClipId === clip.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {clip.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    @{clip.owner_username}\n                    {clip.duration && ` - ${formatTime(clip.duration)}`}\n                  </div>\n                </div>\n              </div>\n            ))\n          )}\n        </div>\n      </div>\n\n      {/* Main Video Player Area */}\n      <div style={{\n        flex: 1,\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}>\n        {error && (\n          <div style={{\n            background: 'rgba(239, 68, 68, 0.1)',\n            border: '1px solid #ef4444',\n            color: '#ef4444',\n            padding: 12,\n            borderRadius: 8,\n            marginBottom: 16,\n            fontSize: 13,\n          }}>\n            {error}\n          </div>\n        )}\n\n        {selectedClip ? (\n          <>\n            {/* Header */}\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div style={{ flex: 1 }}>\n                {canEditSelectedClip ? (\n                  <input\n                    type=\"text\"\n                    value={selectedClip.title}\n                    onChange={(e) => handleUpdateTitle(selectedClip.id, e.target.value)}\n                    style={{\n                      background: 'transparent',\n                      border: 'none',\n                      color: '#f8fafc',\n                      fontSize: 18,\n                      fontWeight: 600,\n                      width: '100%',\n                      outline: 'none',\n                    }}\n                    placeholder=\"Untitled\"\n                  />\n                ) : (\n                  <h2 style={{ color: '#f8fafc', fontSize: 18, fontWeight: 600, margin: 0 }}>\n                    {selectedClip.title}\n                  </h2>\n                )}\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Uploaded by @{selectedClip.owner_username}\n                </div>\n              </div>\n              {canEditSelectedClip && (\n                <button\n                  onClick={() => handleDelete(selectedClip.id)}\n                  style={{\n                    background: 'rgba(239, 68, 68, 0.1)',\n                    border: '1px solid #ef4444',\n                    color: '#ef4444',\n                    padding: '8px 16px',\n                    borderRadius: 6,\n                    fontSize: 12,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                >\n                  Delete\n                </button>\n              )}\n            </div>\n\n            {/* Video Player */}\n            <div style={{\n              flex: 1,\n              display: 'flex',\n              flexDirection: 'column',\n              gap: 16,\n            }}>\n              <div style={{\n                flex: 1,\n                background: '#0f172a',\n                borderRadius: 8,\n                overflow: 'hidden',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                position: 'relative',\n              }}>\n                {selectedClip.media_file ? (\n                  <video\n                    ref={videoRef}\n                    src={selectedClip.media_file}\n                    onTimeUpdate={handleTimeUpdate}\n                    onLoadedMetadata={handleLoadedMetadata}\n                    onEnded={() => setPlaying(false)}\n                    onClick={togglePlay}\n                    style={{\n                      maxWidth: '100%',\n                      maxHeight: '100%',\n                      cursor: 'pointer',\n                    }}\n                  />\n                ) : (\n                  <div style={{ color: '#64748b', fontSize: 14 }}>\n                    No video available\n                  </div>\n                )}\n              </div>\n\n              {/* Controls */}\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 16,\n                padding: '12px 16px',\n                background: '#0f172a',\n                borderRadius: 8,\n              }}>\n                <button\n                  onClick={togglePlay}\n                  disabled={!selectedClip.media_file}\n                  style={{\n                    width: 40,\n                    height: 40,\n                    borderRadius: '50%',\n                    background: selectedClip.media_file ? '#f59e0b' : '#334155',\n                    border: 'none',\n                    display: 'flex',\n                    alignItems: 'center',\n                    justifyContent: 'center',\n                    cursor: selectedClip.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 16,\n                  }}\n                >\n                  {playing ? '‚è∏Ô∏è' : '‚ñ∂Ô∏è'}\n                </button>\n\n                <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                  {formatTime(currentTime)}\n                </span>\n\n                <input\n                  type=\"range\"\n                  min={0}\n                  max={duration || 100}\n                  value={currentTime}\n                  onChange={handleSeek}\n                  style={{\n                    flex: 1,\n                    accentColor: '#f59e0b',\n                  }}\n                />\n\n                <span style={{ color: '#94a3b8', fontSize: 12, minWidth: 40 }}>\n                  {formatTime(duration)}\n                </span>\n\n                <button\n                  onClick={toggleFullscreen}\n                  disabled={!selectedClip.media_file}\n                  style={{\n                    background: 'transparent',\n                    border: '1px solid #334155',\n                    color: '#94a3b8',\n                    padding: '8px 12px',\n                    borderRadius: 6,\n                    cursor: selectedClip.media_file ? 'pointer' : 'not-allowed',\n                    fontSize: 12,\n                  }}\n                >\n                  Fullscreen\n                </button>\n              </div>\n            </div>\n          </>\n        ) : (\n          <div style={{\n            flex: 1,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            color: '#64748b',\n            fontSize: 14,\n          }}>\n            {clips.length === 0\n              ? 'Upload a video clip to get started'\n              : 'Select a clip to play'}\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n","import React, { useState, useEffect } from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  collaborationApi,\n} from '../../services/collaborationApi';\nimport { sanitizeHtml } from '../../utils/sanitize';\nimport { Eye, MessageSquare, Send, FileText, Image, Music, Video, CheckCircle } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ReviewerInterfaceProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  reviewableTypes: string[];\n  onCommentAdd?: (comment: ProjectComment) => void;\n}\n\nexport default function ReviewerInterface({\n  project,\n  currentUser,\n  reviewableTypes,\n  onCommentAdd,\n}: ReviewerInterfaceProps) {\n  const [sections, setSections] = useState<ProjectSection[]>([]);\n  const [comments, setComments] = useState<ProjectComment[]>([]);\n  const [selectedSectionId, setSelectedSectionId] = useState<number | null>(null);\n  const [newComment, setNewComment] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n  const [loading, setLoading] = useState(true);\n\n  // Load sections and comments\n  useEffect(() => {\n    loadContent();\n  }, [project.id]);\n\n  const loadContent = async () => {\n    setLoading(true);\n    try {\n      const [sectionsData, commentsData] = await Promise.all([\n        collaborationApi.getProjectSections(project.id),\n        collaborationApi.getComments(project.id),\n      ]);\n\n      // Filter sections to only those the reviewer can see\n      const filteredSections = sectionsData.filter((s: ProjectSection) =>\n        reviewableTypes.includes(s.section_type)\n      );\n      setSections(filteredSections);\n      setComments(commentsData);\n\n      if (filteredSections.length > 0) {\n        setSelectedSectionId(filteredSections[0].id);\n      }\n    } catch (err) {\n      console.error('Failed to load content:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const selectedSection = sections.find(s => s.id === selectedSectionId);\n  const sectionComments = comments.filter(c =>\n    !c.parent_comment // Only top-level comments for now\n  );\n\n  const handleSubmitComment = async () => {\n    if (!newComment.trim()) return;\n\n    setSubmitting(true);\n    try {\n      const comment = await collaborationApi.addComment({\n        project: project.id,\n        content: newComment,\n      });\n      setComments([...comments, comment]);\n      setNewComment('');\n      if (onCommentAdd) {\n        onCommentAdd(comment);\n      }\n    } catch (err) {\n      console.error('Failed to submit comment:', err);\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const getSectionIcon = (type: string) => {\n    switch (type) {\n      case 'text': return <FileText size={16} />;\n      case 'image': return <Image size={16} />;\n      case 'audio': return <Music size={16} />;\n      case 'video': return <Video size={16} />;\n      default: return <FileText size={16} />;\n    }\n  };\n\n  if (loading) {\n    return (\n      <div style={{ padding: 40, textAlign: 'center', color: '#94a3b8' }}>\n        Loading content...\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ display: 'grid', gridTemplateColumns: '250px 1fr 300px', gap: 20, height: '100%' }}>\n      {/* Section list */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        overflow: 'auto',\n      }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 16,\n          color: '#f8fafc',\n          fontWeight: 600,\n        }}>\n          <Eye size={18} />\n          Review Content\n        </div>\n\n        <div style={{ fontSize: 11, color: '#64748b', marginBottom: 12 }}>\n          You have read-only access to review the following content types: {reviewableTypes.join(', ')}\n        </div>\n\n        {sections.length === 0 ? (\n          <div style={{ color: '#64748b', fontSize: 13, textAlign: 'center', padding: 20 }}>\n            No content available for review yet.\n          </div>\n        ) : (\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\n            {sections.map(section => (\n              <button\n                key={section.id}\n                onClick={() => setSelectedSectionId(section.id)}\n                style={{\n                  display: 'flex',\n                  alignItems: 'center',\n                  gap: 10,\n                  padding: 12,\n                  background: selectedSectionId === section.id ? 'rgba(245,158,11,0.15)' : '#0f172a',\n                  border: `1px solid ${selectedSectionId === section.id ? '#f59e0b' : '#334155'}`,\n                  borderRadius: 8,\n                  cursor: 'pointer',\n                  textAlign: 'left',\n                }}\n              >\n                <span style={{ color: selectedSectionId === section.id ? '#f59e0b' : '#94a3b8' }}>\n                  {getSectionIcon(section.section_type)}\n                </span>\n                <div style={{ flex: 1, overflow: 'hidden' }}>\n                  <div style={{\n                    color: selectedSectionId === section.id ? '#f59e0b' : '#f8fafc',\n                    fontSize: 13,\n                    fontWeight: 600,\n                    overflow: 'hidden',\n                    textOverflow: 'ellipsis',\n                    whiteSpace: 'nowrap',\n                  }}>\n                    {section.title}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 11 }}>\n                    by @{section.owner_username}\n                  </div>\n                </div>\n              </button>\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Content viewer */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 20,\n        overflow: 'auto',\n      }}>\n        {selectedSection ? (\n          <>\n            <div style={{\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'space-between',\n              marginBottom: 16,\n              paddingBottom: 16,\n              borderBottom: '1px solid #334155',\n            }}>\n              <div>\n                <h3 style={{ color: '#f8fafc', margin: 0, fontSize: 18 }}>\n                  {selectedSection.title}\n                </h3>\n                <div style={{ color: '#64748b', fontSize: 12, marginTop: 4 }}>\n                  Written by @{selectedSection.owner_username}\n                </div>\n              </div>\n              <div style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                padding: '6px 12px',\n                background: 'rgba(16,185,129,0.15)',\n                borderRadius: 6,\n                color: '#10b981',\n                fontSize: 11,\n                fontWeight: 600,\n              }}>\n                <Eye size={14} />\n                Read Only\n              </div>\n            </div>\n\n            {/* Content display based on type */}\n            {selectedSection.section_type === 'text' && (\n              <div\n                style={{\n                  color: '#cbd5e1',\n                  fontSize: 15,\n                  lineHeight: 1.8,\n                }}\n                dangerouslySetInnerHTML={{ __html: sanitizeHtml(selectedSection.content_html) || '<em>No content yet</em>' }}\n              />\n            )}\n\n            {selectedSection.section_type === 'image' && selectedSection.media_file && (\n              <div style={{ textAlign: 'center' }}>\n                <img\n                  src={selectedSection.media_file}\n                  alt={selectedSection.title}\n                  style={{ maxWidth: '100%', borderRadius: 8 }}\n                />\n              </div>\n            )}\n\n            {selectedSection.section_type === 'audio' && selectedSection.media_file && (\n              <audio controls style={{ width: '100%' }}>\n                <source src={selectedSection.media_file} />\n                Your browser does not support the audio element.\n              </audio>\n            )}\n\n            {selectedSection.section_type === 'video' && selectedSection.media_file && (\n              <video controls style={{ width: '100%', borderRadius: 8 }}>\n                <source src={selectedSection.media_file} />\n                Your browser does not support the video element.\n              </video>\n            )}\n          </>\n        ) : (\n          <div style={{ color: '#64748b', textAlign: 'center', padding: 40 }}>\n            Select a section to review\n          </div>\n        )}\n      </div>\n\n      {/* Comments panel */}\n      <div style={{\n        background: '#1e293b',\n        borderRadius: 12,\n        padding: 16,\n        display: 'flex',\n        flexDirection: 'column',\n      }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 16,\n          color: '#f8fafc',\n          fontWeight: 600,\n        }}>\n          <MessageSquare size={18} />\n          Comments ({sectionComments.length})\n        </div>\n\n        {/* Comment list */}\n        <div style={{ flex: 1, overflow: 'auto', marginBottom: 16 }}>\n          {sectionComments.length === 0 ? (\n            <div style={{ color: '#64748b', fontSize: 13, textAlign: 'center', padding: 20 }}>\n              No comments yet. Be the first to leave feedback!\n            </div>\n          ) : (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n              {sectionComments.map(comment => (\n                <div\n                  key={comment.id}\n                  style={{\n                    padding: 12,\n                    background: '#0f172a',\n                    borderRadius: 8,\n                    borderLeft: comment.resolved ? '3px solid #10b981' : '3px solid #334155',\n                  }}\n                >\n                  <div style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                    marginBottom: 6,\n                  }}>\n                    <span style={{ color: '#f59e0b', fontWeight: 600, fontSize: 12 }}>\n                      @{comment.author_username}\n                    </span>\n                    {comment.resolved && (\n                      <span style={{\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: 4,\n                        color: '#10b981',\n                        fontSize: 10,\n                      }}>\n                        <CheckCircle size={12} />\n                        Resolved\n                      </span>\n                    )}\n                  </div>\n                  <div style={{ color: '#cbd5e1', fontSize: 13, lineHeight: 1.5 }}>\n                    {comment.content}\n                  </div>\n                  <div style={{ color: '#64748b', fontSize: 10, marginTop: 6 }}>\n                    {new Date(comment.created_at).toLocaleString()}\n                  </div>\n                </div>\n              ))}\n            </div>\n          )}\n        </div>\n\n        {/* New comment input */}\n        <div style={{\n          borderTop: '1px solid #334155',\n          paddingTop: 16,\n        }}>\n          <textarea\n            value={newComment}\n            onChange={(e) => setNewComment(e.target.value)}\n            placeholder=\"Leave feedback or suggestions...\"\n            style={{\n              width: '100%',\n              background: '#0f172a',\n              border: '1px solid #334155',\n              borderRadius: 8,\n              padding: 12,\n              color: '#f8fafc',\n              fontSize: 13,\n              fontFamily: 'inherit',\n              resize: 'none',\n              minHeight: 80,\n            }}\n          />\n          <button\n            onClick={handleSubmitComment}\n            disabled={submitting || !newComment.trim()}\n            style={{\n              width: '100%',\n              marginTop: 8,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              gap: 8,\n              padding: '10px 16px',\n              background: submitting || !newComment.trim() ? '#334155' : '#f59e0b',\n              border: 'none',\n              borderRadius: 8,\n              color: submitting || !newComment.trim() ? '#64748b' : '#000',\n              fontWeight: 600,\n              fontSize: 13,\n              cursor: submitting || !newComment.trim() ? 'not-allowed' : 'pointer',\n            }}\n          >\n            <Send size={14} />\n            {submitting ? 'Submitting...' : 'Submit Comment'}\n          </button>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React from 'react';\nimport {\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n  CollaboratorRole,\n} from '../../../services/collaborationApi';\nimport CollaborativeEditor from '../CollaborativeEditor';\nimport CollaborativeBookEditor from '../CollaborativeBookEditor';\nimport CollaborativeArtEditor from '../CollaborativeArtEditor';\nimport CollaborativeMusicEditor from '../CollaborativeMusicEditor';\nimport CollaborativeVideoEditor from '../CollaborativeVideoEditor';\nimport ReviewerInterface from '../ReviewerInterface';\nimport { Eye, Palette, Music, Video, FileText, AlertCircle } from 'lucide-react';\n\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\ninterface ContentTabProps {\n  project: CollaborativeProject;\n  currentUser: User;\n  onSectionUpdate?: (section: ProjectSection) => void;\n  onCommentAdd?: (comment: ProjectComment) => void;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\n// Helper to get user's effective permissions from their role\nfunction getEffectivePermissions(role: CollaboratorRole | undefined) {\n  if (!role) return null;\n\n  // Check new permissions structure first\n  const perms = role.effective_permissions || role.permissions;\n  if (perms && typeof perms === 'object' && Object.keys(perms).length > 0) {\n    return {\n      create: perms.create || [],\n      edit: perms.edit || { scope: 'none', types: [] },\n      review: perms.review || [],\n      ui_components: role.ui_components || [],\n    };\n  }\n\n  // Fallback to legacy boolean flags\n  const create: string[] = [];\n  const editTypes: string[] = [];\n  if (role.can_edit_text) {\n    create.push('text');\n    editTypes.push('text');\n  }\n  if (role.can_edit_images) {\n    create.push('image');\n    editTypes.push('image');\n  }\n  if (role.can_edit_audio) {\n    create.push('audio');\n    editTypes.push('audio');\n  }\n  if (role.can_edit_video) {\n    create.push('video');\n    editTypes.push('video');\n  }\n\n  return {\n    create,\n    edit: { scope: 'own', types: editTypes },\n    review: [],\n    ui_components: role.ui_components || [],\n  };\n}\n\n// Check if user is project owner (has full access)\nfunction isProjectOwner(project: CollaborativeProject, userId: number): boolean {\n  return project.created_by === userId;\n}\n\n// Determine what interface type to show based on permissions\nfunction getInterfaceType(permissions: ReturnType<typeof getEffectivePermissions>): 'creator' | 'reviewer' | 'none' {\n  if (!permissions) return 'none';\n\n  const isCreator =\n    permissions.create.length > 0 ||\n    (permissions.edit.types && permissions.edit.types.length > 0);\n\n  const isReviewer =\n    permissions.review.length > 0 && !isCreator;\n\n  if (isCreator) return 'creator';\n  if (isReviewer) return 'reviewer';\n  return 'none';\n}\n\nexport default function ContentTab({\n  project,\n  currentUser,\n  onSectionUpdate,\n  onCommentAdd,\n  onProjectUpdate,\n}: ContentTabProps) {\n  const collaborators = project.collaborators || [];\n  const currentUserRole = collaborators.find(c => c.user === currentUser.id);\n  const isOwner = isProjectOwner(project, currentUser.id);\n\n  // Owner sees everything - route by project type\n  if (isOwner) {\n    return renderByProjectType(project, currentUser, onSectionUpdate, onCommentAdd, onProjectUpdate);\n  }\n\n  // Non-owner: check permissions and render appropriate interface\n  const permissions = getEffectivePermissions(currentUserRole);\n  const interfaceType = getInterfaceType(permissions);\n\n  // No permissions - show access denied\n  if (interfaceType === 'none' || !permissions) {\n    return (\n      <div style={{\n        padding: 40,\n        textAlign: 'center',\n        color: '#94a3b8',\n      }}>\n        <AlertCircle size={48} style={{ marginBottom: 16, color: '#f59e0b' }} />\n        <h3 style={{ color: '#f8fafc', marginBottom: 8 }}>No Content Access</h3>\n        <p style={{ fontSize: 14 }}>\n          You don't have permission to view or edit content in this project yet.\n          <br />\n          Contact the project owner to update your permissions.\n        </p>\n      </div>\n    );\n  }\n\n  // Reviewer interface - read-only with commenting\n  if (interfaceType === 'reviewer') {\n    return (\n      <ReviewerInterface\n        project={project}\n        currentUser={currentUser}\n        reviewableTypes={permissions.review}\n        onCommentAdd={onCommentAdd}\n      />\n    );\n  }\n\n  // Creator interface - route based on what they can create/edit\n  const uiComponents = permissions.ui_components || [];\n\n  // Check what UI components this role should see\n  const hasChapterEditor = uiComponents.includes('chapter_editor') || permissions.create.includes('text') || permissions.edit.types?.includes('text');\n  const hasImageUploader = uiComponents.includes('image_uploader') || permissions.create.includes('image') || permissions.edit.types?.includes('image');\n  const hasAudioUploader = uiComponents.includes('audio_uploader') || permissions.create.includes('audio') || permissions.edit.types?.includes('audio');\n  const hasVideoUploader = uiComponents.includes('video_uploader') || permissions.create.includes('video') || permissions.edit.types?.includes('video');\n\n  // For roles like Illustrator on a book project: show art editor even though project is 'book'\n  // Route based on what the user can actually work with\n\n  // If they can edit text and project is book, show book editor\n  if (project.content_type === 'book' && hasChapterEditor) {\n    return (\n      <CollaborativeBookEditor\n        project={project}\n        currentUser={currentUser}\n        onProjectUpdate={onProjectUpdate}\n      />\n    );\n  }\n\n  // If they can only edit images (e.g., Illustrator on book project), show art editor\n  if (hasImageUploader && !hasChapterEditor && !hasAudioUploader && !hasVideoUploader) {\n    return (\n      <CollaborativeArtEditor\n        project={project}\n        currentUser={currentUser}\n        onProjectUpdate={onProjectUpdate}\n      />\n    );\n  }\n\n  // If they can edit audio (e.g., Narrator on book project), show audio interface\n  if (hasAudioUploader && !hasChapterEditor && !hasImageUploader && !hasVideoUploader) {\n    return (\n      <CollaborativeMusicEditor\n        project={project}\n        currentUser={currentUser}\n        onProjectUpdate={onProjectUpdate}\n      />\n    );\n  }\n\n  // If they can edit video, show video editor\n  if (hasVideoUploader && !hasChapterEditor && !hasImageUploader && !hasAudioUploader) {\n    return (\n      <CollaborativeVideoEditor\n        project={project}\n        currentUser={currentUser}\n        onProjectUpdate={onProjectUpdate}\n      />\n    );\n  }\n\n  // Mixed permissions or default: show hybrid interface with all allowed components\n  return (\n    <HybridCreatorInterface\n      project={project}\n      currentUser={currentUser}\n      permissions={permissions}\n      onProjectUpdate={onProjectUpdate}\n    />\n  );\n}\n\n// Helper: render based on project content type (for owner or fallback)\nfunction renderByProjectType(\n  project: CollaborativeProject,\n  currentUser: { id: number; username: string; display_name?: string },\n  onSectionUpdate?: (section: ProjectSection) => void,\n  onCommentAdd?: (comment: ProjectComment) => void,\n  onProjectUpdate?: (project: CollaborativeProject) => void\n) {\n  switch (project.content_type) {\n    case 'book':\n      return (\n        <CollaborativeBookEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'art':\n      return (\n        <CollaborativeArtEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'music':\n      return (\n        <CollaborativeMusicEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    case 'video':\n      return (\n        <CollaborativeVideoEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n\n    default:\n      return (\n        <CollaborativeEditor\n          project={project}\n          currentUser={currentUser}\n          onSectionUpdate={onSectionUpdate}\n          onCommentAdd={onCommentAdd}\n          onProjectUpdate={onProjectUpdate}\n        />\n      );\n  }\n}\n\n// Hybrid interface for users with multiple content type permissions\ninterface HybridCreatorInterfaceProps {\n  project: CollaborativeProject;\n  currentUser: { id: number; username: string; display_name?: string };\n  permissions: ReturnType<typeof getEffectivePermissions>;\n  onProjectUpdate?: (project: CollaborativeProject) => void;\n}\n\nfunction HybridCreatorInterface({\n  project,\n  currentUser,\n  permissions,\n  onProjectUpdate,\n}: HybridCreatorInterfaceProps) {\n  const [activeTab, setActiveTab] = React.useState<'text' | 'image' | 'audio' | 'video'>('text');\n\n  const hasText = permissions?.create.includes('text') || permissions?.edit.types?.includes('text');\n  const hasImage = permissions?.create.includes('image') || permissions?.edit.types?.includes('image');\n  const hasAudio = permissions?.create.includes('audio') || permissions?.edit.types?.includes('audio');\n  const hasVideo = permissions?.create.includes('video') || permissions?.edit.types?.includes('video');\n\n  // Set initial active tab based on what's available\n  React.useEffect(() => {\n    if (hasText) setActiveTab('text');\n    else if (hasImage) setActiveTab('image');\n    else if (hasAudio) setActiveTab('audio');\n    else if (hasVideo) setActiveTab('video');\n  }, [hasText, hasImage, hasAudio, hasVideo]);\n\n  const tabs = [\n    { key: 'text', label: 'Text', icon: <FileText size={16} />, available: hasText },\n    { key: 'image', label: 'Images', icon: <Palette size={16} />, available: hasImage },\n    { key: 'audio', label: 'Audio', icon: <Music size={16} />, available: hasAudio },\n    { key: 'video', label: 'Video', icon: <Video size={16} />, available: hasVideo },\n  ].filter(t => t.available);\n\n  return (\n    <div>\n      {/* Tab navigation for multiple content types */}\n      {tabs.length > 1 && (\n        <div style={{\n          display: 'flex',\n          gap: 8,\n          marginBottom: 16,\n          borderBottom: '1px solid #334155',\n          paddingBottom: 12,\n        }}>\n          {tabs.map(tab => (\n            <button\n              key={tab.key}\n              onClick={() => setActiveTab(tab.key as any)}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                padding: '8px 16px',\n                background: activeTab === tab.key ? 'rgba(245,158,11,0.15)' : 'transparent',\n                border: `1px solid ${activeTab === tab.key ? '#f59e0b' : '#334155'}`,\n                borderRadius: 8,\n                color: activeTab === tab.key ? '#f59e0b' : '#94a3b8',\n                fontSize: 13,\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              {tab.icon}\n              {tab.label}\n            </button>\n          ))}\n        </div>\n      )}\n\n      {/* Render appropriate editor based on active tab */}\n      {activeTab === 'text' && hasText && (\n        <CollaborativeBookEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'image' && hasImage && (\n        <CollaborativeArtEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'audio' && hasAudio && (\n        <CollaborativeMusicEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n      {activeTab === 'video' && hasVideo && (\n        <CollaborativeVideoEditor\n          project={project}\n          currentUser={currentUser}\n          onProjectUpdate={onProjectUpdate}\n        />\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport { API_URL } from '../config';\nimport TabNavigation, { TabId } from '../components/collaboration/tabs/TabNavigation';\nimport OverviewTab from '../components/collaboration/tabs/OverviewTab';\nimport TeamTab from '../components/collaboration/tabs/TeamTab';\nimport ActivityTab from '../components/collaboration/tabs/ActivityTab';\nimport PublishTab from '../components/collaboration/tabs/PublishTab';\nimport ContentTab from '../components/collaboration/tabs/ContentTab';\nimport {\n  collaborationApi,\n  CollaborativeProject,\n  ProjectSection,\n  ProjectComment,\n} from '../services/collaborationApi';\n\n// Simple User interface - in real app, get from auth context\ninterface User {\n  id: number;\n  username: string;\n  display_name?: string;\n}\n\nexport default function CollaborativeProjectPage() {\n  const { projectId } = useParams<{ projectId: string }>();\n  const navigate = useNavigate();\n  const [searchParams, setSearchParams] = useSearchParams();\n\n  const [project, setProject] = useState<CollaborativeProject | null>(null);\n  const [currentUser, setCurrentUser] = useState<User | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string>('');\n\n  // Title editing state\n  const [isEditingTitle, setIsEditingTitle] = useState(false);\n  const [editedTitle, setEditedTitle] = useState('');\n  const [savingTitle, setSavingTitle] = useState(false);\n\n  // Tab state from URL or default to 'overview'\n  const activeTab = (searchParams.get('tab') as TabId) || 'overview';\n\n  const setActiveTab = (tab: TabId) => {\n    setSearchParams({ tab });\n  };\n\n  useEffect(() => {\n    loadProjectAndUser();\n  }, [projectId]);\n\n  const loadProjectAndUser = async () => {\n    if (!projectId) {\n      setError('Invalid project ID');\n      setLoading(false);\n      return;\n    }\n\n    setLoading(true);\n    setError('');\n\n    try {\n      // Load project\n      const projectData = await collaborationApi.getCollaborativeProject(parseInt(projectId, 10));\n      setProject(projectData);\n\n      // Get current user from auth status\n      const authResponse = await fetch(`${API_URL}/api/auth/status/`, { credentials: 'include' });\n      const authData = await authResponse.json();\n\n      if (authData.authenticated && authData.user) {\n        setCurrentUser({\n          id: authData.user.id,\n          username: authData.user.username,\n          display_name: authData.user.display_name,\n        });\n      } else {\n        setError('You must be logged in to access this project');\n      }\n    } catch (err: any) {\n      setError(err.message || 'Failed to load project');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleSectionUpdate = (section: ProjectSection) => {\n    console.log('Section updated:', section);\n    // Optionally refresh project data\n  };\n\n  const handleCommentAdd = (comment: ProjectComment) => {\n    console.log('Comment added:', comment);\n    // Optionally refresh project data\n  };\n\n  const handleProjectUpdate = (updatedProject: CollaborativeProject) => {\n    console.log('Project updated:', updatedProject);\n    setProject(updatedProject);\n  };\n\n  // Save project title\n  const handleSaveTitle = async () => {\n    if (!project || !editedTitle.trim() || editedTitle.trim() === project.title) {\n      setIsEditingTitle(false);\n      return;\n    }\n\n    setSavingTitle(true);\n    try {\n      const csrfRes = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n      const csrfData = await csrfRes.json();\n      const csrf = csrfData?.csrfToken || '';\n\n      const res = await fetch(`${API_URL}/api/collaborative-projects/${project.id}/`, {\n        method: 'PATCH',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrf,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ title: editedTitle.trim() }),\n      });\n\n      if (res.ok) {\n        const updated = await res.json();\n        setProject(updated);\n        setIsEditingTitle(false);\n      } else {\n        const err = await res.json();\n        console.error('Failed to update title:', err);\n      }\n    } catch (err) {\n      console.error('Failed to update title:', err);\n    } finally {\n      setSavingTitle(false);\n    }\n  };\n\n  const startEditingTitle = () => {\n    setEditedTitle(project?.title || '');\n    setIsEditingTitle(true);\n  };\n\n  const cancelEditingTitle = () => {\n    setIsEditingTitle(false);\n    setEditedTitle('');\n  };\n\n  // Check if title is a placeholder\n  const isPlaceholderTitle = project?.title?.startsWith('Collaboration Invite');\n\n  if (loading) {\n    return (\n      <div className=\"page\" style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>\n        <div style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          height: '60vh',\n          color: '#94a3b8',\n          fontSize: 16,\n        }}>\n          Loading project...\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"page\" style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>\n        <div style={{\n          background: 'rgba(239, 68, 68, 0.1)',\n          border: '1px solid #ef4444',\n          borderRadius: 12,\n          padding: 24,\n          color: '#ef4444',\n          textAlign: 'center',\n        }}>\n          <div style={{ fontSize: 48, marginBottom: 16 }}>&#9888;&#65039;</div>\n          <div style={{ fontSize: 18, fontWeight: 600, marginBottom: 8 }}>\n            Error Loading Project\n          </div>\n          <div style={{ fontSize: 14, marginBottom: 24 }}>\n            {error}\n          </div>\n          <button\n            onClick={() => navigate('/collaborations')}\n            style={{\n              background: '#ef4444',\n              border: 'none',\n              borderRadius: 8,\n              padding: '10px 20px',\n              color: '#fff',\n              fontWeight: 600,\n              cursor: 'pointer',\n              fontSize: 14,\n            }}\n          >\n            Back to Dashboard\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!project || !currentUser) {\n    return null;\n  }\n\n  // Calculate badges for tabs\n  const unresolvedComments = project.recent_comments?.filter(c => !c.resolved).length || 0;\n  const pendingApprovals = project.collaborators?.filter(\n    c => c.status === 'accepted' && (!c.approved_current_version || !c.approved_revenue_split)\n  ).length || 0;\n\n  return (\n    <div className=\"page\" style={{ maxWidth: 1400, margin: '0 auto', padding: 24 }}>\n      {/* Header */}\n      <div style={{\n        display: 'flex',\n        justifyContent: 'space-between',\n        alignItems: 'flex-start',\n        marginBottom: 20,\n      }}>\n        <div>\n          <button\n            onClick={() => navigate('/collaborations')}\n            style={{\n              background: 'transparent',\n              border: '1px solid var(--panel-border)',\n              borderRadius: 8,\n              padding: '8px 16px',\n              color: 'var(--text)',\n              cursor: 'pointer',\n              fontSize: 14,\n              marginBottom: 12,\n            }}\n          >\n            &larr; Back to Dashboard\n          </button>\n          {/* Editable Title */}\n          {isEditingTitle ? (\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, marginBottom: 8 }}>\n              <input\n                type=\"text\"\n                value={editedTitle}\n                onChange={(e) => setEditedTitle(e.target.value)}\n                placeholder=\"Enter project title...\"\n                autoFocus\n                onKeyDown={(e) => {\n                  if (e.key === 'Enter') handleSaveTitle();\n                  if (e.key === 'Escape') cancelEditingTitle();\n                }}\n                style={{\n                  fontSize: 28,\n                  fontWeight: 700,\n                  background: 'var(--panel)',\n                  border: '2px solid #f59e0b',\n                  borderRadius: 8,\n                  padding: '8px 16px',\n                  color: 'var(--text)',\n                  minWidth: 400,\n                }}\n              />\n              <button\n                onClick={handleSaveTitle}\n                disabled={savingTitle || !editedTitle.trim()}\n                style={{\n                  background: '#10b981',\n                  border: 'none',\n                  borderRadius: 8,\n                  padding: '10px 20px',\n                  color: '#fff',\n                  fontWeight: 600,\n                  cursor: savingTitle ? 'not-allowed' : 'pointer',\n                  opacity: savingTitle ? 0.6 : 1,\n                }}\n              >\n                {savingTitle ? 'Saving...' : 'Save'}\n              </button>\n              <button\n                onClick={cancelEditingTitle}\n                style={{\n                  background: 'transparent',\n                  border: '1px solid var(--panel-border)',\n                  borderRadius: 8,\n                  padding: '10px 20px',\n                  color: '#94a3b8',\n                  cursor: 'pointer',\n                }}\n              >\n                Cancel\n              </button>\n            </div>\n          ) : (\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n              <h1 style={{\n                margin: 0,\n                fontSize: 28,\n                fontWeight: 700,\n                color: isPlaceholderTitle ? '#f59e0b' : 'var(--text)',\n              }}>\n                {project.title}\n              </h1>\n              {project.created_by === currentUser.id && (\n                <button\n                  onClick={startEditingTitle}\n                  title=\"Edit project title\"\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    padding: 4,\n                    cursor: 'pointer',\n                    fontSize: 18,\n                    color: '#94a3b8',\n                  }}\n                >\n                  ‚úèÔ∏è\n                </button>\n              )}\n            </div>\n          )}\n\n          {/* Placeholder title warning */}\n          {isPlaceholderTitle && !isEditingTitle && (\n            <div style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              marginTop: 8,\n              padding: '8px 12px',\n              background: 'rgba(245, 158, 11, 0.1)',\n              border: '1px solid #f59e0b',\n              borderRadius: 8,\n              fontSize: 13,\n              color: '#f59e0b',\n            }}>\n              <span>‚ö†Ô∏è</span>\n              <span>\n                {project.created_by === currentUser.id\n                  ? 'This project has a placeholder title. Click the edit button to set a proper title before publishing.'\n                  : 'This project has a placeholder title. Only the owner can change the title.'}\n              </span>\n            </div>\n          )}\n\n          <div style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 12,\n            marginTop: 8,\n          }}>\n            <span style={{\n              background: 'rgba(139, 92, 246, 0.1)',\n              color: '#8b5cf6',\n              padding: '4px 10px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n            }}>\n              {project.content_type.charAt(0).toUpperCase() + project.content_type.slice(1)} Project\n            </span>\n            <span style={{\n              background: project.status === 'ready_for_mint'\n                ? 'rgba(16, 185, 129, 0.1)'\n                : 'rgba(245, 158, 11, 0.1)',\n              color: project.status === 'ready_for_mint' ? '#10b981' : '#f59e0b',\n              padding: '4px 10px',\n              borderRadius: 6,\n              fontSize: 12,\n              fontWeight: 600,\n            }}>\n              {project.status.replace(/_/g, ' ').replace(/\\b\\w/g, c => c.toUpperCase())}\n            </span>\n          </div>\n        </div>\n      </div>\n\n      {/* Tab Navigation */}\n      <div style={{ marginBottom: 20 }}>\n        <TabNavigation\n          activeTab={activeTab}\n          onTabChange={setActiveTab}\n          badges={{\n            activity: unresolvedComments,\n            team: pendingApprovals,\n          }}\n          isFullyApproved={project.is_fully_approved}\n        />\n      </div>\n\n      {/* Tab Content */}\n      <div style={{ minHeight: '60vh' }}>\n        {activeTab === 'overview' && (\n          <OverviewTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'content' && (\n          <ContentTab\n            project={project}\n            currentUser={currentUser}\n            onSectionUpdate={handleSectionUpdate}\n            onCommentAdd={handleCommentAdd}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'team' && (\n          <TeamTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n\n        {activeTab === 'activity' && (\n          <ActivityTab project={project} currentUser={currentUser} />\n        )}\n\n        {activeTab === 'publish' && (\n          <PublishTab\n            project={project}\n            currentUser={currentUser}\n            onProjectUpdate={handleProjectUpdate}\n          />\n        )}\n      </div>\n    </div>\n  );\n}\n\n"],"names":["LayoutDashboard","createLucideIcon","width","height","x","y","rx","key","tabs","id","label","icon","jsx","size","FileText","Users","MessageSquare","Rocket","TabNavigation","activeTab","onTabChange","badges","isFullyApproved","style","display","gap","background","padding","borderRadius","border","children","map","tab","isActive","badge","activity","team","isPublishReady","jsxs","onClick","alignItems","color","cursor","fontSize","fontWeight","transition","position","minWidth","textAlign","COLORS","RevenueSplitChart","collaborators","centerX","centerY","radius","innerRadius","currentAngle","slices","collab","index","percentage","Number","revenue_percentage","startAngle","endAngle","length","polarToCartesian","cx","cy","r","angle","radians","Math","PI","cos","sin","createArc","outerR","innerR","start","end","startInner","endInner","largeArc","viewBox","slice","d","fill","stroke","strokeWidth","onMouseEnter","e","target","opacity","onMouseLeave","username","textAnchor","flexDirection","flexShrink","flex","role","toFixed","OverviewTab","project","currentUser","onProjectUpdate","isEditingDescription","setIsEditingDescription","useState","description","setDescription","isProjectLead","created_by","acceptedCollaborators","_a","filter","c","status","totalApproved","approved_current_version","approved_revenue_split","gridTemplateColumns","gridColumn","justifyContent","marginBottom","margin","value","onChange","placeholder","minHeight","lineHeight","resize","marginTop","fontStyle","paddingTop","borderTop","created_by_username","Date","created_at","toLocaleDateString","year","month","day","content_type","charAt","toUpperCase","reduce","sum","is_fully_approved","round","overflow","hasApproved","user","StatCard","_b","sections","_c","recent_comments","_d","progress_percentage","TeamOverview","projectCreatorId","getCollaboratorProgress","collaborator","assignedSections","s","owner","completedSections","content_html","trim","assigned","completed","getStatusBadge","progress","deadline","delivery_deadline","now","daysRemaining","ceil","getTime","days","abs","getDeadlineStatus","text","bg","remaining","statusBadge","isOwner","isLead","is_lead","borderLeft","whiteSpace","title","Fragment","flexWrap","StatusBadge","isOverdue","config","pending","in_progress","complete","signed_off","cancelled","async","fetchCsrf","res","fetch","API_URL","credentials","data","json","csrfToken","TaskTracker","collaboratorRole","currentUserId","isProjectOwner","projectId","onTaskUpdate","expandedTasks","setExpandedTasks","Set","loading","setLoading","error","setError","completionNotes","setCompletionNotes","signoffNotes","setSignoffNotes","rejectionReason","setRejectionReason","isOwnTasks","tasks","contract_tasks","toggleExpand","taskId","prev","next","has","delete","add","all_tasks_complete","tasks_signed_off","tasks_total","has_active_breach","task","isExpanded","canMarkComplete","canSignOff","canReject","isLoadingThis","is_overdue","days_until_deadline","textTransform","completion_notes","marked_complete_by_username","signoff_notes","signed_off_by_username","rejection_notes","csrf","method","headers","body","JSON","stringify","ok","err","message","handleMarkComplete","disabled","handleSignOff","rejection_reason","handleReject","TeamTab","showInviteForm","setShowInviteForm","inviteUserId","setInviteUserId","inviteRole","setInviteRole","invitePercentage","setInvitePercentage","inviteError","setInviteError","inviting","setInviting","availablePercentage","type","marginLeft","min","max","perm","userId","parseInt","isNaN","collaborationApi","inviteCollaborator","user_id","can_edit_text","can_edit_images","can_edit_audio","can_edit_video","updatedProject","getCollaborativeProject","overflowX","borderCollapse","borderBottom","PermissionBadge","allowed","can_edit","includes","can_invite_others","some","proposed_percentage","textDecoration","counter_message","projectStates","Map","getProjectState","set","activities","onlineUsers","currentlyEditing","lastUpdated","isPolling","get","CONFIG","pollingIntervals","retryCounts","getFreshCsrfToken","response","API_BASE","apiRequest","url","options","errorData","catch","Error","detail","getProjectActivities","limit","state","events","emit","getOnlineUsers","users","is_online","last_seen","getCurrentlyEditing","editing","sendHeartbeat","pollActivity","Promise","all","retryCount","stopPolling","interval","clearInterval","constructor","__publicField","this","on","event","handler","listeners","off","handlers","forEach","clear","getActivityIcon","section_updated","comment_added","collaborator_joined","collaborator_left","approval_given","approval_requested","ready_for_mint","project_minted","media_uploaded","invitation_sent","getActivityColor","getTimeAgo","dateString","date","seconds","floor","activityService","startEditingSection","sectionId","section_id","stopEditingSection","logActivity","activityType","metadata","activity_type","startPolling","setInterval","getState","getCachedActivities","getCachedOnlineUsers","getCachedCurrentlyEditing","reset","resetAll","isUserEditingSection","getEditorsForSection","useActivity","autoStart","onNewActivity","setActivities","setOnlineUsers","setCurrentlyEditing","isLoading","setIsLoading","setIsPolling","currentEditingSectionRef","useRef","refresh","useCallback","activitiesData","onlineUsersData","editingData","startEditing","current","stopEditing","startPollingCallback","stopPollingCallback","isUserOnline","u","isSectionBeingEdited","useEffect","unsubActivities","pid","acts","unsubNew","unsubOnlineUsers","unsubEditing","unsubPollingStarted","unsubPollingStopped","unsubPollingError","useComments","includeResolved","pollingInterval","flatComments","setFlatComments","comments","setComments","commentsBySection","setCommentsBySection","unresolvedCount","setUnresolvedCount","totalCount","setTotalCount","tree","commentMap","rootComments","comment","replies","commentWithReplies","parent_comment","parent","push","buildCommentTree","grouped","general","section","toString","groupCommentsBySection","resolved","fetchedComments","getComments","addComment","content","mentions","attachments","parentCommentId","commentSectionId","newComment","updateComment","commentId","updatedComment","deleteComment","resolveComment","unresolveComment","unresolved","addReaction","emoji","reaction","reactions","removeReaction","reactionId","getCommentById","find","getReplies","ActivityFeed","maxItems","showAvatar","compact","displayActivities","ActivityItem","timeAgo","currentTarget","borderLeftColor","avatar","bottom","right","section_title","replace","CommentComposer","autoFocus","onSubmit","onCancel","initialValue","submitButtonText","setContent","setMentions","setAttachments","isSubmitting","setIsSubmitting","showMentions","setShowMentions","mentionQuery","setMentionQuery","mentionSuggestions","setMentionSuggestions","selectedMentionIndex","setSelectedMentionIndex","mentionStart","setMentionStart","textareaRef","fileInputRef","allSuggestions","displayName","display_name","insertMention","suggestion","beforeMention","afterCursor","selectionStart","newContent","setTimeout","newPosition","setSelectionRange","focus","handleSubmit","ref","cursorPosition","textBeforeCursor","lastAtSymbol","lastIndexOf","textAfterAt","query","toLowerCase","filtered","onKeyDown","preventDefault","metaKey","ctrlKey","maxHeight","outline","fontFamily","left","maxWidth","boxShadow","overflowY","zIndex","textOverflow","file","name","_","i","removeAttachment","multiple","files","newFiles","Array","from","click","navigator","platform","AVAILABLE_EMOJIS","CommentReactions","onReaction","onRemoveReaction","showPicker","setShowPicker","isAdding","setIsAdding","pickerRef","groupedReactions","hasUserReacted","handleEmojiClick","existingReaction","handleClickOutside","contains","document","addEventListener","removeEventListener","Object","entries","hasReacted","join","transform","borderColor","CommentThread","depth","maxDepth","onReply","onEdit","onDelete","onResolve","onUnresolve","showReplyComposer","setShowReplyComposer","showEditComposer","setShowEditComposer","showMenu","setShowMenu","showEditHistory","setShowEditHistory","isAuthor","author","canReply","author_avatar","author_username","edited","edit_history","resolved_by_username","top","confirm","edit","edited_at","toLocaleString","handleEdit","attachment","href","file_url","rel","filename","file_size","reply","ActivityTab","activeView","setActiveView","showResolvedComments","setShowResolvedComments","commentsLoading","checked","parentId","PublishTab","step","setStep","minting","setMinting","saving","setSaving","teaserPercent","setTeaserPercent","teaser_percent","watermark","setWatermark","watermark_preview","price","setPrice","parseFloat","String","price_usd","editions","setEditions","authorsNote","setAuthorsNote","authors_note","currentUserRole","titleValid","Boolean","startsWith","hasContentSections","textSections","section_type","hasValidTextContent","mediaSections","hasValidMediaContent","media_file","priceValid","editionsValid","collaboratorsWithTasks","allTasksSignedOff","every","incompleteTaskCount","checklistItems","hint","allChecked","item","steps","stepIndex","findIndex","userEstimatedEarnings","isCurrent","isCompleted","canClick","placeItems","CustomizeStep","onNext","updateCustomization","authorName","ApproveStep","onApproveVersion","approveCurrentVersion","onApproveRevenue","approveProject","approve_content","approve_revenue","MintStep","onMint","mintProject","ShareStep","wordCount","split","w","isOverLimit","CopyrightPreview","userHasApproved","agree","setAgree","gross","platformFee","net","projectUrl","window","location","origin","copied","setCopied","readOnly","clipboard","writeText","encodeURIComponent","OnlineStatus","showLabel","showLastSeen","isOnline","lastSeen","dotSize","small","medium","large","EditingIndicator","editors","editor","othersCount","animation","ApprovalRequestModal","pendingCollaborators","onClose","selectedCollaborators","setSelectedCollaborators","setMessage","setDeadline","stopPropagation","newSelected","handleToggleCollaborator","onFocus","onBlur","alert","IndividualApprovalView","onApprove","approveContent","setApproveContent","approveRevenue","setApproveRevenue","feedback","setFeedback","currentUserCollab","hasAlreadyApproved","canApprove","totalSections","totalRevenue","revenueSplitsCorrect","_e","_f","isCurrentUser","STAGES","validating","uploading","creating_contract","finalizing","MintingProgressModal","onComplete","currentStage","setCurrentStage","nftData","setNftData","stageOrder","currentStageIndex","indexOf","timer","currentIndex","tokenId","random","contractAddress","ipfsHash","clearTimeout","handleClose","stage","isPending","wordBreak","MintingWorkflow","onApprovalRequest","showApprovalRequestModal","setShowApprovalRequestModal","showApprovalView","setShowApprovalView","showMintingProgress","setShowMintingProgress","checklist","setChecklist","isProjectCreator","approvedCollaborators","hasUserApproved","approvalProgress","items","hasContent","allSectionsComplete","required","allCollaboratorsAccepted","allApproved","allRequiredChecked","canRequestApproval","canMint","canForceMint","backgroundColor","approved","CollaborativeEditor","onSectionUpdate","onCommentAdd","setSections","setCollaborators","currentlyEditingSection","setCurrentlyEditingSection","lastSaved","setLastSaved","showCommentInput","setShowCommentInput","showInviteModal","setShowInviteModal","showPreview","setShowPreview","showActivityFeed","setShowActivityFeed","setActiveTab","commentTotalCount","canEditSectionType","sectionType","ownsSection","loadSections","loadedSections","getProjectSections","handleReplyComment","parent_comment_id","getSectionTypeBadgeColor","approvalStatus","total","project_status","float","paddingBottom","substring","comment_id","result","token_id","SectionEditor","sectionNumber","canEdit","isEditing","onStartEdit","onStopEdit","onUpdate","updates","updatedSection","updateProjectSection","handleUpdateSection","deleteProjectSection","handleDeleteSection","onMediaUpload","handleMediaUpload","canAdd","newSection","createProjectSection","order","handleAddSection","formatTimeAgo","setTitle","isBeingEditedByOthers","getSectionColor","getSectionIcon","owner_username","ReactQuill","theme","modules","toolbar","header","list","src","alt","controls","accept","dangerouslySetInnerHTML","__html","sanitizeHtml","minutes","hours","CollaborativeBookEditor","chapters","setChapters","selectedChapterId","setSelectedChapterId","canEditText","loadChapters","sort","a","b","synopsis","selectedChapter","ch","canEditSelectedChapter","newChapter","chapter","isSelected","ChapterEditor","chapterId","updateData","updated","handleUpdateChapter","handleDeleteChapter","setSynopsis","showSynopsis","setShowSynopsis","maxLength","CollaborativeArtEditor","artPieces","setArtPieces","selectedPieceId","setSelectedPieceId","setUploading","canEditImages","loadArtPieces","imageSections","selectedPiece","p","canEditSelectedPiece","newPiece","piece","backgroundImage","backgroundSize","backgroundPosition","pieceId","handleUpdateTitle","handleDelete","objectFit","CollaborativeMusicEditor","tracks","setTracks","selectedTrackId","setSelectedTrackId","playing","setPlaying","currentTime","setCurrentTime","duration","setDuration","audioRef","canEditAudio","loadTracks","audioSections","formatTime","padStart","selectedTrack","t","canEditSelectedTrack","match","newTrack","track","onTimeUpdate","onLoadedMetadata","onEnded","trackId","pause","play","time","accentColor","CollaborativeVideoEditor","clips","setClips","selectedClipId","setSelectedClipId","videoRef","canEditVideo","loadClips","videoSections","togglePlay","selectedClip","canEditSelectedClip","newClip","clip","clipId","fullscreenElement","exitFullscreen","requestFullscreen","ReviewerInterface","reviewableTypes","selectedSectionId","setSelectedSectionId","setNewComment","submitting","setSubmitting","loadContent","sectionsData","commentsData","filteredSections","selectedSection","sectionComments","Image","Music","Video","Eye","CheckCircle","Send","ContentTab","renderByProjectType","permissions","perms","effective_permissions","keys","create","scope","types","review","ui_components","editTypes","getEffectivePermissions","interfaceType","isCreator","isReviewer","getInterfaceType","AlertCircle","uiComponents","hasChapterEditor","hasImageUploader","hasAudioUploader","hasVideoUploader","HybridCreatorInterface","React","hasText","hasImage","hasAudio","hasVideo","available","Palette","CollaborativeProjectPage","useParams","navigate","useNavigate","searchParams","setSearchParams","useSearchParams","setProject","setCurrentUser","isEditingTitle","setIsEditingTitle","editedTitle","setEditedTitle","savingTitle","setSavingTitle","loadProjectAndUser","projectData","authResponse","authData","authenticated","handleProjectUpdate","handleSaveTitle","csrfRes","csrfData","cancelEditingTitle","isPlaceholderTitle","className","unresolvedComments","pendingApprovals"],"mappings":"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","x_google_ignoreList":[0]}