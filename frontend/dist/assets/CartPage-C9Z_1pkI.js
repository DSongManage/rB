import{j as e}from"./web3auth-BkZxjmxM.js";import{r as t,a as r}from"./router-cVcvJ1e3.js";import{c as n,d as i,W as a,s as o,V as s,X as l,e as d,i as c,t as p,w as x,Y as g,H as m,B as u,A as h,Z as y,_ as f,$ as b}from"./index-Clb-55uW.js";import{I as v,C as j}from"./info-DRgV8fDi.js";import{C as w}from"./credit-card-BdLjyy9K.js";import{R as C,B as S}from"./BalanceDisplay-Bf6KbNXu.js";import{L as k}from"./loader-circle-Cr8Dfevu.js";import{C as z}from"./circle-alert-qhyYh1Bv.js";import{C as I}from"./circle-check-Koaxwtap.js";import{E as _}from"./external-link-CedBgNxg.js";import{A as R}from"./arrow-left-Cx3lpWdl.js";import{T as E}from"./trash-2-CuRyvxhn.js";import{S as W}from"./shield-BwXZwLwT.js";import"./vendor-Cfs_Iq82.js";
/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const P=n("qr-code",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]);function B({intent:r,onSelect:n,loading:o=!1,selectedMethod:s=null}){const[l,d]=t.useState(!1);r.payment_options.find(e=>"coinbase"===e.method);const c=t=>{switch(t){case"balance":default:return e.jsx(a,{size:20});case"coinbase":return e.jsx(w,{size:20});case"direct_crypto":return e.jsx(P,{size:20})}},p=(e,t)=>{const r={display:"flex",alignItems:"center",gap:"14px",padding:"16px",borderRadius:"12px",cursor:e.available&&!o?"pointer":"not-allowed",opacity:e.available?1:.5,transition:"all 0.2s ease",border:"2px solid"};return t?{...r,backgroundColor:"rgba(59, 130, 246, 0.1)",borderColor:"var(--accent, #3b82f6)"}:e.primary&&e.available?{...r,backgroundColor:"rgba(59, 130, 246, 0.05)",borderColor:"var(--border, #334155)"}:{...r,backgroundColor:"var(--bg-secondary, #1e293b)",borderColor:"var(--border, #334155)"}};return e.jsxs("div",{className:"rb-payment-options",style:{display:"flex",flexDirection:"column",gap:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 16px",backgroundColor:"var(--bg-tertiary, #0f172a)",borderRadius:"8px",fontSize:"14px"},children:[e.jsx("span",{style:{color:"var(--text-muted, #94a3b8)"},children:"Current Balance"}),e.jsx("span",{style:{fontWeight:600,color:"var(--text-primary, #f1f5f9)"},children:r.balance.display})]}),e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"10px"},children:r.payment_options.map(t=>{const r=s===t.method;return e.jsxs("div",{children:[e.jsxs("button",{onClick:()=>t.available&&!o&&n(t.method),disabled:!t.available||o,style:p(t,r),children:[e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"40px",height:"40px",borderRadius:"10px",backgroundColor:r?"var(--accent, #3b82f6)":"var(--bg-tertiary, #0f172a)",color:r?"white":"var(--text-muted, #94a3b8)"},children:c(t.method)}),e.jsxs("div",{style:{flex:1,textAlign:"left"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"4px"},children:[e.jsx("span",{style:{fontWeight:600,fontSize:"15px",color:"var(--text-primary, #f1f5f9)"},children:t.label}),t.primary&&t.available&&e.jsx("span",{style:{fontSize:"11px",fontWeight:500,padding:"2px 6px",borderRadius:"4px",backgroundColor:"rgba(34, 197, 94, 0.1)",color:"#22c55e"},children:"Recommended"})]}),e.jsx("span",{style:{fontSize:"13px",color:"var(--text-muted, #94a3b8)"},children:t.description})]}),e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:"24px",height:"24px",borderRadius:"12px",backgroundColor:r?"var(--accent, #3b82f6)":"transparent",border:r?"none":"2px solid var(--border, #334155)"},children:r&&e.jsx(i,{size:14,color:"white"})})]}),"coinbase"===t.method&&t.explanation&&e.jsxs("div",{style:{marginTop:"8px",marginLeft:"54px",padding:"10px 12px",backgroundColor:"rgba(59, 130, 246, 0.05)",borderRadius:"8px",border:"1px solid rgba(59, 130, 246, 0.2)",display:"flex",alignItems:"flex-start",gap:"8px"},children:[e.jsx(v,{size:16,style:{color:"var(--accent, #3b82f6)",flexShrink:0,marginTop:"2px"}}),e.jsx("span",{style:{fontSize:"13px",color:"var(--text-secondary, #cbd5e1)",lineHeight:1.5},children:t.explanation})]})]},t.method)})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px",backgroundColor:"var(--bg-tertiary, #0f172a)",borderRadius:"8px",marginTop:"8px",borderTop:"1px solid var(--border, #334155)"},children:[e.jsx("span",{style:{fontWeight:500,color:"var(--text-primary, #f1f5f9)"},children:"Total"}),e.jsx("span",{style:{fontWeight:700,fontSize:"18px",color:"var(--text-primary, #f1f5f9)"},children:r.display_total})]}),r.balance.sufficient&&r.balance.after_purchase&&e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"10px 16px",fontSize:"13px",color:"var(--text-muted, #94a3b8)"},children:[e.jsx("span",{children:"Balance after purchase"}),e.jsxs("span",{style:{fontWeight:500},children:["$",parseFloat(r.balance.after_purchase).toFixed(2)]})]})]})}var L,T,O=Object.defineProperty,A=(e,t)=>O(e,"name",{value:t,configurable:!0}),N=(e,t,r)=>(((e,t,r)=>{t in e?O(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r})(e,"symbol"!=typeof t?t+"":t,r),r),M="https://pay.coinbase.com",F=A(({host:e=M,...t})=>{const r=new URL(e);if(r.pathname="/buy/select-asset",t.destinationWallets&&t.addresses)throw new Error("Only one of destinationWallets or addresses can be provided");if(!t.destinationWallets&&!t.addresses)throw new Error("One of destinationWallets or addresses must be provided");return Object.keys(t).forEach(e=>{const n=t[e];void 0!==n&&(["string","number","boolean"].includes(typeof n)?r.searchParams.append(e,n.toString()):r.searchParams.append(e,JSON.stringify(n)))}),r.searchParams.sort(),r.toString()},"generateOnRampURL"),D="cbpay-embedded-onramp",U=A(({url:e,width:t="100%",height:r="100%",position:n="fixed",top:i="0px"})=>{const a=document.createElement("iframe");return a.style.border="unset",a.style.borderWidth="0",a.style.width=t.toString(),a.style.height=r.toString(),a.style.position=n,a.style.top=i,a.id=D,a.src=e,a},"createEmbeddedContent");(T=L||(L={})).LaunchEmbedded="launch_embedded",T.AppReady="app_ready",T.AppParams="app_params",T.SigninSuccess="signin_success",T.Success="success",T.Exit="exit",T.Event="event",T.Error="error",T.PixelReady="pixel_ready",T.OnAppParamsNonce="on_app_params_nonce";var $=A((e,{onMessage:t,shouldUnsubscribe:r=!0,allowedOrigin:n,onValidateOrigin:i=A(()=>Promise.resolve(!0),"onValidateOrigin")})=>{const a=A(o=>{const{eventName:s,data:l}=H(o.data),d=!n||o.origin===n;s===e&&(async()=>{d&&await i(o.origin)&&(t(l),r&&window.removeEventListener("message",a))})()},"onMessage");return window.addEventListener("message",a),()=>{window.removeEventListener("message",a)}},"onBroadcastedPostMessage"),q=A((e,t,{allowedOrigin:r="*",data:n}={})=>{const i=Y(t,n);e.postMessage(i,r)},"broadcastPostMessage"),H=A(e=>{try{return JSON.parse(e)}catch{return{eventName:e}}},"parsePostMessage"),Y=A((e,t)=>t?JSON.stringify({eventName:e,data:t}):e,"formatPostMessage"),J=A(({host:e=M,...t})=>{const r=new URL(e);return r.pathname="/v3/sell/input",Object.keys(t).forEach(e=>{const n=t[e];void 0!==n&&(["string","number","boolean"].includes(typeof n)?r.searchParams.append(e,n.toString()):r.searchParams.append(e,JSON.stringify(n)))}),r.searchParams.sort(),r.toString()},"generateOffRampURL"),V={width:460,height:730},G={width:430,height:600},Q=class{constructor({host:e=M,appId:t,appParams:r,debug:n,theme:i}){N(this,"debug"),N(this,"host"),N(this,"appId"),N(this,"eventStreamListeners",{}),N(this,"unsubs",[]),N(this,"appParams"),N(this,"removeEventListener"),N(this,"theme"),N(this,"openExperience",A(e=>{var t,r,n,i;this.log("Attempting to open experience"),this.setupExperienceListeners(e);const{experienceLoggedIn:a,experienceLoggedOut:o,embeddedContentStyles:s}=e,l=o||a;let d="";if(d="/v3/sell"===e.path?J({appId:this.appId,host:this.host,theme:this.theme??void 0,...this.appParams}):F({appId:this.appId,host:this.host,theme:this.theme??void 0,...this.appParams}),this.log("Opening experience",{experience:l}),"embedded"===l){this.log("DEPRECATION WARNING: Two factor authentication does not work in an iframe, so the embedded experience should not be used. It will be removed in a future release");const e=A(()=>{var e;const t=U({url:d,...s});(null==s?void 0:s.target)?null==(e=document.querySelector(null==s?void 0:s.target))||e.replaceChildren(t):document.body.appendChild(t)},"openEmbeddedExperience");this.startDirectSignin(e)}else"popup"===l&&(null==(r=null==(t=window.chrome)?void 0:t.windows)?void 0:r.create)?window.chrome.windows.create({url:d,setSelfAsOpener:!0,type:"popup",focused:!0,width:V.width,height:V.height,left:window.screenLeft-V.width-10,top:window.screenTop},e=>{const t=A(()=>{(null==e?void 0:e.id)&&(chrome.windows.update(e.id,{width:G.width,height:G.height,left:window.screenLeft-G.width-10,top:window.screenTop}),this.removeEventStreamListener("open",t))},"onOpenCallback");this.addEventStreamListener("open",t)}):"new_tab"===l&&(null==(i=null==(n=window.chrome)?void 0:n.tabs)?void 0:i.create)?window.chrome.tabs.create({url:d}):Z(d,l)},"openExperience")),N(this,"endExperience",A(()=>{var e;null==(e=document.getElementById(D))||e.remove()},"endExperience")),N(this,"destroy",A(()=>{this.unsubs.forEach(e=>e())},"destroy")),N(this,"setupExperienceListeners",A(({onSuccess:e,onExit:t,onEvent:r,onRequestedUrl:n})=>{this.removeEventListener&&this.removeEventListener(),this.removeEventListener=this.onMessage("event",{shouldUnsubscribe:!1,onMessage:i=>{var a;const o=i;null==(a=this.eventStreamListeners[o.eventName])||a.forEach(e=>null==e?void 0:e()),"success"===o.eventName&&(null==e||e()),"exit"===o.eventName&&(null==t||t(o.error)),"request_open_url"===o.eventName&&(null==n||n(o.url)),null==r||r(i)}})},"setupExperienceListeners")),N(this,"startDirectSignin",A(e=>{const t=new URLSearchParams;t.set("appId",this.appId),t.set("type","direct");const r=Z(`${this.host}/signin?${t.toString()}`,"popup");this.onMessage("signin_success",{onMessage:()=>{null==r||r.close(),e()}})},"startDirectSignin")),N(this,"addEventStreamListener",A((e,t)=>{var r;this.eventStreamListeners[e]?null==(r=this.eventStreamListeners[e])||r.push(t):this.eventStreamListeners[e]=[t]},"addEventStreamListener")),N(this,"removeEventStreamListener",A((e,t)=>{var r;if(this.eventStreamListeners[e]){const n=null==(r=this.eventStreamListeners[e])?void 0:r.filter(e=>e!==t);this.eventStreamListeners[e]=n}},"removeEventStreamListener")),N(this,"onMessage",A((...e)=>{const t=$(e[0],{allowedOrigin:this.host,...e[1]});return this.unsubs.push(t),t},"onMessage")),N(this,"log",A((...e)=>{this.debug},"log")),this.host=e,this.appId=t,this.appParams=r,this.debug=n||!1,this.theme=i}};function Z(e,t){return window.open(e,"Coinbase","popup"===t?`toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, height=${V.height},width=${V.width}`:void 0)}A(Q,"CoinbasePixel"),A(Z,"openWindow");var K={buy:"/buy",checkout:"/checkout",sell:"/v3/sell"},X=class{constructor(e){if(N(this,"pixel"),N(this,"options"),N(this,"open",A(()=>{const{widget:e,experienceLoggedIn:t,experienceLoggedOut:r,embeddedContentStyles:n,onExit:i,onSuccess:a,onEvent:o,onRequestedUrl:s,closeOnSuccess:l,closeOnExit:d}=this.options;this.pixel.openExperience({path:K[e],experienceLoggedIn:t,experienceLoggedOut:r,embeddedContentStyles:n,onExit:()=>{null==i||i(),d&&this.pixel.endExperience()},onSuccess:()=>{null==a||a(),l&&this.pixel.endExperience()},onRequestedUrl:s,onEvent:o})},"open")),N(this,"destroy",A(()=>{this.pixel.destroy()},"destroy")),this.options=e,this.pixel=new Q({...e,appParams:{widget:e.widget,...e.appParams}}),e.target){const t=document.querySelector(e.target);t&&t.addEventListener("click",this.open)}}};A(X,"CBPayInstance");var ee=A(({experienceLoggedIn:e="new_tab",widgetParameters:t,...r},n)=>{n(null,new X({...r,widget:"buy",experienceLoggedIn:e,appParams:t}))},"initOnRamp");function te({intentId:r,onSuccess:n,onCancel:i,onError:a}){const[c,p]=t.useState("loading"),[x,g]=t.useState(null),[m,u]=t.useState(null),[h,y]=t.useState(null),f=t.useRef(null),{forceSync:b}=o();t.useEffect(()=>{(async()=>{try{p("loading");const e=await s.initiateCoinbaseOnramp(r);g(e),p("ready")}catch(e){const t=e instanceof Error?e.message:"Failed to initialize payment";u(t),p("error"),a(t)}})()},[r,a]);const v=t.useCallback(e=>{const t=setInterval(async()=>{try{const r=await s.getCoinbaseStatus(e);"completed"===r.status?(clearInterval(t),y(null),p("success"),await b(),await s.completeCoinbaseOnramp(e),setTimeout(()=>{n()},1500)):"failed"===r.status&&(clearInterval(t),y(null),u(r.failure_reason||"Payment failed"),p("error"))}catch(r){}},3e3);y(t)},[b,n]);t.useEffect(()=>()=>{h&&clearInterval(h),f.current&&f.current.destroy()},[h]);const j=t.useCallback(()=>{if(!x)return u("Payment config not ready"),void p("error");const{widget_config:e}=x;try{ee({appId:e.appId,widgetParameters:{destinationWallets:e.destinationWallets,presetCryptoAmount:e.presetCryptoAmount,defaultNetwork:e.defaultNetwork,defaultExperience:"buy",handlingRequestedUrls:e.handlingRequestedUrls,partnerUserId:e.partnerUserId,...e.sessionToken&&{sessionToken:e.sessionToken}},onSuccess:()=>{p("processing"),v(x.transaction_id)},onExit:e=>{e||i()},onEvent:e=>{var t;if("error"===e.eventName){u((null==(t=e.error)?void 0:t.message)||"Payment error occurred"),p("error")}},experienceLoggedIn:"popup"},(e,t)=>{if(e)return u(e.message||"Failed to initialize payment widget"),void p("error");t&&(f.current=t,t.open())})}catch(t){const e=t instanceof Error?t.message:"Failed to open payment widget";u(e),p("error")}},[x,i,v,c]);return t.useEffect(()=>{if("ready"===c&&x){const e=setTimeout(()=>{j()},500);return()=>clearTimeout(e)}},[c,j,x]),e.jsxs("div",{className:"rb-coinbase-onramp",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:[e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"420px",width:"100%",border:"1px solid var(--border, #334155)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:600,color:"var(--text-primary, #f1f5f9)"},children:"Add Funds"}),"processing"!==c&&"success"!==c&&e.jsx("button",{onClick:i,style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",color:"var(--text-muted, #94a3b8)"},children:e.jsx(l,{size:20})})]}),e.jsxs("div",{style:{textAlign:"center"},children:["loading"===c&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:48,style:{color:"var(--accent, #3b82f6)",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Preparing secure payment..."})]}),"ready"===c&&e.jsxs(e.Fragment,{children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"16px",backgroundColor:"rgba(59, 130, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx(w,{size:32,style:{color:"var(--accent, #3b82f6)"}})}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 16px"},children:"Opening secure payment window..."}),x&&e.jsx("p",{style:{fontSize:"14px",color:"var(--text-muted, #94a3b8)",margin:0,padding:"12px",backgroundColor:"var(--bg-secondary, #1e293b)",borderRadius:"8px"},children:x.explanation}),e.jsxs("button",{onClick:j,style:{marginTop:"16px",padding:"12px 24px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",gap:"8px",margin:"16px auto 0"},children:[e.jsx(w,{size:18}),"Open Payment Window"]})]}),"processing"===c&&e.jsxs(e.Fragment,{children:[e.jsx(k,{size:48,style:{color:"var(--accent, #3b82f6)",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Processing Payment"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Your funds are being added to your account..."}),e.jsx("p",{style:{fontSize:"13px",color:"var(--text-muted, #94a3b8)",margin:"16px 0 0"},children:"This usually takes 10-30 seconds"})]}),"success"===c&&e.jsxs(e.Fragment,{children:[e.jsx(d,{size:48,style:{color:"#22c55e",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Funds Added!"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Completing your purchase..."})]}),"error"===c&&e.jsxs(e.Fragment,{children:[e.jsx(z,{size:48,style:{color:"var(--error, #ef4444)",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Payment Issue"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 16px"},children:m||"Something went wrong with your payment."}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsxs("button",{onClick:()=>{p("loading"),u(null),s.initiateCoinbaseOnramp(r).then(e=>{g(e),p("ready")}).catch(e=>{u(e.message),p("error")})},style:{padding:"10px 20px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx(C,{size:16}),"Try Again"]}),e.jsx("button",{onClick:i,style:{padding:"10px 20px",backgroundColor:"var(--bg-secondary, #1e293b)",color:"var(--text-primary, #f1f5f9)",border:"1px solid var(--border, #334155)",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Cancel"})]})]})]})]}),e.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "})]})}function re({intentId:r,onSuccess:n,onCancel:a,onError:o}){const[p,x]=t.useState("loading"),[g,m]=t.useState(null),[u,h]=t.useState(null),[y,f]=t.useState(null),[b,v]=t.useState(0),w=t.useRef(null),C=t.useRef(null);t.useEffect(()=>{(async()=>{try{x("loading");const e=await s.initiateDirectCrypto(r);m(e),v(e.expires_in_seconds),x("awaiting")}catch(e){const t=e instanceof Error?e.message:"Failed to initialize payment";h(t),x("error"),o(t)}})()},[r,o]);const S=t.useCallback(async()=>{if(g)try{const e=await s.getDirectCryptoStatus(g.payment_id);switch(e.status){case"detected":x("detected");break;case"confirming":x("confirming");break;case"completed":x("completed"),w.current&&clearInterval(w.current),setTimeout(()=>{n()},1500);break;case"expired":x("expired"),w.current&&clearInterval(w.current);break;case"failed":x("error"),h(e.failure_reason||"Payment failed"),w.current&&clearInterval(w.current)}}catch(e){}},[g,n]);t.useEffect(()=>{if("awaiting"===p||"detected"===p||"confirming"===p)return w.current=setInterval(S,5e3),()=>{w.current&&clearInterval(w.current)}},[p,S]),t.useEffect(()=>{if("awaiting"===p&&b>0)return C.current=setInterval(()=>{v(e=>e<=1?(x("expired"),C.current&&clearInterval(C.current),0):e-1)},1e3),()=>{C.current&&clearInterval(C.current)}},[p,b]),t.useEffect(()=>()=>{w.current&&clearInterval(w.current),C.current&&clearInterval(C.current)},[]);const I=async(e,t)=>{try{await navigator.clipboard.writeText(e),f(t),setTimeout(()=>f(null),2e3)}catch(r){}};return e.jsxs("div",{className:"rb-direct-crypto-modal",style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:[e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"480px",width:"100%",maxHeight:"90vh",overflow:"auto",border:"1px solid var(--border, #334155)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:600,color:"var(--text-primary, #f1f5f9)"},children:"Pay with Crypto Wallet"}),("awaiting"===p||"loading"===p||"error"===p||"expired"===p)&&e.jsx("button",{onClick:async()=>{if(g&&"awaiting"===p)try{await s.cancelDirectCrypto(g.payment_id)}catch(e){}a()},style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",color:"var(--text-muted, #94a3b8)"},children:e.jsx(l,{size:20})})]}),"loading"===p&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(k,{size:48,style:{color:"var(--accent, #3b82f6)",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Generating payment details..."})]}),"awaiting"===p&&g&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"12px",backgroundColor:b<60?"rgba(239, 68, 68, 0.1)":"var(--bg-secondary, #1e293b)",borderRadius:"8px",marginBottom:"20px",color:b<60?"var(--error, #ef4444)":"var(--text-secondary, #cbd5e1)"},children:[e.jsx(c,{size:18}),e.jsxs("span",{style:{fontSize:"14px"},children:["Payment expires in ",e.jsx("strong",{children:(_=b,`${Math.floor(_/60)}:${(_%60).toString().padStart(2,"0")}`)})]})]}),e.jsx("p",{style:{fontSize:"14px",color:"var(--text-secondary, #cbd5e1)",marginBottom:"20px",lineHeight:1.6},children:g.instructions}),g.qr_code_data&&e.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:"24px"},children:e.jsx("div",{style:{padding:"16px",backgroundColor:"white",borderRadius:"12px"},children:e.jsx("img",{src:g.qr_code_data,alt:"Payment QR Code",style:{width:"160px",height:"160px",display:"block"}})})}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"16px"},children:[e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--text-muted, #94a3b8)",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Amount (USDC)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:"var(--bg-secondary, #1e293b)",borderRadius:"8px",border:"1px solid var(--border, #334155)"},children:[e.jsx("span",{style:{flex:1,fontSize:"18px",fontWeight:700,color:"var(--text-primary, #f1f5f9)"},children:g.display_amount}),e.jsxs("button",{onClick:()=>I(g.expected_amount,"amount"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",backgroundColor:"amount"===y?"rgba(34, 197, 94, 0.1)":"var(--bg-tertiary, #0f172a)",border:"none",borderRadius:"6px",cursor:"pointer",color:"amount"===y?"#22c55e":"var(--text-muted, #94a3b8)",fontSize:"13px"},children:["amount"===y?e.jsx(i,{size:14}):e.jsx(j,{size:14}),"amount"===y?"Copied":"Copy"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--text-muted, #94a3b8)",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Send To Address"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:"var(--bg-secondary, #1e293b)",borderRadius:"8px",border:"1px solid var(--border, #334155)"},children:[e.jsx("span",{style:{flex:1,fontSize:"13px",fontFamily:"monospace",color:"var(--text-primary, #f1f5f9)",wordBreak:"break-all"},children:g.payment_address}),e.jsxs("button",{onClick:()=>I(g.payment_address,"address"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",backgroundColor:"address"===y?"rgba(34, 197, 94, 0.1)":"var(--bg-tertiary, #0f172a)",border:"none",borderRadius:"6px",cursor:"pointer",color:"address"===y?"#22c55e":"var(--text-muted, #94a3b8)",fontSize:"13px",flexShrink:0},children:["address"===y?e.jsx(i,{size:14}):e.jsx(j,{size:14}),"address"===y?"Copied":"Copy"]})]})]}),e.jsxs("div",{children:[e.jsx("label",{style:{display:"block",fontSize:"12px",fontWeight:500,color:"var(--text-muted, #94a3b8)",marginBottom:"6px",textTransform:"uppercase",letterSpacing:"0.5px"},children:"Memo (Required)"}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",padding:"12px",backgroundColor:"rgba(234, 179, 8, 0.1)",borderRadius:"8px",border:"1px solid rgba(234, 179, 8, 0.3)"},children:[e.jsx("span",{style:{flex:1,fontSize:"16px",fontWeight:600,fontFamily:"monospace",color:"var(--text-primary, #f1f5f9)"},children:g.payment_memo}),e.jsxs("button",{onClick:()=>I(g.payment_memo,"memo"),style:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",backgroundColor:"memo"===y?"rgba(34, 197, 94, 0.1)":"var(--bg-tertiary, #0f172a)",border:"none",borderRadius:"6px",cursor:"pointer",color:"memo"===y?"#22c55e":"var(--text-muted, #94a3b8)",fontSize:"13px",flexShrink:0},children:["memo"===y?e.jsx(i,{size:14}):e.jsx(j,{size:14}),"memo"===y?"Copied":"Copy"]})]}),e.jsx("p",{style:{fontSize:"12px",color:"#eab308",margin:"8px 0 0"},children:"Include this memo in your transaction to identify your payment"})]})]}),e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",marginTop:"24px",padding:"12px",backgroundColor:"var(--bg-secondary, #1e293b)",borderRadius:"8px",color:"var(--text-muted, #94a3b8)",fontSize:"14px"},children:[e.jsx(k,{size:16,style:{animation:"spin 1s linear infinite"}}),"Waiting for payment..."]})]}),("detected"===p||"confirming"===p)&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(k,{size:48,style:{color:"#22c55e",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"detected"===p?"Payment Detected!":"Confirming Transaction..."}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"detected"===p?"We found your payment. Confirming on the blockchain...":"Almost done. Finalizing your purchase..."})]}),"completed"===p&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(d,{size:48,style:{color:"#22c55e",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Payment Complete!"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Your purchase is being processed..."})]}),"expired"===p&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(c,{size:48,style:{color:"var(--text-muted, #94a3b8)",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Payment Expired"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 16px"},children:"The payment window has expired. Please try again."}),e.jsx("button",{onClick:a,style:{padding:"12px 24px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",fontSize:"15px",fontWeight:600,cursor:"pointer"},children:"Start Over"})]}),"error"===p&&e.jsxs("div",{style:{textAlign:"center",padding:"40px 0"},children:[e.jsx(z,{size:48,style:{color:"var(--error, #ef4444)",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Payment Issue"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 16px"},children:u||"Something went wrong with your payment."}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>{x("loading"),h(null),s.initiateDirectCrypto(r).then(e=>{m(e),v(e.expires_in_seconds),x("awaiting")}).catch(e=>{h(e.message),x("error")})},style:{padding:"10px 20px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Try Again"}),e.jsx("button",{onClick:a,style:{padding:"10px 20px",backgroundColor:"var(--bg-secondary, #1e293b)",color:"var(--text-primary, #f1f5f9)",border:"1px solid var(--border, #334155)",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Cancel"})]})]})]}),e.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "})]});var _}function ne(){const{cart:n,loading:i,error:d,removeFromCart:c,clearCart:v,refreshCart:j}=p(),{forceSync:w}=o(),[C,P]=t.useState(null),L=r(),[T,O]=t.useState("idle"),[A,N]=t.useState(null),[M,F]=t.useState(null),[D,U]=t.useState(null),[$,q]=t.useState(""),[H,Y]=t.useState(null),[J,V]=t.useState(null),[G,Q]=t.useState(!1);async function Z(){await v(),await w(),O("success")}function K(){O("idle"),N(null),F(null)}function X(e){U(e),O("error")}function ee(){O("idle"),N(null),F(null),U(null),Y(null),V(null),q("")}return i?e.jsxs("div",{className:"rb-cart-page rb-cart-page--loading",style:{padding:"60px 20px",textAlign:"center",color:"var(--text-muted, #94a3b8)"},children:[e.jsx(x,{size:48,style:{opacity:.5,marginBottom:"16px"}}),e.jsx("div",{children:"Loading cart..."})]}):"success"===T?e.jsx("div",{className:"rb-cart-page rb-cart-page--success",style:{padding:"60px 20px",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"440px",width:"100%",textAlign:"center",border:"1px solid var(--border, #334155)"},children:[e.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",backgroundColor:"rgba(34, 197, 94, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx(I,{size:36,style:{color:"#22c55e"}})}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"22px",margin:"0 0 8px"},children:"Purchase Complete!"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 20px"},children:"Your items have been added to your library."}),H&&e.jsxs("a",{href:g(H),target:"_blank",rel:"noopener noreferrer",style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:"10px 16px",backgroundColor:"var(--bg-secondary, #1e293b)",border:"1px solid var(--border, #334155)",borderRadius:"8px",color:"var(--text-muted, #94a3b8)",fontSize:"13px",textDecoration:"none",marginBottom:"20px"},children:[e.jsx("span",{children:"View on Solana Explorer"}),e.jsx(_,{size:14})]}),e.jsxs("div",{style:{backgroundColor:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.2)",borderRadius:"8px",padding:"12px 16px",marginBottom:"24px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(m,{size:16,style:{color:"#22c55e"}}),e.jsx("span",{style:{color:"#22c55e",fontSize:"14px",fontWeight:500},children:"You supported the creators!"})]}),e.jsxs("button",{onClick:()=>{ee(),L("/")},style:{width:"100%",padding:"14px 24px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(u,{size:18}),"Go to Library"]})]})}):"error"===T?e.jsx("div",{className:"rb-cart-page rb-cart-page--error",style:{padding:"60px 20px",display:"flex",alignItems:"center",justifyContent:"center",minHeight:"60vh"},children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"100%",textAlign:"center",border:"1px solid var(--border, #334155)"},children:[e.jsx(z,{size:48,style:{color:"var(--error, #ef4444)",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Payment Failed"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:"0 0 24px"},children:D||"Something went wrong with your payment."}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"center"},children:[e.jsx("button",{onClick:()=>{U(null),O("selecting_method")},style:{padding:"10px 20px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Try Again"}),e.jsx("button",{onClick:ee,style:{padding:"10px 20px",backgroundColor:"var(--bg-secondary, #1e293b)",color:"var(--text-primary, #f1f5f9)",border:"1px solid var(--border, #334155)",borderRadius:"8px",fontSize:"14px",fontWeight:500,cursor:"pointer"},children:"Cancel"})]})]})}):n&&0!==n.item_count?e.jsxs("div",{className:"rb-cart-page",style:{maxWidth:"900px",margin:"0 auto",padding:"40px 20px"},children:[e.jsxs("div",{className:"rb-cart-header",style:{marginBottom:"32px"},children:[e.jsx("h1",{style:{fontSize:"28px",fontWeight:700,marginBottom:"8px"},children:"Shopping Cart"}),e.jsxs("p",{style:{color:"var(--text-muted, #94a3b8)"},children:[n.item_count," ",1===n.item_count?"item":"items"," in your cart"]})]}),e.jsxs("div",{className:"rb-cart-grid",children:[e.jsxs("div",{className:"rb-cart-items","data-tour":"cart-items",children:[n.items.map(t=>{let r=null;return t.cover_url&&(r=t.cover_url.startsWith("http")?t.cover_url:`${h}${t.cover_url}`),e.jsxs("div",{className:"rb-cart-item",style:{opacity:C===t.id?.5:1,transition:"opacity 0.2s ease"},children:[e.jsx("div",{className:"rb-cart-item-cover",children:r?e.jsx("img",{src:r,alt:t.title}):e.jsx(u,{size:32,style:{color:"var(--text-muted, #64748b)",opacity:.5}})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsx("h3",{style:{fontSize:"16px",fontWeight:600,marginBottom:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:t.title}),t.book_title&&e.jsxs("p",{style:{fontSize:"13px",color:"var(--text-muted, #94a3b8)",marginBottom:"4px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[t.book_title," â€¢ Chapter ",t.chapter_order]}),e.jsxs("p",{style:{fontSize:"13px",color:"var(--text-muted, #64748b)"},children:["By @",t.creator_username]})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",justifyContent:"space-between",flexShrink:0},children:[e.jsxs("span",{style:{fontSize:"18px",fontWeight:600,color:"var(--accent, #3b82f6)"},children:["$",t.unit_price]}),e.jsx("button",{onClick:()=>async function(e){P(e),await c(e),P(null)}(t.id),disabled:C===t.id,style:{padding:"8px",backgroundColor:"transparent",color:"var(--text-error, #ef4444)",border:"1px solid var(--text-error, #ef4444)",borderRadius:"8px",cursor:"pointer",opacity:C===t.id?.5:1},title:"Remove from cart",children:e.jsx(E,{size:16})})]})]},t.id)}),e.jsx("button",{onClick:async function(){window.confirm("Remove all items from your cart?")&&await v()},style:{alignSelf:"flex-start",padding:"8px 16px",backgroundColor:"transparent",color:"var(--text-muted, #94a3b8)",border:"1px solid var(--border, #334155)",borderRadius:"6px",fontSize:"13px",cursor:"pointer",marginTop:"8px"},children:"Clear Cart"})]}),e.jsxs("div",{className:"rb-cart-summary","data-tour":"cart-summary",children:[e.jsx("h2",{style:{fontSize:"18px",fontWeight:600,marginBottom:"20px"},children:"Order Summary"}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"12px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsxs("span",{style:{color:"var(--text-muted, #94a3b8)"},children:[n.item_count," ",1===n.item_count?"item":"items"]}),e.jsxs("span",{children:["$",n.subtotal]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:"16px",borderTop:"1px solid var(--border, #334155)",fontSize:"20px",fontWeight:700},children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{style:{color:"var(--accent, #3b82f6)"},children:["$",n.subtotal]})]})]}),d&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"16px",padding:"12px",backgroundColor:"var(--bg-error, #450a0a)",border:"1px solid var(--border-error, #ef4444)",borderRadius:"8px",color:"var(--text-error, #fca5a5)",fontSize:"14px"},children:[e.jsx(z,{size:16}),d]}),e.jsxs("label",{className:"rb-terms-checkbox",style:{display:"flex",alignItems:"flex-start",gap:"10px",marginBottom:"16px",padding:"12px",borderRadius:"8px",border:"1px solid var(--border, #334155)",cursor:"pointer",fontSize:"13px",lineHeight:"1.5"},children:[e.jsx("input",{type:"checkbox",checked:G,onChange:e=>Q(e.target.checked),style:{width:"18px",height:"18px",marginTop:"2px",flexShrink:0,accentColor:"var(--accent, #3b82f6)",cursor:"pointer"}}),e.jsxs("span",{style:{color:"var(--text-secondary)"},children:["I understand that ",e.jsx("strong",{style:{color:"var(--text-primary)"},children:"all purchases are final"}),". Payments are processed in USDC (a digital dollar) on the Solana blockchain and are irreversible. By checking this box, I agree to the"," ",e.jsx("a",{href:"/terms",target:"_blank",rel:"noopener noreferrer",style:{color:"var(--accent, #3b82f6)",textDecoration:"underline"},onClick:e=>e.stopPropagation(),children:"Terms of Service"}),"."]})]}),e.jsx("button",{onClick:async function(){O("creating_intent"),U(null);try{const e=await s.createIntent({cart:!0});N(e),O("selecting_method")}catch(e){const t=e instanceof Error?e.message:"Failed to start checkout";U(t),O("error")}},disabled:!G||"idle"!==T,"data-tour":"checkout-button",style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px",padding:"16px 24px",backgroundColor:G&&"idle"===T?"var(--accent, #3b82f6)":"var(--bg-disabled, #475569)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:600,cursor:G&&"idle"===T?"pointer":"not-allowed",transition:"background-color 0.2s ease"},children:"creating_intent"===T?e.jsxs(e.Fragment,{children:[e.jsx(k,{size:20,style:{animation:"spin 1s linear infinite"}}),"Loading..."]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{size:20}),"Checkout - $",n.subtotal]})}),e.jsxs("div",{style:{marginTop:"20px",padding:"16px",backgroundColor:"var(--chip-bg)",borderRadius:"10px",fontSize:"13px"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:"8px"},children:[e.jsx(m,{size:16,style:{color:"var(--text-success, #10b981)"}}),e.jsx("span",{style:{fontWeight:600,color:"var(--text-success, #10b981)"},children:"Supporting Creators"})]}),e.jsx("p",{style:{color:"var(--text-muted)",lineHeight:"1.5"},children:"Creators receive 90% of each item's price. Your purchase directly supports the creators you love."})]}),e.jsx("div",{style:{marginTop:"12px"},children:e.jsx(S,{size:"small",showLabel:!0,compact:!1})})]})]}),"selecting_method"===T&&A&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"480px",width:"100%",maxHeight:"90vh",overflow:"auto",border:"1px solid var(--border, #334155)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"},children:[e.jsx("h2",{style:{margin:0,fontSize:"20px",fontWeight:600,color:"var(--text-primary, #f1f5f9)"},children:"Choose Payment Method"}),e.jsx("button",{onClick:K,style:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px",backgroundColor:"transparent",border:"none",borderRadius:"8px",cursor:"pointer",color:"var(--text-muted, #94a3b8)"},children:e.jsx(l,{size:20})})]}),e.jsx(B,{intent:A,onSelect:async function(e){if(A){F(e),U(null);try{if(await s.selectPaymentMethod(A.intent_id,e),"balance"===e){q("Verifying wallet connection...");await y();O("confirm_balance"),V({amount:A.total_amount})}else"coinbase"===e?O("coinbase"):"direct_crypto"===e&&O("direct_crypto")}catch(t){const e=t instanceof Error?t.message:"Failed to select payment method";U(e),O("error")}}},loading:!1,selectedMethod:M})]})}),"confirm_balance"===T&&A&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsx("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"440px",width:"100%",border:"1px solid var(--border, #334155)"},children:J?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{textAlign:"center",marginBottom:"24px"},children:[e.jsx("div",{style:{width:"56px",height:"56px",borderRadius:"50%",backgroundColor:"rgba(59, 130, 246, 0.15)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:e.jsx(W,{size:28,style:{color:"#3b82f6"}})}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"20px",margin:"0 0 8px"},children:"Confirm Payment"}),e.jsx("p",{style:{color:"var(--text-secondary, #94a3b8)",margin:0,fontSize:"14px"},children:"Review your purchase details before signing"})]}),e.jsxs("div",{style:{backgroundColor:"var(--bg-secondary, #1e293b)",borderRadius:"12px",padding:"16px",marginBottom:"20px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsx("span",{style:{color:"var(--text-muted, #94a3b8)",fontSize:"14px"},children:"Items"}),e.jsxs("span",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"14px"},children:[(null==n?void 0:n.item_count)||1," ",1===((null==n?void 0:n.item_count)||1)?"item":"items"]})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"12px"},children:[e.jsx("span",{style:{color:"var(--text-muted, #94a3b8)",fontSize:"14px"},children:"Amount"}),e.jsxs("span",{style:{color:"var(--accent, #3b82f6)",fontSize:"18px",fontWeight:700},children:["$",J.amount," USDC"]})]}),e.jsx("div",{style:{borderTop:"1px solid var(--border, #334155)",paddingTop:"12px",marginTop:"4px"},children:e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx("span",{style:{color:"var(--text-muted, #94a3b8)",fontSize:"13px"},children:"Network Fee"}),e.jsx("span",{style:{color:"var(--text-success, #22c55e)",fontSize:"13px",fontWeight:500},children:"FREE (paid by platform)"})]})})]}),e.jsxs("div",{style:{backgroundColor:"rgba(34, 197, 94, 0.1)",border:"1px solid rgba(34, 197, 94, 0.2)",borderRadius:"8px",padding:"12px",marginBottom:"24px",display:"flex",alignItems:"center",gap:"10px"},children:[e.jsx(m,{size:18,style:{color:"#22c55e",flexShrink:0}}),e.jsx("span",{style:{color:"var(--text-secondary, #cbd5e1)",fontSize:"13px"},children:"90% goes directly to the creators"})]}),e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("button",{onClick:K,style:{flex:1,padding:"14px 20px",backgroundColor:"var(--bg-secondary, #1e293b)",color:"var(--text-primary, #f1f5f9)",border:"1px solid var(--border, #334155)",borderRadius:"10px",fontSize:"15px",fontWeight:500,cursor:"pointer"},children:"Cancel"}),e.jsxs("button",{onClick:async function(){if(A){O("signing"),q("Preparing transaction...");try{const e=await s.payWithBalance(A.intent_id),t=await f(),r=e.user_pubkey;if(t.toBase58()!==r)throw new Error("Wallet mismatch: Your Web3Auth login method may have changed. Please use the same login method (Google, email, etc.) you originally signed up with. If issue persists, logout completely and login again using your original method.");q("Please approve in your wallet...");const{signedTransaction:n,userSignatureIndex:i}=await b(e.serialized_transaction);O("submitting"),q("Submitting to blockchain...");const a=await s.submitSponsoredPayment(A.intent_id,n,i);Y(a.signature),await v(),await w(),O("success")}catch(e){const r=e instanceof Error?e.message:"Payment failed";if((r.includes("Failed to fetch")||r.includes("network")||r.includes("timeout")||r.includes("NetworkError"))&&A)try{q("Connection lost. Checking transaction status..."),await new Promise(e=>setTimeout(e,2e3));const e=await s.getIntentStatus(A.intent_id);if("completed"===e.status||"payment_received"===e.status)return e.solana_tx_signature&&Y(e.solana_tx_signature),await v(),await w(),void O("success");if("processing"===e.status){q("Transaction submitted. Waiting for confirmation...");for(let e=0;e<5;e++){await new Promise(e=>setTimeout(e,3e3));const e=await s.getIntentStatus(A.intent_id);if("completed"===e.status||"payment_received"===e.status)return e.solana_tx_signature&&Y(e.solana_tx_signature),await v(),await w(),void O("success");if("failed"===e.status)return U(e.failure_reason||"Payment failed after submission"),void O("error")}return await v(),await w(),void O("success")}}catch(t){}U(r),O("error")}}},style:{flex:2,padding:"14px 20px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"10px",fontSize:"15px",fontWeight:600,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px"},children:[e.jsx(a,{size:18}),"Sign & Pay"]})]})]}):e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx(k,{size:48,style:{color:"var(--accent, #3b82f6)",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"Preparing Transaction"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:"Setting up your payment..."})]})})}),("signing"===T||"submitting"===T)&&e.jsx("div",{style:{position:"fixed",inset:0,backgroundColor:"rgba(0, 0, 0, 0.85)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3,padding:"20px"},children:e.jsxs("div",{style:{backgroundColor:"var(--bg-primary, #0f172a)",borderRadius:"16px",padding:"32px",maxWidth:"400px",width:"100%",textAlign:"center",border:"1px solid var(--border, #334155)"},children:[e.jsx(k,{size:48,style:{color:"var(--accent, #3b82f6)",animation:"spin 1s linear infinite",marginBottom:"16px"}}),e.jsx("h3",{style:{color:"var(--text-primary, #f1f5f9)",fontSize:"18px",margin:"0 0 8px"},children:"signing"===T?"Awaiting Signature":"Processing Payment"}),e.jsx("p",{style:{color:"var(--text-secondary, #cbd5e1)",margin:0},children:$}),"signing"===T&&e.jsx("p",{style:{color:"var(--text-muted, #64748b)",margin:"16px 0 0",fontSize:"13px"},children:"Check for a Web3Auth popup window"})]})}),"coinbase"===T&&A&&e.jsx(te,{intentId:A.intent_id,onSuccess:Z,onCancel:K,onError:X}),"direct_crypto"===T&&A&&e.jsx(re,{intentId:A.intent_id,onSuccess:Z,onCancel:K,onError:X}),e.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n\n        /* Terms checkbox - theme aware using existing CSS variables */\n        .rb-terms-checkbox {\n          background-color: var(--chip-bg);\n        }\n\n        /* Cart grid layout - desktop */\n        .rb-cart-grid {\n          display: grid;\n          grid-template-columns: 1fr 340px;\n          gap: 32px;\n        }\n\n        /* Cart items list */\n        .rb-cart-items {\n          display: flex;\n          flex-direction: column;\n          gap: 12px;\n        }\n\n        /* Individual cart item */\n        .rb-cart-item {\n          display: flex;\n          gap: 16px;\n          padding: 16px;\n          background-color: var(--bg-secondary, #1e293b);\n          border-radius: 12px;\n          border: 1px solid var(--border, #334155);\n        }\n\n        /* Cart item cover image */\n        .rb-cart-item-cover {\n          width: 80px;\n          height: 100px;\n          flex-shrink: 0;\n          border-radius: 8px;\n          overflow: hidden;\n          background-color: var(--bg-tertiary, #0f172a);\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .rb-cart-item-cover img {\n          width: 100%;\n          height: 100%;\n          object-fit: cover;\n        }\n\n        /* Order summary panel */\n        .rb-cart-summary {\n          padding: 24px;\n          background-color: var(--bg-secondary, #1e293b);\n          border-radius: 16px;\n          border: 1px solid var(--border, #334155);\n          height: fit-content;\n          position: sticky;\n          top: 100px;\n        }\n\n        /* Mobile responsive styles */\n        @media (max-width: 768px) {\n          .rb-cart-page {\n            padding: 20px 16px !important;\n          }\n\n          .rb-cart-header {\n            margin-bottom: 20px !important;\n          }\n\n          .rb-cart-header h1 {\n            font-size: 22px !important;\n          }\n\n          .rb-cart-grid {\n            grid-template-columns: 1fr;\n            gap: 20px;\n          }\n\n          .rb-cart-items {\n            gap: 10px;\n          }\n\n          .rb-cart-item {\n            gap: 12px;\n            padding: 12px;\n          }\n\n          .rb-cart-item-cover {\n            width: 60px;\n            height: 75px;\n          }\n\n          .rb-cart-summary {\n            padding: 16px;\n            position: static;\n            order: -1;\n          }\n\n          .rb-cart-summary h2 {\n            font-size: 16px !important;\n            margin-bottom: 16px !important;\n          }\n        }\n\n        /* Extra small mobile */\n        @media (max-width: 400px) {\n          .rb-cart-page {\n            padding: 16px 12px !important;\n          }\n\n          .rb-cart-item {\n            gap: 10px;\n            padding: 10px;\n          }\n\n          .rb-cart-item-cover {\n            width: 50px;\n            height: 65px;\n          }\n\n          .rb-cart-summary {\n            padding: 14px;\n          }\n        }\n      "})]}):e.jsxs("div",{className:"rb-cart-page rb-cart-page--empty",style:{padding:"60px 20px",textAlign:"center",maxWidth:"500px",margin:"0 auto"},children:[e.jsx(x,{size:64,style:{opacity:.3,marginBottom:"24px"}}),e.jsx("h1",{style:{fontSize:"24px",fontWeight:700,marginBottom:"12px"},children:"Your Cart is Empty"}),e.jsx("p",{style:{color:"var(--text-muted, #94a3b8)",marginBottom:"32px"},children:"Browse chapters and add them to your cart to purchase multiple items at once."}),e.jsxs("button",{onClick:()=>L("/"),style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"14px 28px",backgroundColor:"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"10px",fontSize:"16px",fontWeight:600,cursor:"pointer"},children:[e.jsx(R,{size:18}),"Browse Marketplace"]})]})}A(function(e,t){q(e,"event",{data:t})},"broadcastEvent");export{ne as default};
