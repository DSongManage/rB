{"version":3,"file":"bridgeApi-kBR9Jg8d.js","sources":["../../node_modules/lucide-react/dist/esm/icons/building-2.js","../../node_modules/lucide-react/dist/esm/icons/wallet.js","../../src/services/bridgeApi.ts"],"sourcesContent":["/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10 12h4\", key: \"a56b0p\" }],\n  [\"path\", { d: \"M10 8h4\", key: \"1sr2af\" }],\n  [\"path\", { d: \"M14 21v-3a2 2 0 0 0-4 0v3\", key: \"1rgiei\" }],\n  [\n    \"path\",\n    {\n      d: \"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2\",\n      key: \"secmi2\"\n    }\n  ],\n  [\"path\", { d: \"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16\", key: \"16ra0t\" }]\n];\nconst Building2 = createLucideIcon(\"building-2\", __iconNode);\n\nexport { __iconNode, Building2 as default };\n//# sourceMappingURL=building-2.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1\",\n      key: \"18etb6\"\n    }\n  ],\n  [\"path\", { d: \"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4\", key: \"xoc0q4\" }]\n];\nconst Wallet = createLucideIcon(\"wallet\", __iconNode);\n\nexport { __iconNode, Wallet as default };\n//# sourceMappingURL=wallet.js.map\n","/**\n * Bridge.xyz API service for USDC -> USD off-ramp functionality.\n *\n * Provides methods for:\n * - Customer/KYC management\n * - Bank account linking\n * - Liquidation address management\n * - Payout preferences\n * - Payout history\n */\n\nimport { API_URL } from '../config';\nimport type {\n  BridgeOnboardingStatus,\n  BridgeCustomerResponse,\n  KYCLinkResponse,\n  KYCStatusResponse,\n  ExternalAccountsResponse,\n  ExternalAccountResponse,\n  LiquidationAddressesResponse,\n  LiquidationAddressResponse,\n  PayoutsResponse,\n  PayoutPreferences,\n  PayoutPreferencesUpdateResponse,\n  ManualBankAccountInput,\n  PayoutDestination,\n} from '../types/bridge';\n\n/**\n * Get CSRF token for authenticated requests.\n */\nasync function getCsrfToken(): Promise<string> {\n  const response = await fetch(`${API_URL}/api/auth/csrf/`, {\n    credentials: 'include',\n  });\n  const data = await response.json();\n  return data?.csrfToken || '';\n}\n\n/**\n * Make authenticated POST request.\n */\nasync function postRequest<T>(endpoint: string, body?: object): Promise<T> {\n  const csrf = await getCsrfToken();\n\n  const response = await fetch(`${API_URL}${endpoint}`, {\n    method: 'POST',\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-CSRFToken': csrf,\n      'X-Requested-With': 'XMLHttpRequest',\n    },\n    body: body ? JSON.stringify(body) : undefined,\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || `Request failed: ${response.status}`);\n  }\n\n  return response.json();\n}\n\n/**\n * Make authenticated DELETE request.\n */\nasync function deleteRequest<T>(endpoint: string): Promise<T> {\n  const csrf = await getCsrfToken();\n\n  const response = await fetch(`${API_URL}${endpoint}`, {\n    method: 'DELETE',\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      'X-CSRFToken': csrf,\n      'X-Requested-With': 'XMLHttpRequest',\n    },\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || `Request failed: ${response.status}`);\n  }\n\n  return response.json();\n}\n\n// =============================================================================\n// Onboarding Status\n// =============================================================================\n\n/**\n * Get complete Bridge onboarding status.\n * Returns KYC status, bank account status, liquidation address status, and preferences.\n */\nexport async function getBridgeOnboardingStatus(): Promise<BridgeOnboardingStatus> {\n  const response = await fetch(`${API_URL}/api/bridge/status/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to get Bridge onboarding status');\n  }\n\n  return response.json();\n}\n\n// =============================================================================\n// Customer / KYC\n// =============================================================================\n\n/**\n * Create a Bridge customer for the current user.\n * This is the first step in Bridge onboarding.\n */\nexport async function createBridgeCustomer(): Promise<BridgeCustomerResponse> {\n  return postRequest('/api/bridge/customer/create/');\n}\n\n/**\n * Get the KYC verification link.\n * Opens Bridge's hosted KYC flow in a new tab/window.\n */\nexport async function getKYCLink(): Promise<KYCLinkResponse> {\n  const response = await fetch(`${API_URL}/api/bridge/kyc/link/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData.error || 'Failed to get KYC link');\n  }\n\n  return response.json();\n}\n\n/**\n * Get current KYC status.\n * Useful for polling after user returns from KYC flow.\n */\nexport async function getKYCStatus(): Promise<KYCStatusResponse> {\n  const response = await fetch(`${API_URL}/api/bridge/kyc/status/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to get KYC status');\n  }\n\n  return response.json();\n}\n\n// =============================================================================\n// External Accounts (Bank Accounts)\n// =============================================================================\n\n/**\n * List all linked bank accounts.\n */\nexport async function listBankAccounts(): Promise<ExternalAccountsResponse> {\n  const response = await fetch(`${API_URL}/api/bridge/accounts/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to list bank accounts');\n  }\n\n  return response.json();\n}\n\n/**\n * Link a bank account using Plaid.\n * @param plaidProcessorToken Token from Plaid Link flow\n */\nexport async function linkBankAccountPlaid(\n  plaidProcessorToken: string\n): Promise<ExternalAccountResponse> {\n  return postRequest('/api/bridge/accounts/plaid/', {\n    plaid_processor_token: plaidProcessorToken,\n  });\n}\n\n/**\n * Link a bank account with manual entry.\n * @param accountData Bank account details\n */\nexport async function linkBankAccountManual(\n  accountData: ManualBankAccountInput\n): Promise<ExternalAccountResponse> {\n  return postRequest('/api/bridge/accounts/manual/', accountData);\n}\n\n/**\n * Delete a linked bank account.\n * @param accountId ID of the account to delete\n */\nexport async function deleteBankAccount(\n  accountId: number\n): Promise<{ message: string }> {\n  return deleteRequest(`/api/bridge/accounts/${accountId}/`);\n}\n\n/**\n * Set a bank account as default for new liquidation addresses.\n * @param accountId ID of the account to set as default\n */\nexport async function setDefaultBankAccount(\n  accountId: number\n): Promise<ExternalAccountResponse> {\n  return postRequest(`/api/bridge/accounts/${accountId}/default/`);\n}\n\n// =============================================================================\n// Liquidation Addresses\n// =============================================================================\n\n/**\n * List all liquidation addresses.\n */\nexport async function listLiquidationAddresses(): Promise<LiquidationAddressesResponse> {\n  const response = await fetch(`${API_URL}/api/bridge/liquidation-addresses/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to list liquidation addresses');\n  }\n\n  return response.json();\n}\n\n/**\n * Create a new liquidation address.\n * @param externalAccountId Optional - ID of bank account to link. Uses default if not provided.\n */\nexport async function createLiquidationAddress(\n  externalAccountId?: number\n): Promise<LiquidationAddressResponse> {\n  const body = externalAccountId ? { external_account_id: externalAccountId } : undefined;\n  return postRequest('/api/bridge/liquidation-addresses/create/', body);\n}\n\n/**\n * Set a liquidation address as primary for receiving payouts.\n * @param addressId ID of the address to set as primary\n */\nexport async function setPrimaryLiquidationAddress(\n  addressId: number\n): Promise<LiquidationAddressResponse> {\n  return postRequest(`/api/bridge/liquidation-addresses/${addressId}/primary/`);\n}\n\n// =============================================================================\n// Payouts\n// =============================================================================\n\n/**\n * List payout history (drains).\n */\nexport async function listPayouts(): Promise<PayoutsResponse> {\n  const response = await fetch(`${API_URL}/api/bridge/payouts/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to list payouts');\n  }\n\n  return response.json();\n}\n\n// =============================================================================\n// Payout Preferences\n// =============================================================================\n\n/**\n * Get current payout preferences.\n */\nexport async function getPayoutPreferences(): Promise<PayoutPreferences> {\n  const response = await fetch(`${API_URL}/api/bridge/preferences/`, {\n    credentials: 'include',\n  });\n\n  if (!response.ok) {\n    throw new Error('Failed to get payout preferences');\n  }\n\n  return response.json();\n}\n\n/**\n * Update payout preferences.\n * @param destination Where to send payouts: 'wallet', 'bridge', or 'split'\n * @param percentage Percentage to send to Bridge (1-100). Only used when destination is 'split'.\n */\nexport async function updatePayoutPreferences(\n  destination: PayoutDestination,\n  percentage: number = 100\n): Promise<PayoutPreferencesUpdateResponse> {\n  return postRequest('/api/bridge/preferences/update/', {\n    payout_destination: destination,\n    bridge_payout_percentage: percentage,\n  });\n}\n\n// =============================================================================\n// Utility Functions\n// =============================================================================\n\n/**\n * Check if Bridge is fully set up for the user.\n * Useful for showing/hiding payout options.\n */\nexport async function isBridgeFullySetup(): Promise<boolean> {\n  try {\n    const status = await getBridgeOnboardingStatus();\n    return status.is_fully_setup;\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Open KYC verification in a new window.\n * Returns the window reference for monitoring.\n */\nexport async function openKYCFlow(): Promise<Window | null> {\n  const { url } = await getKYCLink();\n  if (url) {\n    return window.open(url, '_blank', 'width=600,height=700');\n  }\n  return null;\n}\n\n/**\n * Open bank account linking flow.\n * This is a placeholder for Plaid Link integration.\n * In production, this would:\n * 1. Get a Plaid Link token from the backend\n * 2. Open Plaid Link in a modal\n * 3. Send the processor token to link the account\n *\n * For MVP, this opens a prompt for manual bank account entry.\n */\nexport async function openBankLinkingFlow(): Promise<void> {\n  // For MVP, we'll use a simple approach - this would be replaced with Plaid Link\n  // For now, just return a resolved promise as the manual entry is handled in the UI\n  return Promise.resolve();\n}\n\n/**\n * Poll KYC status until approved or rejected.\n * @param intervalMs Polling interval in milliseconds (default: 3000)\n * @param maxAttempts Maximum polling attempts (default: 100)\n * @param onStatusChange Callback when status changes\n */\nexport async function pollKYCStatus(\n  intervalMs: number = 3000,\n  maxAttempts: number = 100,\n  onStatusChange?: (status: KYCStatusResponse) => void\n): Promise<KYCStatusResponse> {\n  let attempts = 0;\n  let lastStatus: string | null = null;\n\n  return new Promise((resolve, reject) => {\n    const poll = async () => {\n      try {\n        const status = await getKYCStatus();\n\n        // Notify on status change\n        if (status.kyc_status !== lastStatus) {\n          lastStatus = status.kyc_status;\n          onStatusChange?.(status);\n        }\n\n        // Check for terminal states\n        if (status.kyc_status === 'approved' || status.kyc_status === 'rejected') {\n          resolve(status);\n          return;\n        }\n\n        // Continue polling\n        attempts++;\n        if (attempts < maxAttempts) {\n          setTimeout(poll, intervalMs);\n        } else {\n          reject(new Error('KYC status polling timed out'));\n        }\n      } catch (error) {\n        reject(error);\n      }\n    };\n\n    poll();\n  });\n}\n"],"names":["Building2","createLucideIcon","d","key","Wallet","async","getCsrfToken","response","fetch","API_URL","credentials","data","json","csrfToken","postRequest","endpoint","body","csrf","method","headers","JSON","stringify","ok","errorData","catch","Error","error","status","getBridgeOnboardingStatus","createBridgeCustomer","getKYCStatus","listBankAccounts","deleteBankAccount","accountId","deleteRequest","setDefaultBankAccount","createLiquidationAddress","externalAccountId","external_account_id","listPayouts","updatePayoutPreferences","destination","percentage","payout_destination","bridge_payout_percentage","openKYCFlow","url","getKYCLink","window","open","openBankLinkingFlow","Promise","resolve"],"mappings":"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","x_google_ignoreList":[0,1]}