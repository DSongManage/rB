{"version":3,"mappings":"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","names":["g","globalThis","window","global","Buffer","process","on","emitter","EventEmitter","bind","once","off","emit","removeListener","removeAllListeners","listeners","env","API_URL","libraryApi","getLibrary","response","fetch","API_BASE","method","credentials","ok","Error","statusText","json","getFullContent","contentId","status","updateProgress","progressPercentage","lastPosition","csrfToken","async","data","error","getFreshCsrfToken","headers","body","JSON","stringify","content_id","progress_percentage","last_position","getProgress","getAllProgress","getComicReaderData","getComicPreviewData","LibraryItemCard","memo","item","onClick","Math","round","progress","jsxs","Link","to","id","className","style","display","gap","padding","background","border","borderRadius","textDecoration","color","transition","cursor","onMouseEnter","e","currentTarget","borderColor","onMouseLeave","children","position","width","height","flexShrink","overflow","jsx","src","thumbnail","alt","title","objectFit","onError","bottom","left","right","flex","flexDirection","justifyContent","minWidth","fontWeight","fontSize","marginBottom","textOverflow","whiteSpace","creator","toPascalCase","string","camelCase","replace","match","p1","p2","toUpperCase","toLowerCase","toCamelCase","charAt","slice","mergeClasses","classes","filter","index","array","Boolean","trim","indexOf","join","hasA11yProp","props","prop","startsWith","defaultAttributes","xmlns","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","Icon","forwardRef","size","absoluteStrokeWidth","iconNode","rest","ref","createElement","Number","map","tag","attrs","Array","isArray","createLucideIcon","iconName","Component","displayName","Bell","d","key","BookOpen","ChevronLeft","ChevronRight","CircleCheckBig","Clock","cx","cy","r","DollarSign","x1","x2","y1","y2","FilePen","Film","x","y","rx","Image","ry","LogOut","MailOpen","Mail","Menu","MessageSquare","Music","PartyPopper","Search","ShoppingCart","User","Users","X","useAuth","authState","setAuthState","useState","user","loading","isAuthenticated","checkAuth","useCallback","authenticated","logout","csrfResponse","csrfData","refreshAuth","prev","useEffect","LibrarySidebar","library","setLibrary","setLoading","setError","isExpanded","setIsExpanded","selectedTab","setSelectedTab","loadLibrary","err","message","top","borderRight","alignItems","zIndex","writingMode","marginTop","totalItems","Object","values","reduce","sum","items","length","currentItems","borderBottom","overflowX","tab","count","_a","isActive","disabled","opacity","overflowY","textAlign","borderTop","flexWrap","footerLinkStyle","href","Date","getFullYear","MobileLibraryCard","placeholderSvg","aspectRatio","TAB_ICONS","books","art","film","music","MobileLibrary","margin","WebkitOverflowScrolling","paddingBottom","scrollbarWidth","msOverflowStyle","gridTemplateColumns","getState","innerWidth","isMobile","isPhone","isTablet","isDesktop","screenWidth","useMobile","state","setState","handleResize","addEventListener","removeEventListener","ProtectedRoute","setIsAuthenticated","location","useLocation","Navigate","from","ErrorBoundary","constructor","super","__publicField","this","hasError","getDerivedStateFromError","componentDidCatch","errorInfo","render","fallback","minHeight","handleRetry","notifications","unreadCount","lastChecked","isPolling","lastError","knownNotificationIds","Set","initialLoadComplete","CONFIG","POLLING_INTERVAL","MAX_RETRIES","RETRY_DELAY","getCsrfToken","apiRequest","url","options","fullUrl","errorData","catch","getNotifications","n","read","forEach","add","events","pollingInterval","retryCount","retryTimeout","pollNotifications","previouslyKnownIds","newNotifications","has","stopPolling","setTimeout","startPolling","setInterval","clearInterval","clearTimeout","Map","event","handler","set","get","handlers","delete","clear","getTimeAgo","dateString","date","now","seconds","floor","getTime","toLocaleDateString","getNotificationIcon","type","invitation","invitation_response","comment","approval","section_update","revenue_proposal","mint_ready","getNotificationColor","notificationService","getUnreadNotifications","getUnreadCount","markNotificationRead","notificationId","notification","find","max","markAllNotificationsRead","deleteNotification","removeFromLocalState","findIndex","wasUnread","splice","getNotificationStats","stats","total","unread","by_type","setPollingInterval","intervalMs","getCachedNotifications","getCachedUnreadCount","reset","useNotifications","autoStart","onNewNotification","setNotifications","setUnreadCount","isLoading","setIsLoading","setIsPolling","refresh","markAsRead","markAllAsRead","deleteNotificationCallback","startPollingCallback","stopPollingCallback","getStats","unsubUpdated","unsubUnreadCount","unsubNew","newNotifs","unsubPollingStarted","unsubPollingStopped","unsubPollingError","NotificationItem","onDelete","onViewInvite","icon","iconProps","CheckCircle","FileEdit","getNotificationLucideIcon","timeAgo","created_at","isInvitation","role","tabIndex","onKeyDown","preventDefault","borderLeft","lineHeight","from_user","username","stopPropagation","boxShadow","handleResponse","errorMessage","detail","collaborationApi","createCollaborativeProject","deleteCollaborativeProject","projectId","splits","getApprovalStatus","project","getCollaborativeProject","pendingApprovals","collaborators","c","approved_current_version","approved_revenue_split","is_fully_approved","pending_approvals","createProjectSection","formData","FormData","append","toString","section_type","content_html","media_file","order","updateProjectSection","deleteProjectSection","addComment","attachments","content","section","parent_comment","mentions","file","getComments","sectionId","commentId","deleteComment","emoji","removeReaction","reactionId","reaction_id","getCommentsBySection","includeResolved","getUnresolvedCommentCount","resolved","priceUsd","price_usd","settings","forceMint","force_mint","proposalId","ratedUserId","rated_user_id","userId","pageId","deleteComicPage","newPosition","new_position","panelId","deleteComicPanel","uploadPanelArtwork","artworkFile","panels","bubbleId","deleteSpeechBubble","bubbles","seriesId","deleteComicSeries","getComicIssues","params","queryParams","URLSearchParams","series","issueId","deleteComicIssue","InviteResponseModal","open","onClose","notificationMessage","navigate","useNavigate","setProject","myRole","setMyRole","mode","setMode","proposedPercentage","setProposedPercentage","counterMessage","setCounterMessage","submitting","setSubmitting","success","setSuccess","invitedRole","revenue_percentage","loadProject","created_by","othersPercentage","placeItems","target","maxWidth","maxHeight","Fragment","book","video","content_type","description","textTransform","contract_tasks","task","deadline","weekday","month","day","year","label","value","can_edit_text","can_edit_images","can_edit_audio","can_edit_video","perm","declineInvitation","acceptInvitation","min","step","onChange","parseInt","placeholder","resize","counterProposeInvite","proposed_percentage","NotificationDropdown","isOpen","anchorEl","panelRef","useRef","inviteModalOpen","setInviteModalOpen","selectedInvite","setSelectedInvite","recentNotifications","handleViewInvite","handleClickOutside","current","contains","timer","document","handleEscape","action_url","project_id","handleNotificationClick","handleDelete","NotificationBell","setIsOpen","isAnimating","setIsAnimating","bellRef","useUnreadCount","unsubscribe","animation","transformOrigin","NotificationToast","onDismiss","autoDismissMs","isExiting","setIsExiting","handleDismiss","transform","NotificationToastContainer","toasts","setToasts","pointerEvents","FeedbackModal","feedback","setFeedback","email","setEmail","submitted","setSubmitted","onSubmit","required","rows","fontFamily","BetaBadge","variant","showTestMode","letterSpacing","marginLeft","TestModeBanner","showFeedback","setShowFeedback","BetaWelcomeModal","paddingLeft","BetaOnboarding","showWelcome","setShowWelcome","hasSeenWelcome","localStorage","getItem","lastSeenUserId","String","setItem","Footer","currentYear","linkStyle","paddingTop","COOKIE_CONSENT_KEY","CookieBanner","isVisible","setIsVisible","showCustomize","setShowCustomize","preferences","setPreferences","necessary","analytics","marketing","saveConsent","prefs","timestamp","toISOString","handleRejectNonEssential","checked","CartContext","createContext","CartProvider","cart","setCart","getCSRFToken","res","refreshCart","Provider","addToCart","chapterId","chapter_id","removeFromCart","itemId","clearCart","checkout","checkout_url","isInCart","some","item_id","useCart","context","useContext","CartIcon","itemCount","item_count","backgroundColor","RECENT_SEARCHES_KEY","SearchAutocomplete","onSearch","query","setQuery","suggestions","setSuggestions","recentSearches","setRecentSearches","selectedIndex","setSelectedIndex","inputRef","containerRef","stored","parse","encodeURIComponent","then","finally","handleSearch","searchQuery","search","updated","s","saveRecentSearch","showDropdown","onFocus","selected","_b","blur","autoComplete","creator_username","removeRecentSearch","HomePage","lazy","__vitePreload","import","__VITE_PRELOAD__","SearchPage","StudioPage","DashboardPage","ProfilePage","AuthPage","WalletInfoPage","BetaLanding","CollaboratorsPage","PublicProfilePage","ContentDetail","PurchaseSuccessPage","ReaderPage","m","default","CollaborationDashboard","CollaborativeProjectPage","NotificationsPage","FollowingFeedPage","CartPage","CartSuccessPage","PayoutSettingsPage","TermsOfServicePage","PrivacyPolicyPage","ContentPolicyPage","DMCAPolicyPage","CreatorAgreementPage","PageLoader","Header","isAuthed","setIsAuthed","setUsername","avatarUrl","setAvatarUrl","mobileMenuOpen","setMobileMenuOpen","React","authed","avatar_url","interval","pathname","t","j","App","showLibrarySidebar","test","showMobileLibrary","isReaderPage","showFooter","isPublicRoute","route","Suspense","Routes","Route","path","element","marginRight","ReactDOM","createRoot","getElementById","StrictMode","BrowserRouter"],"ignoreList":[4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29],"sources":["../../src/polyfills.ts","../../src/config.ts","../../src/services/libraryApi.ts","../../src/components/LibraryItemCard.tsx","../../node_modules/lucide-react/dist/esm/shared/src/utils.js","../../node_modules/lucide-react/dist/esm/defaultAttributes.js","../../node_modules/lucide-react/dist/esm/Icon.js","../../node_modules/lucide-react/dist/esm/createLucideIcon.js","../../node_modules/lucide-react/dist/esm/icons/bell.js","../../node_modules/lucide-react/dist/esm/icons/book-open.js","../../node_modules/lucide-react/dist/esm/icons/chevron-left.js","../../node_modules/lucide-react/dist/esm/icons/chevron-right.js","../../node_modules/lucide-react/dist/esm/icons/circle-check-big.js","../../node_modules/lucide-react/dist/esm/icons/clock.js","../../node_modules/lucide-react/dist/esm/icons/dollar-sign.js","../../node_modules/lucide-react/dist/esm/icons/file-pen.js","../../node_modules/lucide-react/dist/esm/icons/film.js","../../node_modules/lucide-react/dist/esm/icons/image.js","../../node_modules/lucide-react/dist/esm/icons/log-out.js","../../node_modules/lucide-react/dist/esm/icons/mail-open.js","../../node_modules/lucide-react/dist/esm/icons/mail.js","../../node_modules/lucide-react/dist/esm/icons/menu.js","../../node_modules/lucide-react/dist/esm/icons/message-square.js","../../node_modules/lucide-react/dist/esm/icons/music.js","../../node_modules/lucide-react/dist/esm/icons/party-popper.js","../../node_modules/lucide-react/dist/esm/icons/search.js","../../node_modules/lucide-react/dist/esm/icons/shopping-cart.js","../../node_modules/lucide-react/dist/esm/icons/user.js","../../node_modules/lucide-react/dist/esm/icons/users.js","../../node_modules/lucide-react/dist/esm/icons/x.js","../../src/hooks/useAuth.ts","../../src/components/LibrarySidebar.tsx","../../src/components/MobileLibraryCard.tsx","../../src/components/MobileLibrary.tsx","../../src/hooks/useMobile.ts","../../src/components/ProtectedRoute.tsx","../../src/components/ErrorBoundary.tsx","../../src/services/notificationService.ts","../../src/hooks/useNotifications.ts","../../src/components/notifications/NotificationItem.tsx","../../src/services/collaborationApi.ts","../../src/components/collaboration/InviteResponseModal.tsx","../../src/components/notifications/NotificationDropdown.tsx","../../src/components/notifications/NotificationBell.tsx","../../src/components/notifications/NotificationToast.tsx","../../src/components/notifications/NotificationToastContainer.tsx","../../src/components/FeedbackModal.tsx","../../src/components/BetaBadge.tsx","../../src/components/BetaOnboarding.tsx","../../src/components/legal/Footer.tsx","../../src/components/legal/CookieBanner.tsx","../../src/contexts/CartContext.tsx","../../src/components/CartIcon.tsx","../../src/components/SearchAutocomplete.tsx","../../src/App.tsx","../../src/index.tsx"],"sourcesContent":["// Global polyfills for browser runtime (Vite)\nimport { Buffer } from 'buffer';\nimport process from 'process';\nimport { EventEmitter } from 'events';\n\nconst g: any = (typeof globalThis !== 'undefined' ? globalThis : window) as any;\n\n// Polyfill global\nif (!g.global) g.global = g;\n\n// Polyfill Buffer\nif (!g.Buffer) g.Buffer = Buffer;\n\n// Polyfill process with EventEmitter methods\nif (!g.process) {\n  g.process = process;\n}\n\n// Ensure process has EventEmitter methods (for end-of-stream)\nif (g.process && !g.process.on) {\n  const emitter = new EventEmitter();\n  g.process.on = emitter.on.bind(emitter);\n  g.process.once = emitter.once.bind(emitter);\n  g.process.off = emitter.off.bind(emitter);\n  g.process.emit = emitter.emit.bind(emitter);\n  g.process.removeListener = emitter.removeListener.bind(emitter);\n  g.process.removeAllListeners = emitter.removeAllListeners.bind(emitter);\n  g.process.listeners = emitter.listeners.bind(emitter);\n}\n\nif (!g.process.env) g.process.env = {};\n","// API Configuration\n// In development, use empty string to leverage Vite's proxy (same-origin requests)\n// This ensures cookies work correctly regardless of localhost vs 127.0.0.1\n// In production, use the full API URL from environment\nconst isDev = import.meta.env.DEV;\nexport const API_URL = isDev ? '' : (import.meta.env.VITE_API_URL || '');\n\nexport const appConfig = {\n  showTeasers: import.meta.env.VITE_SHOW_TEASERS !== 'false',\n};\n","/**\n * Library API Service\n *\n * Provides functions for accessing user's library and reading progress.\n */\n\nimport { API_URL as API_BASE } from '../config';\n\nexport interface LibraryItem {\n  id: number;\n  title: string;\n  creator: string;\n  thumbnail: string;\n  content_type: string;\n  purchased_at: string;\n  progress: number;\n}\n\nexport interface Library {\n  books: LibraryItem[];\n  art: LibraryItem[];\n  film: LibraryItem[];\n  music: LibraryItem[];\n  comics: LibraryItem[];\n}\n\n// Comic Reader Data Types\nexport interface SpeechBubbleData {\n  id: number;\n  bubble_type: string;\n  x_percent: number;\n  y_percent: number;\n  width_percent: number;\n  height_percent: number;\n  z_index: number;\n  text: string;\n  font_family: string;\n  font_size: number;\n  font_color: string;\n  font_weight: string;\n  font_style: string;\n  text_align: string;\n  background_color: string;\n  border_color: string;\n  border_width: number;\n  pointer_direction: string;\n  pointer_position: number;\n  order: number;\n}\n\nexport interface ComicPanelData {\n  id: number;\n  x_percent: number;\n  y_percent: number;\n  width_percent: number;\n  height_percent: number;\n  z_index: number;\n  border_style: string;\n  border_width: number;\n  border_color: string;\n  border_radius: number;\n  background_color: string;\n  rotation: number;\n  skew_x: number;\n  skew_y: number;\n  artwork?: string;\n  artwork_fit: string;\n  order: number;\n  speech_bubbles: SpeechBubbleData[];\n}\n\nexport interface ComicPageData {\n  id: number;\n  page_number: number;\n  page_format: string;\n  canvas_width: number;\n  canvas_height: number;\n  background_image?: string;\n  background_color: string;\n  panels: ComicPanelData[];\n}\n\nexport interface ComicReaderData {\n  content_id: number;\n  title: string;\n  creator: string;\n  total_pages: number;\n  pages: ComicPageData[];\n}\n\nexport interface ComicPreviewData {\n  content_id: number;\n  title: string;\n  creator: string;\n  total_pages: number;\n  preview_pages: number;\n  pages: ComicPageData[];\n  is_preview: boolean;\n}\n\nexport interface FullContent {\n  id: number;\n  title: string;\n  content_html: string;\n  creator: string;\n  content_type: string;\n  owned: boolean;\n  teaser_link?: string | null;\n}\n\nexport interface ReadingProgress {\n  id?: number;\n  user?: number;\n  content: number;\n  progress_percentage: number;\n  last_position: string;\n  last_read_at?: string;\n  created_at?: string;\n}\n\n/**\n * Get fresh CSRF token from API\n * This is more reliable than reading from cookies\n */\nasync function getFreshCsrfToken(): Promise<string> {\n  try {\n    const response = await fetch(`${API_BASE}/api/auth/csrf/`, {\n      credentials: 'include',\n    });\n    const data = await response.json();\n    return data?.csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    return '';\n  }\n}\n\nexport const libraryApi = {\n  /**\n   * Get user's library grouped by content type\n   */\n  async getLibrary(): Promise<Library> {\n    const response = await fetch(`${API_BASE}/api/library/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch library: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Get full content for owned items\n   */\n  async getFullContent(contentId: number): Promise<FullContent> {\n    const response = await fetch(`${API_BASE}/api/content/${contentId}/full/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      if (response.status === 403) {\n        throw new Error('You do not own this content');\n      }\n      throw new Error(`Failed to fetch content: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Update reading progress for content\n   */\n  async updateProgress(\n    contentId: number,\n    progressPercentage: number,\n    lastPosition: string = ''\n  ): Promise<ReadingProgress> {\n    const csrfToken = await getFreshCsrfToken();\n    const response = await fetch(`${API_BASE}/api/reading-progress/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrfToken,\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({\n        content_id: contentId,\n        progress_percentage: progressPercentage,\n        last_position: lastPosition,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to update progress: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Get reading progress for specific content\n   */\n  async getProgress(contentId: number): Promise<ReadingProgress> {\n    const response = await fetch(`${API_BASE}/api/reading-progress/${contentId}/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch progress: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Get all reading progress for user\n   */\n  async getAllProgress(): Promise<ReadingProgress[]> {\n    const response = await fetch(`${API_BASE}/api/reading-progress/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to fetch all progress: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Get comic reader data (pages, panels, speech bubbles) for owned comics\n   */\n  async getComicReaderData(contentId: number): Promise<ComicReaderData> {\n    const response = await fetch(`${API_BASE}/api/content/${contentId}/comic-reader-data/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      if (response.status === 403) {\n        throw new Error('You do not own this content');\n      }\n      if (response.status === 404) {\n        throw new Error('Comic data not found');\n      }\n      throw new Error(`Failed to fetch comic data: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n\n  /**\n   * Get comic preview data (limited pages for non-owners)\n   */\n  async getComicPreviewData(contentId: number): Promise<ComicPreviewData> {\n    const response = await fetch(`${API_BASE}/api/content/${contentId}/comic-preview/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    if (!response.ok) {\n      if (response.status === 404) {\n        throw new Error('Comic data not found');\n      }\n      throw new Error(`Failed to fetch comic preview: ${response.statusText}`);\n    }\n\n    return response.json();\n  },\n};\n","import React, { memo } from 'react';\nimport { Link } from 'react-router-dom';\nimport type { LibraryItem } from '../services/libraryApi';\n\ninterface LibraryItemCardProps {\n  item: LibraryItem;\n  onClick?: () => void;\n}\n\nfunction LibraryItemCardComponent({ item, onClick }: LibraryItemCardProps) {\n  const progressPercentage = Math.round(item.progress);\n\n  return (\n    <Link\n      to={`/reader/${item.id}`}\n      className=\"library-item-card\"\n      onClick={onClick}\n      style={{\n        display: 'flex',\n        gap: 12,\n        padding: 12,\n        background: '#0b1220',\n        border: '1px solid #2a3444',\n        borderRadius: 8,\n        textDecoration: 'none',\n        color: 'inherit',\n        transition: 'all 0.2s ease',\n        cursor: 'pointer',\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = '#111827';\n        e.currentTarget.style.borderColor = '#374151';\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = '#0b1220';\n        e.currentTarget.style.borderColor = '#2a3444';\n      }}\n    >\n      {/* Thumbnail */}\n      <div\n        style={{\n          position: 'relative',\n          width: 80,\n          height: 80,\n          flexShrink: 0,\n          borderRadius: 6,\n          overflow: 'hidden',\n          background: '#0e1320',\n        }}\n      >\n        <img\n          src={item.thumbnail || 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"80\" height=\"80\"%3E%3Crect fill=\"%23111827\" width=\"80\" height=\"80\"/%3E%3Ctext fill=\"%2394a3b8\" font-family=\"sans-serif\" font-size=\"12\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dominant-baseline=\"middle\"%3E%F0%9F%93%96%3C/text%3E%3C/svg%3E'}\n          alt={item.title}\n          style={{\n            width: '100%',\n            height: '100%',\n            objectFit: 'cover',\n          }}\n          onError={(e: React.SyntheticEvent<HTMLImageElement>) => {\n            e.currentTarget.src = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"80\" height=\"80\"%3E%3Crect fill=\"%23111827\" width=\"80\" height=\"80\"/%3E%3Ctext fill=\"%2394a3b8\" font-family=\"sans-serif\" font-size=\"12\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dominant-baseline=\"middle\"%3E%F0%9F%93%96%3C/text%3E%3C/svg%3E';\n          }}\n        />\n        {/* Progress overlay */}\n        {item.progress > 0 && (\n          <div\n            style={{\n              position: 'absolute',\n              bottom: 0,\n              left: 0,\n              right: 0,\n              height: 4,\n              background: 'rgba(0,0,0,0.5)',\n            }}\n          >\n            <div\n              style={{\n                height: '100%',\n                width: `${item.progress}%`,\n                background: '#f59e0b',\n                transition: 'width 0.3s ease',\n              }}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Content info */}\n      <div\n        style={{\n          flex: 1,\n          display: 'flex',\n          flexDirection: 'column',\n          justifyContent: 'space-between',\n          minWidth: 0,\n        }}\n      >\n        <div>\n          <div\n            style={{\n              fontWeight: 600,\n              fontSize: 14,\n              color: '#e5e7eb',\n              marginBottom: 4,\n              overflow: 'hidden',\n              textOverflow: 'ellipsis',\n              whiteSpace: 'nowrap',\n            }}\n          >\n            {item.title}\n          </div>\n          <div\n            style={{\n              fontSize: 12,\n              color: '#94a3b8',\n            }}\n          >\n            {item.creator}\n          </div>\n        </div>\n        <div\n          style={{\n            fontSize: 11,\n            color: '#10b981',\n            fontWeight: 600,\n          }}\n        >\n          {progressPercentage > 0 ? `${progressPercentage}% complete` : 'Not started'}\n        </div>\n      </div>\n    </Link>\n  );\n}\n\nexport const LibraryItemCard = memo(LibraryItemCardComponent);\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nconst toKebabCase = (string) => string.replace(/([a-z0-9])([A-Z])/g, \"$1-$2\").toLowerCase();\nconst toCamelCase = (string) => string.replace(\n  /^([A-Z])|[\\s-_]+(\\w)/g,\n  (match, p1, p2) => p2 ? p2.toUpperCase() : p1.toLowerCase()\n);\nconst toPascalCase = (string) => {\n  const camelCase = toCamelCase(string);\n  return camelCase.charAt(0).toUpperCase() + camelCase.slice(1);\n};\nconst mergeClasses = (...classes) => classes.filter((className, index, array) => {\n  return Boolean(className) && className.trim() !== \"\" && array.indexOf(className) === index;\n}).join(\" \").trim();\nconst hasA11yProp = (props) => {\n  for (const prop in props) {\n    if (prop.startsWith(\"aria-\") || prop === \"role\" || prop === \"title\") {\n      return true;\n    }\n  }\n};\n\nexport { hasA11yProp, mergeClasses, toCamelCase, toKebabCase, toPascalCase };\n//# sourceMappingURL=utils.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nvar defaultAttributes = {\n  xmlns: \"http://www.w3.org/2000/svg\",\n  width: 24,\n  height: 24,\n  viewBox: \"0 0 24 24\",\n  fill: \"none\",\n  stroke: \"currentColor\",\n  strokeWidth: 2,\n  strokeLinecap: \"round\",\n  strokeLinejoin: \"round\"\n};\n\nexport { defaultAttributes as default };\n//# sourceMappingURL=defaultAttributes.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport defaultAttributes from './defaultAttributes.js';\nimport { mergeClasses, hasA11yProp } from './shared/src/utils.js';\n\nconst Icon = forwardRef(\n  ({\n    color = \"currentColor\",\n    size = 24,\n    strokeWidth = 2,\n    absoluteStrokeWidth,\n    className = \"\",\n    children,\n    iconNode,\n    ...rest\n  }, ref) => createElement(\n    \"svg\",\n    {\n      ref,\n      ...defaultAttributes,\n      width: size,\n      height: size,\n      stroke: color,\n      strokeWidth: absoluteStrokeWidth ? Number(strokeWidth) * 24 / Number(size) : strokeWidth,\n      className: mergeClasses(\"lucide\", className),\n      ...!children && !hasA11yProp(rest) && { \"aria-hidden\": \"true\" },\n      ...rest\n    },\n    [\n      ...iconNode.map(([tag, attrs]) => createElement(tag, attrs)),\n      ...Array.isArray(children) ? children : [children]\n    ]\n  )\n);\n\nexport { Icon as default };\n//# sourceMappingURL=Icon.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport { forwardRef, createElement } from 'react';\nimport { mergeClasses, toKebabCase, toPascalCase } from './shared/src/utils.js';\nimport Icon from './Icon.js';\n\nconst createLucideIcon = (iconName, iconNode) => {\n  const Component = forwardRef(\n    ({ className, ...props }, ref) => createElement(Icon, {\n      ref,\n      iconNode,\n      className: mergeClasses(\n        `lucide-${toKebabCase(toPascalCase(iconName))}`,\n        `lucide-${iconName}`,\n        className\n      ),\n      ...props\n    })\n  );\n  Component.displayName = toPascalCase(iconName);\n  return Component;\n};\n\nexport { createLucideIcon as default };\n//# sourceMappingURL=createLucideIcon.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M10.268 21a2 2 0 0 0 3.464 0\", key: \"vwvbt9\" }],\n  [\n    \"path\",\n    {\n      d: \"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326\",\n      key: \"11g9vi\"\n    }\n  ]\n];\nconst Bell = createLucideIcon(\"bell\", __iconNode);\n\nexport { __iconNode, Bell as default };\n//# sourceMappingURL=bell.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 7v14\", key: \"1akyts\" }],\n  [\n    \"path\",\n    {\n      d: \"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z\",\n      key: \"ruj8y\"\n    }\n  ]\n];\nconst BookOpen = createLucideIcon(\"book-open\", __iconNode);\n\nexport { __iconNode, BookOpen as default };\n//# sourceMappingURL=book-open.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m15 18-6-6 6-6\", key: \"1wnfg3\" }]];\nconst ChevronLeft = createLucideIcon(\"chevron-left\", __iconNode);\n\nexport { __iconNode, ChevronLeft as default };\n//# sourceMappingURL=chevron-left.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"m9 18 6-6-6-6\", key: \"mthhwq\" }]];\nconst ChevronRight = createLucideIcon(\"chevron-right\", __iconNode);\n\nexport { __iconNode, ChevronRight as default };\n//# sourceMappingURL=chevron-right.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21.801 10A10 10 0 1 1 17 3.335\", key: \"yps3ct\" }],\n  [\"path\", { d: \"m9 11 3 3L22 4\", key: \"1pflzl\" }]\n];\nconst CircleCheckBig = createLucideIcon(\"circle-check-big\", __iconNode);\n\nexport { __iconNode, CircleCheckBig as default };\n//# sourceMappingURL=circle-check-big.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 6v6l4 2\", key: \"mmk7yg\" }],\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"10\", key: \"1mglay\" }]\n];\nconst Clock = createLucideIcon(\"clock\", __iconNode);\n\nexport { __iconNode, Clock as default };\n//# sourceMappingURL=clock.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"line\", { x1: \"12\", x2: \"12\", y1: \"2\", y2: \"22\", key: \"7eqyqh\" }],\n  [\"path\", { d: \"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6\", key: \"1b0p4s\" }]\n];\nconst DollarSign = createLucideIcon(\"dollar-sign\", __iconNode);\n\nexport { __iconNode, DollarSign as default };\n//# sourceMappingURL=dollar-sign.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M12.659 22H18a2 2 0 0 0 2-2V8a2.4 2.4 0 0 0-.706-1.706l-3.588-3.588A2.4 2.4 0 0 0 14 2H6a2 2 0 0 0-2 2v9.34\",\n      key: \"o6klzx\"\n    }\n  ],\n  [\"path\", { d: \"M14 2v5a1 1 0 0 0 1 1h5\", key: \"wfsgrz\" }],\n  [\n    \"path\",\n    {\n      d: \"M10.378 12.622a1 1 0 0 1 3 3.003L8.36 20.637a2 2 0 0 1-.854.506l-2.867.837a.5.5 0 0 1-.62-.62l.836-2.869a2 2 0 0 1 .506-.853z\",\n      key: \"zhnas1\"\n    }\n  ]\n];\nconst FilePen = createLucideIcon(\"file-pen\", __iconNode);\n\nexport { __iconNode, FilePen as default };\n//# sourceMappingURL=file-pen.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", key: \"afitv7\" }],\n  [\"path\", { d: \"M7 3v18\", key: \"bbkbws\" }],\n  [\"path\", { d: \"M3 7.5h4\", key: \"zfgn84\" }],\n  [\"path\", { d: \"M3 12h18\", key: \"1i2n21\" }],\n  [\"path\", { d: \"M3 16.5h4\", key: \"1230mu\" }],\n  [\"path\", { d: \"M17 3v18\", key: \"in4fa5\" }],\n  [\"path\", { d: \"M17 7.5h4\", key: \"myr1c1\" }],\n  [\"path\", { d: \"M17 16.5h4\", key: \"go4c1d\" }]\n];\nconst Film = createLucideIcon(\"film\", __iconNode);\n\nexport { __iconNode, Film as default };\n//# sourceMappingURL=film.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"rect\", { width: \"18\", height: \"18\", x: \"3\", y: \"3\", rx: \"2\", ry: \"2\", key: \"1m3agn\" }],\n  [\"circle\", { cx: \"9\", cy: \"9\", r: \"2\", key: \"af1f0g\" }],\n  [\"path\", { d: \"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21\", key: \"1xmnt7\" }]\n];\nconst Image = createLucideIcon(\"image\", __iconNode);\n\nexport { __iconNode, Image as default };\n//# sourceMappingURL=image.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m16 17 5-5-5-5\", key: \"1bji2h\" }],\n  [\"path\", { d: \"M21 12H9\", key: \"dn1m92\" }],\n  [\"path\", { d: \"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4\", key: \"1uf3rs\" }]\n];\nconst LogOut = createLucideIcon(\"log-out\", __iconNode);\n\nexport { __iconNode, LogOut as default };\n//# sourceMappingURL=log-out.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M21.2 8.4c.5.38.8.97.8 1.6v10a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V10a2 2 0 0 1 .8-1.6l8-6a2 2 0 0 1 2.4 0l8 6Z\",\n      key: \"1jhwl8\"\n    }\n  ],\n  [\"path\", { d: \"m22 10-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 10\", key: \"1qfld7\" }]\n];\nconst MailOpen = createLucideIcon(\"mail-open\", __iconNode);\n\nexport { __iconNode, MailOpen as default };\n//# sourceMappingURL=mail-open.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m22 7-8.991 5.727a2 2 0 0 1-2.009 0L2 7\", key: \"132q7q\" }],\n  [\"rect\", { x: \"2\", y: \"4\", width: \"20\", height: \"16\", rx: \"2\", key: \"izxlao\" }]\n];\nconst Mail = createLucideIcon(\"mail\", __iconNode);\n\nexport { __iconNode, Mail as default };\n//# sourceMappingURL=mail.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M4 5h16\", key: \"1tepv9\" }],\n  [\"path\", { d: \"M4 12h16\", key: \"1lakjw\" }],\n  [\"path\", { d: \"M4 19h16\", key: \"1djgab\" }]\n];\nconst Menu = createLucideIcon(\"menu\", __iconNode);\n\nexport { __iconNode, Menu as default };\n//# sourceMappingURL=menu.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z\",\n      key: \"18887p\"\n    }\n  ]\n];\nconst MessageSquare = createLucideIcon(\"message-square\", __iconNode);\n\nexport { __iconNode, MessageSquare as default };\n//# sourceMappingURL=message-square.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M9 18V5l12-2v13\", key: \"1jmyc2\" }],\n  [\"circle\", { cx: \"6\", cy: \"18\", r: \"3\", key: \"fqmcym\" }],\n  [\"circle\", { cx: \"18\", cy: \"16\", r: \"3\", key: \"1hluhg\" }]\n];\nconst Music = createLucideIcon(\"music\", __iconNode);\n\nexport { __iconNode, Music as default };\n//# sourceMappingURL=music.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M5.8 11.3 2 22l10.7-3.79\", key: \"gwxi1d\" }],\n  [\"path\", { d: \"M4 3h.01\", key: \"1vcuye\" }],\n  [\"path\", { d: \"M22 8h.01\", key: \"1mrtc2\" }],\n  [\"path\", { d: \"M15 2h.01\", key: \"1cjtqr\" }],\n  [\"path\", { d: \"M22 20h.01\", key: \"1mrys2\" }],\n  [\n    \"path\",\n    {\n      d: \"m22 2-2.24.75a2.9 2.9 0 0 0-1.96 3.12c.1.86-.57 1.63-1.45 1.63h-.38c-.86 0-1.6.6-1.76 1.44L14 10\",\n      key: \"hbicv8\"\n    }\n  ],\n  [\n    \"path\",\n    { d: \"m22 13-.82-.33c-.86-.34-1.82.2-1.98 1.11c-.11.7-.72 1.22-1.43 1.22H17\", key: \"1i94pl\" }\n  ],\n  [\"path\", { d: \"m11 2 .33.82c.34.86-.2 1.82-1.11 1.98C9.52 4.9 9 5.52 9 6.23V7\", key: \"1cofks\" }],\n  [\n    \"path\",\n    {\n      d: \"M11 13c1.93 1.93 2.83 4.17 2 5-.83.83-3.07-.07-5-2-1.93-1.93-2.83-4.17-2-5 .83-.83 3.07.07 5 2Z\",\n      key: \"4kbmks\"\n    }\n  ]\n];\nconst PartyPopper = createLucideIcon(\"party-popper\", __iconNode);\n\nexport { __iconNode, PartyPopper as default };\n//# sourceMappingURL=party-popper.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m21 21-4.34-4.34\", key: \"14j7rj\" }],\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }]\n];\nconst Search = createLucideIcon(\"search\", __iconNode);\n\nexport { __iconNode, Search as default };\n//# sourceMappingURL=search.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"8\", cy: \"21\", r: \"1\", key: \"jimo8o\" }],\n  [\"circle\", { cx: \"19\", cy: \"21\", r: \"1\", key: \"13723u\" }],\n  [\n    \"path\",\n    {\n      d: \"M2.05 2.05h2l2.66 12.42a2 2 0 0 0 2 1.58h9.78a2 2 0 0 0 1.95-1.57l1.65-7.43H5.12\",\n      key: \"9zh506\"\n    }\n  ]\n];\nconst ShoppingCart = createLucideIcon(\"shopping-cart\", __iconNode);\n\nexport { __iconNode, ShoppingCart as default };\n//# sourceMappingURL=shopping-cart.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2\", key: \"975kel\" }],\n  [\"circle\", { cx: \"12\", cy: \"7\", r: \"4\", key: \"17ys0d\" }]\n];\nconst User = createLucideIcon(\"user\", __iconNode);\n\nexport { __iconNode, User as default };\n//# sourceMappingURL=user.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2\", key: \"1yyitq\" }],\n  [\"path\", { d: \"M16 3.128a4 4 0 0 1 0 7.744\", key: \"16gr8j\" }],\n  [\"path\", { d: \"M22 21v-2a4 4 0 0 0-3-3.87\", key: \"kshegd\" }],\n  [\"circle\", { cx: \"9\", cy: \"7\", r: \"4\", key: \"nufk8\" }]\n];\nconst Users = createLucideIcon(\"users\", __iconNode);\n\nexport { __iconNode, Users as default };\n//# sourceMappingURL=users.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M18 6 6 18\", key: \"1bl5f8\" }],\n  [\"path\", { d: \"m6 6 12 12\", key: \"d8bk6v\" }]\n];\nconst X = createLucideIcon(\"x\", __iconNode);\n\nexport { __iconNode, X as default };\n//# sourceMappingURL=x.js.map\n","import { useState, useEffect, useCallback } from 'react';\nimport { API_URL } from '../config';\n\n/**\n * Authentication hook\n *\n * Provides authentication state and methods for the entire app.\n * Checks auth status on mount and provides loading state.\n */\n\ninterface User {\n  id: number;\n  username: string;\n  email?: string;\n  display_name?: string;\n  avatar?: string;\n}\n\ninterface AuthState {\n  user: User | null;\n  loading: boolean;\n  isAuthenticated: boolean;\n}\n\nexport const useAuth = () => {\n  const [authState, setAuthState] = useState<AuthState>({\n    user: null,\n    loading: true,\n    isAuthenticated: false,\n  });\n\n  const checkAuth = useCallback(async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/auth/status/`, {\n        credentials: 'include',\n      });\n\n      if (!response.ok) {\n        setAuthState({\n          user: null,\n          loading: false,\n          isAuthenticated: false,\n        });\n        return;\n      }\n\n      const data = await response.json();\n\n      if (data?.authenticated && data?.user) {\n        setAuthState({\n          user: data.user,\n          loading: false,\n          isAuthenticated: true,\n        });\n      } else {\n        setAuthState({\n          user: null,\n          loading: false,\n          isAuthenticated: false,\n        });\n      }\n    } catch (error) {\n      console.error('[useAuth] Auth check failed:', error);\n      setAuthState({\n        user: null,\n        loading: false,\n        isAuthenticated: false,\n      });\n    }\n  }, []);\n\n  const logout = useCallback(async () => {\n    try {\n      // Get CSRF token\n      const csrfResponse = await fetch(`${API_URL}/api/auth/csrf/`, {\n        credentials: 'include',\n      });\n      const csrfData = await csrfResponse.json();\n      const csrfToken = csrfData?.csrfToken || '';\n\n      // Logout\n      await fetch(`${API_URL}/api/auth/logout/`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': csrfToken,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n      });\n\n      // Update state\n      setAuthState({\n        user: null,\n        loading: false,\n        isAuthenticated: false,\n      });\n    } catch (error) {\n      console.error('Logout failed:', error);\n    }\n  }, []);\n\n  const refreshAuth = useCallback(() => {\n    setAuthState(prev => ({ ...prev, loading: true }));\n    checkAuth();\n  }, [checkAuth]);\n\n  useEffect(() => {\n    checkAuth();\n  }, [checkAuth]);\n\n  return {\n    user: authState.user,\n    loading: authState.loading,\n    isAuthenticated: authState.isAuthenticated,\n    logout,\n    refreshAuth,\n  };\n};\n\nexport default useAuth;\n","import React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { libraryApi, type Library } from '../services/libraryApi';\nimport { LibraryItemCard } from './LibraryItemCard';\nimport { ChevronRight, ChevronLeft } from 'lucide-react';\nimport { useAuth } from '../hooks/useAuth';\n\nexport function LibrarySidebar() {\n  const [library, setLibrary] = useState<Library | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [isExpanded, setIsExpanded] = useState(true);\n  const [selectedTab, setSelectedTab] = useState<keyof Library>('books');\n  const { isAuthenticated } = useAuth();\n\n  useEffect(() => {\n    // Only load library if user is authenticated\n    if (isAuthenticated) {\n      loadLibrary();\n    } else {\n      // Reset state if user is not authenticated\n      setLibrary(null);\n      setLoading(false);\n      setError(null);\n    }\n  }, [isAuthenticated]);\n\n  const loadLibrary = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await libraryApi.getLibrary();\n      setLibrary(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load library');\n      console.error('Library load error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  // Don't render anything if not authenticated\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  if (!isExpanded) {\n    return (\n      <div\n        style={{\n          position: 'fixed',\n          left: 0,\n          top: 72,\n          bottom: 0,\n          width: 48,\n          background: '#0b1220',\n          borderRight: '1px solid #2a3444',\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center',\n          padding: '12px 0',\n          zIndex: 40,\n        }}\n      >\n        <button\n          onClick={() => setIsExpanded(true)}\n          style={{\n            background: 'transparent',\n            border: 'none',\n            color: '#94a3b8',\n            cursor: 'pointer',\n            padding: 8,\n            borderRadius: 8,\n            transition: 'all 0.2s ease',\n          }}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = '#111827';\n            e.currentTarget.style.color = '#e5e7eb';\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = 'transparent';\n            e.currentTarget.style.color = '#94a3b8';\n          }}\n          aria-label=\"Expand library\"\n        >\n          <ChevronRight size={20} />\n        </button>\n        <div\n          style={{\n            writingMode: 'vertical-rl',\n            fontSize: 12,\n            fontWeight: 600,\n            color: '#94a3b8',\n            marginTop: 16,\n          }}\n        >\n          LIBRARY\n        </div>\n      </div>\n    );\n  }\n\n  const totalItems = library\n    ? Object.values(library).reduce((sum, items) => sum + items.length, 0)\n    : 0;\n\n  const currentItems = library?.[selectedTab] || [];\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        left: 0,\n        top: 72,\n        bottom: 0,\n        width: 320,\n        background: '#0b1220',\n        borderRight: '1px solid #2a3444',\n        display: 'flex',\n        flexDirection: 'column',\n        zIndex: 40,\n        transition: 'width 0.3s ease',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          padding: 16,\n          borderBottom: '1px solid #2a3444',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n        }}\n      >\n        <div>\n          <div\n            style={{\n              fontSize: 16,\n              fontWeight: 700,\n              color: '#e5e7eb',\n            }}\n          >\n            My Library\n          </div>\n          <div\n            style={{\n              fontSize: 12,\n              color: '#94a3b8',\n              marginTop: 2,\n            }}\n          >\n            {totalItems} {totalItems === 1 ? 'item' : 'items'}\n          </div>\n        </div>\n        <button\n          onClick={() => setIsExpanded(false)}\n          style={{\n            background: 'transparent',\n            border: 'none',\n            color: '#94a3b8',\n            cursor: 'pointer',\n            padding: 8,\n            borderRadius: 8,\n            transition: 'all 0.2s ease',\n          }}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = '#111827';\n            e.currentTarget.style.color = '#e5e7eb';\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = 'transparent';\n            e.currentTarget.style.color = '#94a3b8';\n          }}\n          aria-label=\"Collapse library\"\n        >\n          <ChevronLeft size={20} />\n        </button>\n      </div>\n\n      {/* Tabs */}\n      <div\n        style={{\n          display: 'flex',\n          gap: 4,\n          padding: '12px 16px',\n          borderBottom: '1px solid #2a3444',\n          overflowX: 'auto',\n        }}\n      >\n        {(['books', 'art'] as const).map((tab) => {\n          const count = library?.[tab]?.length || 0;\n          const isActive = selectedTab === tab;\n          return (\n            <button\n              key={tab}\n              onClick={() => setSelectedTab(tab)}\n              style={{\n                background: isActive ? '#f59e0b' : '#111827',\n                border: '1px solid',\n                borderColor: isActive ? '#f59e0b' : '#2a3444',\n                color: isActive ? '#111827' : '#cbd5e1',\n                padding: '6px 12px',\n                borderRadius: 18,\n                fontSize: 12,\n                fontWeight: 600,\n                cursor: 'pointer',\n                whiteSpace: 'nowrap',\n                transition: 'all 0.2s ease',\n              }}\n              onMouseEnter={(e) => {\n                if (!isActive) {\n                  e.currentTarget.style.background = '#1f2937';\n                  e.currentTarget.style.borderColor = '#374151';\n                }\n              }}\n              onMouseLeave={(e) => {\n                if (!isActive) {\n                  e.currentTarget.style.background = '#111827';\n                  e.currentTarget.style.borderColor = '#2a3444';\n                }\n              }}\n            >\n              {tab.charAt(0).toUpperCase() + tab.slice(1)} ({count})\n            </button>\n          );\n        })}\n        {/* Coming Soon tabs */}\n        {(['film', 'music'] as const).map((tab) => (\n          <button\n            key={tab}\n            disabled\n            style={{\n              background: '#111827',\n              border: '1px solid #2a3444',\n              color: '#64748b',\n              padding: '6px 12px',\n              borderRadius: 18,\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: 'not-allowed',\n              whiteSpace: 'nowrap',\n              opacity: 0.5,\n              display: 'flex',\n              alignItems: 'center',\n              gap: 4,\n            }}\n          >\n            {tab.charAt(0).toUpperCase() + tab.slice(1)}\n            <span style={{\n              fontSize: 8,\n              background: '#f59e0b',\n              color: '#000',\n              padding: '1px 3px',\n              borderRadius: 2,\n              fontWeight: 700,\n            }}>\n              SOON\n            </span>\n          </button>\n        ))}\n      </div>\n\n      {/* Content */}\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n          padding: 16,\n        }}\n      >\n        {loading && (\n          <div\n            style={{\n              textAlign: 'center',\n              padding: 32,\n              color: '#94a3b8',\n              fontSize: 14,\n            }}\n          >\n            Loading library...\n          </div>\n        )}\n\n        {error && (\n          <div\n            style={{\n              background: '#ef444420',\n              border: '1px solid #ef4444',\n              borderRadius: 8,\n              padding: 16,\n              color: '#fca5a5',\n              fontSize: 14,\n            }}\n          >\n            {error}\n            <button\n              onClick={loadLibrary}\n              style={{\n                marginTop: 8,\n                background: '#ef4444',\n                color: '#fff',\n                padding: '6px 12px',\n                fontSize: 12,\n              }}\n            >\n              Retry\n            </button>\n          </div>\n        )}\n\n        {!loading && !error && currentItems.length === 0 && (\n          <div\n            style={{\n              textAlign: 'center',\n              padding: 32,\n              color: '#94a3b8',\n              fontSize: 14,\n            }}\n          >\n            No {selectedTab} in your library yet.\n          </div>\n        )}\n\n        {!loading && !error && currentItems.length > 0 && (\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\n            {currentItems.map((item) => (\n              <LibraryItemCard key={item.id} item={item} />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer Links - YouTube style */}\n      <div\n        style={{\n          padding: '12px 16px',\n          borderTop: '1px solid #2a3444',\n          flexShrink: 0,\n        }}\n      >\n        {/* Legal Links Row */}\n        <div\n          style={{\n            display: 'flex',\n            flexWrap: 'wrap',\n            gap: '6px 12px',\n            marginBottom: 8,\n          }}\n        >\n          <Link to=\"/legal/terms\" style={footerLinkStyle}>Terms</Link>\n          <Link to=\"/legal/privacy\" style={footerLinkStyle}>Privacy</Link>\n          <Link to=\"/legal/content-policy\" style={footerLinkStyle}>Content Policy</Link>\n          <Link to=\"/legal/dmca\" style={footerLinkStyle}>DMCA</Link>\n        </div>\n        {/* Support Links Row */}\n        <div\n          style={{\n            display: 'flex',\n            flexWrap: 'wrap',\n            gap: '6px 12px',\n            marginBottom: 10,\n          }}\n        >\n          <a href=\"mailto:support@renaissblock.com\" style={footerLinkStyle}>Contact</a>\n          <a href=\"mailto:dmca@renaissblock.com\" style={footerLinkStyle}>Report Copyright</a>\n        </div>\n        {/* Copyright */}\n        <div\n          style={{\n            fontSize: 11,\n            color: '#64748b',\n          }}\n        >\n           {new Date().getFullYear()} renaissBlock\n        </div>\n      </div>\n    </div>\n  );\n}\n\nconst footerLinkStyle: React.CSSProperties = {\n  fontSize: 11,\n  color: '#64748b',\n  textDecoration: 'none',\n  transition: 'color 0.2s',\n};\n// Add hover effect via onMouseEnter/Leave in the JSX or use CSS classes\n","import React, { memo } from 'react';\nimport { Link } from 'react-router-dom';\nimport type { LibraryItem } from '../services/libraryApi';\n\ninterface MobileLibraryCardProps {\n  item: LibraryItem;\n}\n\nfunction MobileLibraryCardComponent({ item }: MobileLibraryCardProps) {\n  const progressPercentage = Math.round(item.progress);\n  const placeholderSvg = 'data:image/svg+xml,%3Csvg xmlns=\"http://www.w3.org/2000/svg\" width=\"200\" height=\"200\"%3E%3Crect fill=\"%23111827\" width=\"200\" height=\"200\"/%3E%3Ctext fill=\"%2394a3b8\" font-family=\"sans-serif\" font-size=\"48\" x=\"50%25\" y=\"50%25\" text-anchor=\"middle\" dominant-baseline=\"middle\"%3E%F0%9F%93%96%3C/text%3E%3C/svg%3E';\n\n  return (\n    <Link\n      to={`/reader/${item.id}`}\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        background: '#0b1220',\n        border: '1px solid #2a3444',\n        borderRadius: 12,\n        overflow: 'hidden',\n        textDecoration: 'none',\n        color: 'inherit',\n        transition: 'transform 0.2s ease, box-shadow 0.2s ease',\n      }}\n    >\n      {/* Square thumbnail with progress overlay */}\n      <div\n        style={{\n          position: 'relative',\n          aspectRatio: '1',\n          background: '#0e1320',\n        }}\n      >\n        <img\n          src={item.thumbnail || placeholderSvg}\n          alt={item.title}\n          style={{\n            width: '100%',\n            height: '100%',\n            objectFit: 'cover',\n          }}\n          onError={(e: React.SyntheticEvent<HTMLImageElement>) => {\n            e.currentTarget.src = placeholderSvg;\n          }}\n        />\n        {/* Progress bar at bottom of thumbnail */}\n        {item.progress > 0 && (\n          <div\n            style={{\n              position: 'absolute',\n              bottom: 0,\n              left: 0,\n              right: 0,\n              height: 4,\n              background: 'rgba(0,0,0,0.6)',\n            }}\n          >\n            <div\n              style={{\n                height: '100%',\n                width: `${item.progress}%`,\n                background: '#f59e0b',\n                transition: 'width 0.3s ease',\n              }}\n            />\n          </div>\n        )}\n      </div>\n\n      {/* Title and progress info */}\n      <div style={{ padding: 10 }}>\n        <div\n          style={{\n            fontWeight: 600,\n            fontSize: 13,\n            color: '#e5e7eb',\n            marginBottom: 4,\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          {item.title}\n        </div>\n        <div\n          style={{\n            fontSize: 11,\n            color: '#94a3b8',\n            marginBottom: 4,\n            overflow: 'hidden',\n            textOverflow: 'ellipsis',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          {item.creator}\n        </div>\n        <div\n          style={{\n            fontSize: 11,\n            color: progressPercentage > 0 ? '#10b981' : '#64748b',\n            fontWeight: 500,\n          }}\n        >\n          {progressPercentage > 0 ? `${progressPercentage}%` : 'New'}\n        </div>\n      </div>\n    </Link>\n  );\n}\n\nexport const MobileLibraryCard = memo(MobileLibraryCardComponent);\n","import React, { useState, useEffect } from 'react';\nimport { libraryApi, type Library } from '../services/libraryApi';\nimport { MobileLibraryCard } from './MobileLibraryCard';\nimport { BookOpen, Image, Film, Music } from 'lucide-react';\nimport { useAuth } from '../hooks/useAuth';\n\nconst TAB_ICONS = {\n  books: BookOpen,\n  art: Image,\n  film: Film,\n  music: Music,\n};\n\nexport function MobileLibrary() {\n  const [library, setLibrary] = useState<Library | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedTab, setSelectedTab] = useState<keyof Library>('books');\n  const { isAuthenticated } = useAuth();\n\n  useEffect(() => {\n    if (isAuthenticated) {\n      loadLibrary();\n    } else {\n      setLibrary(null);\n      setLoading(false);\n      setError(null);\n    }\n  }, [isAuthenticated]);\n\n  const loadLibrary = async () => {\n    try {\n      setLoading(true);\n      setError(null);\n      const data = await libraryApi.getLibrary();\n      setLibrary(data);\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'Failed to load library');\n      console.error('Library load error:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  if (!isAuthenticated) {\n    return null;\n  }\n\n  const totalItems = library\n    ? Object.values(library).reduce((sum, items) => sum + items.length, 0)\n    : 0;\n\n  const currentItems = library?.[selectedTab] || [];\n\n  // If library is empty, don't show the section\n  if (!loading && !error && totalItems === 0) {\n    return null;\n  }\n\n  return (\n    <div\n      style={{\n        background: '#0a0f1a',\n        padding: '20px 16px',\n        marginBottom: 16,\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          marginBottom: 16,\n        }}\n      >\n        <div>\n          <h2\n            style={{\n              fontSize: 18,\n              fontWeight: 700,\n              color: '#e5e7eb',\n              margin: 0,\n            }}\n          >\n            My Library\n          </h2>\n          <div\n            style={{\n              fontSize: 13,\n              color: '#94a3b8',\n              marginTop: 2,\n            }}\n          >\n            {totalItems} {totalItems === 1 ? 'item' : 'items'}\n          </div>\n        </div>\n      </div>\n\n      {/* Horizontal scrollable tabs */}\n      <div\n        style={{\n          display: 'flex',\n          gap: 8,\n          overflowX: 'auto',\n          WebkitOverflowScrolling: 'touch',\n          paddingBottom: 8,\n          marginBottom: 16,\n          scrollbarWidth: 'none',\n          msOverflowStyle: 'none',\n        }}\n      >\n        {(['books', 'art', 'film', 'music'] as const).map((tab) => {\n          const count = library?.[tab]?.length || 0;\n          const isActive = selectedTab === tab;\n          const Icon = TAB_ICONS[tab];\n\n          return (\n            <button\n              key={tab}\n              onClick={() => setSelectedTab(tab)}\n              style={{\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                background: isActive ? '#f59e0b' : '#111827',\n                border: '1px solid',\n                borderColor: isActive ? '#f59e0b' : '#2a3444',\n                color: isActive ? '#111827' : '#cbd5e1',\n                padding: '10px 16px',\n                borderRadius: 20,\n                fontSize: 13,\n                fontWeight: 600,\n                cursor: 'pointer',\n                whiteSpace: 'nowrap',\n                flexShrink: 0,\n                transition: 'all 0.2s ease',\n              }}\n            >\n              <Icon size={16} />\n              {tab.charAt(0).toUpperCase() + tab.slice(1)}\n              <span\n                style={{\n                  background: isActive ? 'rgba(0,0,0,0.2)' : '#2a3444',\n                  padding: '2px 8px',\n                  borderRadius: 10,\n                  fontSize: 11,\n                }}\n              >\n                {count}\n              </span>\n            </button>\n          );\n        })}\n      </div>\n\n      {/* Content */}\n      {loading && (\n        <div\n          style={{\n            textAlign: 'center',\n            padding: 32,\n            color: '#94a3b8',\n            fontSize: 14,\n          }}\n        >\n          Loading library...\n        </div>\n      )}\n\n      {error && (\n        <div\n          style={{\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            borderRadius: 12,\n            padding: 16,\n            color: '#fca5a5',\n            fontSize: 14,\n          }}\n        >\n          {error}\n          <button\n            onClick={loadLibrary}\n            style={{\n              marginTop: 8,\n              display: 'block',\n              background: '#ef4444',\n              color: '#fff',\n              border: 'none',\n              padding: '8px 16px',\n              borderRadius: 8,\n              fontSize: 13,\n              fontWeight: 600,\n              cursor: 'pointer',\n            }}\n          >\n            Retry\n          </button>\n        </div>\n      )}\n\n      {!loading && !error && currentItems.length === 0 && (\n        <div\n          style={{\n            textAlign: 'center',\n            padding: 32,\n            color: '#94a3b8',\n            fontSize: 14,\n          }}\n        >\n          No {selectedTab} in your library yet.\n        </div>\n      )}\n\n      {!loading && !error && currentItems.length > 0 && (\n        <div\n          style={{\n            display: 'grid',\n            gridTemplateColumns: 'repeat(2, 1fr)',\n            gap: 12,\n          }}\n        >\n          {currentItems.map((item) => (\n            <MobileLibraryCard key={item.id} item={item} />\n          ))}\n        </div>\n      )}\n    </div>\n  );\n}\n","import { useState, useEffect } from 'react';\n\nexport interface MobileState {\n  isMobile: boolean;      // <= 768px\n  isPhone: boolean;       // <= 480px\n  isTablet: boolean;      // 481px - 768px\n  isDesktop: boolean;     // > 768px\n  screenWidth: number;\n}\n\nfunction getState(): MobileState {\n  const width = typeof window !== 'undefined' ? window.innerWidth : 1024;\n  return {\n    isMobile: width <= 768,\n    isPhone: width <= 480,\n    isTablet: width > 480 && width <= 768,\n    isDesktop: width > 768,\n    screenWidth: width,\n  };\n}\n\nexport function useMobile(): MobileState {\n  const [state, setState] = useState<MobileState>(getState);\n\n  useEffect(() => {\n    const handleResize = () => setState(getState());\n    window.addEventListener('resize', handleResize);\n    return () => window.removeEventListener('resize', handleResize);\n  }, []);\n\n  return state;\n}\n","import React, { useEffect, useState } from 'react';\nimport { Navigate, useLocation } from 'react-router-dom';\nimport { API_URL } from '../config';\n\ninterface ProtectedRouteProps {\n  children: React.ReactNode;\n}\n\nexport default function ProtectedRoute({ children }: ProtectedRouteProps) {\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\n  const location = useLocation();\n\n  useEffect(() => {\n    checkAuth();\n  }, []);\n\n  const checkAuth = async () => {\n    try {\n      const response = await fetch(`${API_URL}/api/auth/status/`, { credentials: 'include' });\n      const data = await response.json();\n      setIsAuthenticated(!!data?.authenticated);\n    } catch {\n      setIsAuthenticated(false);\n    }\n  };\n\n  // Loading state\n  if (isAuthenticated === null) {\n    return (\n      <div style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        height: '60vh',\n        color: '#94a3b8',\n        fontSize: 16,\n      }}>\n        Checking authentication...\n      </div>\n    );\n  }\n\n  // Not authenticated - redirect to auth page\n  if (!isAuthenticated) {\n    return <Navigate to=\"/auth\" state={{ from: location }} replace />;\n  }\n\n  // Authenticated - render children\n  return <>{children}</>;\n}\n","import React, { Component, ErrorInfo, ReactNode } from 'react';\n\ninterface Props {\n  children: ReactNode;\n  fallback?: ReactNode;\n}\n\ninterface State {\n  hasError: boolean;\n  error: Error | null;\n}\n\n/**\n * Error Boundary component to catch and handle React errors gracefully.\n * Prevents the entire app from crashing when a component throws an error.\n */\nclass ErrorBoundary extends Component<Props, State> {\n  constructor(props: Props) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error: Error): State {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: ErrorInfo): void {\n    console.error('ErrorBoundary caught an error:', error, errorInfo);\n  }\n\n  handleRetry = (): void => {\n    this.setState({ hasError: false, error: null });\n  };\n\n  render(): ReactNode {\n    if (this.state.hasError) {\n      if (this.props.fallback) {\n        return this.props.fallback;\n      }\n\n      return (\n        <div style={{\n          display: 'flex',\n          flexDirection: 'column',\n          alignItems: 'center',\n          justifyContent: 'center',\n          minHeight: '200px',\n          padding: '40px',\n          textAlign: 'center',\n          color: 'var(--text, #e5e7eb)',\n        }}>\n          <h2 style={{ marginBottom: '16px', color: 'var(--text, #e5e7eb)' }}>\n            Something went wrong\n          </h2>\n          <p style={{ marginBottom: '24px', color: 'var(--text-muted, #94a3b8)' }}>\n            An error occurred while loading this section.\n          </p>\n          <button\n            onClick={this.handleRetry}\n            style={{\n              padding: '10px 24px',\n              background: 'var(--accent, #f59e0b)',\n              color: '#111',\n              border: 'none',\n              borderRadius: '8px',\n              cursor: 'pointer',\n              fontWeight: 600,\n            }}\n          >\n            Try Again\n          </button>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\nexport default ErrorBoundary;\n","/**\n * Real-time Notification Service\n * Handles collaboration notifications, activity tracking, and real-time updates\n */\n\nimport { API_URL } from '../config';\n\n// ============================================================================\n// TypeScript Interfaces\n// ============================================================================\n\nexport type NotificationType =\n  | 'invitation'\n  | 'invitation_response'\n  | 'comment'\n  | 'approval'\n  | 'section_update'\n  | 'revenue_proposal'\n  | 'mint_ready';\n\nexport interface NotificationUser {\n  id: number;\n  username: string;\n  avatar?: string;\n}\n\nexport interface Notification {\n  id: number;\n  type: NotificationType;\n  title: string;\n  message: string;\n  project_id?: number;\n  from_user: NotificationUser;\n  created_at: string;\n  read: boolean;\n  action_url?: string;\n}\n\nexport interface NotificationStats {\n  total: number;\n  unread: number;\n  by_type: Record<NotificationType, number>;\n}\n\n// ============================================================================\n// Event System for Real-time Updates\n// ============================================================================\n\ntype NotificationEventHandler = (data: any) => void;\n\nclass NotificationEventEmitter {\n  private listeners: Map<string, Set<NotificationEventHandler>> = new Map();\n\n  on(event: string, handler: NotificationEventHandler): () => void {\n    if (!this.listeners.has(event)) {\n      this.listeners.set(event, new Set());\n    }\n    this.listeners.get(event)!.add(handler);\n\n    // Return unsubscribe function\n    return () => this.off(event, handler);\n  }\n\n  off(event: string, handler: NotificationEventHandler): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.delete(handler);\n    }\n  }\n\n  emit(event: string, data: any): void {\n    const handlers = this.listeners.get(event);\n    if (handlers) {\n      handlers.forEach(handler => {\n        try {\n          handler(data);\n        } catch (error) {\n          console.error(`Error in notification event handler for ${event}:`, error);\n        }\n      });\n    }\n  }\n\n  clear(): void {\n    this.listeners.clear();\n  }\n}\n\n// ============================================================================\n// Local State Management\n// ============================================================================\n\ninterface NotificationState {\n  notifications: Notification[];\n  unreadCount: number;\n  lastChecked: Date | null;\n  isPolling: boolean;\n  lastError: Error | null;\n  knownNotificationIds: Set<number>; // Track IDs of notifications we've seen\n  initialLoadComplete: boolean; // Prevent toast spam on first load\n}\n\nconst state: NotificationState = {\n  notifications: [],\n  unreadCount: 0,\n  lastChecked: null,\n  isPolling: false,\n  lastError: null,\n  knownNotificationIds: new Set(),\n  initialLoadComplete: false,\n};\n\n// ============================================================================\n// Configuration\n// ============================================================================\n\nconst CONFIG = {\n  POLLING_INTERVAL: 30000, // 30 seconds\n  MAX_RETRIES: 3,\n  RETRY_DELAY: 5000, // 5 seconds\n  REQUEST_TIMEOUT: 10000, // 10 seconds\n};\n\n// ============================================================================\n// API Helper Functions\n// ============================================================================\n\nasync function getCsrfToken(): Promise<string> {\n  try {\n    const response = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n    const data = await response.json();\n    return data?.csrfToken || '';\n  } catch (error) {\n    console.error('Failed to get CSRF token:', error);\n    return '';\n  }\n}\n\nasync function apiRequest<T>(\n  url: string,\n  options: RequestInit = {}\n): Promise<T> {\n  // Prepend API_URL if url is relative (starts with /)\n  const fullUrl = url.startsWith('/') ? `${API_URL}${url}` : url;\n\n  const response = await fetch(fullUrl, {\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...options.headers,\n    },\n    ...options,\n  });\n\n  if (!response.ok) {\n    const errorData = await response.json().catch(() => ({}));\n    throw new Error(errorData?.error || `API request failed: ${response.status}`);\n  }\n\n  return response.json();\n}\n\n// ============================================================================\n// Core API Functions\n// ============================================================================\n\n/**\n * Fetch all notifications for the current user\n */\nexport async function getNotifications(): Promise<Notification[]> {\n  try {\n    const notifications = await apiRequest<Notification[]>('/api/notifications/');\n    state.notifications = notifications;\n    state.unreadCount = notifications.filter(n => !n.read).length;\n    state.lastChecked = new Date();\n    state.lastError = null;\n\n    // Track known notification IDs (for detecting truly new notifications)\n    notifications.forEach(n => state.knownNotificationIds.add(n.id));\n\n    events.emit('notifications:updated', { notifications, unreadCount: state.unreadCount });\n\n    return notifications;\n  } catch (error) {\n    state.lastError = error as Error;\n    console.error('Failed to fetch notifications:', error);\n    throw error;\n  }\n}\n\n/**\n * Get only unread notifications\n */\nexport async function getUnreadNotifications(): Promise<Notification[]> {\n  const allNotifications = await getNotifications();\n  return allNotifications.filter(n => !n.read);\n}\n\n/**\n * Get unread notification count\n */\nexport async function getUnreadCount(): Promise<number> {\n  try {\n    const notifications = await getNotifications();\n    const count = notifications.filter(n => !n.read).length;\n    state.unreadCount = count;\n\n    events.emit('notifications:unread-count', { count });\n\n    return count;\n  } catch (error) {\n    console.error('Failed to get unread count:', error);\n    return state.unreadCount; // Return cached count on error\n  }\n}\n\n/**\n * Mark a single notification as read\n */\nexport async function markNotificationRead(notificationId: number): Promise<void> {\n  try {\n    const csrfToken = await getCsrfToken();\n\n    await apiRequest(`/api/notifications/${notificationId}/mark-read/`, {\n      method: 'POST',\n      headers: {\n        'X-CSRFToken': csrfToken,\n      },\n    });\n\n    // Update local state\n    const notification = state.notifications.find(n => n.id === notificationId);\n    if (notification && !notification.read) {\n      notification.read = true;\n      state.unreadCount = Math.max(0, state.unreadCount - 1);\n\n      events.emit('notifications:updated', {\n        notifications: state.notifications,\n        unreadCount: state.unreadCount\n      });\n      events.emit('notifications:unread-count', { count: state.unreadCount });\n    }\n  } catch (error) {\n    console.error('Failed to mark notification as read:', error);\n    throw error;\n  }\n}\n\n/**\n * Mark all notifications as read\n */\nexport async function markAllNotificationsRead(): Promise<void> {\n  try {\n    const csrfToken = await getCsrfToken();\n\n    await apiRequest('/api/notifications/mark-all-read/', {\n      method: 'POST',\n      headers: {\n        'X-CSRFToken': csrfToken,\n      },\n    });\n\n    // Update local state\n    state.notifications.forEach(n => n.read = true);\n    state.unreadCount = 0;\n\n    events.emit('notifications:updated', {\n      notifications: state.notifications,\n      unreadCount: 0\n    });\n    events.emit('notifications:unread-count', { count: 0 });\n  } catch (error) {\n    console.error('Failed to mark all notifications as read:', error);\n    throw error;\n  }\n}\n\n/**\n * Delete a notification\n */\nexport async function deleteNotification(notificationId: number): Promise<void> {\n  // Helper to update local state after delete\n  const removeFromLocalState = () => {\n    const index = state.notifications.findIndex(n => n.id === notificationId);\n    if (index !== -1) {\n      const wasUnread = !state.notifications[index].read;\n      state.notifications.splice(index, 1);\n\n      if (wasUnread) {\n        state.unreadCount = Math.max(0, state.unreadCount - 1);\n      }\n\n      // Also remove from known IDs\n      state.knownNotificationIds.delete(notificationId);\n\n      events.emit('notifications:updated', {\n        notifications: state.notifications,\n        unreadCount: state.unreadCount\n      });\n      events.emit('notifications:unread-count', { count: state.unreadCount });\n    }\n  };\n\n  try {\n    const csrfToken = await getCsrfToken();\n\n    const fullUrl = `${API_URL}/api/notifications/${notificationId}/`;\n    const response = await fetch(fullUrl, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrfToken,\n      },\n    });\n\n    // Handle 404 gracefully - notification doesn't exist or already deleted\n    // Still remove from local state since it's effectively \"gone\"\n    if (response.status === 404) {\n      console.warn(`Notification ${notificationId} not found on server, removing from local state`);\n      removeFromLocalState();\n      return;\n    }\n\n    if (!response.ok) {\n      throw new Error(`Failed to delete notification: ${response.status}`);\n    }\n\n    // Successfully deleted - update local state\n    removeFromLocalState();\n  } catch (error) {\n    console.error('Failed to delete notification:', error);\n    // On network error, still try to remove from local state for better UX\n    removeFromLocalState();\n    throw error;\n  }\n}\n\n/**\n * Get notification statistics\n */\nexport async function getNotificationStats(): Promise<NotificationStats> {\n  const notifications = await getNotifications();\n\n  const stats: NotificationStats = {\n    total: notifications.length,\n    unread: notifications.filter(n => !n.read).length,\n    by_type: {\n      invitation: 0,\n      invitation_response: 0,\n      comment: 0,\n      approval: 0,\n      section_update: 0,\n      revenue_proposal: 0,\n      mint_ready: 0,\n    },\n  };\n\n  notifications.forEach(n => {\n    stats.by_type[n.type] = (stats.by_type[n.type] || 0) + 1;\n  });\n\n  return stats;\n}\n\n// ============================================================================\n// Real-time Polling System\n// ============================================================================\n\nlet pollingInterval: NodeJS.Timeout | null = null;\nlet retryCount = 0;\nlet retryTimeout: NodeJS.Timeout | null = null;\n\n/**\n * Poll for new notifications\n */\nasync function pollNotifications(): Promise<void> {\n  if (!state.isPolling) return;\n\n  try {\n    // Store IDs of previously known notifications before fetching\n    const previouslyKnownIds = new Set(state.knownNotificationIds);\n\n    await getNotifications();\n\n    // Only emit 'notifications:new' after initial load is complete\n    // This prevents a flood of toasts when the page first loads\n    if (state.initialLoadComplete) {\n      // Find truly NEW notifications (IDs we haven't seen before)\n      const newNotifications = state.notifications.filter(\n        n => !previouslyKnownIds.has(n.id) && !n.read\n      );\n\n      if (newNotifications.length > 0) {\n        events.emit('notifications:new', {\n          notifications: newNotifications,\n          count: newNotifications.length\n        });\n      }\n    } else {\n      // Mark initial load as complete after first successful fetch\n      state.initialLoadComplete = true;\n    }\n\n    // Reset retry count on success\n    retryCount = 0;\n  } catch (error) {\n    console.error('Polling error:', error);\n    retryCount++;\n\n    if (retryCount >= CONFIG.MAX_RETRIES) {\n      console.error('Max retries reached, stopping polling');\n      stopPolling();\n      events.emit('notifications:polling-error', { error, retryCount });\n    } else {\n      // Schedule retry\n      if (retryTimeout) clearTimeout(retryTimeout);\n      retryTimeout = setTimeout(() => {\n        pollNotifications();\n      }, CONFIG.RETRY_DELAY);\n    }\n  }\n}\n\n/**\n * Start polling for notifications\n */\nexport function startPolling(): void {\n  if (state.isPolling) {\n    console.warn('Notification polling already started');\n    return;\n  }\n\n  console.log('Starting notification polling...');\n  state.isPolling = true;\n  retryCount = 0;\n\n  // Initial fetch\n  pollNotifications();\n\n  // Set up polling interval\n  pollingInterval = setInterval(pollNotifications, CONFIG.POLLING_INTERVAL);\n\n  events.emit('notifications:polling-started', {});\n}\n\n/**\n * Stop polling for notifications\n */\nexport function stopPolling(): void {\n  if (!state.isPolling) {\n    return;\n  }\n\n  console.log('Stopping notification polling...');\n  state.isPolling = false;\n\n  if (pollingInterval) {\n    clearInterval(pollingInterval);\n    pollingInterval = null;\n  }\n\n  if (retryTimeout) {\n    clearTimeout(retryTimeout);\n    retryTimeout = null;\n  }\n\n  events.emit('notifications:polling-stopped', {});\n}\n\n/**\n * Check if polling is active\n */\nexport function isPolling(): boolean {\n  return state.isPolling;\n}\n\n/**\n * Update polling interval\n */\nexport function setPollingInterval(intervalMs: number): void {\n  CONFIG.POLLING_INTERVAL = intervalMs;\n\n  if (state.isPolling) {\n    stopPolling();\n    startPolling();\n  }\n}\n\n// ============================================================================\n// Event System Export\n// ============================================================================\n\nexport const events = new NotificationEventEmitter();\n\n/**\n * Available events:\n * - 'notifications:updated' - Fired when notifications list is updated\n * - 'notifications:unread-count' - Fired when unread count changes\n * - 'notifications:new' - Fired when new notifications are received\n * - 'notifications:polling-started' - Fired when polling starts\n * - 'notifications:polling-stopped' - Fired when polling stops\n * - 'notifications:polling-error' - Fired when polling encounters errors\n */\n\n// ============================================================================\n// State Access Functions\n// ============================================================================\n\n/**\n * Get current notification state\n */\nexport function getState(): Readonly<NotificationState> {\n  return { ...state };\n}\n\n/**\n * Get cached notifications (without API call)\n */\nexport function getCachedNotifications(): Notification[] {\n  return [...state.notifications];\n}\n\n/**\n * Get cached unread count (without API call)\n */\nexport function getCachedUnreadCount(): number {\n  return state.unreadCount;\n}\n\n/**\n * Clear local state and stop polling\n */\nexport function reset(): void {\n  stopPolling();\n  state.notifications = [];\n  state.unreadCount = 0;\n  state.lastChecked = null;\n  state.lastError = null;\n  state.knownNotificationIds.clear();\n  state.initialLoadComplete = false;\n  events.clear();\n}\n\n// ============================================================================\n// Utility Functions\n// ============================================================================\n\n/**\n * Get human-readable time ago string\n */\nexport function getTimeAgo(dateString: string): string {\n  const date = new Date(dateString);\n  const now = new Date();\n  const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);\n\n  if (seconds < 60) return 'just now';\n  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;\n  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;\n  if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;\n  return date.toLocaleDateString();\n}\n\n/**\n * Get notification icon based on type\n */\nexport function getNotificationIcon(type: NotificationType): string {\n  const icons: Record<NotificationType, string> = {\n    invitation: '',\n    invitation_response: '',\n    comment: '',\n    approval: '',\n    section_update: '',\n    revenue_proposal: '',\n    mint_ready: '',\n  };\n  return icons[type] || '';\n}\n\n/**\n * Get notification color based on type\n */\nexport function getNotificationColor(type: NotificationType): string {\n  const colors: Record<NotificationType, string> = {\n    invitation: '#3b82f6', // blue\n    invitation_response: '#8b5cf6', // purple\n    comment: '#06b6d4', // cyan\n    approval: '#10b981', // green\n    section_update: '#f59e0b', // amber\n    revenue_proposal: '#eab308', // yellow\n    mint_ready: '#ec4899', // pink\n  };\n  return colors[type] || '#6b7280';\n}\n\n// ============================================================================\n// Export Default Service\n// ============================================================================\n\nexport default {\n  // API Functions\n  getNotifications,\n  getUnreadNotifications,\n  getUnreadCount,\n  markNotificationRead,\n  markAllNotificationsRead,\n  deleteNotification,\n  getNotificationStats,\n\n  // Polling Functions\n  startPolling,\n  stopPolling,\n  isPolling,\n  setPollingInterval,\n\n  // State Functions\n  getState,\n  getCachedNotifications,\n  getCachedUnreadCount,\n  reset,\n\n  // Event System\n  events,\n\n  // Utilities\n  getTimeAgo,\n  getNotificationIcon,\n  getNotificationColor,\n};\n","/**\n * React Hook for Notification System\n * Provides easy integration with notificationService in React components\n */\n\nimport { useEffect, useState, useCallback } from 'react';\nimport notificationService, {\n  Notification,\n  NotificationStats,\n  events,\n} from '../services/notificationService';\n\ninterface UseNotificationsOptions {\n  autoStart?: boolean; // Auto-start polling when hook mounts\n  onNewNotification?: (notifications: Notification[]) => void; // Callback for new notifications\n}\n\ninterface UseNotificationsReturn {\n  notifications: Notification[];\n  unreadCount: number;\n  isLoading: boolean;\n  isPolling: boolean;\n  error: Error | null;\n\n  // Actions\n  refresh: () => Promise<void>;\n  markAsRead: (notificationId: number) => Promise<void>;\n  markAllAsRead: () => Promise<void>;\n  deleteNotification: (notificationId: number) => Promise<void>;\n  startPolling: () => void;\n  stopPolling: () => void;\n  getStats: () => Promise<NotificationStats>;\n}\n\n/**\n * Custom hook for managing notifications\n */\nexport function useNotifications(\n  options: UseNotificationsOptions = {}\n): UseNotificationsReturn {\n  const { autoStart = false, onNewNotification } = options;\n\n  // State\n  const [notifications, setNotifications] = useState<Notification[]>([]);\n  const [unreadCount, setUnreadCount] = useState<number>(0);\n  const [isLoading, setIsLoading] = useState<boolean>(false);\n  const [isPolling, setIsPolling] = useState<boolean>(false);\n  const [error, setError] = useState<Error | null>(null);\n\n  // Refresh notifications\n  const refresh = useCallback(async () => {\n    setIsLoading(true);\n    setError(null);\n\n    try {\n      const data = await notificationService.getNotifications();\n      setNotifications(data);\n      setUnreadCount(data.filter(n => !n.read).length);\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to refresh notifications:', err);\n    } finally {\n      setIsLoading(false);\n    }\n  }, []);\n\n  // Mark notification as read\n  const markAsRead = useCallback(async (notificationId: number) => {\n    try {\n      await notificationService.markNotificationRead(notificationId);\n      // State will be updated via event listener\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to mark notification as read:', err);\n      throw err;\n    }\n  }, []);\n\n  // Mark all notifications as read\n  const markAllAsRead = useCallback(async () => {\n    try {\n      await notificationService.markAllNotificationsRead();\n      // State will be updated via event listener\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to mark all notifications as read:', err);\n      throw err;\n    }\n  }, []);\n\n  // Delete notification\n  const deleteNotificationCallback = useCallback(async (notificationId: number) => {\n    try {\n      await notificationService.deleteNotification(notificationId);\n      // State will be updated via event listener\n    } catch (err) {\n      // Don't throw - the service handles 404 gracefully and updates local state\n      // Other errors are logged but we don't want to block the UI\n      console.error('Failed to delete notification:', err);\n    }\n  }, []);\n\n  // Start polling\n  const startPollingCallback = useCallback(() => {\n    notificationService.startPolling();\n    setIsPolling(true);\n  }, []);\n\n  // Stop polling\n  const stopPollingCallback = useCallback(() => {\n    notificationService.stopPolling();\n    setIsPolling(false);\n  }, []);\n\n  // Get statistics\n  const getStats = useCallback(async () => {\n    try {\n      return await notificationService.getNotificationStats();\n    } catch (err) {\n      setError(err as Error);\n      console.error('Failed to get notification stats:', err);\n      throw err;\n    }\n  }, []);\n\n  // Subscribe to notification events\n  useEffect(() => {\n    // Handle notifications updated\n    const unsubUpdated = events.on('notifications:updated', ({ notifications, unreadCount }) => {\n      setNotifications(notifications);\n      setUnreadCount(unreadCount);\n    });\n\n    // Handle unread count changes\n    const unsubUnreadCount = events.on('notifications:unread-count', ({ count }) => {\n      setUnreadCount(count);\n    });\n\n    // Handle new notifications\n    const unsubNew = events.on('notifications:new', ({ notifications: newNotifs }) => {\n      if (onNewNotification) {\n        onNewNotification(newNotifs);\n      }\n    });\n\n    // Handle polling state changes\n    const unsubPollingStarted = events.on('notifications:polling-started', () => {\n      setIsPolling(true);\n    });\n\n    const unsubPollingStopped = events.on('notifications:polling-stopped', () => {\n      setIsPolling(false);\n    });\n\n    // Handle polling errors\n    const unsubPollingError = events.on('notifications:polling-error', ({ error }) => {\n      setError(error);\n      setIsPolling(false);\n    });\n\n    // Cleanup subscriptions\n    return () => {\n      unsubUpdated();\n      unsubUnreadCount();\n      unsubNew();\n      unsubPollingStarted();\n      unsubPollingStopped();\n      unsubPollingError();\n    };\n  }, [onNewNotification]);\n\n  // Auto-start polling if enabled\n  useEffect(() => {\n    if (autoStart) {\n      startPollingCallback();\n      refresh();\n    }\n\n    return () => {\n      if (autoStart) {\n        stopPollingCallback();\n      }\n    };\n  }, [autoStart, startPollingCallback, stopPollingCallback, refresh]);\n\n  return {\n    notifications,\n    unreadCount,\n    isLoading,\n    isPolling,\n    error,\n\n    refresh,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification: deleteNotificationCallback,\n    startPolling: startPollingCallback,\n    stopPolling: stopPollingCallback,\n    getStats,\n  };\n}\n\n/**\n * Simple hook to just get unread count\n */\nexport function useUnreadCount(autoStart = false): {\n  unreadCount: number;\n  refresh: () => Promise<void>;\n} {\n  const [unreadCount, setUnreadCount] = useState<number>(0);\n\n  const refresh = useCallback(async () => {\n    try {\n      const count = await notificationService.getUnreadCount();\n      setUnreadCount(count);\n    } catch (err) {\n      console.error('Failed to get unread count:', err);\n    }\n  }, []);\n\n  useEffect(() => {\n    const unsubUnreadCount = events.on('notifications:unread-count', ({ count }) => {\n      setUnreadCount(count);\n    });\n\n    if (autoStart) {\n      refresh();\n    }\n\n    return () => {\n      unsubUnreadCount();\n    };\n  }, [autoStart, refresh]);\n\n  return { unreadCount, refresh };\n}\n\nexport default useNotifications;\n","/**\n * NotificationItem Component\n * Reusable component for individual notifications\n */\n\nimport React, { memo } from 'react';\nimport {\n  Mail,\n  MailOpen,\n  MessageSquare,\n  CheckCircle,\n  FileEdit,\n  DollarSign,\n  PartyPopper,\n  Bell,\n} from 'lucide-react';\nimport {\n  Notification,\n  NotificationType,\n  getTimeAgo,\n  getNotificationColor,\n} from '../../services/notificationService';\n\n// Get Lucide icon component based on notification type\nfunction getNotificationLucideIcon(type: NotificationType): React.ReactNode {\n  const iconProps = { size: 20 };\n\n  switch (type) {\n    case 'invitation':\n      return <Mail {...iconProps} />;\n    case 'invitation_response':\n      return <MailOpen {...iconProps} />;\n    case 'comment':\n      return <MessageSquare {...iconProps} />;\n    case 'approval':\n      return <CheckCircle {...iconProps} />;\n    case 'section_update':\n      return <FileEdit {...iconProps} />;\n    case 'revenue_proposal':\n      return <DollarSign {...iconProps} />;\n    case 'mint_ready':\n      return <PartyPopper {...iconProps} />;\n    default:\n      return <Bell {...iconProps} />;\n  }\n}\n\ninterface NotificationItemProps {\n  notification: Notification;\n  onClick: () => void;\n  onDelete: (e: React.MouseEvent) => void;\n  onViewInvite?: (notification: Notification) => void;\n}\n\nfunction NotificationItemComponent({ notification, onClick, onDelete, onViewInvite }: NotificationItemProps) {\n  const icon = getNotificationLucideIcon(notification.type);\n  const color = getNotificationColor(notification.type);\n  const timeAgo = getTimeAgo(notification.created_at);\n  const isInvitation = notification.type === 'invitation';\n\n  return (\n    <div\n      onClick={onClick}\n      role=\"button\"\n      tabIndex={0}\n      aria-label={`${notification.read ? 'Read' : 'Unread'} notification: ${notification.title}`}\n      onKeyDown={(e) => {\n        if (e.key === 'Enter' || e.key === ' ') {\n          e.preventDefault();\n          onClick();\n        }\n      }}\n      style={{\n        padding: '12px 20px',\n        cursor: 'pointer',\n        background: notification.read ? 'transparent' : '#0b1220',\n        borderLeft: `3px solid ${notification.read ? 'transparent' : color}`,\n        transition: 'all 0.2s',\n        position: 'relative',\n      }}\n      onMouseEnter={(e) => {\n        e.currentTarget.style.background = '#1e293b';\n      }}\n      onMouseLeave={(e) => {\n        e.currentTarget.style.background = notification.read ? 'transparent' : '#0b1220';\n      }}\n    >\n      <div style={{ display: 'flex', gap: 12 }}>\n        {/* Icon */}\n        <div\n          style={{\n            width: 40,\n            height: 40,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            background: `${color}20`,\n            borderRadius: 8,\n            flexShrink: 0,\n            color: color,\n          }}\n          aria-hidden=\"true\"\n        >\n          {icon}\n        </div>\n\n        {/* Content */}\n        <div style={{ flex: 1, minWidth: 0 }}>\n          <div\n            style={{\n              fontSize: 13,\n              fontWeight: 600,\n              color: '#e5e7eb',\n              marginBottom: 4,\n              lineHeight: 1.4,\n            }}\n          >\n            {notification.title}\n          </div>\n          <div\n            style={{\n              fontSize: 12,\n              color: '#94a3b8',\n              marginBottom: 6,\n              lineHeight: 1.5,\n            }}\n          >\n            {notification.message}\n          </div>\n          <div\n            style={{\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              fontSize: 11,\n              color: '#64748b',\n            }}\n          >\n            <span>@{notification.from_user.username}</span>\n            <span></span>\n            <span>{timeAgo}</span>\n          </div>\n\n          {/* View Invite button for invitation notifications */}\n          {isInvitation && onViewInvite && (\n            <button\n              onClick={(e) => {\n                e.stopPropagation();\n                onViewInvite(notification);\n              }}\n              style={{\n                marginTop: 10,\n                background: '#f59e0b',\n                color: '#000',\n                border: 'none',\n                padding: '8px 16px',\n                borderRadius: 6,\n                fontSize: 12,\n                fontWeight: 700,\n                cursor: 'pointer',\n                display: 'flex',\n                alignItems: 'center',\n                gap: 6,\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.background = '#fbbf24';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.background = '#f59e0b';\n              }}\n            >\n              View Invite \n            </button>\n          )}\n        </div>\n\n        {/* Delete button */}\n        <button\n          onClick={onDelete}\n          aria-label=\"Delete notification\"\n          style={{\n            background: 'transparent',\n            border: 'none',\n            color: '#64748b',\n            cursor: 'pointer',\n            padding: 4,\n            borderRadius: 4,\n            fontSize: 18,\n            width: 28,\n            height: 28,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            flexShrink: 0,\n            opacity: 0.6,\n            transition: 'all 0.2s',\n          }}\n          onMouseEnter={(e) => {\n            e.currentTarget.style.background = '#1e293b';\n            e.currentTarget.style.color = '#ef4444';\n            e.currentTarget.style.opacity = '1';\n          }}\n          onMouseLeave={(e) => {\n            e.currentTarget.style.background = 'transparent';\n            e.currentTarget.style.color = '#64748b';\n            e.currentTarget.style.opacity = '0.6';\n          }}\n        >\n          \n        </button>\n      </div>\n\n      {/* Unread indicator */}\n      {!notification.read && (\n        <div\n          aria-label=\"Unread\"\n          style={{\n            position: 'absolute',\n            top: 18,\n            right: 20,\n            width: 8,\n            height: 8,\n            background: color,\n            borderRadius: '50%',\n            boxShadow: `0 0 8px ${color}`,\n          }}\n        />\n      )}\n    </div>\n  );\n}\n\nexport const NotificationItem = memo(NotificationItemComponent);\n\nexport default NotificationItem;\n","/**\n * Collaboration API Service\n *\n * Provides functions for managing collaborative projects, invitations,\n * sections, and communication between collaborators.\n */\n\nimport { API_URL as API_BASE } from '../config';\n\n// ===== TypeScript Interfaces =====\n\nexport interface CopyrightPreview {\n  copyright_line: string;\n  blockchain_message: string;\n  full_text: string;\n}\n\nexport interface CollaborativeProject {\n  id: number;\n  title: string;\n  content_type: 'book' | 'music' | 'video' | 'art' | 'comic';\n  description: string;\n  status: 'draft' | 'active' | 'ready_for_mint' | 'minted' | 'cancelled';\n  milestones: Milestone[];\n  price_usd: number;\n  editions: number;\n  teaser_percent: number;\n  watermark_preview: boolean;\n  authors_note?: string;\n  estimated_earnings?: { [userId: number]: number };\n  copyright_preview?: CopyrightPreview;\n  created_by: number;\n  created_by_username: string;\n  created_at: string;\n  updated_at: string;\n  collaborators: CollaboratorRole[];\n  sections: ProjectSection[];\n  recent_comments: ProjectComment[];\n  is_fully_approved: boolean;\n  total_collaborators: number;\n  progress_percentage: number;\n  is_solo: boolean;\n  cover_image?: string | null;\n}\n\nexport interface CollaborativeProjectListItem {\n  id: number;\n  title: string;\n  content_type: string;\n  status: string;\n  created_by: number;\n  created_by_username: string;\n  total_collaborators: number;\n  created_at: string;\n  updated_at: string;\n  price_usd: number;\n  is_solo: boolean;\n  cover_image?: string | null;\n}\n\n// Contract task interface for task-based collaboration\nexport interface ContractTask {\n  id: number;\n  title: string;\n  description: string;\n  deadline: string;\n  status: 'pending' | 'in_progress' | 'complete' | 'signed_off' | 'cancelled';\n  order: number;\n  marked_complete_at?: string;\n  marked_complete_by?: number;\n  marked_complete_by_username?: string;\n  completion_notes?: string;\n  signed_off_at?: string;\n  signed_off_by?: number;\n  signed_off_by_username?: string;\n  signoff_notes?: string;\n  rejection_notes?: string;\n  rejected_at?: string;\n  is_overdue: boolean;\n  days_until_deadline?: number;\n  created_at: string;\n  updated_at: string;\n}\n\n// Role definition for standard roles\nexport interface RoleDefinition {\n  id: number;\n  name: string;\n  category: 'creator' | 'contributor' | 'reviewer' | 'technical' | 'management';\n  description: string;\n  applicable_to_book: boolean;\n  applicable_to_art: boolean;\n  applicable_to_music: boolean;\n  applicable_to_video: boolean;\n  default_permissions: {\n    create: string[];\n    edit: { scope: string; types: string[] };\n    review: string[];\n  };\n  ui_components: string[];\n  icon: string;\n  color: string;\n  is_active: boolean;\n}\n\nexport interface CollaboratorRole {\n  id: number;\n  user: number;\n  username: string;\n  display_name: string;\n  avatar_url?: string;\n  role: string;\n  revenue_percentage: number;\n  status: 'invited' | 'accepted' | 'declined' | 'exited';\n  invited_at: string;\n  accepted_at?: string;\n  // Legacy permission flags (still supported)\n  can_edit_text: boolean;\n  can_edit_images: boolean;\n  can_edit_audio: boolean;\n  can_edit_video: boolean;\n  can_edit: string[];\n  // New role-based permission fields\n  role_definition_id?: number;\n  role_definition_details?: RoleDefinition;\n  permissions?: {\n    create?: string[];\n    edit?: { scope: string; types: string[] };\n    review?: string[];\n  };\n  effective_role_name?: string;\n  effective_permissions?: {\n    create: string[];\n    edit: { scope: string; types: string[] };\n    review: string[];\n  };\n  ui_components?: string[];\n  // Approval tracking\n  approved_current_version: boolean;\n  approved_revenue_split: boolean;\n  // Counter-proposal fields\n  proposed_percentage?: number;\n  counter_message?: string;\n  // Deadline and accountability fields\n  delivery_deadline?: string;\n  deadline_extended_at?: string;\n  deadline_extension_reason?: string;\n  sections_due?: number[];\n  // Multi-party governance fields\n  is_lead: boolean;\n  can_invite_others: boolean;\n  voting_weight: number;\n  // Contract task fields\n  contract_tasks: ContractTask[];\n  tasks_total: number;\n  tasks_signed_off: number;\n  all_tasks_complete: boolean;\n  has_active_breach: boolean;\n  cancellation_eligible: boolean;\n  contract_version: number;\n  contract_locked_at?: string;\n}\n\nexport interface ProjectSection {\n  id: number;\n  section_type: 'text' | 'image' | 'audio' | 'video';\n  title: string;\n  content_html?: string;\n  synopsis?: string;\n  media_file?: string;\n  owner: number;\n  owner_username: string;\n  order: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface CommentReaction {\n  id: number;\n  user_id: number;\n  username: string;\n  emoji: string;\n}\n\nexport interface ProjectComment {\n  id: number;\n  author: number;\n  author_username: string;\n  author_avatar: string;\n  content: string;\n  parent_comment?: number;\n  section?: number;\n  section_title?: string;\n  resolved: boolean;\n  resolved_by?: number;\n  resolved_by_username?: string;\n  resolved_at?: string;\n  created_at: string;\n  updated_at?: string;\n  edited: boolean;\n  edit_history?: Array<{\n    content: string;\n    edited_at: string;\n  }>;\n  replies_count: number;\n  replies?: ProjectComment[];\n  reactions?: CommentReaction[];\n  attachments?: Array<{\n    id: number;\n    filename: string;\n    file_url: string;\n    file_size: number;\n  }>;\n  mentions?: number[]; // User IDs mentioned in the comment\n}\n\nexport interface Milestone {\n  id?: string;\n  title: string;\n  description?: string;\n  due_date?: string;\n  completed: boolean;\n}\n\nexport interface RevenueSplit {\n  user_id: number;\n  percentage: number;\n}\n\nexport interface InviteCollaboratorData {\n  user_id: number;\n  role: string;\n  revenue_percentage: number;\n  can_edit_text?: boolean;\n  can_edit_images?: boolean;\n  can_edit_audio?: boolean;\n  can_edit_video?: boolean;\n}\n\nexport interface CreateProjectData {\n  title: string;\n  content_type: 'book' | 'music' | 'video' | 'art' | 'comic';\n  description?: string;\n  milestones?: Milestone[];\n  is_solo?: boolean;\n}\n\nexport interface CreateSectionData {\n  project: number;\n  section_type: 'text' | 'image' | 'audio' | 'video';\n  title: string;\n  content_html?: string;\n  media_file?: File;\n  order?: number;\n}\n\nexport interface CreateCommentData {\n  project: number;\n  content: string;\n  section?: number;\n  parent_comment?: number;\n  mentions?: number[];\n  attachments?: File[];\n}\n\n// ===== Helper Functions =====\n\n/**\n * Get fresh CSRF token from API\n * This is more reliable than reading from cookies\n */\nasync function getFreshCsrfToken(): Promise<string> {\n  try {\n    const response = await fetch(`${API_BASE}/api/auth/csrf/`, {\n      credentials: 'include',\n    });\n    const data = await response.json();\n    return data?.csrfToken || '';\n  } catch (error) {\n    console.error('Failed to fetch CSRF token:', error);\n    return '';\n  }\n}\n\n/**\n * Handle API errors with detailed messages\n */\nasync function handleResponse<T>(response: Response): Promise<T> {\n  if (!response.ok) {\n    let errorMessage = `Request failed: ${response.statusText}`;\n    try {\n      const errorData = await response.json();\n      if (errorData.error) {\n        errorMessage = errorData.error;\n      } else if (errorData.detail) {\n        errorMessage = errorData.detail;\n      }\n    } catch {\n      // Response body not JSON, use status text\n    }\n    throw new Error(errorMessage);\n  }\n  return response.json();\n}\n\n// ===== API Functions =====\n\nexport const collaborationApi = {\n  // ===== Project Management =====\n\n  /**\n   * Create a new collaborative project\n   */\n  async createCollaborativeProject(data: CreateProjectData): Promise<CollaborativeProject> {\n    const csrfToken = await getFreshCsrfToken();\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': csrfToken,\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Get all collaborative projects for current user\n   */\n  async getCollaborativeProjects(): Promise<CollaborativeProjectListItem[]> {\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    return handleResponse<CollaborativeProjectListItem[]>(response);\n  },\n\n  /**\n   * Get single project with full details\n   */\n  async getCollaborativeProject(id: number): Promise<CollaborativeProject> {\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/${id}/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Get all pending collaboration invites for the current user\n   * Returns projects where user has status='invited'\n   */\n  async getPendingInvites(): Promise<{ project: CollaborativeProject; invite: CollaboratorRole }[]> {\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/pending_invites/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    return handleResponse<{ project: CollaborativeProject; invite: CollaboratorRole }[]>(response);\n  },\n\n  /**\n   * Update collaborative project\n   */\n  async updateCollaborativeProject(\n    id: number,\n    data: Partial<CreateProjectData>\n  ): Promise<CollaborativeProject> {\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/${id}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Delete collaborative project\n   */\n  async deleteCollaborativeProject(id: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/collaborative-projects/${id}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to delete project: ${response.statusText}`);\n    }\n  },\n\n  // ===== Collaboration Actions =====\n\n  /**\n   * Invite a collaborator to the project\n   */\n  async inviteCollaborator(\n    projectId: number,\n    data: InviteCollaboratorData\n  ): Promise<CollaboratorRole> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/invite_collaborator/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<CollaboratorRole>(response);\n  },\n\n  /**\n   * Accept invitation to collaborate\n   */\n  async acceptInvitation(projectId: number): Promise<CollaboratorRole> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/accept_invitation/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<CollaboratorRole>(response);\n  },\n\n  /**\n   * Decline invitation to collaborate\n   */\n  async declineInvitation(projectId: number): Promise<{ message: string }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/decline_invitation/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<{ message: string }>(response);\n  },\n\n  /**\n   * Submit counter-proposal for collaboration invitation\n   */\n  async counterProposeInvite(\n    projectId: number,\n    data: { proposed_percentage: number; message: string }\n  ): Promise<{ message: string; invitation: CollaboratorRole }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/counter_propose/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<{ message: string; invitation: CollaboratorRole }>(response);\n  },\n\n  /**\n   * Propose new revenue split percentages\n   */\n  async proposeRevenueSplit(\n    projectId: number,\n    splits: RevenueSplit[]\n  ): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/propose_revenue_split/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ splits }),\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  // ===== Approval System =====\n\n  /**\n   * Approve current version for minting\n   */\n  async approveCurrentVersion(projectId: number): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/approve_version/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Get approval status for a project\n   */\n  async getApprovalStatus(projectId: number): Promise<{\n    is_fully_approved: boolean;\n    pending_approvals: string[];\n  }> {\n    const project = await this.getCollaborativeProject(projectId);\n\n    const pendingApprovals = project.collaborators\n      .filter(\n        (c) =>\n          c.status === 'accepted' &&\n          (!c.approved_current_version || !c.approved_revenue_split)\n      )\n      .map((c) => c.username);\n\n    return {\n      is_fully_approved: project.is_fully_approved,\n      pending_approvals: pendingApprovals,\n    };\n  },\n\n  /**\n   * Get project preview (combined sections)\n   */\n  async getProjectPreview(projectId: number): Promise<{\n    title: string;\n    content_type: string;\n    sections: any[];\n  }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/preview/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse(response);\n  },\n\n  // ===== Section Management =====\n\n  /**\n   * Create a new project section\n   */\n  async createProjectSection(data: CreateSectionData): Promise<ProjectSection> {\n    const formData = new FormData();\n    formData.append('project', data.project.toString());\n    formData.append('section_type', data.section_type);\n    formData.append('title', data.title);\n    if (data.content_html) {\n      formData.append('content_html', data.content_html);\n    }\n    if (data.media_file) {\n      formData.append('media_file', data.media_file);\n    }\n    if (data.order !== undefined) {\n      formData.append('order', data.order.toString());\n    }\n\n    const response = await fetch(`${API_BASE}/api/project-sections/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: formData,\n    });\n\n    return handleResponse<ProjectSection>(response);\n  },\n\n  /**\n   * Update project section\n   */\n  async updateProjectSection(\n    id: number,\n    data: Partial<CreateSectionData>\n  ): Promise<ProjectSection> {\n    const formData = new FormData();\n    if (data.section_type) {\n      formData.append('section_type', data.section_type);\n    }\n    if (data.title) {\n      formData.append('title', data.title);\n    }\n    if (data.content_html !== undefined) {\n      formData.append('content_html', data.content_html);\n    }\n    if (data.media_file) {\n      formData.append('media_file', data.media_file);\n    }\n    if (data.order !== undefined) {\n      formData.append('order', data.order.toString());\n    }\n\n    const response = await fetch(`${API_BASE}/api/project-sections/${id}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: formData,\n    });\n\n    return handleResponse<ProjectSection>(response);\n  },\n\n  /**\n   * Delete project section\n   */\n  async deleteProjectSection(id: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/project-sections/${id}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to delete section: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Get all sections for a project\n   */\n  async getProjectSections(projectId: number): Promise<ProjectSection[]> {\n    const response = await fetch(\n      `${API_BASE}/api/project-sections/?project=${projectId}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse<ProjectSection[]>(response);\n  },\n\n  // ===== Communication =====\n\n  /**\n   * Add a comment to project or section\n   */\n  async addComment(data: CreateCommentData): Promise<ProjectComment> {\n    // Use FormData if there are attachments\n    if (data.attachments && data.attachments.length > 0) {\n      const formData = new FormData();\n      formData.append('project', data.project.toString());\n      formData.append('content', data.content);\n      if (data.section) formData.append('section', data.section.toString());\n      if (data.parent_comment) formData.append('parent_comment', data.parent_comment.toString());\n      if (data.mentions) formData.append('mentions', JSON.stringify(data.mentions));\n\n      data.attachments.forEach((file, index) => {\n        formData.append(`attachment_${index}`, file);\n      });\n\n      const response = await fetch(`${API_BASE}/api/project-comments/`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: formData,\n      });\n\n      return handleResponse<ProjectComment>(response);\n    }\n\n    // Regular JSON request without attachments\n    const response = await fetch(`${API_BASE}/api/project-comments/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n\n    return handleResponse<ProjectComment>(response);\n  },\n\n  /**\n   * Get comments for a project or section\n   */\n  async getComments(projectId: number, sectionId?: number): Promise<ProjectComment[]> {\n    let url = `${API_BASE}/api/project-comments/?project=${projectId}`;\n    if (sectionId) {\n      url += `&section=${sectionId}`;\n    }\n\n    const response = await fetch(url, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    return handleResponse<ProjectComment[]>(response);\n  },\n\n  /**\n   * Resolve a comment\n   */\n  async resolveComment(commentId: number): Promise<ProjectComment> {\n    const response = await fetch(\n      `${API_BASE}/api/project-comments/${commentId}/resolve/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<ProjectComment>(response);\n  },\n\n  /**\n   * Unresolve a comment\n   */\n  async unresolveComment(commentId: number): Promise<ProjectComment> {\n    const response = await fetch(\n      `${API_BASE}/api/project-comments/${commentId}/unresolve/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<ProjectComment>(response);\n  },\n\n  /**\n   * Update a comment\n   */\n  async updateComment(commentId: number, content: string): Promise<ProjectComment> {\n    const response = await fetch(`${API_BASE}/api/project-comments/${commentId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({ content }),\n    });\n\n    return handleResponse<ProjectComment>(response);\n  },\n\n  /**\n   * Delete a comment\n   */\n  async deleteComment(commentId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/project-comments/${commentId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n\n    if (!response.ok) {\n      throw new Error(`Failed to delete comment: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Add reaction to a comment\n   */\n  async addReaction(commentId: number, emoji: string): Promise<CommentReaction> {\n    const response = await fetch(\n      `${API_BASE}/api/project-comments/${commentId}/add-reaction/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ emoji }),\n      }\n    );\n\n    return handleResponse<CommentReaction>(response);\n  },\n\n  /**\n   * Remove reaction from a comment\n   */\n  async removeReaction(commentId: number, reactionId: number): Promise<void> {\n    const response = await fetch(\n      `${API_BASE}/api/project-comments/${commentId}/remove-reaction/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ reaction_id: reactionId }),\n      }\n    );\n\n    if (!response.ok) {\n      throw new Error(`Failed to remove reaction: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Get comment thread (with replies)\n   */\n  async getCommentThread(commentId: number): Promise<ProjectComment> {\n    const response = await fetch(\n      `${API_BASE}/api/project-comments/${commentId}/thread/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse<ProjectComment>(response);\n  },\n\n  /**\n   * Get comments by section\n   */\n  async getCommentsBySection(\n    projectId: number,\n    includeResolved: boolean = false\n  ): Promise<{ [sectionId: string]: ProjectComment[] }> {\n    let url = `${API_BASE}/api/project-comments/by-section/?project=${projectId}`;\n    if (includeResolved) {\n      url += '&include_resolved=true';\n    }\n\n    const response = await fetch(url, {\n      method: 'GET',\n      credentials: 'include',\n    });\n\n    return handleResponse<{ [sectionId: string]: ProjectComment[] }>(response);\n  },\n\n  /**\n   * Get unresolved comment count\n   */\n  async getUnresolvedCommentCount(projectId: number): Promise<number> {\n    const comments = await this.getComments(projectId);\n    return comments.filter(c => !c.resolved).length;\n  },\n\n  // ===== Minting Workflow =====\n\n  /**\n   * Request approval from specific collaborators\n   */\n  async requestApproval(\n    projectId: number,\n    data: {\n      collaborator_ids: number[];\n      message?: string;\n      deadline_days?: number;\n    }\n  ): Promise<{ message: string; notifications_sent: number }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/request_approval/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<{ message: string; notifications_sent: number }>(response);\n  },\n\n  /**\n   * Approve project (both content and revenue split)\n   */\n  async approveProject(\n    projectId: number,\n    data: {\n      approve_content: boolean;\n      approve_revenue: boolean;\n      feedback?: string;\n    }\n  ): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/approve_project/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Set the NFT price for a project (project owner only)\n   */\n  async setPrice(\n    projectId: number,\n    priceUsd: number\n  ): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/set_price/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ price_usd: priceUsd }),\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Update customization settings (price, editions, teaser)\n   * Only project owner can update these settings.\n   * Updating these settings resets revenue split approvals.\n   */\n  async updateCustomization(\n    projectId: number,\n    settings: {\n      price_usd?: number;\n      editions?: number;\n      teaser_percent?: number;\n      watermark_preview?: boolean;\n      authors_note?: string;\n    }\n  ): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/update_customization/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(settings),\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  /**\n   * Mint project as NFT\n   */\n  async mintProject(\n    projectId: number,\n    forceMint: boolean = false\n  ): Promise<{\n    success: boolean;\n    nft_id: string;\n    token_id: string;\n    contract_address: string;\n    ipfs_hash: string;\n    transaction_hash: string;\n  }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/mint/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ force_mint: forceMint }),\n      }\n    );\n\n    return handleResponse<{\n      success: boolean;\n      nft_id: string;\n      token_id: string;\n      contract_address: string;\n      ipfs_hash: string;\n      transaction_hash: string;\n    }>(response);\n  },\n\n  /**\n   * Get minting status for a project\n   */\n  async getMintingStatus(projectId: number): Promise<{\n    status: 'not_started' | 'validating' | 'uploading' | 'creating_contract' | 'minting' | 'completed' | 'error';\n    stage: string;\n    progress: number;\n    error?: string;\n    nft_data?: {\n      id: string;\n      token_id: string;\n      contract_address: string;\n      ipfs_hash: string;\n    };\n  }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/minting-status/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse(response);\n  },\n\n  /**\n   * Cancel approval (reset approval status)\n   */\n  async cancelApproval(projectId: number): Promise<CollaborativeProject> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/cancel_approval/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<CollaborativeProject>(response);\n  },\n\n  // ===== Proposals & Voting =====\n\n  /**\n   * Get all proposals for a project\n   */\n  async getProposals(projectId: number): Promise<Proposal[]> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/proposals/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse<Proposal[]>(response);\n  },\n\n  /**\n   * Create a new proposal\n   */\n  async createProposal(\n    projectId: number,\n    data: CreateProposalData\n  ): Promise<Proposal> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/proposals/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<Proposal>(response);\n  },\n\n  /**\n   * Cast a vote on a proposal\n   */\n  async castVote(\n    projectId: number,\n    proposalId: number,\n    data: { vote: 'approve' | 'reject' | 'abstain'; comment?: string }\n  ): Promise<ProposalVote> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/proposals/${proposalId}/vote/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify(data),\n      }\n    );\n\n    return handleResponse<ProposalVote>(response);\n  },\n\n  /**\n   * Cancel a proposal (only proposer or owner can cancel)\n   */\n  async cancelProposal(projectId: number, proposalId: number): Promise<{ message: string }> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/proposals/${proposalId}/cancel/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n      }\n    );\n\n    return handleResponse<{ message: string }>(response);\n  },\n\n  // ===== Collaborator Ratings =====\n\n  /**\n   * Submit a rating for a collaborator\n   */\n  async rateCollaborator(\n    projectId: number,\n    ratedUserId: number,\n    data: CollaboratorRatingData\n  ): Promise<CollaboratorRating> {\n    const response = await fetch(\n      `${API_BASE}/api/collaborative-projects/${projectId}/rate_collaborator/`,\n      {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': await getFreshCsrfToken(),\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({ rated_user_id: ratedUserId, ...data }),\n      }\n    );\n\n    return handleResponse<CollaboratorRating>(response);\n  },\n\n  /**\n   * Get ratings for a user\n   */\n  async getUserRatings(userId: number): Promise<{\n    ratings: CollaboratorRating[];\n    average_scores: {\n      quality: number;\n      deadline: number;\n      communication: number;\n      would_collab_again: number;\n      overall: number;\n    };\n    total_projects: number;\n  }> {\n    const response = await fetch(\n      `${API_BASE}/api/users/${userId}/ratings/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n\n    return handleResponse(response);\n  },\n\n  // ===== Comic Page Management =====\n\n  /**\n   * Get all pages for a comic project\n   */\n  async getComicPages(projectId: number): Promise<ComicPage[]> {\n    const response = await fetch(\n      `${API_BASE}/api/comic-pages/?project=${projectId}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n    return handleResponse<ComicPage[]>(response);\n  },\n\n  /**\n   * Get a single comic page with panels and bubbles\n   */\n  async getComicPage(pageId: number): Promise<ComicPage> {\n    const response = await fetch(\n      `${API_BASE}/api/comic-pages/${pageId}/`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n    return handleResponse<ComicPage>(response);\n  },\n\n  /**\n   * Create a new comic page\n   */\n  async createComicPage(data: CreateComicPageData): Promise<ComicPage> {\n    const response = await fetch(`${API_BASE}/api/comic-pages/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicPage>(response);\n  },\n\n  /**\n   * Update a comic page\n   */\n  async updateComicPage(pageId: number, data: Partial<CreateComicPageData>): Promise<ComicPage> {\n    const response = await fetch(`${API_BASE}/api/comic-pages/${pageId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicPage>(response);\n  },\n\n  /**\n   * Delete a comic page\n   */\n  async deleteComicPage(pageId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/comic-pages/${pageId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete page: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Reorder a comic page\n   */\n  async reorderComicPage(pageId: number, newPosition: number): Promise<{ status: string; new_position: number }> {\n    const response = await fetch(`${API_BASE}/api/comic-pages/${pageId}/reorder/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({ new_position: newPosition }),\n    });\n    return handleResponse(response);\n  },\n\n  // ===== Comic Panel Management =====\n\n  /**\n   * Get all panels for a comic page\n   */\n  async getComicPanels(pageId: number): Promise<ComicPanel[]> {\n    const response = await fetch(\n      `${API_BASE}/api/comic-panels/?page=${pageId}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n    return handleResponse<ComicPanel[]>(response);\n  },\n\n  /**\n   * Create a new comic panel\n   */\n  async createComicPanel(data: CreateComicPanelData): Promise<ComicPanel> {\n    const response = await fetch(`${API_BASE}/api/comic-panels/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicPanel>(response);\n  },\n\n  /**\n   * Update a comic panel\n   */\n  async updateComicPanel(panelId: number, data: Partial<CreateComicPanelData>): Promise<ComicPanel> {\n    const response = await fetch(`${API_BASE}/api/comic-panels/${panelId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicPanel>(response);\n  },\n\n  /**\n   * Delete a comic panel\n   */\n  async deleteComicPanel(panelId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/comic-panels/${panelId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete panel: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Upload artwork to a panel\n   */\n  async uploadPanelArtwork(panelId: number, artworkFile: File): Promise<ComicPanel> {\n    const formData = new FormData();\n    formData.append('artwork', artworkFile);\n\n    const response = await fetch(`${API_BASE}/api/comic-panels/${panelId}/upload_artwork/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: formData,\n    });\n    return handleResponse<ComicPanel>(response);\n  },\n\n  /**\n   * Batch update panel positions (for drag operations)\n   */\n  async batchUpdatePanelPositions(\n    panels: Array<{\n      id: number;\n      x_percent?: number;\n      y_percent?: number;\n      width_percent?: number;\n      height_percent?: number;\n      z_index?: number;\n      rotation?: number;\n    }>\n  ): Promise<{ updated: number[] }> {\n    const response = await fetch(`${API_BASE}/api/comic-panels/batch_update_positions/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({ panels }),\n    });\n    return handleResponse(response);\n  },\n\n  // ===== Speech Bubble Management =====\n\n  /**\n   * Get all speech bubbles for a panel\n   */\n  async getSpeechBubbles(panelId: number): Promise<SpeechBubble[]> {\n    const response = await fetch(\n      `${API_BASE}/api/speech-bubbles/?panel=${panelId}`,\n      {\n        method: 'GET',\n        credentials: 'include',\n      }\n    );\n    return handleResponse<SpeechBubble[]>(response);\n  },\n\n  /**\n   * Create a new speech bubble\n   */\n  async createSpeechBubble(data: CreateSpeechBubbleData): Promise<SpeechBubble> {\n    const response = await fetch(`${API_BASE}/api/speech-bubbles/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<SpeechBubble>(response);\n  },\n\n  /**\n   * Update a speech bubble\n   */\n  async updateSpeechBubble(bubbleId: number, data: Partial<CreateSpeechBubbleData>): Promise<SpeechBubble> {\n    const response = await fetch(`${API_BASE}/api/speech-bubbles/${bubbleId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<SpeechBubble>(response);\n  },\n\n  /**\n   * Delete a speech bubble\n   */\n  async deleteSpeechBubble(bubbleId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/speech-bubbles/${bubbleId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete bubble: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Batch create speech bubbles\n   */\n  async batchCreateSpeechBubbles(bubbles: CreateSpeechBubbleData[]): Promise<{ created: SpeechBubble[] }> {\n    const response = await fetch(`${API_BASE}/api/speech-bubbles/batch_create/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({ bubbles }),\n    });\n    return handleResponse(response);\n  },\n\n  /**\n   * Batch update speech bubble positions\n   */\n  async batchUpdateBubblePositions(\n    bubbles: Array<{\n      id: number;\n      x_percent?: number;\n      y_percent?: number;\n      width_percent?: number;\n      height_percent?: number;\n      z_index?: number;\n    }>\n  ): Promise<{ updated: number[] }> {\n    const response = await fetch(`${API_BASE}/api/speech-bubbles/batch_update_positions/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify({ bubbles }),\n    });\n    return handleResponse(response);\n  },\n\n  // ===== Comic Series Management =====\n\n  /**\n   * Get all comic series for current user\n   */\n  async getComicSeries(): Promise<ComicSeriesListItem[]> {\n    const response = await fetch(`${API_BASE}/api/comic-series/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    return handleResponse<ComicSeriesListItem[]>(response);\n  },\n\n  /**\n   * Get a single comic series with details\n   */\n  async getComicSeriesDetail(seriesId: number): Promise<ComicSeries> {\n    const response = await fetch(`${API_BASE}/api/comic-series/${seriesId}/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    return handleResponse<ComicSeries>(response);\n  },\n\n  /**\n   * Create a new comic series\n   */\n  async createComicSeries(data: CreateComicSeriesData): Promise<ComicSeries> {\n    const response = await fetch(`${API_BASE}/api/comic-series/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicSeries>(response);\n  },\n\n  /**\n   * Update a comic series\n   */\n  async updateComicSeries(seriesId: number, data: Partial<CreateComicSeriesData>): Promise<ComicSeries> {\n    const response = await fetch(`${API_BASE}/api/comic-series/${seriesId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicSeries>(response);\n  },\n\n  /**\n   * Delete a comic series\n   */\n  async deleteComicSeries(seriesId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/comic-series/${seriesId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete series: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Publish an entire comic series\n   */\n  async publishComicSeries(seriesId: number): Promise<{ content_id: number; message: string }> {\n    const response = await fetch(`${API_BASE}/api/comic-series/${seriesId}/publish/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    return handleResponse(response);\n  },\n\n  // ===== Comic Issue Management =====\n\n  /**\n   * Get all comic issues (optionally filtered by series or project)\n   */\n  async getComicIssues(params?: { series?: number; project?: number }): Promise<ComicIssueListItem[]> {\n    let url = `${API_BASE}/api/comic-issues/`;\n    if (params) {\n      const queryParams = new URLSearchParams();\n      if (params.series) queryParams.append('series', params.series.toString());\n      if (params.project) queryParams.append('project', params.project.toString());\n      if (queryParams.toString()) url += `?${queryParams.toString()}`;\n    }\n    const response = await fetch(url, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    return handleResponse<ComicIssueListItem[]>(response);\n  },\n\n  /**\n   * Get a single comic issue with pages\n   */\n  async getComicIssueDetail(issueId: number): Promise<ComicIssue> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/${issueId}/`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    return handleResponse<ComicIssue>(response);\n  },\n\n  /**\n   * Create a new comic issue\n   */\n  async createComicIssue(data: CreateComicIssueData): Promise<ComicIssue> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicIssue>(response);\n  },\n\n  /**\n   * Update a comic issue\n   */\n  async updateComicIssue(issueId: number, data: Partial<CreateComicIssueData>): Promise<ComicIssue> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/${issueId}/`, {\n      method: 'PATCH',\n      credentials: 'include',\n      headers: {\n        'Content-Type': 'application/json',\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n      body: JSON.stringify(data),\n    });\n    return handleResponse<ComicIssue>(response);\n  },\n\n  /**\n   * Delete a comic issue\n   */\n  async deleteComicIssue(issueId: number): Promise<void> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/${issueId}/`, {\n      method: 'DELETE',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    if (!response.ok) {\n      throw new Error(`Failed to delete issue: ${response.statusText}`);\n    }\n  },\n\n  /**\n   * Prepare a comic issue for minting (validates and generates preview)\n   */\n  async prepareComicIssue(issueId: number): Promise<{ ready: boolean; preview_data: any; errors?: string[] }> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/${issueId}/prepare/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    return handleResponse(response);\n  },\n\n  /**\n   * Publish a single comic issue\n   */\n  async publishComicIssue(issueId: number): Promise<{ content_id: number; message: string }> {\n    const response = await fetch(`${API_BASE}/api/comic-issues/${issueId}/publish/`, {\n      method: 'POST',\n      credentials: 'include',\n      headers: {\n        'X-CSRFToken': await getFreshCsrfToken(),\n        'X-Requested-With': 'XMLHttpRequest',\n      },\n    });\n    return handleResponse(response);\n  },\n\n  /**\n   * Get pages for a specific issue\n   */\n  async getComicIssuePages(issueId: number): Promise<ComicPage[]> {\n    const response = await fetch(`${API_BASE}/api/comic-pages/?issue=${issueId}`, {\n      method: 'GET',\n      credentials: 'include',\n    });\n    return handleResponse<ComicPage[]>(response);\n  },\n};\n\n// ===== Additional TypeScript Interfaces =====\n\nexport interface Proposal {\n  id: number;\n  proposal_type: string;\n  title: string;\n  description: string;\n  proposal_data: Record<string, any>;\n  status: 'pending' | 'approved' | 'rejected' | 'expired' | 'cancelled';\n  voting_threshold: 'majority' | 'unanimous' | 'owner_decides';\n  proposer_id: number;\n  proposer_username: string;\n  expires_at?: string;\n  resolved_at?: string;\n  created_at: string;\n  votes: ProposalVote[];\n  vote_counts: {\n    approve: number;\n    reject: number;\n    abstain: number;\n    total: number;\n  };\n  total_voters: number;\n}\n\nexport interface ProposalVote {\n  id: number;\n  voter_id: number;\n  voter_username: string;\n  vote: 'approve' | 'reject' | 'abstain';\n  comment?: string;\n  voted_at: string;\n}\n\nexport interface CreateProposalData {\n  proposal_type: string;\n  title: string;\n  description?: string;\n  proposal_data: Record<string, any>;\n  voting_threshold?: 'majority' | 'unanimous' | 'owner_decides';\n  expires_in_days?: number;\n}\n\nexport interface CollaboratorRating {\n  id: number;\n  project_id: number;\n  project_title: string;\n  rater_id: number;\n  rater_username: string;\n  rated_user_id: number;\n  rated_user_username: string;\n  quality_score: number;\n  deadline_score: number;\n  communication_score: number;\n  would_collab_again: number;\n  average_score: number;\n  private_note?: string;\n  public_feedback?: string;\n  created_at: string;\n}\n\nexport interface CollaboratorRatingData {\n  quality_score: number;\n  deadline_score: number;\n  communication_score: number;\n  would_collab_again: number;\n  private_note?: string;\n  public_feedback?: string;\n}\n\n// ===== Comic Book Collaboration Interfaces =====\n\nexport type BubbleType = 'oval' | 'thought' | 'shout' | 'whisper' | 'narrative' | 'caption' | 'radio' | 'burst';\nexport type PointerDirection = 'none' | 'top' | 'bottom' | 'left' | 'right' | 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right';\nexport type BorderStyle = 'solid' | 'dashed' | 'none' | 'jagged' | 'wavy';\nexport type ArtworkFit = 'contain' | 'cover' | 'fill';\nexport type PageFormat = 'standard' | 'manga' | 'webtoon' | 'custom';\n\nexport interface SpeechBubble {\n  id: number;\n  panel: number;\n  bubble_type: BubbleType;\n  x_percent: number;\n  y_percent: number;\n  width_percent: number;\n  height_percent: number;\n  z_index: number;\n  text: string;\n  font_family: string;\n  font_size: number;\n  font_color: string;\n  font_weight: 'normal' | 'bold';\n  font_style: 'normal' | 'italic';\n  text_align: 'left' | 'center' | 'right';\n  background_color: string;\n  border_color: string;\n  border_width: number;\n  pointer_direction: PointerDirection;\n  pointer_position: number;\n  writer?: number;\n  writer_username?: string;\n  order: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ComicPanel {\n  id: number;\n  page: number;\n  x_percent: number;\n  y_percent: number;\n  width_percent: number;\n  height_percent: number;\n  z_index: number;\n  border_style: BorderStyle;\n  border_width: number;\n  border_color: string;\n  border_radius: number;\n  background_color: string;\n  rotation: number;\n  skew_x: number;  // Horizontal skew for diagonal effect (-45 to 45)\n  skew_y: number;  // Vertical skew for diagonal effect (-45 to 45)\n  artwork?: string;\n  artwork_fit: ArtworkFit;\n  artist?: number;\n  artist_username?: string;\n  order: number;\n  speech_bubbles: SpeechBubble[];\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ComicPage {\n  id: number;\n  project?: number | null;\n  issue?: number | null;\n  page_number: number;\n  page_format: PageFormat;\n  canvas_width: number;\n  canvas_height: number;\n  background_image?: string;\n  background_color: string;\n  panels: ComicPanel[];\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ComicPageListItem {\n  id: number;\n  project: number;\n  page_number: number;\n  page_format: PageFormat;\n  panel_count: number;\n}\n\nexport interface CreateComicPageData {\n  project?: number;\n  issue?: number;\n  page_format?: PageFormat;\n  canvas_width?: number;\n  canvas_height?: number;\n  background_color?: string;\n}\n\nexport interface CreateComicPanelData {\n  page: number;\n  x_percent?: number;\n  y_percent?: number;\n  width_percent?: number;\n  height_percent?: number;\n  z_index?: number;\n  border_style?: BorderStyle;\n  border_width?: number;\n  border_color?: string;\n  border_radius?: number;\n  background_color?: string;\n  rotation?: number;\n  skew_x?: number;\n  skew_y?: number;\n  artwork_fit?: ArtworkFit;\n}\n\nexport interface CreateSpeechBubbleData {\n  panel: number;\n  bubble_type?: BubbleType;\n  x_percent?: number;\n  y_percent?: number;\n  width_percent?: number;\n  height_percent?: number;\n  z_index?: number;\n  text?: string;\n  font_family?: string;\n  font_size?: number;\n  font_color?: string;\n  font_weight?: 'normal' | 'bold';\n  font_style?: 'normal' | 'italic';\n  text_align?: 'left' | 'center' | 'right';\n  background_color?: string;\n  border_color?: string;\n  border_width?: number;\n  pointer_direction?: PointerDirection;\n  pointer_position?: number;\n}\n\n// ===== Comic Series & Issue Interfaces =====\n\nexport interface ComicSeries {\n  id: number;\n  creator: number;\n  creator_username: string;\n  title: string;\n  synopsis: string;\n  cover_image?: string | null;\n  is_published: boolean;\n  published_content?: number | null;\n  issue_count: number;\n  total_pages: number;\n  created_at: string;\n  updated_at: string;\n  issues?: ComicIssue[];\n}\n\nexport interface ComicSeriesListItem {\n  id: number;\n  creator: number;\n  creator_username: string;\n  title: string;\n  cover_image?: string | null;\n  is_published: boolean;\n  issue_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface ComicIssue {\n  id: number;\n  series?: number | null;\n  series_title?: string | null;\n  project?: number | null;\n  project_title?: string | null;\n  title: string;\n  issue_number: number;\n  synopsis: string;\n  cover_image?: string | null;\n  price: number;\n  is_published: boolean;\n  is_listed: boolean;\n  published_content?: number | null;\n  page_count: number;\n  created_at: string;\n  updated_at: string;\n  pages?: ComicPage[];\n}\n\nexport interface ComicIssueListItem {\n  id: number;\n  series?: number | null;\n  project?: number | null;\n  title: string;\n  issue_number: number;\n  cover_image?: string | null;\n  price: number;\n  is_published: boolean;\n  is_listed: boolean;\n  page_count: number;\n  created_at: string;\n  updated_at: string;\n}\n\nexport interface CreateComicSeriesData {\n  title: string;\n  synopsis?: string;\n}\n\nexport interface CreateComicIssueData {\n  series?: number;\n  project?: number;\n  title: string;\n  issue_number?: number;\n  synopsis?: string;\n  price?: number;\n}\n","/**\n * InviteResponseModal Component\n *\n * Displays collaboration invite details and allows the recipient to\n * Accept, Decline, or Counter-Propose.\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  collaborationApi,\n  CollaborativeProject,\n  CollaboratorRole\n} from '../../services/collaborationApi';\n\ninterface InviteResponseModalProps {\n  open: boolean;\n  onClose: () => void;\n  projectId: number;\n  notificationMessage?: string;\n}\n\ntype ModalMode = 'view' | 'counter-propose';\n\nexport function InviteResponseModal({\n  open,\n  onClose,\n  projectId,\n  notificationMessage\n}: InviteResponseModalProps) {\n  const navigate = useNavigate();\n\n  // State\n  const [loading, setLoading] = useState(true);\n  const [project, setProject] = useState<CollaborativeProject | null>(null);\n  const [myRole, setMyRole] = useState<CollaboratorRole | null>(null);\n  const [mode, setMode] = useState<ModalMode>('view');\n  const [proposedPercentage, setProposedPercentage] = useState(50);\n  const [counterMessage, setCounterMessage] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n  const [error, setError] = useState('');\n  const [success, setSuccess] = useState('');\n\n  // Load project details\n  useEffect(() => {\n    if (!open || !projectId) return;\n\n    const loadProject = async () => {\n      setLoading(true);\n      setError('');\n      try {\n        const data = await collaborationApi.getCollaborativeProject(projectId);\n        setProject(data);\n\n        // Find current user's role (the one with status='invited')\n        const invitedRole = data.collaborators.find(\n          (c: CollaboratorRole) => c.status === 'invited'\n        );\n        if (invitedRole) {\n          setMyRole(invitedRole);\n          setProposedPercentage(invitedRole.revenue_percentage);\n        }\n      } catch (err: any) {\n        setError(err.message || 'Failed to load project details');\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadProject();\n  }, [open, projectId]);\n\n  // Reset state when closed\n  useEffect(() => {\n    if (!open) {\n      setMode('view');\n      setCounterMessage('');\n      setError('');\n      setSuccess('');\n    }\n  }, [open]);\n\n  if (!open) return null;\n\n  const handleAccept = async () => {\n    setSubmitting(true);\n    setError('');\n    try {\n      await collaborationApi.acceptInvitation(projectId);\n      setSuccess('Invite accepted! Redirecting to project...');\n      setTimeout(() => {\n        onClose();\n        navigate(`/collaborations/${projectId}`);\n      }, 1500);\n    } catch (err: any) {\n      setError(err.message || 'Failed to accept invitation');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleDecline = async () => {\n    setSubmitting(true);\n    setError('');\n    try {\n      await collaborationApi.declineInvitation(projectId);\n      setSuccess('Invite declined.');\n      setTimeout(() => {\n        onClose();\n      }, 1500);\n    } catch (err: any) {\n      setError(err.message || 'Failed to decline invitation');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  const handleCounterPropose = async () => {\n    if (!counterMessage.trim()) {\n      setError('Please add a message explaining your counter-proposal');\n      return;\n    }\n\n    setSubmitting(true);\n    setError('');\n    try {\n      await collaborationApi.counterProposeInvite(projectId, {\n        proposed_percentage: proposedPercentage,\n        message: counterMessage,\n      });\n\n      setSuccess('Counter-proposal sent! Waiting for response...');\n      setTimeout(() => {\n        onClose();\n      }, 2000);\n    } catch (err: any) {\n      setError(err.message || 'Failed to send counter-proposal');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  // Get project creator info\n  const creator = project?.collaborators.find(\n    (c: CollaboratorRole) => c.user === project.created_by\n  );\n\n  // Calculate others' share\n  const othersPercentage = myRole ? 100 - myRole.revenue_percentage : 0;\n\n  const contentTypeLabels: Record<string, string> = {\n    book: 'Book',\n    music: 'Music',\n    video: 'Video',\n    art: 'Art',\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0,0,0,0.9)',\n        display: 'grid',\n        placeItems: 'center',\n        zIndex: 1000,\n        padding: 20,\n      }}\n      onClick={(e) => {\n        if (e.target === e.currentTarget && !submitting) onClose();\n      }}\n    >\n      <div\n        style={{\n          background: '#0f172a',\n          border: '1px solid #334155',\n          borderRadius: 16,\n          width: '100%',\n          maxWidth: 600,\n          maxHeight: '90vh',\n          overflow: 'auto',\n          boxShadow: '0 20px 25px -5px rgba(0,0,0,0.5)',\n        }}\n      >\n        {/* Header */}\n        <div\n          style={{\n            padding: 24,\n            borderBottom: '1px solid #334155',\n            background: 'linear-gradient(135deg, #1e293b 0%, #0f172a 100%)',\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'flex-start',\n          }}\n        >\n          <div>\n            <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 8 }}>\n              <span style={{ fontSize: 24 }}></span>\n              <h2 style={{ margin: 0, color: '#f8fafc', fontSize: 20, fontWeight: 600 }}>\n                Collaboration Invite\n              </h2>\n            </div>\n            {creator && (\n              <p style={{ margin: 0, color: '#94a3b8', fontSize: 14 }}>\n                from <span style={{ color: '#f59e0b' }}>@{creator.username}</span>\n              </p>\n            )}\n          </div>\n          <button\n            onClick={onClose}\n            disabled={submitting}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#94a3b8',\n              fontSize: 24,\n              cursor: submitting ? 'not-allowed' : 'pointer',\n              padding: 4,\n            }}\n          >\n            \n          </button>\n        </div>\n\n        {/* Content */}\n        <div style={{ padding: 24 }}>\n          {loading ? (\n            <div style={{ textAlign: 'center', padding: 40, color: '#94a3b8' }}>\n              Loading project details...\n            </div>\n          ) : error && !project ? (\n            <div style={{ textAlign: 'center', padding: 40, color: '#ef4444' }}>\n              {error}\n            </div>\n          ) : project && myRole ? (\n            mode === 'view' ? (\n              <>\n                {/* Project Info */}\n                <div style={{ marginBottom: 24 }}>\n                  <div\n                    style={{\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: 12,\n                      marginBottom: 12,\n                    }}\n                  >\n                    <span\n                      style={{\n                        background: '#f59e0b20',\n                        color: '#f59e0b',\n                        padding: '4px 12px',\n                        borderRadius: 6,\n                        fontSize: 12,\n                        fontWeight: 600,\n                      }}\n                    >\n                      {contentTypeLabels[project.content_type] || project.content_type}\n                    </span>\n                    <span style={{ color: '#64748b', fontSize: 13 }}>\n                      {project.status === 'draft' ? 'Draft' : 'Active'}\n                    </span>\n                  </div>\n                  <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 24, fontWeight: 700 }}>\n                    {project.title}\n                  </h3>\n                  {project.description && (\n                    <p style={{ margin: '8px 0 0', color: '#94a3b8', fontSize: 14, lineHeight: 1.6 }}>\n                      {project.description}\n                    </p>\n                  )}\n                </div>\n\n                {/* Your Role */}\n                <div\n                  style={{\n                    background: '#1e293b',\n                    borderRadius: 12,\n                    padding: 16,\n                    marginBottom: 20,\n                  }}\n                >\n                  <div style={{ color: '#94a3b8', fontSize: 12, fontWeight: 600, marginBottom: 8, textTransform: 'uppercase' }}>\n                    Your Role\n                  </div>\n                  <div style={{ color: '#f8fafc', fontSize: 18, fontWeight: 600 }}>\n                    {myRole.role || 'Collaborator'}\n                  </div>\n                </div>\n\n                {/* Contract Tasks */}\n                {myRole.contract_tasks && myRole.contract_tasks.length > 0 && (\n                  <div\n                    style={{\n                      background: '#1e293b',\n                      borderRadius: 12,\n                      padding: 16,\n                      marginBottom: 20,\n                    }}\n                  >\n                    <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>\n                      <span style={{ fontSize: 18 }}></span>\n                      <span style={{ color: '#94a3b8', fontSize: 12, fontWeight: 600, textTransform: 'uppercase' }}>\n                        Your Contract Tasks ({myRole.contract_tasks.length})\n                      </span>\n                    </div>\n\n                    <div style={{ display: 'flex', flexDirection: 'column', gap: 10 }}>\n                      {myRole.contract_tasks.map((task: any, index: number) => (\n                        <div\n                          key={task.id || index}\n                          style={{\n                            background: '#0f172a',\n                            borderRadius: 8,\n                            padding: 14,\n                            borderLeft: '3px solid #f59e0b',\n                          }}\n                        >\n                          <div style={{ color: '#f8fafc', fontSize: 14, fontWeight: 600 }}>\n                            {task.title}\n                          </div>\n                          {task.description && (\n                            <div style={{ color: '#94a3b8', fontSize: 13, marginTop: 6, lineHeight: 1.5 }}>\n                              {task.description}\n                            </div>\n                          )}\n                          <div\n                            style={{\n                              display: 'flex',\n                              alignItems: 'center',\n                              gap: 6,\n                              marginTop: 10,\n                              color: '#f59e0b',\n                              fontSize: 12,\n                              fontWeight: 500,\n                            }}\n                          >\n                            <span></span>\n                            <span>\n                              Due: {new Date(task.deadline).toLocaleDateString('en-US', {\n                                weekday: 'short',\n                                month: 'short',\n                                day: 'numeric',\n                                year: 'numeric',\n                              })}\n                            </span>\n                          </div>\n                        </div>\n                      ))}\n                    </div>\n\n                    <div\n                      style={{\n                        marginTop: 16,\n                        padding: 12,\n                        background: 'rgba(245, 158, 11, 0.1)',\n                        borderRadius: 8,\n                        display: 'flex',\n                        alignItems: 'flex-start',\n                        gap: 10,\n                      }}\n                    >\n                      <span style={{ fontSize: 16 }}></span>\n                      <div style={{ color: '#f59e0b', fontSize: 12, lineHeight: 1.5 }}>\n                        <strong>Contract Terms:</strong> By accepting, you commit to completing these tasks\n                        by their deadlines. Tasks become binding and can only be changed via mutual agreement.\n                        Missing deadlines may affect the collaboration.\n                      </div>\n                    </div>\n                  </div>\n                )}\n\n                {/* Pitch Message */}\n                {notificationMessage && (\n                  <div\n                    style={{\n                      background: '#1e293b',\n                      borderRadius: 12,\n                      padding: 16,\n                      marginBottom: 20,\n                      borderLeft: '3px solid #3b82f6',\n                    }}\n                  >\n                    <div style={{ color: '#94a3b8', fontSize: 12, fontWeight: 600, marginBottom: 8, textTransform: 'uppercase' }}>\n                      Message from @{creator?.username}\n                    </div>\n                    <div style={{ color: '#cbd5e1', fontSize: 14, lineHeight: 1.6, whiteSpace: 'pre-wrap' }}>\n                      {notificationMessage}\n                    </div>\n                  </div>\n                )}\n\n                {/* Revenue Split */}\n                <div\n                  style={{\n                    background: '#1e293b',\n                    borderRadius: 12,\n                    padding: 16,\n                    marginBottom: 20,\n                  }}\n                >\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>\n                    <span style={{ fontSize: 18 }}></span>\n                    <span style={{ color: '#94a3b8', fontSize: 12, fontWeight: 600, textTransform: 'uppercase' }}>\n                      Revenue Split\n                    </span>\n                  </div>\n\n                  {/* Split bar */}\n                  <div style={{ display: 'flex', gap: 4, marginBottom: 8 }}>\n                    <div\n                      style={{\n                        flex: myRole.revenue_percentage,\n                        background: '#f59e0b',\n                        height: 40,\n                        borderRadius: '8px 0 0 8px',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                        color: '#000',\n                        fontWeight: 700,\n                        fontSize: 14,\n                        minWidth: 60,\n                      }}\n                    >\n                      You: {myRole.revenue_percentage}%\n                    </div>\n                    <div\n                      style={{\n                        flex: othersPercentage,\n                        background: '#334155',\n                        height: 40,\n                        borderRadius: '0 8px 8px 0',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                        color: '#cbd5e1',\n                        fontWeight: 600,\n                        fontSize: 14,\n                        minWidth: 60,\n                      }}\n                    >\n                      Others: {othersPercentage}%\n                    </div>\n                  </div>\n                </div>\n\n                {/* Permissions */}\n                <div\n                  style={{\n                    background: '#1e293b',\n                    borderRadius: 12,\n                    padding: 16,\n                    marginBottom: 20,\n                  }}\n                >\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>\n                    <span style={{ fontSize: 18 }}></span>\n                    <span style={{ color: '#94a3b8', fontSize: 12, fontWeight: 600, textTransform: 'uppercase' }}>\n                      Your Permissions\n                    </span>\n                  </div>\n                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8 }}>\n                    {[\n                      { key: 'can_edit_text', label: 'Text', value: myRole.can_edit_text },\n                      { key: 'can_edit_images', label: 'Images', value: myRole.can_edit_images },\n                      { key: 'can_edit_audio', label: 'Audio', value: myRole.can_edit_audio },\n                      { key: 'can_edit_video', label: 'Video', value: myRole.can_edit_video },\n                    ].map((perm) => (\n                      <span\n                        key={perm.key}\n                        style={{\n                          display: 'flex',\n                          alignItems: 'center',\n                          gap: 6,\n                          padding: '6px 12px',\n                          borderRadius: 6,\n                          background: perm.value ? '#10b98120' : '#64748b20',\n                          color: perm.value ? '#10b981' : '#64748b',\n                          fontSize: 13,\n                          fontWeight: 500,\n                        }}\n                      >\n                        {perm.value ? '' : ''} {perm.label}\n                      </span>\n                    ))}\n                  </div>\n                </div>\n\n                {/* On-Chain Notice */}\n                <div\n                  style={{\n                    background: 'linear-gradient(135deg, #7c3aed20 0%, #3b82f620 100%)',\n                    border: '1px solid #7c3aed40',\n                    borderRadius: 12,\n                    padding: 16,\n                    marginBottom: 24,\n                  }}\n                >\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 8 }}>\n                    <span style={{ fontSize: 18 }}></span>\n                    <span style={{ color: '#a78bfa', fontSize: 13, fontWeight: 600 }}>\n                      On-Chain Agreement\n                    </span>\n                  </div>\n                  <p style={{ margin: 0, color: '#c4b5fd', fontSize: 13, lineHeight: 1.6 }}>\n                    By accepting, you agree to the revenue split above. When this project is minted as an NFT,\n                    the split will be enforced via smart contract. USDC payments will be distributed automatically.\n                  </p>\n                </div>\n\n                {/* Error/Success Messages */}\n                {error && (\n                  <div\n                    style={{\n                      background: '#ef444420',\n                      border: '1px solid #ef4444',\n                      color: '#fca5a5',\n                      padding: 12,\n                      borderRadius: 8,\n                      fontSize: 13,\n                      marginBottom: 16,\n                    }}\n                  >\n                    {error}\n                  </div>\n                )}\n                {success && (\n                  <div\n                    style={{\n                      background: '#10b98120',\n                      border: '1px solid #10b981',\n                      color: '#6ee7b7',\n                      padding: 12,\n                      borderRadius: 8,\n                      fontSize: 13,\n                      marginBottom: 16,\n                    }}\n                  >\n                    {success}\n                  </div>\n                )}\n\n                {/* Action Buttons */}\n                <div style={{ display: 'flex', gap: 12 }}>\n                  <button\n                    onClick={handleDecline}\n                    disabled={submitting}\n                    style={{\n                      flex: 1,\n                      padding: '14px 20px',\n                      borderRadius: 10,\n                      border: '1px solid #ef4444',\n                      background: 'transparent',\n                      color: '#ef4444',\n                      fontSize: 14,\n                      fontWeight: 600,\n                      cursor: submitting ? 'not-allowed' : 'pointer',\n                      opacity: submitting ? 0.6 : 1,\n                    }}\n                  >\n                    Decline\n                  </button>\n                  <button\n                    onClick={() => setMode('counter-propose')}\n                    disabled={submitting}\n                    style={{\n                      flex: 1,\n                      padding: '14px 20px',\n                      borderRadius: 10,\n                      border: '1px solid #3b82f6',\n                      background: 'transparent',\n                      color: '#3b82f6',\n                      fontSize: 14,\n                      fontWeight: 600,\n                      cursor: submitting ? 'not-allowed' : 'pointer',\n                      opacity: submitting ? 0.6 : 1,\n                    }}\n                  >\n                    Counter-Propose\n                  </button>\n                  <button\n                    onClick={handleAccept}\n                    disabled={submitting}\n                    style={{\n                      flex: 1.5,\n                      padding: '14px 20px',\n                      borderRadius: 10,\n                      border: 'none',\n                      background: '#10b981',\n                      color: '#fff',\n                      fontSize: 14,\n                      fontWeight: 700,\n                      cursor: submitting ? 'not-allowed' : 'pointer',\n                      opacity: submitting ? 0.6 : 1,\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: 8,\n                    }}\n                  >\n                    {submitting ? 'Processing...' : ' Accept Invite'}\n                  </button>\n                </div>\n              </>\n            ) : (\n              /* Counter-Propose Mode */\n              <>\n                <button\n                  onClick={() => setMode('view')}\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    color: '#94a3b8',\n                    fontSize: 14,\n                    cursor: 'pointer',\n                    padding: 0,\n                    marginBottom: 16,\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 8,\n                  }}\n                >\n                   Back to invite\n                </button>\n\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 24 }}>\n                  <span style={{ fontSize: 24 }}></span>\n                  <h3 style={{ margin: 0, color: '#f8fafc', fontSize: 20, fontWeight: 600 }}>\n                    Propose Different Terms\n                  </h3>\n                </div>\n\n                {/* Proposed Split */}\n                <div style={{ marginBottom: 24 }}>\n                  <label\n                    style={{\n                      display: 'block',\n                      color: '#94a3b8',\n                      fontSize: 13,\n                      fontWeight: 600,\n                      marginBottom: 12,\n                    }}\n                  >\n                    Suggested Revenue Split: {proposedPercentage}% for you\n                  </label>\n                  <input\n                    type=\"range\"\n                    min={5}\n                    max={95}\n                    step={5}\n                    value={proposedPercentage}\n                    onChange={(e) => setProposedPercentage(parseInt(e.target.value))}\n                    style={{ width: '100%', marginBottom: 8 }}\n                  />\n                  <div style={{ display: 'flex', justifyContent: 'space-between', fontSize: 12, color: '#64748b' }}>\n                    <span>Current offer: {myRole.revenue_percentage}%</span>\n                    <span>Proposing: {proposedPercentage}%</span>\n                  </div>\n\n                  {/* Visual diff */}\n                  {proposedPercentage !== myRole.revenue_percentage && (\n                    <div\n                      style={{\n                        marginTop: 12,\n                        padding: 12,\n                        background: '#1e293b',\n                        borderRadius: 8,\n                        fontSize: 13,\n                      }}\n                    >\n                      <span style={{ color: '#94a3b8' }}>Change: </span>\n                      <span\n                        style={{\n                          color: proposedPercentage > myRole.revenue_percentage ? '#10b981' : '#ef4444',\n                          fontWeight: 600,\n                        }}\n                      >\n                        {myRole.revenue_percentage}%  {proposedPercentage}%\n                        ({proposedPercentage > myRole.revenue_percentage ? '+' : ''}\n                        {proposedPercentage - myRole.revenue_percentage}%)\n                      </span>\n                    </div>\n                  )}\n                </div>\n\n                {/* Message */}\n                <div style={{ marginBottom: 24 }}>\n                  <label\n                    style={{\n                      display: 'block',\n                      color: '#94a3b8',\n                      fontSize: 13,\n                      fontWeight: 600,\n                      marginBottom: 8,\n                    }}\n                  >\n                    Message to @{creator?.username}\n                  </label>\n                  <textarea\n                    value={counterMessage}\n                    onChange={(e) => setCounterMessage(e.target.value)}\n                    placeholder=\"Explain why you'd like a different split...\"\n                    style={{\n                      width: '100%',\n                      minHeight: 120,\n                      background: '#1e293b',\n                      border: '1px solid #334155',\n                      borderRadius: 8,\n                      padding: 12,\n                      color: '#f8fafc',\n                      fontSize: 14,\n                      resize: 'vertical',\n                    }}\n                  />\n                  <div style={{ fontSize: 11, color: '#64748b', marginTop: 4 }}>\n                    {counterMessage.length}/500 characters\n                  </div>\n                </div>\n\n                {/* Error/Success */}\n                {error && (\n                  <div\n                    style={{\n                      background: '#ef444420',\n                      border: '1px solid #ef4444',\n                      color: '#fca5a5',\n                      padding: 12,\n                      borderRadius: 8,\n                      fontSize: 13,\n                      marginBottom: 16,\n                    }}\n                  >\n                    {error}\n                  </div>\n                )}\n                {success && (\n                  <div\n                    style={{\n                      background: '#10b98120',\n                      border: '1px solid #10b981',\n                      color: '#6ee7b7',\n                      padding: 12,\n                      borderRadius: 8,\n                      fontSize: 13,\n                      marginBottom: 16,\n                    }}\n                  >\n                    {success}\n                  </div>\n                )}\n\n                {/* Actions */}\n                <div style={{ display: 'flex', gap: 12 }}>\n                  <button\n                    onClick={() => setMode('view')}\n                    disabled={submitting}\n                    style={{\n                      flex: 1,\n                      padding: '14px 20px',\n                      borderRadius: 10,\n                      border: '1px solid #334155',\n                      background: 'transparent',\n                      color: '#cbd5e1',\n                      fontSize: 14,\n                      fontWeight: 600,\n                      cursor: submitting ? 'not-allowed' : 'pointer',\n                    }}\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleCounterPropose}\n                    disabled={submitting || !counterMessage.trim() || counterMessage.length > 500}\n                    style={{\n                      flex: 2,\n                      padding: '14px 20px',\n                      borderRadius: 10,\n                      border: 'none',\n                      background: '#3b82f6',\n                      color: '#fff',\n                      fontSize: 14,\n                      fontWeight: 700,\n                      cursor:\n                        submitting || !counterMessage.trim() || counterMessage.length > 500\n                          ? 'not-allowed'\n                          : 'pointer',\n                      opacity:\n                        submitting || !counterMessage.trim() || counterMessage.length > 500\n                          ? 0.6\n                          : 1,\n                    }}\n                  >\n                    {submitting ? 'Sending...' : 'Send Counter-Offer'}\n                  </button>\n                </div>\n              </>\n            )\n          ) : (\n            <div style={{ textAlign: 'center', padding: 40, color: '#94a3b8' }}>\n              No invite found for this project.\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default InviteResponseModal;\n","/**\n * NotificationDropdown Component\n * Dropdown panel showing recent notifications (last 10)\n */\n\nimport React, { useState, useEffect, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useNotifications } from '../../hooks/useNotifications';\nimport { Notification } from '../../services/notificationService';\nimport NotificationItem from './NotificationItem';\nimport { InviteResponseModal } from '../collaboration/InviteResponseModal';\n\ninterface NotificationDropdownProps {\n  isOpen: boolean;\n  onClose: () => void;\n  anchorEl?: HTMLElement | null;\n}\n\nexport function NotificationDropdown({ isOpen, onClose, anchorEl }: NotificationDropdownProps) {\n  const navigate = useNavigate();\n  const panelRef = useRef<HTMLDivElement>(null);\n\n  // State for invite modal\n  const [inviteModalOpen, setInviteModalOpen] = useState(false);\n  const [selectedInvite, setSelectedInvite] = useState<Notification | null>(null);\n\n  const {\n    notifications,\n    unreadCount,\n    isLoading,\n    markAsRead,\n    markAllAsRead,\n    deleteNotification,\n    refresh,\n  } = useNotifications();\n\n  // Get last 10 notifications\n  const recentNotifications = notifications.slice(0, 10);\n\n  // Handle viewing an invite\n  const handleViewInvite = async (notification: Notification) => {\n    // Mark as read\n    if (!notification.read) {\n      await markAsRead(notification.id);\n    }\n    setSelectedInvite(notification);\n    setInviteModalOpen(true);\n  };\n\n  // Close invite modal\n  const handleCloseInviteModal = () => {\n    setInviteModalOpen(false);\n    setSelectedInvite(null);\n    refresh(); // Refresh notifications after modal closes\n  };\n\n  // Close panel when clicking outside\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleClickOutside = (event: MouseEvent) => {\n      if (\n        panelRef.current &&\n        !panelRef.current.contains(event.target as Node) &&\n        anchorEl &&\n        !anchorEl.contains(event.target as Node)\n      ) {\n        onClose();\n      }\n    };\n\n    const timer = setTimeout(() => {\n      document.addEventListener('mousedown', handleClickOutside);\n    }, 100);\n\n    return () => {\n      clearTimeout(timer);\n      document.removeEventListener('mousedown', handleClickOutside);\n    };\n  }, [isOpen, onClose, anchorEl]);\n\n  // Close on escape key\n  useEffect(() => {\n    if (!isOpen) return;\n\n    const handleEscape = (event: KeyboardEvent) => {\n      if (event.key === 'Escape') {\n        onClose();\n      }\n    };\n\n    document.addEventListener('keydown', handleEscape);\n    return () => document.removeEventListener('keydown', handleEscape);\n  }, [isOpen, onClose]);\n\n  // Refresh notifications when panel opens\n  useEffect(() => {\n    if (isOpen) {\n      refresh();\n    }\n  }, [isOpen, refresh]);\n\n  const handleNotificationClick = async (notification: any) => {\n    // Mark as read\n    if (!notification.read) {\n      await markAsRead(notification.id);\n    }\n\n    // Navigate to action URL if provided\n    if (notification.action_url) {\n      navigate(notification.action_url);\n      onClose();\n    } else if (notification.project_id) {\n      navigate(`/collaborations/${notification.project_id}`);\n      onClose();\n    }\n  };\n\n  const handleMarkAllRead = async () => {\n    try {\n      await markAllAsRead();\n    } catch (error) {\n      console.error('Failed to mark all as read:', error);\n    }\n  };\n\n  const handleDelete = async (e: React.MouseEvent, notificationId: number) => {\n    e.stopPropagation();\n    try {\n      await deleteNotification(notificationId);\n    } catch (error) {\n      console.error('Failed to delete notification:', error);\n    }\n  };\n\n  const handleViewAll = () => {\n    navigate('/notifications');\n    onClose();\n  };\n\n  if (!isOpen) return null;\n\n  return (\n    <div\n      ref={panelRef}\n      role=\"dialog\"\n      aria-label=\"Notifications\"\n      aria-modal=\"false\"\n      style={{\n        position: 'absolute',\n        top: '100%',\n        right: 0,\n        marginTop: 8,\n        width: 420,\n        maxHeight: 600,\n        background: '#0f172a',\n        border: '1px solid #1f2937',\n        borderRadius: 12,\n        boxShadow: '0 10px 40px rgba(0, 0, 0, 0.5)',\n        zIndex: 3000,\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          padding: '16px 20px',\n          borderBottom: '1px solid #1f2937',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <h3 style={{ fontSize: 16, fontWeight: 700, color: '#e5e7eb', margin: 0 }}>\n            Notifications\n          </h3>\n          {unreadCount > 0 && (\n            <div\n              aria-label={`${unreadCount} unread`}\n              style={{\n                background: '#ef4444',\n                color: '#fff',\n                fontSize: 11,\n                fontWeight: 700,\n                padding: '2px 8px',\n                borderRadius: 10,\n                minWidth: 20,\n                textAlign: 'center',\n              }}\n            >\n              {unreadCount}\n            </div>\n          )}\n        </div>\n\n        {recentNotifications.length > 0 && unreadCount > 0 && (\n          <button\n            onClick={handleMarkAllRead}\n            aria-label=\"Mark all as read\"\n            style={{\n              background: 'transparent',\n              color: '#3b82f6',\n              border: 'none',\n              fontSize: 12,\n              fontWeight: 600,\n              cursor: 'pointer',\n              padding: '4px 8px',\n              borderRadius: 4,\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = '#1e293b';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n            }}\n          >\n            Mark All Read\n          </button>\n        )}\n      </div>\n\n      {/* Content */}\n      <div\n        style={{\n          flex: 1,\n          overflowY: 'auto',\n          maxHeight: 500,\n        }}\n      >\n        {isLoading && recentNotifications.length === 0 ? (\n          <div\n            style={{\n              padding: 40,\n              textAlign: 'center',\n              color: '#94a3b8',\n              fontSize: 14,\n            }}\n          >\n            Loading notifications...\n          </div>\n        ) : recentNotifications.length === 0 ? (\n          <div\n            style={{\n              padding: 40,\n              textAlign: 'center',\n              color: '#94a3b8',\n            }}\n          >\n            <div style={{ fontSize: 48, marginBottom: 12 }} aria-hidden=\"true\">\n              \n            </div>\n            <div style={{ fontSize: 14, fontWeight: 600, marginBottom: 4 }}>\n              No notifications yet\n            </div>\n            <div style={{ fontSize: 12, color: '#64748b' }}>\n              We'll notify you when there's activity on your collaborations\n            </div>\n          </div>\n        ) : (\n          <div style={{ padding: '8px 0' }}>\n            {recentNotifications.map((notification) => (\n              <NotificationItem\n                key={notification.id}\n                notification={notification}\n                onClick={() => handleNotificationClick(notification)}\n                onDelete={(e) => handleDelete(e, notification.id)}\n                onViewInvite={handleViewInvite}\n              />\n            ))}\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      {recentNotifications.length > 0 && (\n        <div\n          style={{\n            padding: '12px 20px',\n            borderTop: '1px solid #1f2937',\n            display: 'flex',\n            gap: 8,\n          }}\n        >\n          {notifications.length > 10 && (\n            <button\n              onClick={handleViewAll}\n              aria-label=\"View all notifications\"\n              style={{\n                background: 'transparent',\n                color: '#3b82f6',\n                border: 'none',\n                fontSize: 13,\n                fontWeight: 600,\n                cursor: 'pointer',\n                padding: '6px 12px',\n                borderRadius: 6,\n                flex: 1,\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.background = '#1e293b';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.background = 'transparent';\n              }}\n            >\n              View All\n            </button>\n          )}\n        </div>\n      )}\n\n      {/* Invite Response Modal */}\n      {selectedInvite && selectedInvite.project_id && (\n        <InviteResponseModal\n          open={inviteModalOpen}\n          onClose={handleCloseInviteModal}\n          projectId={selectedInvite.project_id}\n          notificationMessage={selectedInvite.message}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default NotificationDropdown;\n","/**\n * NotificationBell Component\n * Bell icon with unread count badge for navbar\n */\n\nimport React, { useState, useRef, useEffect } from 'react';\nimport { Bell } from 'lucide-react';\nimport { useUnreadCount } from '../../hooks/useNotifications';\nimport { events } from '../../services/notificationService';\nimport NotificationDropdown from './NotificationDropdown';\n\nexport function NotificationBell() {\n  const [isOpen, setIsOpen] = useState(false);\n  const [isAnimating, setIsAnimating] = useState(false);\n  const bellRef = useRef<HTMLButtonElement>(null);\n  const { unreadCount } = useUnreadCount();\n\n  // Animate bell when new notifications arrive\n  useEffect(() => {\n    const unsubscribe = events.on('notifications:new', () => {\n      setIsAnimating(true);\n      setTimeout(() => setIsAnimating(false), 1000);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const toggleDropdown = () => {\n    setIsOpen(!isOpen);\n  };\n\n  return (\n    <div style={{ position: 'relative' }}>\n      <button\n        ref={bellRef}\n        onClick={toggleDropdown}\n        aria-label={`Notifications${unreadCount > 0 ? ` (${unreadCount} unread)` : ''}`}\n        aria-expanded={isOpen}\n        aria-haspopup=\"true\"\n        className=\"rb-nav-link\"\n        style={{\n          position: 'relative',\n        }}\n        title=\"Notifications\"\n      >\n        <Bell\n          size={20}\n          style={{\n            animation: isAnimating ? 'ring 1s ease-in-out' : 'none',\n            transformOrigin: 'top center',\n          }}\n        />\n        {unreadCount > 0 && (\n          <span\n            style={{\n              position: 'absolute',\n              top: 4,\n              right: 4,\n              background: '#ef4444',\n              color: '#fff',\n              fontSize: 10,\n              fontWeight: 700,\n              padding: '2px 6px',\n              borderRadius: 10,\n              minWidth: 18,\n              textAlign: 'center',\n              boxShadow: '0 0 8px rgba(239, 68, 68, 0.5)',\n            }}\n            aria-label={`${unreadCount} unread notifications`}\n          >\n            {unreadCount}\n          </span>\n        )}\n      </button>\n\n      <NotificationDropdown\n        isOpen={isOpen}\n        onClose={() => setIsOpen(false)}\n        anchorEl={bellRef.current}\n      />\n\n      {/* Keyframes for bell animation */}\n      <style>{`\n        @keyframes ring {\n          0%, 100% { transform: rotate(0deg); }\n          10%, 30%, 50%, 70% { transform: rotate(15deg); }\n          20%, 40%, 60%, 80% { transform: rotate(-15deg); }\n          90% { transform: rotate(5deg); }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default NotificationBell;\n","/**\n * NotificationToast Component\n * Toast notification with auto-dismiss and action buttons\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport {\n  Notification,\n  getNotificationIcon,\n  getNotificationColor,\n} from '../../services/notificationService';\n\ninterface NotificationToastProps {\n  notification: Notification;\n  onDismiss: () => void;\n  autoDismissMs?: number;\n}\n\nexport function NotificationToast({\n  notification,\n  onDismiss,\n  autoDismissMs = 5000,\n}: NotificationToastProps) {\n  const navigate = useNavigate();\n  const [isExiting, setIsExiting] = useState(false);\n  const icon = getNotificationIcon(notification.type);\n  const color = getNotificationColor(notification.type);\n\n  useEffect(() => {\n    const timer = setTimeout(() => {\n      handleDismiss();\n    }, autoDismissMs);\n\n    return () => clearTimeout(timer);\n  }, [autoDismissMs]);\n\n  const handleDismiss = () => {\n    setIsExiting(true);\n    setTimeout(() => {\n      onDismiss();\n    }, 300); // Match animation duration\n  };\n\n  const handleView = () => {\n    if (notification.action_url) {\n      navigate(notification.action_url);\n    } else if (notification.project_id) {\n      navigate(`/collaborations/${notification.project_id}`);\n    }\n    handleDismiss();\n  };\n\n  return (\n    <div\n      role=\"alert\"\n      aria-live=\"polite\"\n      aria-atomic=\"true\"\n      style={{\n        width: 380,\n        background: '#1e293b',\n        border: `1px solid ${color}40`,\n        borderLeft: `4px solid ${color}`,\n        borderRadius: 8,\n        boxShadow: '0 10px 40px rgba(0, 0, 0, 0.3)',\n        overflow: 'hidden',\n        marginBottom: 12,\n        animation: isExiting\n          ? 'slideOut 0.3s ease-out forwards'\n          : 'slideIn 0.3s ease-out',\n      }}\n    >\n      {/* Progress bar */}\n      <div\n        style={{\n          height: 3,\n          background: `linear-gradient(90deg, ${color} 0%, transparent 100%)`,\n          animation: `progress ${autoDismissMs}ms linear forwards`,\n        }}\n      />\n\n      <div style={{ padding: '16px' }}>\n        {/* Header */}\n        <div style={{ display: 'flex', alignItems: 'flex-start', gap: 12, marginBottom: 12 }}>\n          <div\n            style={{\n              fontSize: 24,\n              width: 40,\n              height: 40,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              background: `${color}20`,\n              borderRadius: 8,\n              flexShrink: 0,\n            }}\n            aria-hidden=\"true\"\n          >\n            {icon}\n          </div>\n\n          <div style={{ flex: 1, minWidth: 0 }}>\n            <div\n              style={{\n                fontSize: 14,\n                fontWeight: 700,\n                color: '#e5e7eb',\n                marginBottom: 4,\n                lineHeight: 1.3,\n              }}\n            >\n              {notification.title}\n            </div>\n            <div\n              style={{\n                fontSize: 13,\n                color: '#94a3b8',\n                lineHeight: 1.4,\n              }}\n            >\n              {notification.message}\n            </div>\n          </div>\n\n          <button\n            onClick={handleDismiss}\n            aria-label=\"Dismiss notification\"\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#64748b',\n              cursor: 'pointer',\n              padding: 4,\n              fontSize: 20,\n              lineHeight: 1,\n              transition: 'color 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.color = '#e5e7eb';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.color = '#64748b';\n            }}\n          >\n            \n          </button>\n        </div>\n\n        {/* Actions */}\n        <div style={{ display: 'flex', gap: 8 }}>\n          {(notification.action_url || notification.project_id) && (\n            <button\n              onClick={handleView}\n              style={{\n                background: color,\n                color: '#fff',\n                border: 'none',\n                borderRadius: 6,\n                padding: '6px 16px',\n                fontSize: 13,\n                fontWeight: 600,\n                cursor: 'pointer',\n                transition: 'all 0.2s',\n              }}\n              onMouseEnter={(e) => {\n                e.currentTarget.style.opacity = '0.9';\n                e.currentTarget.style.transform = 'translateY(-1px)';\n              }}\n              onMouseLeave={(e) => {\n                e.currentTarget.style.opacity = '1';\n                e.currentTarget.style.transform = 'translateY(0)';\n              }}\n            >\n              View\n            </button>\n          )}\n          <button\n            onClick={handleDismiss}\n            style={{\n              background: 'transparent',\n              color: '#94a3b8',\n              border: '1px solid #334155',\n              borderRadius: 6,\n              padding: '6px 16px',\n              fontSize: 13,\n              fontWeight: 600,\n              cursor: 'pointer',\n              transition: 'all 0.2s',\n            }}\n            onMouseEnter={(e) => {\n              e.currentTarget.style.background = '#334155';\n              e.currentTarget.style.color = '#e5e7eb';\n            }}\n            onMouseLeave={(e) => {\n              e.currentTarget.style.background = 'transparent';\n              e.currentTarget.style.color = '#94a3b8';\n            }}\n          >\n            Dismiss\n          </button>\n        </div>\n      </div>\n\n      {/* Animations */}\n      <style>{`\n        @keyframes slideIn {\n          from {\n            transform: translateX(400px);\n            opacity: 0;\n          }\n          to {\n            transform: translateX(0);\n            opacity: 1;\n          }\n        }\n\n        @keyframes slideOut {\n          from {\n            transform: translateX(0);\n            opacity: 1;\n          }\n          to {\n            transform: translateX(400px);\n            opacity: 0;\n          }\n        }\n\n        @keyframes progress {\n          from {\n            transform: scaleX(1);\n          }\n          to {\n            transform: scaleX(0);\n          }\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default NotificationToast;\n","/**\n * NotificationToastContainer Component\n * Manages and displays multiple toast notifications in a stack\n */\n\nimport React, { useEffect, useState } from 'react';\nimport { events, Notification } from '../../services/notificationService';\nimport NotificationToast from './NotificationToast';\n\nexport function NotificationToastContainer() {\n  const [toasts, setToasts] = useState<Notification[]>([]);\n\n  useEffect(() => {\n    // Subscribe to new notifications event\n    const unsubscribe = events.on('notifications:new', ({ notifications }) => {\n      // Add new notifications to toast queue\n      setToasts((prev) => [...prev, ...notifications]);\n    });\n\n    return () => unsubscribe();\n  }, []);\n\n  const handleDismiss = (notificationId: number) => {\n    setToasts((prev) => prev.filter((n) => n.id !== notificationId));\n  };\n\n  if (toasts.length === 0) return null;\n\n  return (\n    <div\n      aria-live=\"polite\"\n      aria-atomic=\"false\"\n      style={{\n        position: 'fixed',\n        top: 80,\n        right: 20,\n        zIndex: 9999,\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'flex-end',\n        pointerEvents: 'none',\n      }}\n    >\n      <div style={{ pointerEvents: 'auto' }}>\n        {toasts.map((notification) => (\n          <NotificationToast\n            key={notification.id}\n            notification={notification}\n            onDismiss={() => handleDismiss(notification.id)}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n\nexport default NotificationToastContainer;\n","import React, { useState } from 'react';\nimport { API_URL } from '../config';\n\ninterface FeedbackModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n}\n\nexport function FeedbackModal({ isOpen, onClose }: FeedbackModalProps) {\n  const [feedback, setFeedback] = useState('');\n  const [email, setEmail] = useState('');\n  const [submitting, setSubmitting] = useState(false);\n  const [submitted, setSubmitted] = useState(false);\n  const [error, setError] = useState('');\n\n  if (!isOpen) return null;\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setSubmitting(true);\n    setError('');\n\n    try {\n      // Send feedback to backend\n      const response = await fetch(`${API_URL}/api/feedback/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          feedback: feedback,\n          email: email || 'anonymous',\n        }),\n      });\n\n      if (response.ok) {\n        setSubmitted(true);\n        setFeedback('');\n        setEmail('');\n        setTimeout(() => {\n          onClose();\n          setSubmitted(false);\n        }, 2000);\n      } else {\n        setError('Failed to submit feedback. Please try again.');\n      }\n    } catch (err) {\n      console.error('Feedback error:', err);\n      setError('Network error. Please try again later.');\n    } finally {\n      setSubmitting(false);\n    }\n  };\n\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.8)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n        padding: '20px',\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: '#1a1f2e',\n          border: '1px solid #2a3444',\n          borderRadius: '16px',\n          padding: '32px',\n          maxWidth: '500px',\n          width: '100%',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.5)',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {submitted ? (\n          <div style={{ textAlign: 'center' }}>\n            <div style={{ fontSize: '48px', marginBottom: '16px' }}></div>\n            <h2 style={{ fontSize: '24px', fontWeight: 700, color: '#10b981', margin: '0 0 8px 0' }}>\n              Thank You!\n            </h2>\n            <p style={{ fontSize: '14px', color: '#94a3b8', margin: 0 }}>\n              Your feedback helps us improve renaissBlock\n            </p>\n          </div>\n        ) : (\n          <>\n            {/* Header */}\n            <div style={{ marginBottom: '24px' }}>\n              <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '8px' }}>\n                <h2 style={{ fontSize: '24px', fontWeight: 700, color: '#e5e7eb', margin: 0 }}>\n                  Beta Feedback\n                </h2>\n                <button\n                  onClick={onClose}\n                  style={{\n                    background: 'transparent',\n                    border: 'none',\n                    color: '#94a3b8',\n                    fontSize: '24px',\n                    cursor: 'pointer',\n                    padding: '0',\n                    lineHeight: 1,\n                  }}\n                >\n                  \n                </button>\n              </div>\n              <p style={{ fontSize: '14px', color: '#94a3b8', margin: 0 }}>\n                Help us improve by sharing your thoughts, bugs, or feature requests\n              </p>\n            </div>\n\n            {/* Form */}\n            <form onSubmit={handleSubmit} style={{ display: 'grid', gap: '16px' }}>\n              <div>\n                <label style={{ display: 'block', fontSize: '13px', color: '#cbd5e1', marginBottom: '8px', fontWeight: 600 }}>\n                  Your Feedback *\n                </label>\n                <textarea\n                  value={feedback}\n                  onChange={(e) => setFeedback(e.target.value)}\n                  placeholder=\"Tell us what you think! Include bugs, feature requests, or general feedback...\"\n                  required\n                  rows={6}\n                  style={{\n                    width: '100%',\n                    padding: '12px',\n                    background: '#0f1419',\n                    border: '1px solid #2a3444',\n                    borderRadius: '8px',\n                    color: '#e5e7eb',\n                    fontSize: '14px',\n                    fontFamily: 'inherit',\n                    resize: 'vertical',\n                  }}\n                />\n              </div>\n\n              <div>\n                <label style={{ display: 'block', fontSize: '13px', color: '#cbd5e1', marginBottom: '8px', fontWeight: 600 }}>\n                  Email (optional)\n                </label>\n                <input\n                  type=\"email\"\n                  value={email}\n                  onChange={(e) => setEmail(e.target.value)}\n                  placeholder=\"your@email.com (if you'd like a response)\"\n                  style={{\n                    width: '100%',\n                    padding: '12px',\n                    background: '#0f1419',\n                    border: '1px solid #2a3444',\n                    borderRadius: '8px',\n                    color: '#e5e7eb',\n                    fontSize: '14px',\n                  }}\n                />\n              </div>\n\n              {error && (\n                <div style={{\n                  padding: '12px',\n                  background: '#fee2e2',\n                  color: '#dc2626',\n                  borderRadius: '8px',\n                  fontSize: '14px',\n                }}>\n                  {error}\n                </div>\n              )}\n\n              <button\n                type=\"submit\"\n                disabled={submitting || !feedback.trim()}\n                style={{\n                  background: submitting ? '#94a3b8' : 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n                  color: '#000',\n                  border: 'none',\n                  padding: '14px 24px',\n                  borderRadius: '8px',\n                  fontSize: '16px',\n                  fontWeight: 700,\n                  cursor: submitting ? 'not-allowed' : 'pointer',\n                  width: '100%',\n                }}\n              >\n                {submitting ? 'Submitting...' : 'Submit Feedback'}\n              </button>\n            </form>\n          </>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default FeedbackModal;\n","import React, { useState } from 'react';\nimport FeedbackModal from './FeedbackModal';\nimport { MessageSquare } from 'lucide-react';\n\ninterface BetaBadgeProps {\n  variant?: 'header' | 'inline' | 'full';\n  showTestMode?: boolean;\n}\n\nexport function BetaBadge({ variant = 'header', showTestMode = true }: BetaBadgeProps) {\n  if (variant === 'header') {\n    return (\n      <div\n        style={{\n          display: 'inline-flex',\n          alignItems: 'center',\n          gap: '8px',\n          background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n          padding: '4px 12px',\n          borderRadius: '6px',\n          fontSize: '12px',\n          fontWeight: 700,\n          color: '#000',\n          letterSpacing: '0.5px',\n          boxShadow: '0 2px 8px rgba(245, 158, 11, 0.3)',\n        }}\n      >\n        <span>BETA</span>\n        {showTestMode && (\n          <span\n            style={{\n              background: 'rgba(0, 0, 0, 0.2)',\n              padding: '2px 6px',\n              borderRadius: '4px',\n              fontSize: '10px',\n            }}\n          >\n            TEST MODE\n          </span>\n        )}\n      </div>\n    );\n  }\n\n  if (variant === 'inline') {\n    return (\n      <span\n        style={{\n          display: 'inline-block',\n          background: '#f59e0b',\n          color: '#000',\n          padding: '2px 8px',\n          borderRadius: '4px',\n          fontSize: '11px',\n          fontWeight: 700,\n          letterSpacing: '0.5px',\n          marginLeft: '8px',\n        }}\n      >\n        BETA\n      </span>\n    );\n  }\n\n  if (variant === 'full') {\n    return (\n      <div\n        style={{\n          background: 'linear-gradient(135deg, #f59e0b15 0%, #d9770615 100%)',\n          border: '1px solid #f59e0b40',\n          borderRadius: '12px',\n          padding: '16px 20px',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '16px',\n        }}\n      >\n        <div\n          style={{\n            background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n            padding: '8px 16px',\n            borderRadius: '8px',\n            fontSize: '14px',\n            fontWeight: 700,\n            color: '#000',\n            letterSpacing: '0.5px',\n            whiteSpace: 'nowrap',\n          }}\n        >\n          BETA\n        </div>\n        <div style={{ flex: 1 }}>\n          <div style={{ fontSize: '14px', fontWeight: 600, color: '#e5e7eb', marginBottom: '4px' }}>\n            You're in the Beta!\n          </div>\n          <div style={{ fontSize: '13px', color: '#94a3b8', lineHeight: 1.4 }}>\n            Help us improve by{' '}\n            <a\n              href=\"mailto:feedback@renaissblock.com\"\n              style={{\n                color: '#f59e0b',\n                textDecoration: 'none',\n                fontWeight: 600,\n              }}\n            >\n              sharing feedback\n            </a>\n            . All transactions are in test mode.\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return null;\n}\n\nexport function TestModeBanner() {\n  const [showFeedback, setShowFeedback] = useState(false);\n\n  return (\n    <>\n      <button\n        onClick={() => setShowFeedback(true)}\n        style={{\n          position: 'fixed',\n          bottom: 20,\n          right: 20,\n          background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n          color: '#000',\n          border: 'none',\n          padding: '12px 20px',\n          borderRadius: '30px',\n          fontSize: '14px',\n          fontWeight: 700,\n          cursor: 'pointer',\n          zIndex: 1000,\n          boxShadow: '0 4px 12px rgba(245, 158, 11, 0.4)',\n          display: 'flex',\n          alignItems: 'center',\n          gap: '8px',\n          transition: 'transform 0.2s, box-shadow 0.2s',\n        }}\n        onMouseEnter={(e) => {\n          e.currentTarget.style.transform = 'scale(1.05)';\n          e.currentTarget.style.boxShadow = '0 6px 16px rgba(245, 158, 11, 0.5)';\n        }}\n        onMouseLeave={(e) => {\n          e.currentTarget.style.transform = 'scale(1)';\n          e.currentTarget.style.boxShadow = '0 4px 12px rgba(245, 158, 11, 0.4)';\n        }}\n        title=\"Send feedback about the beta\"\n      >\n        <MessageSquare size={18} />\n        Feedback\n      </button>\n      <FeedbackModal isOpen={showFeedback} onClose={() => setShowFeedback(false)} />\n    </>\n  );\n}\n\nexport function BetaWelcomeModal({ onClose }: { onClose: () => void }) {\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        bottom: 0,\n        background: 'rgba(0, 0, 0, 0.8)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 9999,\n        padding: '20px',\n      }}\n      onClick={onClose}\n    >\n      <div\n        style={{\n          background: '#1a1f2e',\n          border: '1px solid #2a3444',\n          borderRadius: '16px',\n          padding: '32px',\n          maxWidth: '500px',\n          width: '100%',\n          boxShadow: '0 20px 60px rgba(0, 0, 0, 0.5)',\n        }}\n        onClick={(e) => e.stopPropagation()}\n      >\n        {/* Header */}\n        <div style={{ textAlign: 'center', marginBottom: '24px' }}>\n          <div\n            style={{\n              display: 'inline-block',\n              background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n              padding: '12px 24px',\n              borderRadius: '12px',\n              fontSize: '18px',\n              fontWeight: 700,\n              color: '#000',\n              letterSpacing: '1px',\n              marginBottom: '16px',\n            }}\n          >\n            BETA TESTER\n          </div>\n          <h2 style={{ fontSize: '24px', fontWeight: 700, color: '#e5e7eb', margin: '0 0 8px 0' }}>\n            Welcome to renaissBlock Beta!\n          </h2>\n          <p style={{ fontSize: '14px', color: '#94a3b8', margin: 0 }}>\n            You're one of the first creators to experience the future\n          </p>\n        </div>\n\n        {/* Content */}\n        <div style={{ marginBottom: '24px' }}>\n          <div style={{ marginBottom: '16px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 600, color: '#f59e0b', marginBottom: '8px' }}>\n               Test Mode Active\n            </div>\n            <ul style={{ fontSize: '13px', color: '#cbd5e1', margin: '0', paddingLeft: '20px', lineHeight: 1.6 }}>\n              <li>No real money charged (use test card: 4242 4242 4242 4242)</li>\n              <li>Blockchain features use Solana devnet (fake SOL)</li>\n              <li>Some features still being polished</li>\n            </ul>\n          </div>\n\n          <div style={{ marginBottom: '16px' }}>\n            <div style={{ fontSize: '14px', fontWeight: 600, color: '#f59e0b', marginBottom: '8px' }}>\n               What to Try\n            </div>\n            <ul style={{ fontSize: '13px', color: '#cbd5e1', margin: '0', paddingLeft: '20px', lineHeight: 1.6 }}>\n              <li>Create and publish your first content</li>\n              <li>Collaborate with other beta testers</li>\n              <li>Test the purchase and reading experience</li>\n            </ul>\n          </div>\n\n          <div\n            style={{\n              background: '#f59e0b20',\n              border: '1px solid #f59e0b40',\n              borderRadius: '8px',\n              padding: '12px',\n              marginTop: '16px',\n            }}\n          >\n            <div style={{ fontSize: '13px', color: '#fbbf24', fontWeight: 600, marginBottom: '4px' }}>\n               Beta Perks\n            </div>\n            <p style={{ fontSize: '12px', color: '#cbd5e1', margin: 0, lineHeight: 1.5 }}>\n              As a beta tester, you'll get early access to new features and special recognition when we launch!\n            </p>\n          </div>\n        </div>\n\n        {/* Footer */}\n        <div style={{ textAlign: 'center' }}>\n          <button\n            onClick={onClose}\n            style={{\n              background: 'linear-gradient(135deg, #f59e0b 0%, #d97706 100%)',\n              color: '#000',\n              border: 'none',\n              padding: '12px 32px',\n              borderRadius: '8px',\n              fontSize: '14px',\n              fontWeight: 700,\n              cursor: 'pointer',\n              width: '100%',\n              marginBottom: '12px',\n            }}\n          >\n            Let's Go! \n          </button>\n          <div style={{ fontSize: '12px', color: '#64748b' }}>\n            Questions?{' '}\n            <a\n              href=\"mailto:feedback@renaissblock.com\"\n              style={{ color: '#f59e0b', textDecoration: 'none', fontWeight: 600 }}\n            >\n              feedback@renaissblock.com\n            </a>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","import React, { useEffect, useState } from 'react';\nimport { BetaWelcomeModal } from './BetaBadge';\nimport { useAuth } from '../hooks/useAuth';\n\n/**\n * BetaOnboarding Component\n *\n * Shows welcome modal to new beta users on first login\n * Stores completion in localStorage to avoid showing again\n */\nexport function BetaOnboarding() {\n  const { isAuthenticated, user } = useAuth();\n  const [showWelcome, setShowWelcome] = useState(false);\n\n  useEffect(() => {\n    if (!isAuthenticated || !user) {\n      return;\n    }\n\n    // Check if user has seen the welcome modal\n    const hasSeenWelcome = localStorage.getItem('beta_welcome_seen');\n    const lastSeenUserId = localStorage.getItem('beta_welcome_user_id');\n\n    // Show welcome if:\n    // 1. Never seen before, OR\n    // 2. Different user than last time (account switching)\n    if (!hasSeenWelcome || lastSeenUserId !== String(user.id)) {\n      // Small delay to let the app load first\n      setTimeout(() => {\n        setShowWelcome(true);\n      }, 1000);\n    }\n  }, [isAuthenticated, user]);\n\n  const handleClose = () => {\n    if (user) {\n      localStorage.setItem('beta_welcome_seen', 'true');\n      localStorage.setItem('beta_welcome_user_id', String(user.id));\n    }\n    setShowWelcome(false);\n  };\n\n  return (\n    <>\n      {showWelcome && <BetaWelcomeModal onClose={handleClose} />}\n    </>\n  );\n}\n\nexport default BetaOnboarding;\n","/**\n * Footer component with legal links.\n */\n\nimport React from 'react';\nimport { Link } from 'react-router-dom';\n\nexport function Footer() {\n  const currentYear = new Date().getFullYear();\n\n  return (\n    <footer style={{\n      marginTop: 'auto',\n      padding: '24px 20px',\n      borderTop: '1px solid var(--border, #334155)',\n      background: 'var(--bg-secondary, #1e293b)',\n    }}>\n      <div style={{\n        maxWidth: 1200,\n        margin: '0 auto',\n        display: 'flex',\n        flexWrap: 'wrap',\n        justifyContent: 'space-between',\n        alignItems: 'flex-start',\n        gap: 32,\n      }}>\n        {/* Brand */}\n        <div style={{ minWidth: 200 }}>\n          <div style={{\n            display: 'flex',\n            alignItems: 'center',\n            gap: 10,\n            marginBottom: 8,\n          }}>\n            <img\n              src=\"/rb-logo.png\"\n              alt=\"renaissBlock\"\n              style={{\n                height: 28,\n                width: 'auto',\n                borderRadius: 4,\n              }}\n            />\n            <span style={{\n              fontSize: 16,\n              fontWeight: 700,\n              color: 'var(--text, #e5e7eb)',\n            }}>\n              renaissBlock\n            </span>\n          </div>\n          <div style={{\n            fontSize: 13,\n            color: 'var(--text-muted, #94a3b8)',\n          }}>\n            A platform for serious creators.\n          </div>\n        </div>\n\n        {/* Legal Links */}\n        <div style={{ minWidth: 150 }}>\n          <div style={{\n            fontSize: 13,\n            fontWeight: 600,\n            color: 'var(--text, #e5e7eb)',\n            marginBottom: 12,\n            textTransform: 'uppercase',\n            letterSpacing: '0.5px',\n          }}>\n            Legal\n          </div>\n          <nav style={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 8,\n          }}>\n            <Link to=\"/legal/terms\" style={linkStyle}>Terms of Service</Link>\n            <Link to=\"/legal/privacy\" style={linkStyle}>Privacy Policy</Link>\n            <Link to=\"/legal/content-policy\" style={linkStyle}>Content Policy</Link>\n            <Link to=\"/legal/dmca\" style={linkStyle}>DMCA / Copyright</Link>\n            <Link to=\"/legal/creator-agreement\" style={linkStyle}>Creator Agreement</Link>\n          </nav>\n        </div>\n\n        {/* Support Links */}\n        <div style={{ minWidth: 150 }}>\n          <div style={{\n            fontSize: 13,\n            fontWeight: 600,\n            color: 'var(--text, #e5e7eb)',\n            marginBottom: 12,\n            textTransform: 'uppercase',\n            letterSpacing: '0.5px',\n          }}>\n            Support\n          </div>\n          <nav style={{\n            display: 'flex',\n            flexDirection: 'column',\n            gap: 8,\n          }}>\n            <a href=\"mailto:support@renaissblock.com\" style={linkStyle}>Contact Us</a>\n            <a href=\"mailto:dmca@renaissblock.com\" style={linkStyle}>Report Copyright</a>\n            <a href=\"mailto:reports@renaissblock.com\" style={linkStyle}>Report Content</a>\n          </nav>\n        </div>\n\n        {/* Copyright */}\n        <div style={{\n          width: '100%',\n          paddingTop: 16,\n          borderTop: '1px solid var(--border, #334155)',\n          marginTop: 8,\n        }}>\n          <div style={{\n            fontSize: 12,\n            color: 'var(--text-muted, #94a3b8)',\n            textAlign: 'center',\n          }}>\n            &copy; {currentYear} renaissBlock. All rights reserved.\n          </div>\n        </div>\n      </div>\n    </footer>\n  );\n}\n\nconst linkStyle: React.CSSProperties = {\n  fontSize: 13,\n  color: 'var(--text-muted, #94a3b8)',\n  textDecoration: 'none',\n  transition: 'color 0.2s',\n};\n\nexport default Footer;\n","/**\n * Cookie consent banner for GDPR/CCPA compliance.\n * Shows on first visit and stores preference in localStorage.\n */\n\nimport React, { useState, useEffect } from 'react';\nimport { Link } from 'react-router-dom';\nimport { X } from 'lucide-react';\n\nconst COOKIE_CONSENT_KEY = 'rb_cookie_consent';\n\ninterface CookiePreferences {\n  necessary: boolean; // Always true\n  analytics: boolean;\n  marketing: boolean;\n}\n\nexport function CookieBanner() {\n  const [isVisible, setIsVisible] = useState(false);\n  const [showCustomize, setShowCustomize] = useState(false);\n  const [preferences, setPreferences] = useState<CookiePreferences>({\n    necessary: true,\n    analytics: false,\n    marketing: false,\n  });\n\n  useEffect(() => {\n    // Check if user has already made a choice\n    const consent = localStorage.getItem(COOKIE_CONSENT_KEY);\n    if (!consent) {\n      // Small delay to prevent flash on page load\n      const timer = setTimeout(() => setIsVisible(true), 1000);\n      return () => clearTimeout(timer);\n    }\n  }, []);\n\n  const saveConsent = (prefs: CookiePreferences) => {\n    localStorage.setItem(COOKIE_CONSENT_KEY, JSON.stringify({\n      ...prefs,\n      timestamp: new Date().toISOString(),\n    }));\n    setIsVisible(false);\n  };\n\n  const handleAcceptAll = () => {\n    saveConsent({\n      necessary: true,\n      analytics: true,\n      marketing: true,\n    });\n  };\n\n  const handleRejectNonEssential = () => {\n    saveConsent({\n      necessary: true,\n      analytics: false,\n      marketing: false,\n    });\n  };\n\n  const handleSavePreferences = () => {\n    saveConsent(preferences);\n  };\n\n  if (!isVisible) return null;\n\n  return (\n    <div style={{\n      position: 'fixed',\n      bottom: 0,\n      left: 0,\n      right: 0,\n      zIndex: 9999,\n      background: 'var(--bg, #0f172a)',\n      borderTop: '1px solid var(--border, #334155)',\n      padding: '16px 20px',\n      boxShadow: '0 -4px 20px rgba(0, 0, 0, 0.3)',\n    }}>\n      <div style={{\n        maxWidth: 1200,\n        margin: '0 auto',\n      }}>\n        {!showCustomize ? (\n          // Simple banner\n          <div style={{\n            display: 'flex',\n            flexWrap: 'wrap',\n            alignItems: 'center',\n            gap: 16,\n            justifyContent: 'space-between',\n          }}>\n            <div style={{ flex: '1 1 400px' }}>\n              <p style={{\n                margin: 0,\n                fontSize: 14,\n                color: 'var(--text, #e5e7eb)',\n              }}>\n                We use cookies to improve your experience.{' '}\n                <Link\n                  to=\"/legal/privacy\"\n                  style={{ color: 'var(--accent, #f59e0b)' }}\n                >\n                  Learn more in our Privacy Policy\n                </Link>\n              </p>\n            </div>\n            <div style={{\n              display: 'flex',\n              gap: 8,\n              flexWrap: 'wrap',\n            }}>\n              <button\n                onClick={() => setShowCustomize(true)}\n                style={{\n                  padding: '8px 16px',\n                  borderRadius: 6,\n                  border: '1px solid var(--border, #334155)',\n                  background: 'transparent',\n                  color: 'var(--text, #e5e7eb)',\n                  fontSize: 13,\n                  cursor: 'pointer',\n                }}\n              >\n                Customize\n              </button>\n              <button\n                onClick={handleRejectNonEssential}\n                style={{\n                  padding: '8px 16px',\n                  borderRadius: 6,\n                  border: '1px solid var(--border, #334155)',\n                  background: 'transparent',\n                  color: 'var(--text, #e5e7eb)',\n                  fontSize: 13,\n                  cursor: 'pointer',\n                }}\n              >\n                Reject Non-Essential\n              </button>\n              <button\n                onClick={handleAcceptAll}\n                style={{\n                  padding: '8px 16px',\n                  borderRadius: 6,\n                  border: 'none',\n                  background: 'var(--accent, #f59e0b)',\n                  color: '#000',\n                  fontSize: 13,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                }}\n              >\n                Accept All\n              </button>\n            </div>\n          </div>\n        ) : (\n          // Customize view\n          <div>\n            <div style={{\n              display: 'flex',\n              justifyContent: 'space-between',\n              alignItems: 'center',\n              marginBottom: 16,\n            }}>\n              <h3 style={{\n                margin: 0,\n                fontSize: 16,\n                fontWeight: 600,\n                color: 'var(--text, #e5e7eb)',\n              }}>\n                Cookie Preferences\n              </h3>\n              <button\n                onClick={() => setShowCustomize(false)}\n                style={{\n                  background: 'none',\n                  border: 'none',\n                  padding: 4,\n                  cursor: 'pointer',\n                  color: 'var(--text-muted, #94a3b8)',\n                }}\n              >\n                <X size={18} />\n              </button>\n            </div>\n\n            <div style={{\n              display: 'flex',\n              flexDirection: 'column',\n              gap: 12,\n              marginBottom: 16,\n            }}>\n              <label style={{\n                display: 'flex',\n                gap: 12,\n                alignItems: 'flex-start',\n                padding: 12,\n                background: 'var(--bg-secondary, #1e293b)',\n                borderRadius: 6,\n              }}>\n                <input\n                  type=\"checkbox\"\n                  checked={true}\n                  disabled\n                  style={{ marginTop: 3 }}\n                />\n                <div>\n                  <div style={{ fontWeight: 500, color: 'var(--text, #e5e7eb)', marginBottom: 2 }}>\n                    Necessary Cookies\n                  </div>\n                  <div style={{ fontSize: 13, color: 'var(--text-muted, #94a3b8)' }}>\n                    Required for the website to function. Cannot be disabled.\n                  </div>\n                </div>\n              </label>\n\n              <label style={{\n                display: 'flex',\n                gap: 12,\n                alignItems: 'flex-start',\n                padding: 12,\n                background: 'var(--bg-secondary, #1e293b)',\n                borderRadius: 6,\n                cursor: 'pointer',\n              }}>\n                <input\n                  type=\"checkbox\"\n                  checked={preferences.analytics}\n                  onChange={(e) => setPreferences(prev => ({ ...prev, analytics: e.target.checked }))}\n                  style={{ marginTop: 3 }}\n                />\n                <div>\n                  <div style={{ fontWeight: 500, color: 'var(--text, #e5e7eb)', marginBottom: 2 }}>\n                    Analytics Cookies\n                  </div>\n                  <div style={{ fontSize: 13, color: 'var(--text-muted, #94a3b8)' }}>\n                    Help us understand how you use the site to improve it.\n                  </div>\n                </div>\n              </label>\n\n              <label style={{\n                display: 'flex',\n                gap: 12,\n                alignItems: 'flex-start',\n                padding: 12,\n                background: 'var(--bg-secondary, #1e293b)',\n                borderRadius: 6,\n                cursor: 'pointer',\n              }}>\n                <input\n                  type=\"checkbox\"\n                  checked={preferences.marketing}\n                  onChange={(e) => setPreferences(prev => ({ ...prev, marketing: e.target.checked }))}\n                  style={{ marginTop: 3 }}\n                />\n                <div>\n                  <div style={{ fontWeight: 500, color: 'var(--text, #e5e7eb)', marginBottom: 2 }}>\n                    Marketing Cookies\n                  </div>\n                  <div style={{ fontSize: 13, color: 'var(--text-muted, #94a3b8)' }}>\n                    Used to show you relevant content and ads.\n                  </div>\n                </div>\n              </label>\n            </div>\n\n            <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 8 }}>\n              <button\n                onClick={handleRejectNonEssential}\n                style={{\n                  padding: '8px 16px',\n                  borderRadius: 6,\n                  border: '1px solid var(--border, #334155)',\n                  background: 'transparent',\n                  color: 'var(--text, #e5e7eb)',\n                  fontSize: 13,\n                  cursor: 'pointer',\n                }}\n              >\n                Reject All\n              </button>\n              <button\n                onClick={handleSavePreferences}\n                style={{\n                  padding: '8px 16px',\n                  borderRadius: 6,\n                  border: 'none',\n                  background: 'var(--accent, #f59e0b)',\n                  color: '#000',\n                  fontSize: 13,\n                  fontWeight: 600,\n                  cursor: 'pointer',\n                }}\n              >\n                Save Preferences\n              </button>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport default CookieBanner;\n","/**\n * Cart Context - Shopping cart state management\n *\n * Provides cart state and operations to all components.\n * Persists cart via backend API (database-backed).\n */\n\nimport React, { createContext, useContext, useState, useEffect, useCallback } from 'react';\nimport { API_URL } from '../config';\n\ninterface CartItem {\n  id: number;\n  type: 'chapter' | 'content';\n  item_id: number;\n  title: string;\n  creator_username: string;\n  unit_price: string;\n  added_at: string;\n  book_title?: string;\n  chapter_order?: number;\n  cover_url?: string;\n}\n\ninterface BreakdownDisplay {\n  subtotal: string;\n  credit_card_fee: string;\n  buyer_total: string;\n  savings: string;\n  item_count: number;\n}\n\ninterface Cart {\n  id: number;\n  status: string;\n  item_count: number;\n  max_items: number;\n  items: CartItem[];\n  subtotal?: string;\n  credit_card_fee?: string;\n  total?: string;\n  savings_vs_individual?: string;\n  breakdown_display?: BreakdownDisplay;\n}\n\ninterface CartContextType {\n  cart: Cart | null;\n  loading: boolean;\n  error: string | null;\n  addToCart: (chapterId?: number, contentId?: number) => Promise<boolean>;\n  removeFromCart: (itemId: number) => Promise<boolean>;\n  clearCart: () => Promise<void>;\n  checkout: () => Promise<string | null>;\n  refreshCart: () => Promise<void>;\n  isInCart: (itemId: number, type: 'chapter' | 'content') => boolean;\n}\n\nconst CartContext = createContext<CartContextType | undefined>(undefined);\n\nexport function CartProvider({ children }: { children: React.ReactNode }) {\n  const [cart, setCart] = useState<Cart | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n\n  const getCSRFToken = async () => {\n    try {\n      const res = await fetch(`${API_URL}/api/auth/csrf/`, { credentials: 'include' });\n      const data = await res.json();\n      return data?.csrfToken || '';\n    } catch {\n      return '';\n    }\n  };\n\n  const refreshCart = useCallback(async () => {\n    try {\n      const res = await fetch(`${API_URL}/api/cart/`, { credentials: 'include' });\n      if (res.ok) {\n        const data = await res.json();\n        setCart(data);\n        setError(null);\n      } else if (res.status === 403) {\n        // Not authenticated\n        setCart(null);\n      }\n    } catch (e) {\n      console.error('Failed to fetch cart:', e);\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n\n  useEffect(() => {\n    refreshCart();\n  }, [refreshCart]);\n\n  const addToCart = async (chapterId?: number, contentId?: number): Promise<boolean> => {\n    setError(null);\n    try {\n      const csrfToken = await getCSRFToken();\n      const res = await fetch(`${API_URL}/api/cart/add/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrfToken,\n        },\n        credentials: 'include',\n        body: JSON.stringify({ chapter_id: chapterId, content_id: contentId }),\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        setError(data.error || 'Failed to add to cart');\n        return false;\n      }\n\n      await refreshCart();\n      return true;\n    } catch (e) {\n      setError('Failed to add to cart');\n      return false;\n    }\n  };\n\n  const removeFromCart = async (itemId: number): Promise<boolean> => {\n    setError(null);\n    try {\n      const csrfToken = await getCSRFToken();\n      const res = await fetch(`${API_URL}/api/cart/remove/${itemId}/`, {\n        method: 'DELETE',\n        headers: { 'X-CSRFToken': csrfToken },\n        credentials: 'include',\n      });\n\n      if (res.ok) {\n        await refreshCart();\n        return true;\n      }\n      return false;\n    } catch (e) {\n      return false;\n    }\n  };\n\n  const clearCart = async () => {\n    setError(null);\n    try {\n      const csrfToken = await getCSRFToken();\n      await fetch(`${API_URL}/api/cart/clear/`, {\n        method: 'POST',\n        headers: { 'X-CSRFToken': csrfToken },\n        credentials: 'include',\n      });\n      await refreshCart();\n    } catch (e) {\n      console.error('Failed to clear cart:', e);\n    }\n  };\n\n  const checkout = async (): Promise<string | null> => {\n    setError(null);\n    try {\n      const csrfToken = await getCSRFToken();\n      const res = await fetch(`${API_URL}/api/cart/checkout/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': csrfToken,\n        },\n        credentials: 'include',\n      });\n\n      const data = await res.json();\n\n      if (!res.ok) {\n        setError(data.error || 'Checkout failed');\n        return null;\n      }\n\n      return data.checkout_url;\n    } catch (e) {\n      setError('Checkout failed');\n      return null;\n    }\n  };\n\n  const isInCart = (itemId: number, type: 'chapter' | 'content'): boolean => {\n    if (!cart) return false;\n    return cart.items.some(\n      item => item.item_id === itemId && item.type === type\n    );\n  };\n\n  return (\n    <CartContext.Provider value={{\n      cart,\n      loading,\n      error,\n      addToCart,\n      removeFromCart,\n      clearCart,\n      checkout,\n      refreshCart,\n      isInCart,\n    }}>\n      {children}\n    </CartContext.Provider>\n  );\n}\n\nexport function useCart() {\n  const context = useContext(CartContext);\n  if (!context) {\n    throw new Error('useCart must be used within CartProvider');\n  }\n  return context;\n}\n\nexport default CartContext;\n","/**\n * Cart Icon Component\n *\n * Shopping cart icon for header navigation.\n * Shows item count badge when cart has items.\n */\n\nimport React from 'react';\nimport { Link } from 'react-router-dom';\nimport { ShoppingCart } from 'lucide-react';\nimport { useCart } from '../contexts/CartContext';\n\ninterface CartIconProps {\n  className?: string;\n}\n\nexport default function CartIcon({ className = '' }: CartIconProps) {\n  const { cart, loading } = useCart();\n  const itemCount = cart?.item_count || 0;\n\n  return (\n    <Link\n      to=\"/cart\"\n      className={`rb-nav-link rb-cart-icon ${className}`}\n      title={itemCount > 0 ? `Cart (${itemCount} items)` : 'Cart'}\n      style={{\n        position: 'relative',\n        display: 'flex',\n        alignItems: 'center',\n        padding: '8px',\n        color: 'var(--text, #e2e8f0)',\n        textDecoration: 'none',\n      }}\n    >\n      <ShoppingCart size={20} />\n\n      {!loading && itemCount > 0 && (\n        <span\n          style={{\n            position: 'absolute',\n            top: '0',\n            right: '0',\n            backgroundColor: 'var(--accent, #3b82f6)',\n            color: 'white',\n            fontSize: '11px',\n            fontWeight: 600,\n            minWidth: '18px',\n            height: '18px',\n            borderRadius: '50%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            padding: '0 4px',\n          }}\n        >\n          {itemCount > 99 ? '99+' : itemCount}\n        </span>\n      )}\n    </Link>\n  );\n}\n","import React, { useState, useEffect, useRef, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { Search, Clock, TrendingUp, X } from 'lucide-react';\nimport { API_URL } from '../config';\n\ntype Suggestion = {\n  id: number;\n  title: string;\n  creator_username?: string;\n  content_type?: string;\n};\n\ntype Props = {\n  onSearch?: (query: string) => void;\n};\n\nconst RECENT_SEARCHES_KEY = 'rb_recent_searches';\nconst MAX_RECENT_SEARCHES = 5;\n\nexport function SearchAutocomplete({ onSearch }: Props) {\n  const [query, setQuery] = useState('');\n  const [suggestions, setSuggestions] = useState<Suggestion[]>([]);\n  const [recentSearches, setRecentSearches] = useState<string[]>([]);\n  const [isOpen, setIsOpen] = useState(false);\n  const [selectedIndex, setSelectedIndex] = useState(-1);\n  const [loading, setLoading] = useState(false);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const navigate = useNavigate();\n\n  // Load recent searches from localStorage\n  useEffect(() => {\n    try {\n      const stored = localStorage.getItem(RECENT_SEARCHES_KEY);\n      if (stored) {\n        setRecentSearches(JSON.parse(stored));\n      }\n    } catch {}\n  }, []);\n\n  // Save recent search\n  const saveRecentSearch = (search: string) => {\n    if (!search.trim()) return;\n    const updated = [search, ...recentSearches.filter(s => s !== search)].slice(0, MAX_RECENT_SEARCHES);\n    setRecentSearches(updated);\n    try {\n      localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(updated));\n    } catch {}\n  };\n\n  // Remove recent search\n  const removeRecentSearch = (search: string, e: React.MouseEvent) => {\n    e.stopPropagation();\n    const updated = recentSearches.filter(s => s !== search);\n    setRecentSearches(updated);\n    try {\n      localStorage.setItem(RECENT_SEARCHES_KEY, JSON.stringify(updated));\n    } catch {}\n  };\n\n  // Fetch suggestions (debounced)\n  useEffect(() => {\n    if (query.length < 2) {\n      setSuggestions([]);\n      return;\n    }\n\n    const timer = setTimeout(() => {\n      setLoading(true);\n      fetch(`${API_URL}/api/search/?q=${encodeURIComponent(query)}`, { credentials: 'include' })\n        .then(r => r.json())\n        .then(data => {\n          if (Array.isArray(data)) {\n            setSuggestions(data.slice(0, 6));\n          }\n        })\n        .catch(() => setSuggestions([]))\n        .finally(() => setLoading(false));\n    }, 200);\n\n    return () => clearTimeout(timer);\n  }, [query]);\n\n  // Handle click outside to close dropdown\n  useEffect(() => {\n    const handleClickOutside = (e: MouseEvent) => {\n      if (containerRef.current && !containerRef.current.contains(e.target as Node)) {\n        setIsOpen(false);\n      }\n    };\n    document.addEventListener('mousedown', handleClickOutside);\n    return () => document.removeEventListener('mousedown', handleClickOutside);\n  }, []);\n\n  // Handle search submission\n  const handleSearch = (searchQuery: string) => {\n    if (!searchQuery.trim()) return;\n    saveRecentSearch(searchQuery.trim());\n    setIsOpen(false);\n    setQuery(searchQuery);\n    if (onSearch) {\n      onSearch(searchQuery);\n    } else {\n      navigate(`/search?q=${encodeURIComponent(searchQuery.trim())}`);\n    }\n  };\n\n  // Handle keyboard navigation\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    const items = query.length >= 2 ? suggestions : recentSearches;\n    const totalItems = items.length;\n\n    switch (e.key) {\n      case 'ArrowDown':\n        e.preventDefault();\n        setSelectedIndex(prev => (prev < totalItems - 1 ? prev + 1 : prev));\n        break;\n      case 'ArrowUp':\n        e.preventDefault();\n        setSelectedIndex(prev => (prev > 0 ? prev - 1 : -1));\n        break;\n      case 'Enter':\n        e.preventDefault();\n        if (selectedIndex >= 0 && selectedIndex < totalItems) {\n          const selected = query.length >= 2\n            ? suggestions[selectedIndex]?.title\n            : recentSearches[selectedIndex];\n          if (selected) handleSearch(selected);\n        } else {\n          handleSearch(query);\n        }\n        break;\n      case 'Escape':\n        setIsOpen(false);\n        inputRef.current?.blur();\n        break;\n    }\n  };\n\n  // Reset selection when suggestions change\n  useEffect(() => {\n    setSelectedIndex(-1);\n  }, [suggestions, recentSearches]);\n\n  const showDropdown = isOpen && (query.length >= 2 ? suggestions.length > 0 : recentSearches.length > 0);\n\n  return (\n    <div ref={containerRef} className=\"search-autocomplete\" style={{ position: 'relative', width: '100%' }}>\n      <form\n        onSubmit={(e) => { e.preventDefault(); handleSearch(query); }}\n        className=\"rb-search\"\n      >\n        <input\n          ref={inputRef}\n          type=\"text\"\n          value={query}\n          onChange={(e) => setQuery(e.target.value)}\n          onFocus={() => setIsOpen(true)}\n          onKeyDown={handleKeyDown}\n          placeholder=\"Search\"\n          autoComplete=\"off\"\n        />\n        <button type=\"submit\">\n          <Search size={18} />\n        </button>\n      </form>\n\n      {/* Dropdown */}\n      {showDropdown && (\n        <div className=\"search-dropdown\" style={{\n          position: 'absolute',\n          top: '100%',\n          left: 0,\n          right: 0,\n          marginTop: 4,\n          background: '#1e293b',\n          borderRadius: 8,\n          boxShadow: '0 4px 20px rgba(0,0,0,0.4)',\n          zIndex: 1000,\n          overflow: 'hidden',\n          border: '1px solid #334155',\n        }}>\n          {query.length >= 2 ? (\n            // Show search suggestions\n            <>\n              {suggestions.map((item, index) => (\n                <div\n                  key={item.id}\n                  onClick={() => handleSearch(item.title)}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 12,\n                    padding: '10px 16px',\n                    cursor: 'pointer',\n                    background: selectedIndex === index ? '#334155' : 'transparent',\n                  }}\n                  onMouseEnter={() => setSelectedIndex(index)}\n                >\n                  <Search size={16} style={{ color: '#64748b', flexShrink: 0 }} />\n                  <div style={{ flex: 1, minWidth: 0 }}>\n                    <div style={{\n                      color: '#f1f5f9',\n                      fontSize: 14,\n                      whiteSpace: 'nowrap',\n                      overflow: 'hidden',\n                      textOverflow: 'ellipsis',\n                    }}>\n                      {item.title}\n                    </div>\n                    {item.creator_username && (\n                      <div style={{ color: '#64748b', fontSize: 12 }}>\n                        by {item.creator_username}\n                      </div>\n                    )}\n                  </div>\n                  {item.content_type && (\n                    <span style={{\n                      fontSize: 10,\n                      padding: '2px 6px',\n                      background: '#334155',\n                      borderRadius: 4,\n                      color: '#94a3b8',\n                      textTransform: 'capitalize',\n                    }}>\n                      {item.content_type}\n                    </span>\n                  )}\n                </div>\n              ))}\n            </>\n          ) : (\n            // Show recent searches\n            <>\n              <div style={{\n                padding: '8px 16px',\n                fontSize: 12,\n                color: '#64748b',\n                borderBottom: '1px solid #334155',\n              }}>\n                Recent searches\n              </div>\n              {recentSearches.map((search, index) => (\n                <div\n                  key={search}\n                  onClick={() => handleSearch(search)}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: 12,\n                    padding: '10px 16px',\n                    cursor: 'pointer',\n                    background: selectedIndex === index ? '#334155' : 'transparent',\n                  }}\n                  onMouseEnter={() => setSelectedIndex(index)}\n                >\n                  <Clock size={16} style={{ color: '#64748b', flexShrink: 0 }} />\n                  <span style={{ flex: 1, color: '#f1f5f9', fontSize: 14 }}>\n                    {search}\n                  </span>\n                  <button\n                    onClick={(e) => removeRecentSearch(search, e)}\n                    style={{\n                      background: 'none',\n                      border: 'none',\n                      padding: 4,\n                      cursor: 'pointer',\n                      color: '#64748b',\n                      display: 'flex',\n                      alignItems: 'center',\n                    }}\n                  >\n                    <X size={14} />\n                  </button>\n                </div>\n              ))}\n            </>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n","import React, { useEffect, useState, Suspense, lazy } from 'react';\nimport { Route, Routes, Link, useLocation, useNavigate, Navigate } from 'react-router-dom';\nimport './App.css';\nimport { CreatorSidebar } from './components/CreatorSidebar';\nimport { LibrarySidebar } from './components/LibrarySidebar';\nimport { MobileLibrary } from './components/MobileLibrary';\nimport { useMobile } from './hooks/useMobile';\nimport ProtectedRoute from './components/ProtectedRoute';\nimport ErrorBoundary from './components/ErrorBoundary';\nimport NotificationBell from './components/notifications/NotificationBell';\nimport NotificationToastContainer from './components/notifications/NotificationToastContainer';\nimport notificationService from './services/notificationService';\nimport { BetaBadge, TestModeBanner } from './components/BetaBadge';\nimport { useAuth } from './hooks/useAuth';\nimport BetaOnboarding from './components/BetaOnboarding';\nimport { Footer } from './components/legal/Footer';\nimport { CookieBanner } from './components/legal/CookieBanner';\nimport { API_URL } from './config';\nimport { CartProvider } from './contexts/CartContext';\nimport CartIcon from './components/CartIcon';\nimport {\n  User, LogOut, Menu, X, Users\n} from 'lucide-react';\nimport { SearchAutocomplete } from './components/SearchAutocomplete';\n\n// Lazy-loaded page components for code splitting\nconst HomePage = lazy(() => import('./pages/HomePage'));\nconst SearchPage = lazy(() => import('./pages/SearchPage'));\nconst StudioPage = lazy(() => import('./pages/StudioPage'));\nconst DashboardPage = lazy(() => import('./pages/DashboardPage'));\nconst ProfilePage = lazy(() => import('./pages/ProfilePageRedesigned'));\nconst AuthPage = lazy(() => import('./pages/AuthPage'));\nconst WalletInfoPage = lazy(() => import('./pages/WalletInfoPage'));\n// TermsPage replaced by TermsOfServicePage in legal pages\nconst BetaLanding = lazy(() => import('./pages/BetaLanding'));\nconst CollaboratorsPage = lazy(() => import('./pages/CollaboratorsPage'));\nconst PublicProfilePage = lazy(() => import('./pages/PublicProfilePage'));\nconst ContentDetail = lazy(() => import('./pages/ContentDetail'));\nconst PurchaseSuccessPage = lazy(() => import('./pages/PurchaseSuccessPage'));\nconst ReaderPage = lazy(() => import('./pages/ReaderPage').then(m => ({ default: m.ReaderPage })));\nconst CollaborationDashboard = lazy(() => import('./pages/CollaborationDashboard'));\nconst CollaborativeProjectPage = lazy(() => import('./pages/CollaborativeProjectPage'));\nconst NotificationsPage = lazy(() => import('./pages/NotificationsPage'));\nconst FollowingFeedPage = lazy(() => import('./pages/FollowingFeedPage'));\nconst CartPage = lazy(() => import('./pages/CartPage'));\nconst CartSuccessPage = lazy(() => import('./pages/CartSuccessPage'));\nconst PayoutSettingsPage = lazy(() => import('./pages/PayoutSettingsPage'));\n\n// Legal pages\nconst TermsOfServicePage = lazy(() => import('./pages/legal/TermsOfServicePage'));\nconst PrivacyPolicyPage = lazy(() => import('./pages/legal/PrivacyPolicyPage'));\nconst ContentPolicyPage = lazy(() => import('./pages/legal/ContentPolicyPage'));\nconst DMCAPolicyPage = lazy(() => import('./pages/legal/DMCAPolicyPage'));\nconst CreatorAgreementPage = lazy(() => import('./pages/legal/CreatorAgreementPage'));\n\n// Loading fallback component\nconst PageLoader = () => (\n  <div style={{\n    display: 'flex',\n    alignItems: 'center',\n    justifyContent: 'center',\n    minHeight: '200px',\n    color: 'var(--text-muted, #94a3b8)',\n  }}>\n    Loading...\n  </div>\n);\n\nfunction Header() {\n  const [isAuthed, setIsAuthed] = useState(false);\n  const [username, setUsername] = useState('');\n  const [avatarUrl, setAvatarUrl] = useState<string | null>(null);\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const navigate = useNavigate();\n  const location = useLocation();\n\n  const checkAuth = React.useCallback(() => {\n    fetch(`${API_URL}/api/auth/status/`, { credentials: 'include' })\n      .then(r=>r.json())\n      .then(d=> {\n        const authed = !!d?.authenticated;\n        setIsAuthed(authed);\n\n        // Store username and avatar if available\n        if (authed && d?.user?.username) {\n          setUsername(d.user.username);\n          setAvatarUrl(d.user.avatar_url || null);\n        } else {\n          setUsername('');\n          setAvatarUrl(null);\n        }\n\n        // Start/stop notification polling based on auth state\n        if (authed) {\n          if (!notificationService.isPolling()) {\n            notificationService.startPolling();\n          }\n        } else {\n          if (notificationService.isPolling()) {\n            notificationService.stopPolling();\n          }\n          notificationService.reset();\n        }\n      })\n      .catch(()=> {\n        setIsAuthed(false);\n        setUsername('');\n        setAvatarUrl(null);\n        notificationService.stopPolling();\n        notificationService.reset();\n      });\n  }, []);\n\n  useEffect(()=>{\n    checkAuth();\n    // Poll auth status every 10 seconds to catch changes\n    const interval = setInterval(checkAuth, 10000);\n    return () => {\n      clearInterval(interval);\n      // Clean up notification service on unmount\n      notificationService.stopPolling();\n    };\n  },[location.pathname, checkAuth]);\n\n  // Also refresh immediately when we land on home with potential fresh logout redirect\n  useEffect(()=>{\n    if (location.pathname === '/') {\n      checkAuth();\n    }\n  }, [location.pathname, checkAuth]);\n\n  const goLogin = () => { navigate('/auth'); };\n\n  const doLogout = async () => {\n    try {\n      const t = await fetch(`${API_URL}/api/auth/csrf/`, { credentials:'include' }).then(r=>r.json()).then(j=> j?.csrfToken || '');\n      await fetch(`${API_URL}/api/auth/logout/`, { method:'POST', credentials:'include', headers:{ 'X-CSRFToken': t, 'X-Requested-With': 'XMLHttpRequest' } });\n    } catch {}\n\n    // Stop notification polling and reset\n    notificationService.stopPolling();\n    notificationService.reset();\n\n    // Optimistically flip immediately\n    setIsAuthed(false);\n\n    // Navigate to home using React Router\n    navigate('/');\n\n    // Re-check server state after navigation\n    setTimeout(() => checkAuth(), 100);\n  };\n  return (\n    <nav className=\"rb-header\">\n      <div className=\"rb-header-left\">\n        <Link to=\"/\" className=\"rb-logo-link\">\n          <img src=\"/rb-logo.png\" alt=\"renaissBlock\" className=\"rb-logo-img\"/>\n        </Link>\n        <BetaBadge variant=\"header\" showTestMode={true} />\n      </div>\n      <div className=\"rb-header-center\">\n        <SearchAutocomplete />\n      </div>\n\n      {/* Mobile Menu Toggle */}\n      <button\n        className=\"rb-mobile-menu-toggle\"\n        onClick={() => setMobileMenuOpen(!mobileMenuOpen)}\n        aria-label=\"Toggle menu\"\n      >\n        {mobileMenuOpen ? <X size={24} /> : <Menu size={24} />}\n      </button>\n\n      {/* Navigation Links */}\n      <div className={`rb-header-right rb-nav ${mobileMenuOpen ? 'rb-nav-mobile-open' : ''}`}>\n        {isAuthed && (\n          <>\n            <CartIcon />\n            <NotificationBell />\n            <Link to=\"/collaborators\" className=\"rb-nav-link\" title=\"Find Collaborators\">\n              <Users size={20} />\n            </Link>\n            <Link to=\"/profile\" className=\"rb-nav-link rb-profile-link\" title=\"Profile\">\n              {avatarUrl ? (\n                <img\n                  src={avatarUrl}\n                  alt={username}\n                  style={{\n                    width: 28,\n                    height: 28,\n                    borderRadius: '50%',\n                    objectFit: 'cover',\n                    border: '2px solid var(--accent)',\n                  }}\n                />\n              ) : (\n                <User size={20} />\n              )}\n              <span>@{username || 'Profile'}</span>\n            </Link>\n            <button\n              onClick={doLogout}\n              className=\"rb-nav-link rb-logout-btn\"\n              title=\"Logout\"\n            >\n              <LogOut size={20} />\n              <span>Logout</span>\n            </button>\n          </>\n        )}\n        {!isAuthed && (\n          <button onClick={goLogin} className=\"rb-nav-link rb-signin-btn\">\n            <User size={20} />\n            <span>Sign in</span>\n          </button>\n        )}\n      </div>\n    </nav>\n  );\n}\n\nexport default function App() {\n  const location = useLocation();\n  const { isAuthenticated, loading } = useAuth();\n  const { isMobile } = useMobile();\n\n  // Legacy CreatorSidebar removed - functionality now in navbar and page tabs\n  const showCreatorSidebar = false;\n  // Only show Library sidebar when authenticated AND on home or search pages AND not mobile\n  const showLibrarySidebar = !isMobile && isAuthenticated && [/^\\/$/, /^\\/search/].some(r => r.test(location.pathname));\n  // Show mobile library on home page for authenticated mobile users\n  const showMobileLibrary = isMobile && isAuthenticated && location.pathname === '/';\n  const isReaderPage = /^\\/reader/.test(location.pathname);\n  // Hide footer on pages that have the sidebar (footer links are in sidebar instead)\n  const showFooter = !showLibrarySidebar;\n\n  // Public routes that don't require authentication\n  const publicRoutes = ['/auth', '/terms', '/wallet-info', '/beta', '/profile/', '/legal'];\n  const isPublicRoute = publicRoutes.some(route => location.pathname.startsWith(route));\n\n  // Show loading state while checking authentication\n  if (loading) {\n    return (\n      <div className=\"rb-app\" style={{\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        height: '100vh',\n        background: 'var(--bg)',\n        color: 'var(--text)'\n      }}>\n        <div style={{ textAlign: 'center' }}>\n          <div style={{ fontSize: '18px', marginBottom: '8px' }}>Loading...</div>\n        </div>\n      </div>\n    );\n  }\n\n  // Show beta landing page for unauthenticated users (except on public routes)\n  if (!isAuthenticated && !isPublicRoute) {\n    return (\n      <div className=\"rb-app\">\n        <BetaLanding />\n        <NotificationToastContainer />\n      </div>\n    );\n  }\n\n  // Special handling for explicit /beta route\n  const isBetaLanding = location.pathname === '/beta';\n  if (isBetaLanding) {\n    return (\n      <div className=\"rb-app\">\n        <BetaLanding />\n        <NotificationToastContainer />\n      </div>\n    );\n  }\n\n  // Reader page gets its own full-screen layout without app chrome\n  if (isReaderPage) {\n    return (\n      <div className=\"rb-app\">\n        <ErrorBoundary>\n          <Suspense fallback={<PageLoader />}>\n            <Routes>\n              <Route path=\"/reader/:contentId\" element={<ReaderPage />} />\n            </Routes>\n          </Suspense>\n        </ErrorBoundary>\n      </div>\n    );\n  }\n\n  return (\n    <CartProvider>\n    <div className=\"rb-app\">\n      <Header />\n      {showLibrarySidebar && <LibrarySidebar />}\n      <main\n        className=\"rb-main\"\n        style={{\n          display: 'grid',\n          gridTemplateColumns: showCreatorSidebar ? '240px 1fr' : '1fr',\n          gap: 16,\n          ...(showLibrarySidebar ? {\n            marginLeft: 320,\n            marginRight: 0,\n            width: 'calc(100% - 320px)',\n          } : {}),\n          transition: 'margin-left 0.3s ease, width 0.3s ease',\n        }}\n      >\n        {showCreatorSidebar && <CreatorSidebar />}\n        <div style={{ width: '100%', minWidth: 0 }}>\n          {/* Mobile Library - shown at top of home page for mobile users */}\n          {showMobileLibrary && <MobileLibrary />}\n          <ErrorBoundary>\n            <Suspense fallback={<PageLoader />}>\n              <Routes>\n                <Route path=\"/\" element={<HomePage />} />\n                <Route path=\"/beta\" element={<BetaLanding />} />\n                <Route path=\"/login\" element={<Navigate to=\"/auth\" replace />} />\n                <Route path=\"/signup\" element={<Navigate to=\"/auth\" replace />} />\n                <Route path=\"/search\" element={<SearchPage />} />\n                <Route path=\"/studio\" element={<StudioPage />} />\n                <Route path=\"/dashboard\" element={<DashboardPage />} />\n                <Route path=\"/profile\" element={<ProfilePage />} />\n                <Route path=\"/profile/:username\" element={<PublicProfilePage />} />\n                <Route path=\"/collaborators\" element={<CollaboratorsPage />} />\n                <Route path=\"/auth\" element={<AuthPage />} />\n                <Route path=\"/wallet-info\" element={<WalletInfoPage />} />\n                <Route path=\"/terms\" element={<TermsOfServicePage />} />\n                <Route path=\"/legal/terms\" element={<TermsOfServicePage />} />\n                <Route path=\"/legal/privacy\" element={<PrivacyPolicyPage />} />\n                <Route path=\"/legal/content-policy\" element={<ContentPolicyPage />} />\n                <Route path=\"/legal/dmca\" element={<DMCAPolicyPage />} />\n                <Route path=\"/legal/creator-agreement\" element={<CreatorAgreementPage />} />\n                <Route path=\"/content/:id\" element={<ContentDetail />} />\n                <Route path=\"/purchase/success\" element={<PurchaseSuccessPage />} />\n                <Route path=\"/cart\" element={<ProtectedRoute><CartPage /></ProtectedRoute>} />\n                <Route path=\"/cart/success\" element={<ProtectedRoute><CartSuccessPage /></ProtectedRoute>} />\n                <Route path=\"/collaborations\" element={<ProtectedRoute><CollaborationDashboard /></ProtectedRoute>} />\n                <Route path=\"/collaborations/:projectId\" element={<ProtectedRoute><CollaborativeProjectPage /></ProtectedRoute>} />\n                <Route path=\"/notifications\" element={<ProtectedRoute><NotificationsPage /></ProtectedRoute>} />\n                <Route path=\"/feed\" element={<ProtectedRoute><FollowingFeedPage /></ProtectedRoute>} />\n                <Route path=\"/payout-settings\" element={<ProtectedRoute><PayoutSettingsPage /></ProtectedRoute>} />\n              </Routes>\n            </Suspense>\n          </ErrorBoundary>\n        </div>\n      </main>\n      {showFooter && <Footer />}\n      <NotificationToastContainer />\n      <CookieBanner />\n      <TestModeBanner />\n      <BetaOnboarding />\n    </div>\n    </CartProvider>\n  );\n}\n","import './polyfills';\nimport React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport './index.css';\nimport App from './App';\nimport { BrowserRouter } from 'react-router-dom';\n\n// Polyfills for Node globals used by some dependencies in the browser\nimport { Buffer } from 'buffer';\nimport process from 'process';\nif (!(window as any).Buffer) (window as any).Buffer = Buffer;\nif (!(window as any).process) (window as any).process = process;\n\nconst root = ReactDOM.createRoot(\n  document.getElementById('root') as HTMLElement\n);\nroot.render(\n  <React.StrictMode>\n    <BrowserRouter>\n      <App />\n    </BrowserRouter>\n  </React.StrictMode>\n);\n"],"file":"assets/index-CNMBFQ8Q.js"}