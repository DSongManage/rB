import{j as e,C as t,S as a,W as i,O as n}from"./web3auth-BGmWjNJV.js";import{r,a as o,d as s,L as l}from"./router-CzH47hF_.js";import{u as c,A as d}from"./index-BCf7wtEB.js";import"./vendor-Cfs_Iq82.js";function u(){const[u,p]=r.useState(""),[h,g]=r.useState("register"),[y,f]=r.useState(""),[m,x]=r.useState(""),[b,v]=r.useState(""),[w,j]=r.useState(""),[S,k]=r.useState(""),[C,T]=r.useState("account"),[P,W]=r.useState("web3auth"),[R,A]=r.useState(""),[N,q]=r.useState("");o();const[z,I]=r.useState(null),{refreshAuth:X}=c(),[F]=s(),[D,O]=r.useState(""),[_,E]=r.useState(null),[$,B]=r.useState(""),[L,Y]=r.useState(!1),[J,H]=r.useState(!1),M=async()=>{try{const e=await fetch(`${d}/api/auth/csrf/`,{credentials:"include"}),t=await e.json(),a=(null==t?void 0:t.csrfToken)||"";return p(a),a}catch{return p(""),""}};r.useEffect(()=>{M()},[]),r.useEffect(()=>{const e=F.get("invite");e&&(O(e),g("register"),U(e))},[F]);const U=async e=>{if(e&&""!==e.trim()){Y(!0);try{const t=await fetch(`${d}/api/beta/validate/`,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({invite_code:e.trim().toUpperCase()})}),a=await t.json();a.valid?(E(!0),B(a.email||""),a.email&&!m&&x(a.email)):(E(!1),k(a.error||"Invalid invite code"))}catch(t){E(!1),k("Failed to validate invite code")}finally{Y(!1)}}else E(null)},K=async()=>{try{const e=await fetch(`${d}/api/auth/status/`,{credentials:"include"}),t=await e.json();if(null==t?void 0:t.authenticated)return!0;if((await fetch(`${d}/api/users/login/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,password:b})})).ok)return await M(),!0}catch(e){}return!1},G=e.jsxs("div",{className:"page",style:{maxWidth:480,margin:"40px auto"},children:[e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:16},children:[e.jsx("button",{className:"login"===h?"chip active":"chip",onClick:()=>g("login"),children:"Sign in"}),e.jsx("button",{className:"register"===h?"chip active":"chip",onClick:()=>g("register"),children:"Create account"})]}),"login"===h?e.jsx("div",{style:{display:"grid",gap:12},children:e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),k("");const t=await M();if(t)try{const e=await fetch(`${d}/api/users/login/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,password:b})}),a=await e.json();e.ok?(k("Login successful! Redirecting..."),setTimeout(()=>{window.location.href="/profile"},500)):k(a.error||"Invalid username or password")}catch(a){k("Network error. Please try again.")}else k("Failed to get CSRF token. Please refresh the page.")},style:{display:"grid",gap:12},children:[e.jsx("input",{value:y,onChange:e=>f(e.target.value),placeholder:"Username",required:!0}),e.jsx("input",{type:"password",value:b,onChange:e=>v(e.target.value),placeholder:"Password",required:!0}),e.jsx("button",{type:"submit",style:{marginTop:6},children:"Sign in"})]})}):e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),k(""),!D||""===D.trim())return void k("Beta invite code is required. Please request access from the beta page.");if(!_)return void k("Please provide a valid beta invite code.");const t=await M();if(t)if(b===w)if(!b||b.length<6)k("Password must be at least 6 characters");else if(J)try{const e=await fetch(`${d}/api/users/signup/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({username:y,email:m||$,invite_code:D.trim().toUpperCase(),password:b})}),a=await e.json();if(e.ok){await M();if(!(await K()))return k("Signed up successfully! Please sign in with your credentials."),void g("login");X(),"web3auth"===P?(k("Account created! Your Solana wallet is being set up automatically."),T("done")):"own"===P?T("wallet"):window.location.href="/"}else a.invite_code?k(Array.isArray(a.invite_code)?a.invite_code[0]:a.invite_code):a.email?k(Array.isArray(a.email)?a.email[0]:a.email):a.username?k(Array.isArray(a.username)?a.username[0]:a.username):a.error?k(a.error):k("Signup failed. Please check your information and try again.")}catch(a){k("Network error. Please try again.")}else k("Please accept the Terms of Service and Privacy Policy to create an account.");else k("Passwords do not match");else k("Failed to get CSRF token. Please refresh the page.")},style:{display:"grid",gap:12},children:[e.jsxs("div",{style:{display:"grid",gap:6},children:[e.jsx("input",{value:D,onChange:e=>{const t=e.target.value;O(t),t.trim().length>=8&&U(t)},placeholder:"Beta Invite Code (required)",required:!0,style:{border:!0===_?"1px solid #10b981":!1===_?"1px solid #ef4444":void 0}}),L&&e.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:"Validating invite code..."}),!0===_&&e.jsxs("div",{style:{fontSize:12,color:"#10b981"},children:["âœ“ Valid invite code for ",$]}),!1===_&&e.jsx("div",{style:{fontSize:12,color:"#ef4444"},children:"âœ— Invalid or expired invite code"})]}),e.jsx("input",{value:y,onChange:e=>f(e.target.value),placeholder:"Username",required:!0}),e.jsx("input",{type:"email",value:m,onChange:e=>x(e.target.value),placeholder:$?`Email (${$})`:"Email",required:!0}),e.jsx("input",{type:"password",value:b,onChange:e=>v(e.target.value),placeholder:"Password",required:!0}),e.jsx("input",{type:"password",value:w,onChange:e=>j(e.target.value),placeholder:"Confirm password",required:!0}),e.jsx("div",{style:{marginTop:12,padding:12,background:"rgba(255,255,255,0.03)",borderRadius:8,border:"1px solid #334155"},children:e.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,fontSize:13,color:"#cbd5e1",cursor:"pointer"},children:[e.jsx("input",{type:"checkbox",checked:J,onChange:e=>H(e.target.checked),required:!0,style:{marginTop:3}}),e.jsxs("span",{children:["I agree to the"," ",e.jsx("a",{href:"/legal/terms",target:"_blank",rel:"noopener noreferrer",style:{color:"#f59e0b",textDecoration:"none"},children:"Terms of Service"})," ","and"," ",e.jsx("a",{href:"/legal/privacy",target:"_blank",rel:"noopener noreferrer",style:{color:"#f59e0b",textDecoration:"none"},children:"Privacy Policy"})]})]})}),e.jsxs("div",{style:{display:"grid",gap:8,marginTop:8},children:[e.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:13,color:"#cbd5e1"},children:[e.jsx("input",{type:"checkbox",checked:"web3auth"===P,onChange:e=>W(e.target.checked?"web3auth":"later")}),"Set up a free Solana wallet for me (automatically created)",e.jsx(l,{to:"/wallet-info",style:{marginLeft:6,color:"#60a5fa"},children:"Learn more"})]}),e.jsxs("div",{style:{display:"flex",gap:12,fontSize:13},children:[e.jsx("button",{type:"button",onClick:()=>W("own"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"I'll use my own wallet"}),e.jsx("button",{type:"button",onClick:()=>W("later"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"I'll set up a wallet later"})]}),"own"===P&&e.jsx("input",{value:R,onChange:e=>A(e.target.value),placeholder:"Your Solana wallet address"})]}),e.jsx("button",{type:"submit",style:{marginTop:6},children:"Create account"})]}),e.jsx("div",{style:{marginTop:10,fontSize:12,color:"#94a3b8"},children:S||"Your session is secured with CSRF & cookies."})]}),V=e.jsxs("div",{className:"page",style:{maxWidth:480,margin:"40px auto"},children:[e.jsx("div",{style:{fontWeight:700,color:"#e5e7eb",marginBottom:8},children:"Create your wallet"}),"web3auth"===P&&e.jsxs("div",{style:{display:"grid",gap:10},children:[e.jsx("div",{style:{fontSize:13,color:"#94a3b8"},children:"We'll automatically create a Solana wallet for you. No seed phrases needed!"}),e.jsx("button",{onClick:async()=>{q("Initializing Web3Auth...");try{u||await M();if(!(await K()))return void q("Error: Please sign in again, then retry.");const s="BKECVnfm_tGc5XfDSuwBycgrP0N1sPen30bFwzRxdZFvXSDYzSzJ7tCdYYS3xJ0t_6xU-Qy8Slcr5oBCtK3kNKs",l={chainNamespace:t.SOLANA,chainId:"0x3",rpcTarget:"https://api.devnet.solana.com"},c=new a({config:{chainConfig:l}});q("Connecting to Web3Auth...");const p=new i({clientId:s,web3AuthNetwork:"sapphire_devnet",chainConfig:l,privateKeyProvider:c,uiConfig:{appName:"renaissBlock",mode:"dark",theme:{primary:"#f59e0b"}}}),h=new n({privateKeyProvider:c,adapterSettings:{network:"sapphire_devnet",clientId:s}});p.configureAdapter(h),q("Initializing Web3Auth modal...");try{await p.initModal()}catch(e){return void q(`Error during init: ${e instanceof Error?e.message:String(e)}`)}if(p.connected)try{await p.logout()}catch(r){}q("Opening Web3Auth modal...");try{await p.connect()}catch(o){return void q(`Error: ${o instanceof Error?o.message:String(o)}`)}const g=await p.getUserInfo(),y=(null==g?void 0:g.idToken)||(null==g?void 0:g.id_token);if(!y)return void q("Error: Could not obtain Web3Auth token");q("Linking wallet to your account...");const f=await fetch(`${d}/api/wallet/link/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({web3auth_token:y})});if(f.ok)q("âœ… Wallet created and linked successfully!"),setTimeout(()=>window.location.href="/profile",1500);else{const e=await f.text();q(`Error linking wallet: ${e}`)}}catch(s){q(`Error: ${s instanceof Error?s.message:String(s)}`)}},children:"Continue"}),e.jsxs("div",{style:{display:"flex",gap:12},children:[e.jsx("button",{onClick:()=>T("account"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Back to account"}),e.jsx("button",{onClick:()=>T("done"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Skip for now"})]}),e.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:N})]}),"own"===P&&e.jsxs("form",{onSubmit:async e=>{e.preventDefault(),q(""),u||await M();if(!(await K()))return void q("Please sign in again, then retry.");const t=await fetch(`${d}/api/wallet/link/`,{method:"POST",credentials:"include",headers:{"Content-Type":"application/json","X-CSRFToken":u,"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({wallet_address:R})});if(t.ok)q("Wallet linked"),setTimeout(()=>window.location.href="/profile",500);else{const e=await t.text();q(`Failed: ${e}`)}},style:{display:"grid",gap:10},children:[e.jsx("input",{value:R,onChange:e=>A(e.target.value),placeholder:"Your Solana wallet address"}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsx("button",{type:"submit",children:"Link wallet"}),e.jsx("button",{type:"button",onClick:()=>T("account"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Back"}),e.jsx("button",{type:"button",onClick:()=>T("done"),style:{background:"transparent",border:"none",color:"#94a3b8",textDecoration:"underline",cursor:"pointer"},children:"Skip"})]}),e.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:N})]})]}),Q=e.jsx("div",{className:"page",style:{maxWidth:480,margin:"40px auto",textAlign:"center"},children:e.jsxs("div",{children:[e.jsx("div",{style:{fontSize:18,fontWeight:700,color:"#e5e7eb",marginBottom:8},children:"Welcome to renaissBlock! ðŸŽ‰"}),e.jsx("div",{style:{fontSize:13,color:"#94a3b8",marginBottom:16},children:"web3auth"===P?"Your Web3Auth wallet has been created automatically. You can now receive NFTs and payments!":"You can link a wallet anytime from your profile to receive NFTs and payments."}),e.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"center"},children:[e.jsx("button",{onClick:()=>window.location.href="/",children:"Go to Home"}),e.jsx("button",{onClick:()=>window.location.href="/profile",children:"Go to Profile"})]})]})}),Z="account"===C?0:"wallet"===C?1:2,ee=e.jsx("div",{style:{display:"flex",justifyContent:"center",gap:16,alignItems:"center",maxWidth:800,margin:"24px auto",padding:"0 20px"},children:["Account","Wallet","Done"].map((t,a)=>{const i=a===Z,n=a<Z;return e.jsxs("div",{style:{flex:1,maxWidth:200},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[e.jsx("div",{style:{width:32,height:32,borderRadius:999,border:"2px solid "+(i||n?"#f59e0b":"#334155"),background:i||n?"#f59e0b":"transparent",color:i||n?"#111":"#94a3b8",display:"grid",placeItems:"center",fontSize:14,fontWeight:700,transition:"all 0.3s"},children:a+1}),e.jsx("div",{style:{fontSize:13,color:i?"#f59e0b":n?"#cbd5e1":"#64748b",fontWeight:i?700:500,textAlign:"center"},children:t})]}),e.jsx("div",{style:{height:2,marginTop:8,borderRadius:999,background:i?"linear-gradient(90deg, #f59e0b 0%, rgba(245,158,11,0.3) 100%)":n?"#f59e0b":"#334155",transition:"all 0.3s"}})]},t)})});return e.jsxs("div",{children:["register"===h&&ee,"account"===C&&G,"wallet"===C&&V,"done"===C&&Q]})}export{u as default};
//# sourceMappingURL=AuthPage-DTbWXhxD.js.map
