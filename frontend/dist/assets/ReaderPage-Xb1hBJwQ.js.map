{"version":3,"file":"ReaderPage-Xb1hBJwQ.js","sources":["../../node_modules/lucide-react/dist/esm/icons/download.js","../../node_modules/lucide-react/dist/esm/icons/list.js","../../node_modules/lucide-react/dist/esm/icons/maximize-2.js","../../node_modules/lucide-react/dist/esm/icons/minimize-2.js","../../node_modules/lucide-react/dist/esm/icons/minus.js","../../node_modules/lucide-react/dist/esm/icons/moon.js","../../node_modules/lucide-react/dist/esm/icons/sun.js","../../node_modules/lucide-react/dist/esm/icons/text-align-justify.js","../../node_modules/lucide-react/dist/esm/icons/text-align-start.js","../../node_modules/lucide-react/dist/esm/icons/zoom-in.js","../../node_modules/lucide-react/dist/esm/icons/zoom-out.js","../../src/types/reader.ts","../../src/hooks/useReaderSettings.ts","../../src/components/reader/ReaderHeader.tsx","../../src/components/reader/ReaderFooter.tsx","../../src/components/reader/ReaderNavigation.tsx","../../src/components/reader/ReaderSettings.tsx","../../src/components/reader/MobileReaderSettings.tsx","../../src/components/reader/TableOfContents.tsx","../../src/components/reader/KindleReader.tsx","../../src/hooks/useFullscreen.ts","../../src/utils/chapterDetection.ts","../../src/hooks/useSwipeGesture.ts","../../src/hooks/useKeyboardNavigation.ts","../../src/hooks/useEdgeGesture.ts","../../src/components/reader/ComicThumbnailSidebar.tsx","../../src/components/reader/ComicReader.tsx","../../src/pages/ReaderPage.tsx","../../src/components/reader/ReaderContent.tsx"],"sourcesContent":["/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M12 15V3\", key: \"m9g1x1\" }],\n  [\"path\", { d: \"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4\", key: \"ih7n3h\" }],\n  [\"path\", { d: \"m7 10 5 5 5-5\", key: \"brsn70\" }]\n];\nconst Download = createLucideIcon(\"download\", __iconNode);\n\nexport { __iconNode, Download as default };\n//# sourceMappingURL=download.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 5h.01\", key: \"18ugdj\" }],\n  [\"path\", { d: \"M3 12h.01\", key: \"nlz23k\" }],\n  [\"path\", { d: \"M3 19h.01\", key: \"noohij\" }],\n  [\"path\", { d: \"M8 5h13\", key: \"1pao27\" }],\n  [\"path\", { d: \"M8 12h13\", key: \"1za7za\" }],\n  [\"path\", { d: \"M8 19h13\", key: \"m83p4d\" }]\n];\nconst List = createLucideIcon(\"list\", __iconNode);\n\nexport { __iconNode, List as default };\n//# sourceMappingURL=list.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M15 3h6v6\", key: \"1q9fwt\" }],\n  [\"path\", { d: \"m21 3-7 7\", key: \"1l2asr\" }],\n  [\"path\", { d: \"m3 21 7-7\", key: \"tjx5ai\" }],\n  [\"path\", { d: \"M9 21H3v-6\", key: \"wtvkvv\" }]\n];\nconst Maximize2 = createLucideIcon(\"maximize-2\", __iconNode);\n\nexport { __iconNode, Maximize2 as default };\n//# sourceMappingURL=maximize-2.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"m14 10 7-7\", key: \"oa77jy\" }],\n  [\"path\", { d: \"M20 10h-6V4\", key: \"mjg0md\" }],\n  [\"path\", { d: \"m3 21 7-7\", key: \"tjx5ai\" }],\n  [\"path\", { d: \"M4 14h6v6\", key: \"rmj7iw\" }]\n];\nconst Minimize2 = createLucideIcon(\"minimize-2\", __iconNode);\n\nexport { __iconNode, Minimize2 as default };\n//# sourceMappingURL=minimize-2.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [[\"path\", { d: \"M5 12h14\", key: \"1ays0h\" }]];\nconst Minus = createLucideIcon(\"minus\", __iconNode);\n\nexport { __iconNode, Minus as default };\n//# sourceMappingURL=minus.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\n    \"path\",\n    {\n      d: \"M20.985 12.486a9 9 0 1 1-9.473-9.472c.405-.022.617.46.402.803a6 6 0 0 0 8.268 8.268c.344-.215.825-.004.803.401\",\n      key: \"kfwtm\"\n    }\n  ]\n];\nconst Moon = createLucideIcon(\"moon\", __iconNode);\n\nexport { __iconNode, Moon as default };\n//# sourceMappingURL=moon.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"12\", cy: \"12\", r: \"4\", key: \"4exip2\" }],\n  [\"path\", { d: \"M12 2v2\", key: \"tus03m\" }],\n  [\"path\", { d: \"M12 20v2\", key: \"1lh1kg\" }],\n  [\"path\", { d: \"m4.93 4.93 1.41 1.41\", key: \"149t6j\" }],\n  [\"path\", { d: \"m17.66 17.66 1.41 1.41\", key: \"ptbguv\" }],\n  [\"path\", { d: \"M2 12h2\", key: \"1t8f8n\" }],\n  [\"path\", { d: \"M20 12h2\", key: \"1q8mjw\" }],\n  [\"path\", { d: \"m6.34 17.66-1.41 1.41\", key: \"1m8zz5\" }],\n  [\"path\", { d: \"m19.07 4.93-1.41 1.41\", key: \"1shlcs\" }]\n];\nconst Sun = createLucideIcon(\"sun\", __iconNode);\n\nexport { __iconNode, Sun as default };\n//# sourceMappingURL=sun.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M3 5h18\", key: \"1u36vt\" }],\n  [\"path\", { d: \"M3 12h18\", key: \"1i2n21\" }],\n  [\"path\", { d: \"M3 19h18\", key: \"awlh7x\" }]\n];\nconst TextAlignJustify = createLucideIcon(\"text-align-justify\", __iconNode);\n\nexport { __iconNode, TextAlignJustify as default };\n//# sourceMappingURL=text-align-justify.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"path\", { d: \"M21 5H3\", key: \"1fi0y6\" }],\n  [\"path\", { d: \"M15 12H3\", key: \"6jk70r\" }],\n  [\"path\", { d: \"M17 19H3\", key: \"z6ezky\" }]\n];\nconst TextAlignStart = createLucideIcon(\"text-align-start\", __iconNode);\n\nexport { __iconNode, TextAlignStart as default };\n//# sourceMappingURL=text-align-start.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"11\", x2: \"11\", y1: \"8\", y2: \"14\", key: \"1vmskp\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomIn = createLucideIcon(\"zoom-in\", __iconNode);\n\nexport { __iconNode, ZoomIn as default };\n//# sourceMappingURL=zoom-in.js.map\n","/**\n * @license lucide-react v0.553.0 - ISC\n *\n * This source code is licensed under the ISC license.\n * See the LICENSE file in the root directory of this source tree.\n */\n\nimport createLucideIcon from '../createLucideIcon.js';\n\nconst __iconNode = [\n  [\"circle\", { cx: \"11\", cy: \"11\", r: \"8\", key: \"4ej97u\" }],\n  [\"line\", { x1: \"21\", x2: \"16.65\", y1: \"21\", y2: \"16.65\", key: \"13gj7c\" }],\n  [\"line\", { x1: \"8\", x2: \"14\", y1: \"11\", y2: \"11\", key: \"durymu\" }]\n];\nconst ZoomOut = createLucideIcon(\"zoom-out\", __iconNode);\n\nexport { __iconNode, ZoomOut as default };\n//# sourceMappingURL=zoom-out.js.map\n","/**\n * Kindle-style Reader Type Definitions\n */\n\n// Reader settings that persist to localStorage\nexport interface ReaderSettings {\n  fontSize: 'xsmall' | 'small' | 'medium' | 'large' | 'xlarge';\n  lineHeight: 'compact' | 'normal' | 'relaxed';\n  theme: 'light' | 'sepia' | 'green' | 'dark';\n  fontFamily: 'amazon-ember' | 'baskerville' | 'bookerly' | 'georgia' | 'palatino';\n  margins: 'narrow' | 'medium' | 'wide';\n  textAlign: 'left' | 'justify';\n  columns: 'single' | 'two';\n  continuousScroll: boolean;\n}\n\nexport const DEFAULT_READER_SETTINGS: ReaderSettings = {\n  fontSize: 'medium',\n  lineHeight: 'normal',\n  theme: 'dark',\n  fontFamily: 'bookerly',\n  margins: 'medium',\n  textAlign: 'justify',\n  columns: 'two',\n  continuousScroll: false,\n};\n\n// Font size mappings in pixels (more granular like Kindle)\nexport const FONT_SIZE_MAP: Record<ReaderSettings['fontSize'], string> = {\n  xsmall: '14px',\n  small: '16px',\n  medium: '18px',\n  large: '22px',\n  xlarge: '26px',\n};\n\n// Line height mappings\nexport const LINE_HEIGHT_MAP: Record<ReaderSettings['lineHeight'], string> = {\n  compact: '1.4',\n  normal: '1.7',\n  relaxed: '2.0',\n};\n\n// Theme color mappings (matching Kindle's 4 page colors)\nexport const THEME_COLORS: Record<ReaderSettings['theme'], {\n  background: string;\n  text: string;\n  secondary: string;\n  border: string;\n  accent: string;\n}> = {\n  light: {\n    background: '#ffffff',\n    text: '#1a1a1a',\n    secondary: '#6b7280',\n    border: '#e5e7eb',\n    accent: '#0066cc',\n  },\n  sepia: {\n    background: '#f5e6c8',\n    text: '#5b4636',\n    secondary: '#8b7355',\n    border: '#d4c4a8',\n    accent: '#8b5a2b',\n  },\n  green: {\n    background: '#d4e8d4',\n    text: '#2d4a2d',\n    secondary: '#4a6b4a',\n    border: '#a8c8a8',\n    accent: '#2d6b2d',\n  },\n  dark: {\n    background: '#0a1628',\n    text: '#c9d1d9',\n    secondary: '#8b949e',\n    border: '#21262d',\n    accent: '#58a6ff',\n  },\n};\n\n// Font family mappings (Kindle-style fonts)\nexport const FONT_FAMILY_MAP: Record<ReaderSettings['fontFamily'], { name: string; css: string }> = {\n  'amazon-ember': {\n    name: 'Amazon Ember',\n    css: \"'Amazon Ember', 'Helvetica Neue', Helvetica, Arial, sans-serif\",\n  },\n  'baskerville': {\n    name: 'Baskerville',\n    css: \"Baskerville, 'Baskerville Old Face', 'Times New Roman', serif\",\n  },\n  'bookerly': {\n    name: 'Bookerly',\n    css: \"Bookerly, Georgia, 'Times New Roman', serif\",\n  },\n  'georgia': {\n    name: 'Georgia',\n    css: \"Georgia, 'Times New Roman', serif\",\n  },\n  'palatino': {\n    name: 'Palatino',\n    css: \"'Palatino Linotype', 'Book Antiqua', Palatino, serif\",\n  },\n};\n\n// Margin mappings\nexport const MARGIN_MAP: Record<ReaderSettings['margins'], string> = {\n  narrow: '20px',\n  medium: '48px',\n  wide: '80px',\n};\n\n// Chapter detected from HTML headings\nexport interface Chapter {\n  id: string;\n  title: string;\n  level: number; // 1, 2, or 3 (h1, h2, h3)\n  pageIndex: number; // Which page this chapter starts on\n  elementId?: string; // ID attribute if present in HTML\n}\n\n// Position saved for progress tracking\nexport interface PagePosition {\n  page: number;\n  totalPages: number;\n  chapterId?: string;\n  fontSize: ReaderSettings['fontSize'];\n  lineHeight: ReaderSettings['lineHeight'];\n  margins?: ReaderSettings['margins'];\n  columns?: ReaderSettings['columns'];\n}\n\n// Legacy position format (for backward compatibility)\nexport interface ScrollPosition {\n  scroll: number;\n}\n\n// Combined position type\nexport type SavedPosition = PagePosition | ScrollPosition;\n\n// Check if position is page-based\nexport function isPagePosition(pos: SavedPosition): pos is PagePosition {\n  return 'page' in pos && 'totalPages' in pos;\n}\n","import { useState, useEffect, useCallback, useMemo } from 'react';\nimport {\n  ReaderSettings,\n  DEFAULT_READER_SETTINGS,\n  FONT_SIZE_MAP,\n  LINE_HEIGHT_MAP,\n  THEME_COLORS,\n  FONT_FAMILY_MAP,\n  MARGIN_MAP,\n} from '../types/reader';\n\nconst STORAGE_KEY = 'rb_reader_settings';\n\nexport function useReaderSettings() {\n  const [settings, setSettings] = useState<ReaderSettings>(() => {\n    // Load from localStorage on init\n    try {\n      const stored = localStorage.getItem(STORAGE_KEY);\n      if (stored) {\n        const parsed = JSON.parse(stored);\n        // Migrate old settings format\n        const migrated = migrateSettings(parsed);\n        return { ...DEFAULT_READER_SETTINGS, ...migrated };\n      }\n    } catch (e) {\n      console.error('Failed to load reader settings:', e);\n    }\n    return DEFAULT_READER_SETTINGS;\n  });\n\n  // Persist to localStorage on change\n  useEffect(() => {\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));\n    } catch (e) {\n      console.error('Failed to save reader settings:', e);\n    }\n  }, [settings]);\n\n  const updateSetting = useCallback(\n    <K extends keyof ReaderSettings>(key: K, value: ReaderSettings[K]) => {\n      setSettings((prev) => ({ ...prev, [key]: value }));\n    },\n    []\n  );\n\n  const resetSettings = useCallback(() => {\n    setSettings(DEFAULT_READER_SETTINGS);\n  }, []);\n\n  // Computed CSS variables for easy application\n  const cssVars = useMemo(\n    () => ({\n      '--reader-font-size': FONT_SIZE_MAP[settings.fontSize],\n      '--reader-line-height': LINE_HEIGHT_MAP[settings.lineHeight],\n      '--reader-bg': THEME_COLORS[settings.theme].background,\n      '--reader-text': THEME_COLORS[settings.theme].text,\n      '--reader-secondary': THEME_COLORS[settings.theme].secondary,\n      '--reader-border': THEME_COLORS[settings.theme].border,\n      '--reader-accent': THEME_COLORS[settings.theme].accent,\n      '--reader-font-family': FONT_FAMILY_MAP[settings.fontFamily].css,\n      '--reader-margin': MARGIN_MAP[settings.margins],\n      '--reader-text-align': settings.textAlign,\n    }),\n    [settings]\n  );\n\n  // Theme class name for CSS\n  const themeClass = `reader-theme-${settings.theme}`;\n\n  return {\n    settings,\n    updateSetting,\n    resetSettings,\n    cssVars,\n    themeClass,\n  };\n}\n\n// Migrate old settings format to new format\nfunction migrateSettings(oldSettings: Record<string, unknown>): Partial<ReaderSettings> {\n  const migrated: Partial<ReaderSettings> = { ...oldSettings } as Partial<ReaderSettings>;\n\n  // Migrate old fontFamily values\n  if (oldSettings.fontFamily === 'serif') {\n    migrated.fontFamily = 'georgia';\n  } else if (oldSettings.fontFamily === 'sans-serif') {\n    migrated.fontFamily = 'amazon-ember';\n  }\n\n  // Ensure new fields have defaults if missing\n  if (!migrated.margins) migrated.margins = DEFAULT_READER_SETTINGS.margins;\n  if (!migrated.textAlign) migrated.textAlign = DEFAULT_READER_SETTINGS.textAlign;\n  if (!migrated.columns) migrated.columns = DEFAULT_READER_SETTINGS.columns;\n  if (migrated.continuousScroll === undefined) migrated.continuousScroll = DEFAULT_READER_SETTINGS.continuousScroll;\n\n  return migrated;\n}\n\nexport default useReaderSettings;\n","import React from 'react';\nimport { ArrowLeft, Settings, List } from 'lucide-react';\n\ninterface ReaderHeaderProps {\n  title: string;\n  chapterTitle?: string;\n  onBack: () => void;\n  onToggleSettings: () => void;\n  onToggleTOC: () => void;\n  visible: boolean;\n}\n\nexport function ReaderHeader({\n  title,\n  chapterTitle,\n  onBack,\n  onToggleSettings,\n  onToggleTOC,\n  visible,\n}: ReaderHeaderProps) {\n  return (\n    <header\n      className={`reader-header ${visible ? 'visible' : 'hidden'}`}\n      style={{\n        position: 'fixed',\n        top: 0,\n        left: 0,\n        right: 0,\n        height: '60px',\n        background: 'var(--reader-bg)',\n        borderBottom: '1px solid var(--reader-border)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'space-between',\n        padding: '0 16px',\n        zIndex: 100,\n        transition: 'transform 0.3s ease, opacity 0.3s ease',\n        transform: visible ? 'translateY(0)' : 'translateY(-100%)',\n        opacity: visible ? 1 : 0,\n      }}\n    >\n      <div style={{ display: 'flex', alignItems: 'center', gap: '16px' }}>\n        <button\n          onClick={onBack}\n          className=\"reader-icon-button\"\n          aria-label=\"Go back\"\n          style={{\n            background: 'none',\n            border: 'none',\n            color: 'var(--reader-text)',\n            cursor: 'pointer',\n            padding: '8px',\n            borderRadius: '8px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <ArrowLeft size={24} />\n        </button>\n\n        <div style={{ overflow: 'hidden' }}>\n          <h1\n            style={{\n              fontSize: '16px',\n              fontWeight: 600,\n              color: 'var(--reader-text)',\n              margin: 0,\n              whiteSpace: 'nowrap',\n              textOverflow: 'ellipsis',\n              overflow: 'hidden',\n              maxWidth: '200px',\n            }}\n          >\n            {title}\n          </h1>\n          {chapterTitle && (\n            <p\n              style={{\n                fontSize: '12px',\n                color: 'var(--reader-secondary)',\n                margin: 0,\n                whiteSpace: 'nowrap',\n                textOverflow: 'ellipsis',\n                overflow: 'hidden',\n                maxWidth: '200px',\n              }}\n            >\n              {chapterTitle}\n            </p>\n          )}\n        </div>\n      </div>\n\n      <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n        <button\n          onClick={onToggleTOC}\n          className=\"reader-icon-button\"\n          aria-label=\"Table of Contents\"\n          style={{\n            background: 'none',\n            border: 'none',\n            color: 'var(--reader-text)',\n            cursor: 'pointer',\n            padding: '8px',\n            borderRadius: '8px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <List size={24} />\n        </button>\n\n        <button\n          onClick={onToggleSettings}\n          className=\"reader-icon-button\"\n          aria-label=\"Settings\"\n          style={{\n            background: 'none',\n            border: 'none',\n            color: 'var(--reader-text)',\n            cursor: 'pointer',\n            padding: '8px',\n            borderRadius: '8px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n          }}\n        >\n          <Settings size={24} />\n        </button>\n      </div>\n    </header>\n  );\n}\n\nexport default ReaderHeader;\n","import React from 'react';\n\ninterface ReaderFooterProps {\n  currentPage: number;\n  totalPages: number;\n  percentComplete: number;\n  visible: boolean;\n  continuousScroll?: boolean;\n}\n\nexport function ReaderFooter({\n  currentPage,\n  totalPages,\n  percentComplete,\n  visible,\n  continuousScroll = false,\n}: ReaderFooterProps) {\n  return (\n    <footer\n      className={`reader-footer ${visible ? 'visible' : 'hidden'}`}\n      style={{\n        position: 'fixed',\n        bottom: 0,\n        left: 0,\n        right: 0,\n        height: '50px',\n        background: 'var(--reader-bg)',\n        borderTop: '1px solid var(--reader-border)',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        padding: '0 16px',\n        zIndex: 100,\n        transition: 'transform 0.3s ease, opacity 0.3s ease',\n        transform: visible ? 'translateY(0)' : 'translateY(100%)',\n        opacity: visible ? 1 : 0,\n      }}\n    >\n      {/* Progress bar */}\n      <div\n        style={{\n          width: '100%',\n          maxWidth: '400px',\n          height: '3px',\n          background: 'var(--reader-border)',\n          borderRadius: '2px',\n          marginBottom: '8px',\n          overflow: 'hidden',\n        }}\n      >\n        <div\n          style={{\n            width: `${percentComplete}%`,\n            height: '100%',\n            background: 'var(--reader-accent, var(--reader-secondary))',\n            borderRadius: '2px',\n            transition: 'width 0.3s ease',\n          }}\n        />\n      </div>\n\n      {/* Page indicator */}\n      <p\n        style={{\n          fontSize: '12px',\n          color: 'var(--reader-secondary)',\n          margin: 0,\n        }}\n      >\n        {continuousScroll\n          ? `${percentComplete}% complete`\n          : `Page ${currentPage + 1} of ${totalPages} (${percentComplete}%)`\n        }\n      </p>\n    </footer>\n  );\n}\n\nexport default ReaderFooter;\n","import React from 'react';\nimport { ChevronLeft, ChevronRight } from 'lucide-react';\n\ninterface ReaderNavigationProps {\n  onPrevious: () => void;\n  onNext: () => void;\n  onCenter: () => void;\n  isFirstPage: boolean;\n  isLastPage: boolean;\n  showArrows: boolean;\n  isMobile?: boolean;\n  headerHeight?: number;\n  footerHeight?: number;\n}\n\nexport function ReaderNavigation({\n  onPrevious,\n  onNext,\n  onCenter,\n  isFirstPage,\n  isLastPage,\n  showArrows,\n  isMobile = false,\n  headerHeight = 60,\n  footerHeight = 50,\n}: ReaderNavigationProps) {\n  // Mobile: 33%/34%/33% zones (larger tap areas)\n  // Desktop: 25%/50%/25% zones\n  const sideWidth = isMobile ? '33%' : '25%';\n  const centerLeft = isMobile ? '33%' : '25%';\n  const centerRight = isMobile ? '33%' : '25%';\n\n  return (\n    <>\n      {/* Left click zone (previous page) */}\n      <div\n        className=\"reader-nav-zone reader-nav-left\"\n        onClick={(e) => {\n          e.stopPropagation();\n          if (!isFirstPage) onPrevious();\n        }}\n        style={{\n          position: 'fixed',\n          left: 0,\n          top: isMobile ? 0 : `${headerHeight}px`,\n          bottom: isMobile ? 0 : `${footerHeight}px`,\n          width: sideWidth,\n          cursor: isFirstPage ? 'default' : 'pointer',\n          zIndex: 50,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'flex-start',\n          paddingLeft: isMobile ? '8px' : '12px',\n        }}\n        role=\"button\"\n        aria-label=\"Previous page\"\n      >\n        {/* Hide arrows on mobile - just use tap zones */}\n        {!isMobile && showArrows && !isFirstPage && (\n          <div\n            className=\"reader-nav-arrow\"\n            style={{\n              opacity: 0.3,\n              transition: 'opacity 0.2s ease',\n              color: 'var(--reader-secondary)',\n            }}\n          >\n            <ChevronLeft size={32} />\n          </div>\n        )}\n      </div>\n\n      {/* Center click zone (toggle UI) */}\n      <div\n        className=\"reader-nav-zone reader-nav-center\"\n        onClick={(e) => {\n          e.stopPropagation();\n          onCenter();\n        }}\n        style={{\n          position: 'fixed',\n          left: centerLeft,\n          right: centerRight,\n          top: isMobile ? 0 : `${headerHeight}px`,\n          bottom: isMobile ? 0 : `${footerHeight}px`,\n          cursor: 'pointer',\n          zIndex: 50,\n        }}\n        role=\"button\"\n        aria-label=\"Toggle controls\"\n      />\n\n      {/* Right click zone (next page) */}\n      <div\n        className=\"reader-nav-zone reader-nav-right\"\n        onClick={(e) => {\n          e.stopPropagation();\n          if (!isLastPage) onNext();\n        }}\n        style={{\n          position: 'fixed',\n          right: 0,\n          top: isMobile ? 0 : `${headerHeight}px`,\n          bottom: isMobile ? 0 : `${footerHeight}px`,\n          width: sideWidth,\n          cursor: isLastPage ? 'default' : 'pointer',\n          zIndex: 50,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'flex-end',\n          paddingRight: isMobile ? '8px' : '12px',\n        }}\n        role=\"button\"\n        aria-label=\"Next page\"\n      >\n        {/* Hide arrows on mobile - just use tap zones */}\n        {!isMobile && showArrows && !isLastPage && (\n          <div\n            className=\"reader-nav-arrow\"\n            style={{\n              opacity: 0.3,\n              transition: 'opacity 0.2s ease',\n              color: 'var(--reader-secondary)',\n            }}\n          >\n            <ChevronRight size={32} />\n          </div>\n        )}\n      </div>\n    </>\n  );\n}\n\nexport default ReaderNavigation;\n","import React, { useState } from 'react';\nimport { X, AlignLeft, AlignJustify } from 'lucide-react';\nimport { ReaderSettings as ReaderSettingsType, FONT_FAMILY_MAP, THEME_COLORS } from '../../types/reader';\n\ntype SettingsTab = 'font' | 'layout' | 'themes' | 'more';\n\ninterface ReaderSettingsPanelProps {\n  settings: ReaderSettingsType;\n  updateSetting: <K extends keyof ReaderSettingsType>(\n    key: K,\n    value: ReaderSettingsType[K]\n  ) => void;\n  resetSettings: () => void;\n  onClose: () => void;\n  visible: boolean;\n}\n\nexport function ReaderSettingsPanel({\n  settings,\n  updateSetting,\n  resetSettings,\n  onClose,\n  visible,\n}: ReaderSettingsPanelProps) {\n  const [activeTab, setActiveTab] = useState<SettingsTab>('font');\n\n  if (!visible) return null;\n\n  const tabs: { id: SettingsTab; label: string }[] = [\n    { id: 'font', label: 'Font' },\n    { id: 'layout', label: 'Layout' },\n    { id: 'themes', label: 'Themes' },\n    { id: 'more', label: 'More' },\n  ];\n\n  const fontSizes: ReaderSettingsType['fontSize'][] = ['xsmall', 'small', 'medium', 'large', 'xlarge'];\n  const currentSizeIndex = fontSizes.indexOf(settings.fontSize);\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        className=\"reader-settings-backdrop\"\n        onClick={onClose}\n        style={{\n          position: 'fixed',\n          inset: 0,\n          background: 'rgba(0, 0, 0, 0.5)',\n          zIndex: 200,\n          animation: 'fadeIn 0.2s ease',\n        }}\n      />\n\n      {/* Settings Panel - Slides from right like Kindle */}\n      <div\n        className=\"reader-settings-panel\"\n        style={{\n          position: 'fixed',\n          top: 0,\n          right: 0,\n          bottom: 0,\n          width: '320px',\n          maxWidth: '90vw',\n          background: 'var(--reader-bg)',\n          borderLeft: '1px solid var(--reader-border)',\n          zIndex: 201,\n          display: 'flex',\n          flexDirection: 'column',\n          animation: 'slideFromRight 0.3s ease',\n        }}\n      >\n        {/* Tab Navigation */}\n        <div\n          style={{\n            display: 'flex',\n            borderBottom: '1px solid var(--reader-border)',\n            padding: '0 8px',\n          }}\n        >\n          {tabs.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => setActiveTab(tab.id)}\n              style={{\n                flex: 1,\n                padding: '16px 8px',\n                background: 'none',\n                border: 'none',\n                borderBottom: activeTab === tab.id ? '2px solid var(--reader-accent, #58a6ff)' : '2px solid transparent',\n                color: activeTab === tab.id ? 'var(--reader-accent, #58a6ff)' : 'var(--reader-secondary)',\n                fontSize: '14px',\n                fontWeight: activeTab === tab.id ? 600 : 400,\n                cursor: 'pointer',\n                transition: 'all 0.2s ease',\n              }}\n            >\n              {tab.label}\n            </button>\n          ))}\n          <button\n            onClick={onClose}\n            style={{\n              background: 'none',\n              border: 'none',\n              color: 'var(--reader-secondary)',\n              cursor: 'pointer',\n              padding: '16px 12px',\n            }}\n            aria-label=\"Close settings\"\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        {/* Tab Content */}\n        <div\n          style={{\n            flex: 1,\n            overflowY: 'auto',\n            padding: '20px',\n          }}\n        >\n          {/* Font Tab */}\n          {activeTab === 'font' && (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\n              {/* Font Family Selection */}\n              <div>\n                <div\n                  style={{\n                    display: 'flex',\n                    gap: '8px',\n                    flexWrap: 'wrap',\n                  }}\n                >\n                  {(Object.keys(FONT_FAMILY_MAP) as ReaderSettingsType['fontFamily'][]).map((fontKey) => (\n                    <button\n                      key={fontKey}\n                      onClick={() => updateSetting('fontFamily', fontKey)}\n                      style={{\n                        padding: '12px 16px',\n                        border: settings.fontFamily === fontKey\n                          ? '2px solid var(--reader-accent, #58a6ff)'\n                          : '1px solid var(--reader-border)',\n                        borderRadius: '8px',\n                        background: settings.fontFamily === fontKey\n                          ? 'rgba(88, 166, 255, 0.1)'\n                          : 'transparent',\n                        color: settings.fontFamily === fontKey\n                          ? 'var(--reader-accent, #58a6ff)'\n                          : 'var(--reader-text)',\n                        cursor: 'pointer',\n                        fontFamily: FONT_FAMILY_MAP[fontKey].css,\n                        fontSize: '18px',\n                        minWidth: '70px',\n                      }}\n                    >\n                      Aa\n                      <div style={{ fontSize: '10px', marginTop: '4px', fontFamily: 'system-ui' }}>\n                        {FONT_FAMILY_MAP[fontKey].name}\n                      </div>\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Font Size Slider */}\n              <div>\n                <label\n                  style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Size\n                </label>\n                <div\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '12px',\n                  }}\n                >\n                  <span style={{ fontSize: '14px', color: 'var(--reader-text)' }}>A</span>\n                  <div style={{ flex: 1, position: 'relative' }}>\n                    <input\n                      type=\"range\"\n                      min={0}\n                      max={fontSizes.length - 1}\n                      value={currentSizeIndex}\n                      onChange={(e) => updateSetting('fontSize', fontSizes[parseInt(e.target.value)])}\n                      style={{\n                        width: '100%',\n                        height: '4px',\n                        appearance: 'none',\n                        background: 'var(--reader-border)',\n                        borderRadius: '2px',\n                        cursor: 'pointer',\n                      }}\n                    />\n                    {/* Tick marks */}\n                    <div\n                      style={{\n                        display: 'flex',\n                        justifyContent: 'space-between',\n                        marginTop: '8px',\n                      }}\n                    >\n                      {fontSizes.map((_, i) => (\n                        <div\n                          key={i}\n                          style={{\n                            width: '2px',\n                            height: '6px',\n                            background: i <= currentSizeIndex ? 'var(--reader-accent, #58a6ff)' : 'var(--reader-border)',\n                            borderRadius: '1px',\n                          }}\n                        />\n                      ))}\n                    </div>\n                  </div>\n                  <span style={{ fontSize: '22px', color: 'var(--reader-text)' }}>A</span>\n                </div>\n              </div>\n\n              {/* Spacing */}\n              <div>\n                <label\n                  style={{\n                    display: 'flex',\n                    justifyContent: 'space-between',\n                    alignItems: 'center',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Spacing\n                  <span style={{ fontSize: '12px', color: 'var(--reader-secondary)' }}>\n                    Adjust text spacing of the page.\n                  </span>\n                </label>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {(['compact', 'normal', 'relaxed'] as const).map((spacing) => (\n                    <button\n                      key={spacing}\n                      onClick={() => updateSetting('lineHeight', spacing)}\n                      style={{\n                        flex: 1,\n                        padding: '10px 8px',\n                        border: settings.lineHeight === spacing\n                          ? '2px solid var(--reader-accent, #58a6ff)'\n                          : '1px solid var(--reader-border)',\n                        borderRadius: '8px',\n                        background: settings.lineHeight === spacing\n                          ? 'rgba(88, 166, 255, 0.1)'\n                          : 'transparent',\n                        color: settings.lineHeight === spacing\n                          ? 'var(--reader-accent, #58a6ff)'\n                          : 'var(--reader-text)',\n                        cursor: 'pointer',\n                        fontSize: '12px',\n                        textTransform: 'capitalize',\n                      }}\n                    >\n                      {spacing}\n                    </button>\n                  ))}\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Layout Tab */}\n          {activeTab === 'layout' && (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '24px' }}>\n              {/* Page Color */}\n              <div>\n                <label\n                  style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Page Color\n                </label>\n                <div style={{ display: 'flex', gap: '12px' }}>\n                  {(Object.keys(THEME_COLORS) as ReaderSettingsType['theme'][]).map((themeKey) => (\n                    <button\n                      key={themeKey}\n                      onClick={() => updateSetting('theme', themeKey)}\n                      style={{\n                        width: '48px',\n                        height: '48px',\n                        borderRadius: '50%',\n                        background: THEME_COLORS[themeKey].background,\n                        border: settings.theme === themeKey\n                          ? '3px solid var(--reader-accent, #58a6ff)'\n                          : '2px solid var(--reader-border)',\n                        cursor: 'pointer',\n                        transition: 'transform 0.2s ease',\n                        boxShadow: '0 2px 4px rgba(0,0,0,0.1)',\n                      }}\n                      title={themeKey.charAt(0).toUpperCase() + themeKey.slice(1)}\n                    />\n                  ))}\n                </div>\n              </div>\n\n              {/* Continuous Scrolling Toggle */}\n              <div\n                style={{\n                  display: 'flex',\n                  justifyContent: 'space-between',\n                  alignItems: 'center',\n                }}\n              >\n                <label\n                  style={{\n                    fontSize: '14px',\n                    color: 'var(--reader-text)',\n                  }}\n                >\n                  Continuous Scrolling\n                </label>\n                <button\n                  onClick={() => updateSetting('continuousScroll', !settings.continuousScroll)}\n                  style={{\n                    width: '48px',\n                    height: '28px',\n                    borderRadius: '14px',\n                    border: 'none',\n                    background: settings.continuousScroll ? 'var(--reader-accent, #58a6ff)' : 'var(--reader-border)',\n                    cursor: 'pointer',\n                    position: 'relative',\n                    transition: 'background 0.2s ease',\n                  }}\n                >\n                  <div\n                    style={{\n                      width: '24px',\n                      height: '24px',\n                      borderRadius: '50%',\n                      background: '#fff',\n                      position: 'absolute',\n                      top: '2px',\n                      left: settings.continuousScroll ? '22px' : '2px',\n                      transition: 'left 0.2s ease',\n                      boxShadow: '0 1px 3px rgba(0,0,0,0.2)',\n                    }}\n                  />\n                </button>\n              </div>\n\n              {/* Alignment */}\n              <div>\n                <label\n                  style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Alignment\n                </label>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  <button\n                    onClick={() => updateSetting('textAlign', 'left')}\n                    style={{\n                      flex: 1,\n                      padding: '12px',\n                      border: settings.textAlign === 'left'\n                        ? '2px solid var(--reader-accent, #58a6ff)'\n                        : '1px solid var(--reader-border)',\n                      borderRadius: '8px',\n                      background: settings.textAlign === 'left'\n                        ? 'rgba(88, 166, 255, 0.1)'\n                        : 'transparent',\n                      color: settings.textAlign === 'left'\n                        ? 'var(--reader-accent, #58a6ff)'\n                        : 'var(--reader-text)',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                    }}\n                  >\n                    <AlignLeft size={20} />\n                  </button>\n                  <button\n                    onClick={() => updateSetting('textAlign', 'justify')}\n                    style={{\n                      flex: 1,\n                      padding: '12px',\n                      border: settings.textAlign === 'justify'\n                        ? '2px solid var(--reader-accent, #58a6ff)'\n                        : '1px solid var(--reader-border)',\n                      borderRadius: '8px',\n                      background: settings.textAlign === 'justify'\n                        ? 'rgba(88, 166, 255, 0.1)'\n                        : 'transparent',\n                      color: settings.textAlign === 'justify'\n                        ? 'var(--reader-accent, #58a6ff)'\n                        : 'var(--reader-text)',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                    }}\n                  >\n                    <AlignJustify size={20} />\n                  </button>\n                </div>\n              </div>\n\n              {/* Margins */}\n              <div>\n                <label\n                  style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Margins\n                </label>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  {(['narrow', 'medium', 'wide'] as const).map((margin) => (\n                    <button\n                      key={margin}\n                      onClick={() => updateSetting('margins', margin)}\n                      style={{\n                        flex: 1,\n                        padding: '12px 8px',\n                        border: settings.margins === margin\n                          ? '2px solid var(--reader-accent, #58a6ff)'\n                          : '1px solid var(--reader-border)',\n                        borderRadius: '8px',\n                        background: settings.margins === margin\n                          ? 'rgba(88, 166, 255, 0.1)'\n                          : 'transparent',\n                        color: settings.margins === margin\n                          ? 'var(--reader-accent, #58a6ff)'\n                          : 'var(--reader-text)',\n                        cursor: 'pointer',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                      }}\n                    >\n                      {/* Visual margin representation */}\n                      <div\n                        style={{\n                          width: margin === 'narrow' ? '28px' : margin === 'medium' ? '20px' : '12px',\n                          height: '20px',\n                          background: 'currentColor',\n                          opacity: 0.3,\n                          borderRadius: '2px',\n                        }}\n                      />\n                    </button>\n                  ))}\n                </div>\n              </div>\n\n              {/* Columns */}\n              <div>\n                <label\n                  style={{\n                    display: 'block',\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-secondary)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Layout\n                </label>\n                <div style={{ display: 'flex', gap: '8px' }}>\n                  <button\n                    onClick={() => updateSetting('columns', 'single')}\n                    style={{\n                      flex: 1,\n                      padding: '12px 8px',\n                      border: settings.columns === 'single'\n                        ? '2px solid var(--reader-accent, #58a6ff)'\n                        : '1px solid var(--reader-border)',\n                      borderRadius: '8px',\n                      background: settings.columns === 'single'\n                        ? 'rgba(88, 166, 255, 0.1)'\n                        : 'transparent',\n                      color: settings.columns === 'single'\n                        ? 'var(--reader-accent, #58a6ff)'\n                        : 'var(--reader-text)',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      flexDirection: 'column',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '6px',\n                    }}\n                  >\n                    {/* Single page icon - one rectangle */}\n                    <div\n                      style={{\n                        width: '24px',\n                        height: '32px',\n                        border: '2px solid currentColor',\n                        borderRadius: '3px',\n                      }}\n                    />\n                    <span style={{ fontSize: '11px' }}>Single</span>\n                  </button>\n                  <button\n                    onClick={() => updateSetting('columns', 'two')}\n                    style={{\n                      flex: 1,\n                      padding: '12px 8px',\n                      border: settings.columns === 'two'\n                        ? '2px solid var(--reader-accent, #58a6ff)'\n                        : '1px solid var(--reader-border)',\n                      borderRadius: '8px',\n                      background: settings.columns === 'two'\n                        ? 'rgba(88, 166, 255, 0.1)'\n                        : 'transparent',\n                      color: settings.columns === 'two'\n                        ? 'var(--reader-accent, #58a6ff)'\n                        : 'var(--reader-text)',\n                      cursor: 'pointer',\n                      display: 'flex',\n                      flexDirection: 'column',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      gap: '6px',\n                    }}\n                  >\n                    {/* Two column icon - two rectangles side by side */}\n                    <div style={{ display: 'flex', gap: '3px' }}>\n                      <div\n                        style={{\n                          width: '16px',\n                          height: '32px',\n                          border: '2px solid currentColor',\n                          borderRadius: '3px',\n                        }}\n                      />\n                      <div\n                        style={{\n                          width: '16px',\n                          height: '32px',\n                          border: '2px solid currentColor',\n                          borderRadius: '3px',\n                        }}\n                      />\n                    </div>\n                    <span style={{ fontSize: '11px' }}>Two Column</span>\n                  </button>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/* Themes Tab */}\n          {activeTab === 'themes' && (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\n              {(Object.keys(THEME_COLORS) as ReaderSettingsType['theme'][]).map((themeKey) => (\n                <button\n                  key={themeKey}\n                  onClick={() => updateSetting('theme', themeKey)}\n                  style={{\n                    display: 'flex',\n                    alignItems: 'center',\n                    gap: '16px',\n                    padding: '16px',\n                    border: settings.theme === themeKey\n                      ? '2px solid var(--reader-accent, #58a6ff)'\n                      : '1px solid var(--reader-border)',\n                    borderRadius: '12px',\n                    background: 'transparent',\n                    cursor: 'pointer',\n                    textAlign: 'left',\n                  }}\n                >\n                  <div\n                    style={{\n                      width: '48px',\n                      height: '48px',\n                      borderRadius: '8px',\n                      background: THEME_COLORS[themeKey].background,\n                      border: '1px solid var(--reader-border)',\n                      display: 'flex',\n                      alignItems: 'center',\n                      justifyContent: 'center',\n                      color: THEME_COLORS[themeKey].text,\n                      fontSize: '16px',\n                      fontFamily: 'Georgia, serif',\n                    }}\n                  >\n                    Aa\n                  </div>\n                  <div>\n                    <div\n                      style={{\n                        fontSize: '15px',\n                        fontWeight: 500,\n                        color: 'var(--reader-text)',\n                        textTransform: 'capitalize',\n                      }}\n                    >\n                      {themeKey}\n                    </div>\n                    <div\n                      style={{\n                        fontSize: '12px',\n                        color: 'var(--reader-secondary)',\n                        marginTop: '2px',\n                      }}\n                    >\n                      {themeKey === 'light' && 'Classic white background'}\n                      {themeKey === 'sepia' && 'Warm, paper-like tone'}\n                      {themeKey === 'green' && 'Easy on the eyes'}\n                      {themeKey === 'dark' && 'Perfect for night reading'}\n                    </div>\n                  </div>\n                  {settings.theme === themeKey && (\n                    <div\n                      style={{\n                        marginLeft: 'auto',\n                        width: '20px',\n                        height: '20px',\n                        borderRadius: '50%',\n                        background: 'var(--reader-accent, #58a6ff)',\n                        display: 'flex',\n                        alignItems: 'center',\n                        justifyContent: 'center',\n                      }}\n                    >\n                      <svg width=\"12\" height=\"12\" viewBox=\"0 0 12 12\" fill=\"none\">\n                        <path\n                          d=\"M2 6L5 9L10 3\"\n                          stroke=\"white\"\n                          strokeWidth=\"2\"\n                          strokeLinecap=\"round\"\n                          strokeLinejoin=\"round\"\n                        />\n                      </svg>\n                    </div>\n                  )}\n                </button>\n              ))}\n            </div>\n          )}\n\n          {/* More Tab */}\n          {activeTab === 'more' && (\n            <div style={{ display: 'flex', flexDirection: 'column', gap: '16px' }}>\n              {/* Reset Button */}\n              <button\n                onClick={resetSettings}\n                style={{\n                  width: '100%',\n                  padding: '14px',\n                  border: '1px solid var(--reader-border)',\n                  borderRadius: '8px',\n                  background: 'transparent',\n                  color: 'var(--reader-text)',\n                  cursor: 'pointer',\n                  fontSize: '14px',\n                }}\n              >\n                Reset to Defaults\n              </button>\n\n              {/* Keyboard Shortcuts Info */}\n              <div\n                style={{\n                  padding: '16px',\n                  background: 'rgba(255,255,255,0.02)',\n                  borderRadius: '8px',\n                  border: '1px solid var(--reader-border)',\n                }}\n              >\n                <div\n                  style={{\n                    fontSize: '13px',\n                    fontWeight: 500,\n                    color: 'var(--reader-text)',\n                    marginBottom: '12px',\n                  }}\n                >\n                  Keyboard Shortcuts\n                </div>\n                <div\n                  style={{\n                    display: 'flex',\n                    flexDirection: 'column',\n                    gap: '8px',\n                    fontSize: '12px',\n                    color: 'var(--reader-secondary)',\n                  }}\n                >\n                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                    <span>Next page</span>\n                    <kbd style={{ background: 'var(--reader-border)', padding: '2px 8px', borderRadius: '4px' }}>\n                      Arrow Right\n                    </kbd>\n                  </div>\n                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                    <span>Previous page</span>\n                    <kbd style={{ background: 'var(--reader-border)', padding: '2px 8px', borderRadius: '4px' }}>\n                      Arrow Left\n                    </kbd>\n                  </div>\n                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                    <span>Toggle settings</span>\n                    <kbd style={{ background: 'var(--reader-border)', padding: '2px 8px', borderRadius: '4px' }}>S</kbd>\n                  </div>\n                  <div style={{ display: 'flex', justifyContent: 'space-between' }}>\n                    <span>Table of contents</span>\n                    <kbd style={{ background: 'var(--reader-border)', padding: '2px 8px', borderRadius: '4px' }}>T</kbd>\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n        </div>\n\n        {/* Brightness Slider at Bottom (like Kindle) */}\n        <div\n          style={{\n            padding: '16px 20px',\n            borderTop: '1px solid var(--reader-border)',\n            display: 'flex',\n            alignItems: 'center',\n            gap: '12px',\n          }}\n        >\n          <svg width=\"20\" height=\"20\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--reader-secondary)\" strokeWidth=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"5\" />\n            <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\" />\n            <line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\" />\n            <line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\" />\n            <line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\" />\n            <line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\" />\n            <line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\" />\n            <line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\" />\n            <line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\" />\n          </svg>\n          <input\n            type=\"range\"\n            min={0}\n            max={100}\n            defaultValue={100}\n            style={{\n              flex: 1,\n              height: '4px',\n              appearance: 'none',\n              background: 'linear-gradient(to right, var(--reader-border) 0%, var(--reader-text) 100%)',\n              borderRadius: '2px',\n              cursor: 'pointer',\n            }}\n            title=\"Brightness (system controlled)\"\n            disabled\n          />\n          <svg width=\"24\" height=\"24\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"var(--reader-text)\" strokeWidth=\"2\">\n            <circle cx=\"12\" cy=\"12\" r=\"5\" />\n            <line x1=\"12\" y1=\"1\" x2=\"12\" y2=\"3\" />\n            <line x1=\"12\" y1=\"21\" x2=\"12\" y2=\"23\" />\n            <line x1=\"4.22\" y1=\"4.22\" x2=\"5.64\" y2=\"5.64\" />\n            <line x1=\"18.36\" y1=\"18.36\" x2=\"19.78\" y2=\"19.78\" />\n            <line x1=\"1\" y1=\"12\" x2=\"3\" y2=\"12\" />\n            <line x1=\"21\" y1=\"12\" x2=\"23\" y2=\"12\" />\n            <line x1=\"4.22\" y1=\"19.78\" x2=\"5.64\" y2=\"18.36\" />\n            <line x1=\"18.36\" y1=\"5.64\" x2=\"19.78\" y2=\"4.22\" />\n          </svg>\n        </div>\n      </div>\n\n      {/* Animation styles */}\n      <style>{`\n        @keyframes slideFromRight {\n          from { transform: translateX(100%); }\n          to { transform: translateX(0); }\n        }\n\n        input[type=\"range\"]::-webkit-slider-thumb {\n          -webkit-appearance: none;\n          width: 16px;\n          height: 16px;\n          border-radius: 50%;\n          background: var(--reader-accent, #58a6ff);\n          cursor: pointer;\n          border: 2px solid white;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n        }\n\n        input[type=\"range\"]::-moz-range-thumb {\n          width: 16px;\n          height: 16px;\n          border-radius: 50%;\n          background: var(--reader-accent, #58a6ff);\n          cursor: pointer;\n          border: 2px solid white;\n          box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n        }\n      `}</style>\n    </>\n  );\n}\n\nexport default ReaderSettingsPanel;\n","import React from 'react';\nimport { Minus, Plus, Sun, Moon, Type, Columns, AlignLeft, AlignJustify } from 'lucide-react';\nimport {\n  ReaderSettings,\n  THEME_COLORS,\n  FONT_FAMILY_MAP,\n} from '../../types/reader';\n\ninterface MobileReaderSettingsProps {\n  settings: ReaderSettings;\n  updateSetting: <K extends keyof ReaderSettings>(key: K, value: ReaderSettings[K]) => void;\n  onClose: () => void;\n  visible: boolean;\n}\n\nexport function MobileReaderSettings({\n  settings,\n  updateSetting,\n  onClose,\n  visible,\n}: MobileReaderSettingsProps) {\n  if (!visible) return null;\n\n  const fontSizes: ReaderSettings['fontSize'][] = ['xsmall', 'small', 'medium', 'large', 'xlarge'];\n  const currentSizeIndex = fontSizes.indexOf(settings.fontSize);\n\n  const fontSizeLabels: Record<ReaderSettings['fontSize'], string> = {\n    xsmall: 'XS',\n    small: 'S',\n    medium: 'M',\n    large: 'L',\n    xlarge: 'XL',\n  };\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        onClick={onClose}\n        style={{\n          position: 'fixed',\n          inset: 0,\n          background: 'rgba(0,0,0,0.6)',\n          zIndex: 200,\n        }}\n      />\n\n      {/* Bottom drawer */}\n      <div\n        style={{\n          position: 'fixed',\n          left: 0,\n          right: 0,\n          bottom: 0,\n          background: 'var(--reader-bg, #0a1628)',\n          borderTopLeftRadius: 16,\n          borderTopRightRadius: 16,\n          padding: 16,\n          paddingBottom: 'max(24px, env(safe-area-inset-bottom))',\n          zIndex: 201,\n          animation: 'slideUp 0.3s ease',\n          maxHeight: '70vh',\n          overflowY: 'auto',\n        }}\n      >\n        {/* Drag handle */}\n        <div\n          style={{\n            width: 40,\n            height: 4,\n            background: 'var(--reader-border, #21262d)',\n            borderRadius: 2,\n            margin: '0 auto 20px',\n          }}\n        />\n\n        {/* Font size controls */}\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            padding: '12px 0',\n            borderBottom: '1px solid var(--reader-border, #21262d)',\n          }}\n        >\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n            <Type size={18} style={{ color: 'var(--reader-secondary, #8b949e)' }} />\n            <span style={{ fontSize: 14, color: 'var(--reader-text, #c9d1d9)' }}>\n              Text Size\n            </span>\n          </div>\n          <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n            <button\n              onClick={() =>\n                currentSizeIndex > 0 &&\n                updateSetting('fontSize', fontSizes[currentSizeIndex - 1])\n              }\n              disabled={currentSizeIndex === 0}\n              style={{\n                width: 44,\n                height: 44,\n                borderRadius: '50%',\n                border: '1px solid var(--reader-border, #21262d)',\n                background: 'transparent',\n                color: currentSizeIndex === 0 ? 'var(--reader-border, #21262d)' : 'var(--reader-text, #c9d1d9)',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                cursor: currentSizeIndex === 0 ? 'not-allowed' : 'pointer',\n              }}\n              aria-label=\"Decrease font size\"\n            >\n              <Minus size={20} />\n            </button>\n            <span\n              style={{\n                minWidth: 32,\n                textAlign: 'center',\n                fontSize: 14,\n                fontWeight: 600,\n                color: 'var(--reader-text, #c9d1d9)',\n              }}\n            >\n              {fontSizeLabels[settings.fontSize]}\n            </span>\n            <button\n              onClick={() =>\n                currentSizeIndex < fontSizes.length - 1 &&\n                updateSetting('fontSize', fontSizes[currentSizeIndex + 1])\n              }\n              disabled={currentSizeIndex === fontSizes.length - 1}\n              style={{\n                width: 44,\n                height: 44,\n                borderRadius: '50%',\n                border: '1px solid var(--reader-border, #21262d)',\n                background: 'transparent',\n                color: currentSizeIndex === fontSizes.length - 1 ? 'var(--reader-border, #21262d)' : 'var(--reader-text, #c9d1d9)',\n                display: 'flex',\n                alignItems: 'center',\n                justifyContent: 'center',\n                cursor: currentSizeIndex === fontSizes.length - 1 ? 'not-allowed' : 'pointer',\n              }}\n              aria-label=\"Increase font size\"\n            >\n              <Plus size={20} />\n            </button>\n          </div>\n        </div>\n\n        {/* Theme switcher */}\n        <div style={{ padding: '16px 0', borderBottom: '1px solid var(--reader-border, #21262d)' }}>\n          <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 12 }}>\n            {settings.theme === 'dark' ? (\n              <Moon size={18} style={{ color: 'var(--reader-secondary, #8b949e)' }} />\n            ) : (\n              <Sun size={18} style={{ color: 'var(--reader-secondary, #8b949e)' }} />\n            )}\n            <span style={{ fontSize: 14, color: 'var(--reader-text, #c9d1d9)' }}>\n              Theme\n            </span>\n          </div>\n          <div\n            style={{\n              display: 'flex',\n              gap: 12,\n              overflowX: 'auto',\n              WebkitOverflowScrolling: 'touch',\n              paddingBottom: 4,\n            }}\n          >\n            {(Object.keys(THEME_COLORS) as ReaderSettings['theme'][]).map((theme) => (\n              <button\n                key={theme}\n                onClick={() => updateSetting('theme', theme)}\n                style={{\n                  width: 56,\n                  height: 56,\n                  borderRadius: 12,\n                  background: THEME_COLORS[theme].background,\n                  border:\n                    settings.theme === theme\n                      ? '3px solid var(--reader-accent, #58a6ff)'\n                      : '2px solid var(--reader-border, #21262d)',\n                  flexShrink: 0,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                }}\n                aria-label={`${theme} theme`}\n              >\n                <span\n                  style={{\n                    fontSize: 16,\n                    fontWeight: 700,\n                    color: THEME_COLORS[theme].text,\n                  }}\n                >\n                  Aa\n                </span>\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Font family selector */}\n        <div style={{ padding: '16px 0', borderBottom: '1px solid var(--reader-border, #21262d)' }}>\n          <div\n            style={{\n              display: 'flex',\n              gap: 8,\n              overflowX: 'auto',\n              WebkitOverflowScrolling: 'touch',\n              paddingBottom: 4,\n            }}\n          >\n            {(Object.keys(FONT_FAMILY_MAP) as ReaderSettings['fontFamily'][]).map((fontKey) => (\n              <button\n                key={fontKey}\n                onClick={() => updateSetting('fontFamily', fontKey)}\n                style={{\n                  padding: '10px 14px',\n                  borderRadius: 8,\n                  border:\n                    settings.fontFamily === fontKey\n                      ? '2px solid var(--reader-accent, #58a6ff)'\n                      : '1px solid var(--reader-border, #21262d)',\n                  background:\n                    settings.fontFamily === fontKey\n                      ? 'rgba(88, 166, 255, 0.1)'\n                      : 'transparent',\n                  color:\n                    settings.fontFamily === fontKey\n                      ? 'var(--reader-accent, #58a6ff)'\n                      : 'var(--reader-text, #c9d1d9)',\n                  fontFamily: FONT_FAMILY_MAP[fontKey].css,\n                  fontSize: 13,\n                  fontWeight: 500,\n                  whiteSpace: 'nowrap',\n                  flexShrink: 0,\n                  cursor: 'pointer',\n                }}\n              >\n                {FONT_FAMILY_MAP[fontKey].name}\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Layout options row */}\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'space-around',\n            padding: '16px 0',\n          }}\n        >\n          {/* Text alignment */}\n          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 8 }}>\n            <span style={{ fontSize: 11, color: 'var(--reader-secondary, #8b949e)' }}>Align</span>\n            <div style={{ display: 'flex', gap: 4 }}>\n              <button\n                onClick={() => updateSetting('textAlign', 'left')}\n                style={{\n                  width: 40,\n                  height: 40,\n                  borderRadius: 8,\n                  border:\n                    settings.textAlign === 'left'\n                      ? '2px solid var(--reader-accent, #58a6ff)'\n                      : '1px solid var(--reader-border, #21262d)',\n                  background:\n                    settings.textAlign === 'left'\n                      ? 'rgba(88, 166, 255, 0.1)'\n                      : 'transparent',\n                  color:\n                    settings.textAlign === 'left'\n                      ? 'var(--reader-accent, #58a6ff)'\n                      : 'var(--reader-secondary, #8b949e)',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  cursor: 'pointer',\n                }}\n                aria-label=\"Align left\"\n              >\n                <AlignLeft size={18} />\n              </button>\n              <button\n                onClick={() => updateSetting('textAlign', 'justify')}\n                style={{\n                  width: 40,\n                  height: 40,\n                  borderRadius: 8,\n                  border:\n                    settings.textAlign === 'justify'\n                      ? '2px solid var(--reader-accent, #58a6ff)'\n                      : '1px solid var(--reader-border, #21262d)',\n                  background:\n                    settings.textAlign === 'justify'\n                      ? 'rgba(88, 166, 255, 0.1)'\n                      : 'transparent',\n                  color:\n                    settings.textAlign === 'justify'\n                      ? 'var(--reader-accent, #58a6ff)'\n                      : 'var(--reader-secondary, #8b949e)',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'center',\n                  cursor: 'pointer',\n                }}\n                aria-label=\"Justify\"\n              >\n                <AlignJustify size={18} />\n              </button>\n            </div>\n          </div>\n\n          {/* Line height */}\n          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 8 }}>\n            <span style={{ fontSize: 11, color: 'var(--reader-secondary, #8b949e)' }}>Spacing</span>\n            <div style={{ display: 'flex', gap: 4 }}>\n              {(['compact', 'normal', 'relaxed'] as const).map((lh) => (\n                <button\n                  key={lh}\n                  onClick={() => updateSetting('lineHeight', lh)}\n                  style={{\n                    width: 40,\n                    height: 40,\n                    borderRadius: 8,\n                    border:\n                      settings.lineHeight === lh\n                        ? '2px solid var(--reader-accent, #58a6ff)'\n                        : '1px solid var(--reader-border, #21262d)',\n                    background:\n                      settings.lineHeight === lh\n                        ? 'rgba(88, 166, 255, 0.1)'\n                        : 'transparent',\n                    color:\n                      settings.lineHeight === lh\n                        ? 'var(--reader-accent, #58a6ff)'\n                        : 'var(--reader-secondary, #8b949e)',\n                    fontSize: 11,\n                    fontWeight: 600,\n                    cursor: 'pointer',\n                  }}\n                  aria-label={`${lh} line height`}\n                >\n                  {lh[0].toUpperCase()}\n                </button>\n              ))}\n            </div>\n          </div>\n\n          {/* Continuous scroll toggle */}\n          <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 8 }}>\n            <span style={{ fontSize: 11, color: 'var(--reader-secondary, #8b949e)' }}>Scroll</span>\n            <button\n              onClick={() => updateSetting('continuousScroll', !settings.continuousScroll)}\n              style={{\n                width: 56,\n                height: 40,\n                borderRadius: 20,\n                border: 'none',\n                background: settings.continuousScroll\n                  ? 'var(--reader-accent, #58a6ff)'\n                  : 'var(--reader-border, #21262d)',\n                position: 'relative',\n                cursor: 'pointer',\n                transition: 'background 0.2s ease',\n              }}\n              aria-label=\"Toggle continuous scroll\"\n            >\n              <div\n                style={{\n                  position: 'absolute',\n                  top: 4,\n                  left: settings.continuousScroll ? 20 : 4,\n                  width: 32,\n                  height: 32,\n                  borderRadius: '50%',\n                  background: 'var(--reader-bg, #0a1628)',\n                  transition: 'left 0.2s ease',\n                }}\n              />\n            </button>\n          </div>\n        </div>\n      </div>\n    </>\n  );\n}\n","import React from 'react';\nimport { X, BookOpen } from 'lucide-react';\nimport { Chapter } from '../../types/reader';\n\ninterface TableOfContentsProps {\n  chapters: Chapter[];\n  currentChapterId?: string;\n  onSelectChapter: (chapter: Chapter) => void;\n  onClose: () => void;\n  visible: boolean;\n}\n\nexport function TableOfContents({\n  chapters,\n  currentChapterId,\n  onSelectChapter,\n  onClose,\n  visible,\n}: TableOfContentsProps) {\n  if (!visible) return null;\n\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        className=\"reader-toc-backdrop\"\n        onClick={onClose}\n        style={{\n          position: 'fixed',\n          inset: 0,\n          background: 'rgba(0, 0, 0, 0.5)',\n          zIndex: 200,\n          animation: 'fadeIn 0.2s ease',\n        }}\n      />\n\n      {/* TOC Panel */}\n      <div\n        className=\"reader-toc-panel\"\n        style={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          bottom: 0,\n          width: '300px',\n          maxWidth: '80vw',\n          background: 'var(--reader-bg)',\n          borderRight: '1px solid var(--reader-border)',\n          zIndex: 201,\n          display: 'flex',\n          flexDirection: 'column',\n          animation: 'slideRight 0.3s ease',\n        }}\n      >\n        {/* Header */}\n        <div\n          style={{\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            padding: '20px',\n            borderBottom: '1px solid var(--reader-border)',\n          }}\n        >\n          <div style={{ display: 'flex', alignItems: 'center', gap: '8px' }}>\n            <BookOpen size={20} color=\"var(--reader-text)\" />\n            <h2\n              style={{\n                fontSize: '18px',\n                fontWeight: 600,\n                color: 'var(--reader-text)',\n                margin: 0,\n              }}\n            >\n              Contents\n            </h2>\n          </div>\n          <button\n            onClick={onClose}\n            style={{\n              background: 'none',\n              border: 'none',\n              color: 'var(--reader-text)',\n              cursor: 'pointer',\n              padding: '8px',\n            }}\n            aria-label=\"Close table of contents\"\n          >\n            <X size={24} />\n          </button>\n        </div>\n\n        {/* Chapter List */}\n        <div\n          style={{\n            flex: 1,\n            overflowY: 'auto',\n            padding: '12px',\n          }}\n        >\n          {chapters.length === 0 ? (\n            <p\n              style={{\n                color: 'var(--reader-secondary)',\n                fontSize: '14px',\n                textAlign: 'center',\n                padding: '20px',\n              }}\n            >\n              No chapters detected\n            </p>\n          ) : (\n            <ul\n              style={{\n                listStyle: 'none',\n                margin: 0,\n                padding: 0,\n              }}\n            >\n              {chapters.map((chapter) => (\n                <li key={chapter.id}>\n                  <button\n                    onClick={() => {\n                      onSelectChapter(chapter);\n                      onClose();\n                    }}\n                    style={{\n                      width: '100%',\n                      padding: '12px 16px',\n                      paddingLeft: `${16 + (chapter.level - 1) * 16}px`,\n                      border: 'none',\n                      borderRadius: '8px',\n                      background:\n                        currentChapterId === chapter.id\n                          ? 'var(--reader-border)'\n                          : 'transparent',\n                      color:\n                        currentChapterId === chapter.id\n                          ? 'var(--reader-text)'\n                          : 'var(--reader-secondary)',\n                      cursor: 'pointer',\n                      textAlign: 'left',\n                      fontSize: chapter.level === 1 ? '15px' : '14px',\n                      fontWeight: chapter.level === 1 ? 500 : 400,\n                      display: 'flex',\n                      alignItems: 'center',\n                      gap: '8px',\n                      transition: 'background 0.2s ease',\n                    }}\n                    onMouseEnter={(e) => {\n                      if (currentChapterId !== chapter.id) {\n                        e.currentTarget.style.background =\n                          'var(--reader-border)';\n                      }\n                    }}\n                    onMouseLeave={(e) => {\n                      if (currentChapterId !== chapter.id) {\n                        e.currentTarget.style.background = 'transparent';\n                      }\n                    }}\n                  >\n                    {chapter.level === 1 && (\n                      <span\n                        style={{\n                          width: '6px',\n                          height: '6px',\n                          borderRadius: '50%',\n                          background:\n                            currentChapterId === chapter.id\n                              ? 'var(--reader-text)'\n                              : 'var(--reader-secondary)',\n                          flexShrink: 0,\n                        }}\n                      />\n                    )}\n                    <span\n                      style={{\n                        overflow: 'hidden',\n                        textOverflow: 'ellipsis',\n                        whiteSpace: 'nowrap',\n                      }}\n                    >\n                      {chapter.title}\n                    </span>\n                  </button>\n                </li>\n              ))}\n            </ul>\n          )}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default TableOfContents;\n","import React, { useState, useRef, useCallback, useEffect, useMemo } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { useReaderSettings } from '../../hooks/useReaderSettings';\nimport { useSwipeGesture } from '../../hooks/useSwipeGesture';\nimport { useKeyboardNavigation } from '../../hooks/useKeyboardNavigation';\nimport { useMobile } from '../../hooks/useMobile';\nimport { useFullscreen } from '../../hooks/useFullscreen';\nimport { useEdgeGesture } from '../../hooks/useEdgeGesture';\nimport {\n  detectChapters,\n  getCurrentChapter,\n  injectChapterIds,\n} from '../../utils/chapterDetection';\nimport { sanitizeHtml } from '../../utils/sanitize';\nimport { Chapter } from '../../types/reader';\nimport { ReaderHeader } from './ReaderHeader';\nimport { ReaderFooter } from './ReaderFooter';\nimport { ReaderNavigation } from './ReaderNavigation';\nimport { ReaderSettingsPanel } from './ReaderSettings';\nimport { MobileReaderSettings } from './MobileReaderSettings';\nimport { TableOfContents } from './TableOfContents';\n\ninterface KindleReaderProps {\n  contentId: string;\n  title: string;\n  htmlContent: string;\n  onBack?: () => void;\n}\n\n// Fixed reading widths for comfortable reading\nconst SINGLE_COLUMN_MAX_WIDTH = 650;\nconst TWO_COLUMN_MAX_WIDTH = 1200;\n// Gap between columns in two-column mode\nconst COLUMN_GAP = 60;\n\nexport function KindleReader({\n  contentId,\n  title,\n  htmlContent,\n  onBack,\n}: KindleReaderProps) {\n  const navigate = useNavigate();\n  const containerRef = useRef<HTMLDivElement>(null);\n  const viewportRef = useRef<HTMLDivElement>(null);\n  const contentRef = useRef<HTMLDivElement>(null);\n\n  // State\n  const [showUI, setShowUI] = useState(true);\n  const [showSettings, setShowSettings] = useState(false);\n  const [showTOC, setShowTOC] = useState(false);\n  const [chapters, setChapters] = useState<Chapter[]>([]);\n  const [currentPage, setCurrentPage] = useState(0);\n  const [totalPages, setTotalPages] = useState(1);\n  const [pageWidth, setPageWidth] = useState(0);\n  const [columnWidth, setColumnWidth] = useState(0);\n\n  // Hooks\n  const { settings, updateSetting, resetSettings, cssVars, themeClass } =\n    useReaderSettings();\n  const { isMobile, isPhone } = useMobile();\n  const { isFullscreen, toggleFullscreen, isSupported: fullscreenSupported } = useFullscreen(containerRef);\n\n  // Process content with chapter IDs\n  const processedContent = useMemo(\n    () => injectChapterIds(htmlContent),\n    [htmlContent]\n  );\n\n  // Detect chapters from content\n  useEffect(() => {\n    const detectedChapters = detectChapters(htmlContent);\n    setChapters(detectedChapters);\n  }, [htmlContent]);\n\n  // Calculate the page dimensions\n  // Industry-standard approach (Kindle, epub.js, iBooks):\n  // - Use CSS columns with fixed height to flow content horizontally\n  // - Use scrollLeft (not transform) for page navigation\n  // - This naturally aligns with CSS column boundaries\n  const calculateDimensions = useCallback(() => {\n    const viewport = viewportRef.current;\n    const content = contentRef.current;\n    if (!viewport || !content || settings.continuousScroll) {\n      setTotalPages(1);\n      return;\n    }\n\n    // The viewport width IS the page width\n    const viewportWidth = viewport.clientWidth;\n    setPageWidth(viewportWidth);\n\n    // Force single column on phones for better readability\n    const effectiveCols = isPhone ? 'single' : settings.columns;\n\n    // Column count determines how many columns fit in viewport\n    // Content padding (32px each side) provides visual spacing between columns\n    const colCount = effectiveCols === 'two' ? 2 : 1;\n    setColumnWidth(colCount); // Store column COUNT, not width\n\n    // Wait for columns to render, then calculate total pages\n    requestAnimationFrame(() => {\n      requestAnimationFrame(() => {\n        if (!viewport) return;\n\n        // Use viewport's scrollWidth (it contains the scrollable content)\n        const scrollWidth = viewport.scrollWidth;\n        // Pages = ceil(scrollWidth / viewportWidth)\n        // Round to avoid floating point issues\n        const pages = Math.max(1, Math.round(scrollWidth / viewportWidth));\n        setTotalPages(pages);\n\n        // Ensure current page is valid\n        setCurrentPage((prev) => Math.min(prev, Math.max(0, pages - 1)));\n      });\n    });\n  }, [settings.continuousScroll, settings.columns, isPhone]);\n\n  // Scroll to current page when page changes (industry-standard approach)\n  useEffect(() => {\n    const viewport = viewportRef.current;\n    if (!viewport || settings.continuousScroll || pageWidth === 0) return;\n\n    // Use scrollTo for smooth, precise navigation\n    viewport.scrollTo({\n      left: currentPage * pageWidth,\n      top: 0,\n      behavior: 'smooth',\n    });\n  }, [currentPage, pageWidth, settings.continuousScroll]);\n\n  // Initialize and handle resize\n  useEffect(() => {\n    if (settings.continuousScroll) return;\n\n    // Wait for content to render\n    const timer = setTimeout(calculateDimensions, 250);\n\n    // Handle resize\n    const handleResize = () => {\n      setTimeout(calculateDimensions, 150);\n    };\n\n    window.addEventListener('resize', handleResize);\n\n    return () => {\n      clearTimeout(timer);\n      window.removeEventListener('resize', handleResize);\n    };\n  }, [calculateDimensions, settings.continuousScroll]);\n\n  // Recalculate when settings change\n  useEffect(() => {\n    const timer = setTimeout(calculateDimensions, 200);\n    return () => clearTimeout(timer);\n  }, [\n    processedContent,\n    calculateDimensions,\n    settings.fontSize,\n    settings.lineHeight,\n    settings.columns,\n    settings.margins,\n  ]);\n\n  // Navigation functions\n  const goToPage = useCallback((page: number) => {\n    const validPage = Math.max(0, Math.min(page, totalPages - 1));\n    setCurrentPage(validPage);\n  }, [totalPages]);\n\n  const nextPage = useCallback(() => {\n    if (currentPage < totalPages - 1) {\n      goToPage(currentPage + 1);\n    }\n  }, [currentPage, totalPages, goToPage]);\n\n  const prevPage = useCallback(() => {\n    if (currentPage > 0) {\n      goToPage(currentPage - 1);\n    }\n  }, [currentPage, goToPage]);\n\n  const goToStart = useCallback(() => {\n    goToPage(0);\n  }, [goToPage]);\n\n  const goToEnd = useCallback(() => {\n    goToPage(totalPages - 1);\n  }, [totalPages, goToPage]);\n\n  // Get current chapter\n  const currentChapter = useMemo(\n    () => getCurrentChapter(chapters, currentPage),\n    [chapters, currentPage]\n  );\n\n  // Handle chapter selection from TOC\n  const handleSelectChapter = useCallback(\n    (chapter: Chapter) => {\n      goToPage(chapter.pageIndex);\n      setShowTOC(false);\n    },\n    [goToPage]\n  );\n\n  // Toggle UI visibility\n  const toggleUI = useCallback(() => {\n    if (!showSettings && !showTOC) {\n      setShowUI((prev) => !prev);\n    }\n  }, [showSettings, showTOC]);\n\n  // Handle back navigation\n  const handleBack = useCallback(() => {\n    if (onBack) {\n      onBack();\n    } else {\n      navigate(-1);\n    }\n  }, [navigate, onBack]);\n\n  // Swipe gestures\n  useSwipeGesture(containerRef, {\n    onSwipeLeft: nextPage,\n    onSwipeRight: prevPage,\n    enabled: !showSettings && !showTOC && !settings.continuousScroll,\n  });\n\n  // Keyboard navigation\n  useKeyboardNavigation({\n    onNext: settings.continuousScroll ? undefined : nextPage,\n    onPrevious: settings.continuousScroll ? undefined : prevPage,\n    onFirst: goToStart,\n    onLast: goToEnd,\n    onEscape: () => {\n      if (showSettings || showTOC) {\n        setShowSettings(false);\n        setShowTOC(false);\n      } else if (showUI) {\n        setShowUI(false);\n      }\n    },\n    onToggleSettings: () => {\n      if (!showTOC) {\n        setShowSettings((prev) => !prev);\n      }\n    },\n    onToggleTOC: () => {\n      if (!showSettings) {\n        setShowTOC((prev) => !prev);\n      }\n    },\n    enabled: true,\n  });\n\n  // Edge gestures for mobile (swipe from edges to open TOC/Settings)\n  useEdgeGesture(containerRef, {\n    onLeftEdge: () => setShowTOC(true),\n    onRightEdge: () => setShowSettings(true),\n    enabled: isMobile && !showSettings && !showTOC && !settings.continuousScroll,\n  });\n\n  // Force single column on phones for better readability\n  const effectiveColumns = isPhone ? 'single' : settings.columns;\n\n  // Calculate percent complete\n  const percentComplete = useMemo(() => {\n    if (totalPages <= 1) return 100;\n    return Math.round(((currentPage + 1) / totalPages) * 100);\n  }, [currentPage, totalPages]);\n\n  const isFirstPage = currentPage === 0;\n  const isLastPage = currentPage >= totalPages - 1;\n\n  // CSS variables for theming\n  const themeStyles: React.CSSProperties = {\n    '--reader-font-size': cssVars['--reader-font-size'],\n    '--reader-line-height': cssVars['--reader-line-height'],\n    '--reader-bg': cssVars['--reader-bg'],\n    '--reader-text': cssVars['--reader-text'],\n    '--reader-secondary': cssVars['--reader-secondary'],\n    '--reader-border': cssVars['--reader-border'],\n    '--reader-accent': cssVars['--reader-accent'],\n    '--reader-font-family': cssVars['--reader-font-family'],\n    '--reader-margin': cssVars['--reader-margin'],\n    '--reader-text-align': cssVars['--reader-text-align'],\n  } as React.CSSProperties;\n\n  // Content width based on column setting (use effectiveColumns which forces single on phones)\n  const contentMaxWidth = effectiveColumns === 'two' ? TWO_COLUMN_MAX_WIDTH : SINGLE_COLUMN_MAX_WIDTH;\n\n  // Mobile-specific dimensions\n  const headerHeight = isMobile ? 48 : 60;\n  const footerHeight = isMobile ? 40 : 50;\n\n  return (\n    <div\n      ref={containerRef}\n      className={`kindle-reader ${themeClass}`}\n      style={{\n        position: 'fixed',\n        inset: 0,\n        background: 'var(--reader-bg)',\n        color: 'var(--reader-text)',\n        overflow: 'hidden',\n        touchAction: settings.continuousScroll ? 'auto' : 'pan-y',\n        ...themeStyles,\n      }}\n    >\n      {/* Header */}\n      <ReaderHeader\n        title={title}\n        chapterTitle={currentChapter?.title}\n        onBack={handleBack}\n        onToggleSettings={() => setShowSettings(true)}\n        onToggleTOC={() => setShowTOC(true)}\n        visible={showUI}\n      />\n\n      {/* Content Area */}\n      <div\n        className=\"reader-content-area\"\n        style={{\n          position: 'fixed',\n          top: showUI ? `${headerHeight}px` : '0',\n          left: 0,\n          right: 0,\n          bottom: showUI ? `${footerHeight}px` : '0',\n          display: 'flex',\n          justifyContent: 'center',\n          overflow: settings.continuousScroll ? 'auto' : 'hidden',\n          transition: 'top 0.3s ease, bottom 0.3s ease',\n          background: 'var(--reader-bg)',\n        }}\n      >\n        {/*\n          VIEWPORT: The scrollable page container\n          Industry-standard approach: overflow-x: scroll with hidden scrollbar\n          Navigation uses scrollTo() for precise column alignment\n        */}\n        <div\n          ref={viewportRef}\n          className=\"reader-viewport\"\n          style={{\n            width: '100%',\n            maxWidth: `${contentMaxWidth}px`,\n            height: '100%',\n            // Scrollable but we hide the scrollbar and use programmatic scrolling\n            overflowX: settings.continuousScroll ? 'hidden' : 'scroll',\n            overflowY: settings.continuousScroll ? 'auto' : 'hidden',\n            position: 'relative',\n            // Hide scrollbar across browsers\n            scrollbarWidth: 'none', // Firefox\n            msOverflowStyle: 'none', // IE/Edge\n          }}\n        >\n          {/*\n            CONTENT: CSS columns container\n            Industry-standard: column-count forces exact N columns per viewport\n            Content padding provides visual spacing between columns\n          */}\n          <div\n            ref={contentRef}\n            className=\"reader-columns\"\n            dangerouslySetInnerHTML={{ __html: sanitizeHtml(processedContent) }}\n            style={{\n              // Fixed height forces content to flow into horizontal columns\n              height: settings.continuousScroll ? 'auto' : '100%',\n              // Let content flow naturally - viewport handles scrolling\n              width: settings.continuousScroll ? '100%' : undefined,\n              padding: settings.continuousScroll ? '24px 48px' : '24px 0',\n              boxSizing: 'border-box',\n              // CSS Columns - column-count forces exact number of columns per viewport\n              // This is the industry-standard approach (Kindle, epub.js, iBooks)\n              columnCount: settings.continuousScroll ? undefined : (effectiveColumns === 'two' ? 2 : 1),\n              columnGap: settings.continuousScroll ? undefined : '0px',\n              columnFill: 'auto',\n              // Typography\n              fontFamily: 'var(--reader-font-family)',\n              fontSize: 'var(--reader-font-size)',\n              lineHeight: 'var(--reader-line-height)',\n              color: 'var(--reader-text)',\n              textAlign: settings.textAlign as 'left' | 'justify',\n              hyphens: settings.textAlign === 'justify' ? 'auto' : 'none',\n              WebkitHyphens: settings.textAlign === 'justify' ? 'auto' : 'none',\n              wordBreak: 'break-word',\n            }}\n          />\n        </div>\n      </div>\n\n      {/* Navigation Zones */}\n      {!settings.continuousScroll && (\n        <ReaderNavigation\n          onPrevious={prevPage}\n          onNext={nextPage}\n          onCenter={toggleUI}\n          isFirstPage={isFirstPage}\n          isLastPage={isLastPage}\n          showArrows={showUI}\n          isMobile={isMobile}\n          headerHeight={headerHeight}\n          footerHeight={footerHeight}\n        />\n      )}\n\n      {/* Footer */}\n      <ReaderFooter\n        currentPage={settings.continuousScroll ? 0 : currentPage}\n        totalPages={settings.continuousScroll ? 1 : totalPages}\n        percentComplete={percentComplete}\n        visible={showUI}\n        continuousScroll={settings.continuousScroll}\n      />\n\n      {/* Settings Panel - Mobile uses bottom drawer, desktop uses side panel */}\n      {isMobile ? (\n        <MobileReaderSettings\n          settings={settings}\n          updateSetting={updateSetting}\n          onClose={() => setShowSettings(false)}\n          visible={showSettings}\n        />\n      ) : (\n        <ReaderSettingsPanel\n          settings={settings}\n          updateSetting={updateSetting}\n          resetSettings={resetSettings}\n          onClose={() => setShowSettings(false)}\n          visible={showSettings}\n        />\n      )}\n\n      {/* Table of Contents */}\n      <TableOfContents\n        chapters={chapters}\n        currentChapterId={currentChapter?.id}\n        onSelectChapter={handleSelectChapter}\n        onClose={() => setShowTOC(false)}\n        visible={showTOC}\n      />\n\n      {/* Global styles */}\n      <style>{`\n        @keyframes fadeIn {\n          from { opacity: 0; }\n          to { opacity: 1; }\n        }\n\n        @keyframes slideUp {\n          from { transform: translateY(100%); }\n          to { transform: translateY(0); }\n        }\n\n        @keyframes slideRight {\n          from { transform: translateX(-100%); }\n          to { transform: translateX(0); }\n        }\n\n        .reader-nav-zone:hover .reader-nav-arrow {\n          opacity: 0.7 !important;\n        }\n\n        .reader-icon-button:hover {\n          background: var(--reader-border) !important;\n        }\n\n        /*\n          Reader content styles - Kindle-like typography\n          IMPORTANT: Visual margins are applied here to content elements,\n          NOT to the column container. This keeps columns aligned with pages.\n        */\n        .reader-columns {\n          letter-spacing: 0.01em;\n        }\n\n        /* Hide scrollbar but allow programmatic scrolling (industry-standard approach) */\n        .reader-viewport::-webkit-scrollbar {\n          display: none;\n        }\n\n        .reader-viewport {\n          -ms-overflow-style: none;\n          scrollbar-width: none;\n        }\n\n        /* Apply horizontal padding to all direct children and common elements */\n        .reader-columns > *,\n        .reader-columns p,\n        .reader-columns h1,\n        .reader-columns h2,\n        .reader-columns h3,\n        .reader-columns h4,\n        .reader-columns h5,\n        .reader-columns h6,\n        .reader-columns ul,\n        .reader-columns ol,\n        .reader-columns blockquote,\n        .reader-columns pre,\n        .reader-columns div {\n          padding-left: 32px;\n          padding-right: 32px;\n          box-sizing: border-box;\n        }\n\n        .reader-columns h1,\n        .reader-columns h2,\n        .reader-columns h3 {\n          color: var(--reader-text);\n          margin-top: 1.5em;\n          margin-bottom: 0.7em;\n          line-height: 1.3;\n          break-after: avoid;\n        }\n\n        .reader-columns h1:first-child,\n        .reader-columns h2:first-child,\n        .reader-columns h3:first-child {\n          margin-top: 0;\n        }\n\n        .reader-columns h1 {\n          font-size: 1.5em;\n          font-weight: 700;\n        }\n\n        .reader-columns h2 {\n          font-size: 1.3em;\n          font-weight: 600;\n        }\n\n        .reader-columns h3 {\n          font-size: 1.15em;\n          font-weight: 600;\n        }\n\n        .reader-columns p {\n          margin: 0 0 1em 0;\n          text-indent: 0;\n          orphans: 2;\n          widows: 2;\n          break-inside: avoid-column;\n          -webkit-column-break-inside: avoid;\n        }\n\n        .reader-columns p + p {\n          text-indent: 1.5em;\n          margin-top: 0;\n        }\n\n        .reader-columns blockquote {\n          margin: 1em 0;\n          padding-top: 0.6em;\n          padding-bottom: 0.6em;\n          border-left: 3px solid var(--reader-border);\n          color: var(--reader-secondary);\n          font-style: italic;\n          margin-left: 32px;\n          padding-left: 1em;\n        }\n\n        .reader-columns a {\n          color: var(--reader-accent, var(--reader-text));\n          text-decoration: underline;\n          text-underline-offset: 2px;\n        }\n\n        .reader-columns img {\n          max-width: calc(100% - 64px);\n          height: auto;\n          margin: 1em auto;\n          display: block;\n        }\n\n        .reader-columns ul,\n        .reader-columns ol {\n          margin: 1em 0;\n          padding-left: calc(32px + 1.5em);\n        }\n\n        .reader-columns li {\n          margin-bottom: 0.3em;\n          padding-left: 0;\n          padding-right: 0;\n        }\n\n        .reader-columns hr {\n          border: none;\n          text-align: center;\n          margin: 1.5em 32px;\n          padding: 0;\n        }\n\n        .reader-columns hr::before {\n          content: \"* * *\";\n          color: var(--reader-secondary);\n          letter-spacing: 0.5em;\n        }\n\n        .reader-columns sup {\n          font-size: 0.75em;\n          vertical-align: super;\n          line-height: 0;\n        }\n\n        .reader-columns pre,\n        .reader-columns code {\n          font-family: 'SF Mono', Monaco, 'Consolas', monospace;\n          font-size: 0.85em;\n          background: rgba(128, 128, 128, 0.1);\n          border-radius: 4px;\n        }\n\n        .reader-columns pre {\n          padding-top: 0.8em;\n          padding-bottom: 0.8em;\n          overflow-x: auto;\n          margin: 1em 0;\n        }\n\n        .reader-columns code {\n          padding: 0.15em 0.35em;\n        }\n\n        .reader-columns pre code {\n          padding: 0;\n          background: none;\n        }\n\n        /* Scrollbar for continuous mode */\n        .reader-content-area::-webkit-scrollbar {\n          width: 8px;\n        }\n\n        .reader-content-area::-webkit-scrollbar-track {\n          background: transparent;\n        }\n\n        .reader-content-area::-webkit-scrollbar-thumb {\n          background: var(--reader-border);\n          border-radius: 4px;\n        }\n\n        .reader-content-area::-webkit-scrollbar-thumb:hover {\n          background: var(--reader-secondary);\n        }\n\n        /* Selection */\n        .reader-columns ::selection {\n          background: var(--reader-accent, #58a6ff);\n          color: white;\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default KindleReader;\n","import { useState, useCallback, useEffect, RefObject } from 'react';\n\ninterface FullscreenState {\n  isFullscreen: boolean;\n  enterFullscreen: () => Promise<void>;\n  exitFullscreen: () => void;\n  toggleFullscreen: () => void;\n  isSupported: boolean;\n}\n\nexport function useFullscreen(elementRef: RefObject<HTMLElement>): FullscreenState {\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  const isSupported = typeof document !== 'undefined' && (\n    'fullscreenEnabled' in document ||\n    'webkitFullscreenEnabled' in document\n  );\n\n  const enterFullscreen = useCallback(async () => {\n    const el = elementRef.current;\n    if (!el) return;\n\n    try {\n      if (el.requestFullscreen) {\n        await el.requestFullscreen();\n      } else if ((el as any).webkitRequestFullscreen) {\n        await (el as any).webkitRequestFullscreen();\n      }\n    } catch (err) {\n      console.warn('Fullscreen not available:', err);\n    }\n  }, [elementRef]);\n\n  const exitFullscreen = useCallback(() => {\n    try {\n      if (document.exitFullscreen) {\n        document.exitFullscreen();\n      } else if ((document as any).webkitExitFullscreen) {\n        (document as any).webkitExitFullscreen();\n      }\n    } catch (err) {\n      console.warn('Exit fullscreen failed:', err);\n    }\n  }, []);\n\n  const toggleFullscreen = useCallback(() => {\n    if (isFullscreen) {\n      exitFullscreen();\n    } else {\n      enterFullscreen();\n    }\n  }, [isFullscreen, enterFullscreen, exitFullscreen]);\n\n  useEffect(() => {\n    const handleChange = () => {\n      const fullscreenElement = document.fullscreenElement || (document as any).webkitFullscreenElement;\n      setIsFullscreen(!!fullscreenElement);\n    };\n\n    document.addEventListener('fullscreenchange', handleChange);\n    document.addEventListener('webkitfullscreenchange', handleChange);\n\n    return () => {\n      document.removeEventListener('fullscreenchange', handleChange);\n      document.removeEventListener('webkitfullscreenchange', handleChange);\n    };\n  }, []);\n\n  return {\n    isFullscreen,\n    enterFullscreen,\n    exitFullscreen,\n    toggleFullscreen,\n    isSupported,\n  };\n}\n","import { Chapter } from '../types/reader';\n\n/**\n * Parse HTML content to detect chapter headings (h1, h2, h3)\n * and create a table of contents structure.\n */\nexport function detectChapters(htmlContent: string): Chapter[] {\n  const chapters: Chapter[] = [];\n\n  // Create a temporary DOM element to parse HTML\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(htmlContent, 'text/html');\n\n  // Find all heading elements\n  const headings = doc.querySelectorAll('h1, h2, h3');\n\n  headings.forEach((heading, index) => {\n    const tagName = heading.tagName.toLowerCase();\n    const level = parseInt(tagName.charAt(1), 10);\n    const title = heading.textContent?.trim() || `Chapter ${index + 1}`;\n\n    // Generate an ID if not present\n    const elementId = heading.id || `chapter-${index + 1}`;\n\n    // Add ID to the heading if not present (for navigation)\n    if (!heading.id) {\n      heading.id = elementId;\n    }\n\n    chapters.push({\n      id: elementId,\n      title,\n      level,\n      pageIndex: 0, // Will be updated after pagination\n      elementId,\n    });\n  });\n\n  return chapters;\n}\n\n/**\n * Update chapter page indices after pagination is calculated.\n * Call this after the content is rendered and pagination is ready.\n */\nexport function updateChapterPageIndices(\n  chapters: Chapter[],\n  contentElement: HTMLElement\n): Chapter[] {\n  const containerWidth = contentElement.clientWidth;\n\n  if (containerWidth === 0) return chapters;\n\n  return chapters.map((chapter) => {\n    const element = contentElement.querySelector(`#${CSS.escape(chapter.elementId || chapter.id)}`);\n\n    if (element) {\n      // Get the element's position relative to the scrollable container\n      const elementRect = element.getBoundingClientRect();\n      const containerRect = contentElement.getBoundingClientRect();\n      const elementLeft = elementRect.left - containerRect.left + contentElement.scrollLeft;\n\n      // Calculate which page this element is on\n      const pageIndex = Math.floor(elementLeft / containerWidth);\n\n      return {\n        ...chapter,\n        pageIndex,\n      };\n    }\n\n    return chapter;\n  });\n}\n\n/**\n * Find the current chapter based on the current page.\n */\nexport function getCurrentChapter(\n  chapters: Chapter[],\n  currentPage: number\n): Chapter | null {\n  if (chapters.length === 0) return null;\n\n  // Find the last chapter that starts at or before the current page\n  let currentChapter: Chapter | null = null;\n\n  for (const chapter of chapters) {\n    if (chapter.pageIndex <= currentPage) {\n      currentChapter = chapter;\n    } else {\n      break;\n    }\n  }\n\n  return currentChapter;\n}\n\n/**\n * Inject IDs into HTML content for chapters without IDs.\n * Returns modified HTML string with IDs added to headings.\n */\nexport function injectChapterIds(htmlContent: string): string {\n  const parser = new DOMParser();\n  const doc = parser.parseFromString(htmlContent, 'text/html');\n\n  const headings = doc.querySelectorAll('h1, h2, h3');\n\n  headings.forEach((heading, index) => {\n    if (!heading.id) {\n      heading.id = `chapter-${index + 1}`;\n    }\n  });\n\n  return doc.body.innerHTML;\n}\n","import { useEffect, useRef, useCallback } from 'react';\n\ninterface SwipeHandlers {\n  onSwipeLeft?: () => void;\n  onSwipeRight?: () => void;\n  onSwipeUp?: () => void;\n  onSwipeDown?: () => void;\n}\n\ninterface UseSwipeGestureOptions extends SwipeHandlers {\n  threshold?: number; // Minimum distance for swipe (default 50px)\n  velocityThreshold?: number; // Minimum velocity for swipe (default 0.3 px/ms)\n  enabled?: boolean;\n}\n\ninterface TouchPoint {\n  x: number;\n  y: number;\n  time: number;\n}\n\nexport function useSwipeGesture(\n  elementRef: React.RefObject<HTMLElement>,\n  options: UseSwipeGestureOptions\n) {\n  const {\n    onSwipeLeft,\n    onSwipeRight,\n    onSwipeUp,\n    onSwipeDown,\n    threshold = 50,\n    velocityThreshold = 0.3,\n    enabled = true,\n  } = options;\n\n  const touchStartRef = useRef<TouchPoint | null>(null);\n  const touchEndRef = useRef<TouchPoint | null>(null);\n\n  const handleTouchStart = useCallback(\n    (e: TouchEvent) => {\n      if (!enabled) return;\n\n      const touch = e.touches[0];\n      touchStartRef.current = {\n        x: touch.clientX,\n        y: touch.clientY,\n        time: Date.now(),\n      };\n      touchEndRef.current = null;\n    },\n    [enabled]\n  );\n\n  const handleTouchMove = useCallback(\n    (e: TouchEvent) => {\n      if (!enabled || !touchStartRef.current) return;\n\n      const touch = e.touches[0];\n      touchEndRef.current = {\n        x: touch.clientX,\n        y: touch.clientY,\n        time: Date.now(),\n      };\n\n      // Calculate horizontal distance\n      const deltaX = touch.clientX - touchStartRef.current.x;\n      const deltaY = touch.clientY - touchStartRef.current.y;\n\n      // If horizontal swipe is more dominant, prevent vertical scroll\n      if (Math.abs(deltaX) > Math.abs(deltaY) && Math.abs(deltaX) > 10) {\n        e.preventDefault();\n      }\n    },\n    [enabled]\n  );\n\n  const handleTouchEnd = useCallback(\n    (e: TouchEvent) => {\n      if (!enabled || !touchStartRef.current || !touchEndRef.current) return;\n\n      const start = touchStartRef.current;\n      const end = touchEndRef.current;\n\n      const deltaX = end.x - start.x;\n      const deltaY = end.y - start.y;\n      const deltaTime = end.time - start.time;\n\n      // Calculate velocity\n      const velocityX = Math.abs(deltaX) / deltaTime;\n      const velocityY = Math.abs(deltaY) / deltaTime;\n\n      // Determine if it's a horizontal or vertical swipe\n      const isHorizontal = Math.abs(deltaX) > Math.abs(deltaY);\n\n      if (isHorizontal) {\n        // Horizontal swipe\n        if (\n          Math.abs(deltaX) >= threshold &&\n          velocityX >= velocityThreshold\n        ) {\n          if (deltaX > 0) {\n            // Swipe right (go to previous page)\n            onSwipeRight?.();\n          } else {\n            // Swipe left (go to next page)\n            onSwipeLeft?.();\n          }\n        }\n      } else {\n        // Vertical swipe\n        if (\n          Math.abs(deltaY) >= threshold &&\n          velocityY >= velocityThreshold\n        ) {\n          if (deltaY > 0) {\n            onSwipeDown?.();\n          } else {\n            onSwipeUp?.();\n          }\n        }\n      }\n\n      // Reset\n      touchStartRef.current = null;\n      touchEndRef.current = null;\n    },\n    [\n      enabled,\n      threshold,\n      velocityThreshold,\n      onSwipeLeft,\n      onSwipeRight,\n      onSwipeUp,\n      onSwipeDown,\n    ]\n  );\n\n  useEffect(() => {\n    const element = elementRef.current;\n    if (!element || !enabled) return;\n\n    // Add touch event listeners\n    element.addEventListener('touchstart', handleTouchStart, { passive: true });\n    element.addEventListener('touchmove', handleTouchMove, { passive: false });\n    element.addEventListener('touchend', handleTouchEnd, { passive: true });\n\n    return () => {\n      element.removeEventListener('touchstart', handleTouchStart);\n      element.removeEventListener('touchmove', handleTouchMove);\n      element.removeEventListener('touchend', handleTouchEnd);\n    };\n  }, [elementRef, enabled, handleTouchStart, handleTouchMove, handleTouchEnd]);\n}\n\nexport default useSwipeGesture;\n","import { useEffect, useCallback } from 'react';\n\ninterface KeyboardNavigationHandlers {\n  onNext?: () => void;\n  onPrevious?: () => void;\n  onFirst?: () => void;\n  onLast?: () => void;\n  onEscape?: () => void;\n  onToggleSettings?: () => void;\n  onToggleTOC?: () => void;\n}\n\ninterface UseKeyboardNavigationOptions extends KeyboardNavigationHandlers {\n  enabled?: boolean;\n}\n\nexport function useKeyboardNavigation(options: UseKeyboardNavigationOptions) {\n  const {\n    onNext,\n    onPrevious,\n    onFirst,\n    onLast,\n    onEscape,\n    onToggleSettings,\n    onToggleTOC,\n    enabled = true,\n  } = options;\n\n  const handleKeyDown = useCallback(\n    (e: KeyboardEvent) => {\n      if (!enabled) return;\n\n      // Don't handle if user is typing in an input\n      if (\n        e.target instanceof HTMLInputElement ||\n        e.target instanceof HTMLTextAreaElement ||\n        e.target instanceof HTMLSelectElement\n      ) {\n        return;\n      }\n\n      switch (e.key) {\n        case 'ArrowRight':\n        case 'PageDown':\n        case ' ': // Space bar\n          if (e.key === ' ') e.preventDefault(); // Prevent page scroll\n          onNext?.();\n          break;\n\n        case 'ArrowLeft':\n        case 'PageUp':\n          onPrevious?.();\n          break;\n\n        case 'Home':\n          e.preventDefault();\n          onFirst?.();\n          break;\n\n        case 'End':\n          e.preventDefault();\n          onLast?.();\n          break;\n\n        case 'Escape':\n          onEscape?.();\n          break;\n\n        case 's':\n        case 'S':\n          // Toggle settings with 's' key\n          if (!e.ctrlKey && !e.metaKey) {\n            onToggleSettings?.();\n          }\n          break;\n\n        case 't':\n        case 'T':\n          // Toggle table of contents with 't' key\n          if (!e.ctrlKey && !e.metaKey) {\n            onToggleTOC?.();\n          }\n          break;\n\n        default:\n          break;\n      }\n    },\n    [\n      enabled,\n      onNext,\n      onPrevious,\n      onFirst,\n      onLast,\n      onEscape,\n      onToggleSettings,\n      onToggleTOC,\n    ]\n  );\n\n  useEffect(() => {\n    if (!enabled) return;\n\n    window.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [enabled, handleKeyDown]);\n}\n\nexport default useKeyboardNavigation;\n","import { useEffect, useRef, useCallback, RefObject } from 'react';\n\ninterface EdgeGestureOptions {\n  onLeftEdge?: () => void;   // Swipe from left edge = open TOC\n  onRightEdge?: () => void;  // Swipe from right edge = open Settings\n  edgeThreshold?: number;    // How close to edge to trigger (default 30px)\n  swipeDistance?: number;    // Min distance to complete gesture (default 50px)\n  enabled?: boolean;\n}\n\ninterface TouchStart {\n  x: number;\n  y: number;\n  isEdge: 'left' | 'right' | null;\n  time: number;\n}\n\nexport function useEdgeGesture(\n  elementRef: RefObject<HTMLElement>,\n  options: EdgeGestureOptions\n) {\n  const {\n    onLeftEdge,\n    onRightEdge,\n    edgeThreshold = 30,\n    swipeDistance = 50,\n    enabled = true,\n  } = options;\n\n  const touchStartRef = useRef<TouchStart | null>(null);\n\n  const handleTouchStart = useCallback((e: TouchEvent) => {\n    if (!enabled) return;\n\n    const touch = e.touches[0];\n    const screenWidth = window.innerWidth;\n\n    let isEdge: 'left' | 'right' | null = null;\n    if (touch.clientX <= edgeThreshold) {\n      isEdge = 'left';\n    } else if (touch.clientX >= screenWidth - edgeThreshold) {\n      isEdge = 'right';\n    }\n\n    touchStartRef.current = {\n      x: touch.clientX,\n      y: touch.clientY,\n      isEdge,\n      time: Date.now(),\n    };\n  }, [enabled, edgeThreshold]);\n\n  const handleTouchMove = useCallback((e: TouchEvent) => {\n    // If it's an edge gesture, prevent scrolling\n    if (touchStartRef.current?.isEdge) {\n      const touch = e.touches[0];\n      const deltaX = Math.abs(touch.clientX - touchStartRef.current.x);\n      const deltaY = Math.abs(touch.clientY - touchStartRef.current.y);\n\n      // If moving more horizontally than vertically, prevent scroll\n      if (deltaX > deltaY && deltaX > 10) {\n        e.preventDefault();\n      }\n    }\n  }, []);\n\n  const handleTouchEnd = useCallback((e: TouchEvent) => {\n    if (!enabled || !touchStartRef.current?.isEdge) {\n      touchStartRef.current = null;\n      return;\n    }\n\n    const touch = e.changedTouches[0];\n    const deltaX = touch.clientX - touchStartRef.current.x;\n    const deltaY = Math.abs(touch.clientY - touchStartRef.current.y);\n\n    // Ignore if more vertical than horizontal\n    if (deltaY > Math.abs(deltaX)) {\n      touchStartRef.current = null;\n      return;\n    }\n\n    // Check if swipe distance threshold met\n    if (touchStartRef.current.isEdge === 'left' && deltaX >= swipeDistance) {\n      onLeftEdge?.();\n    } else if (touchStartRef.current.isEdge === 'right' && deltaX <= -swipeDistance) {\n      onRightEdge?.();\n    }\n\n    touchStartRef.current = null;\n  }, [enabled, swipeDistance, onLeftEdge, onRightEdge]);\n\n  useEffect(() => {\n    const element = elementRef.current;\n    if (!element || !enabled) return;\n\n    element.addEventListener('touchstart', handleTouchStart, { passive: true });\n    element.addEventListener('touchmove', handleTouchMove, { passive: false });\n    element.addEventListener('touchend', handleTouchEnd, { passive: true });\n\n    return () => {\n      element.removeEventListener('touchstart', handleTouchStart);\n      element.removeEventListener('touchmove', handleTouchMove);\n      element.removeEventListener('touchend', handleTouchEnd);\n    };\n  }, [elementRef, enabled, handleTouchStart, handleTouchMove, handleTouchEnd]);\n}\n","/**\n * ComicThumbnailSidebar Component\n *\n * Displays page thumbnails for quick navigation in the comic reader.\n */\n\nimport React from 'react';\nimport { X } from 'lucide-react';\nimport { ComicPageData } from '../../services/libraryApi';\n\ninterface ComicThumbnailSidebarProps {\n  pages: ComicPageData[];\n  currentPage: number;\n  onSelectPage: (pageIndex: number) => void;\n  onClose: () => void;\n}\n\nexport function ComicThumbnailSidebar({\n  pages,\n  currentPage,\n  onSelectPage,\n  onClose,\n}: ComicThumbnailSidebarProps) {\n  return (\n    <>\n      {/* Backdrop */}\n      <div\n        style={{\n          position: 'fixed',\n          inset: 0,\n          backgroundColor: 'rgba(0, 0, 0, 0.5)',\n          zIndex: 1000,\n        }}\n        onClick={onClose}\n      />\n\n      {/* Sidebar */}\n      <div\n        style={{\n          position: 'fixed',\n          top: 0,\n          left: 0,\n          bottom: 0,\n          width: 280,\n          maxWidth: '80vw',\n          backgroundColor: '#0f172a',\n          zIndex: 1001,\n          display: 'flex',\n          flexDirection: 'column',\n          boxShadow: '4px 0 20px rgba(0, 0, 0, 0.3)',\n        }}\n      >\n        {/* Header */}\n        <div\n          style={{\n            padding: '16px 20px',\n            borderBottom: '1px solid #1e293b',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n          }}\n        >\n          <span\n            style={{\n              fontSize: 16,\n              fontWeight: 600,\n              color: '#f8fafc',\n            }}\n          >\n            Pages ({pages.length})\n          </span>\n          <button\n            onClick={onClose}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              padding: 8,\n              cursor: 'pointer',\n              color: '#94a3b8',\n              borderRadius: 4,\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n          >\n            <X size={20} />\n          </button>\n        </div>\n\n        {/* Thumbnail list */}\n        <div\n          style={{\n            flex: 1,\n            overflowY: 'auto',\n            padding: 16,\n            display: 'grid',\n            gridTemplateColumns: 'repeat(2, 1fr)',\n            gap: 12,\n          }}\n        >\n          {pages.map((page, index) => {\n            const isActive = index === currentPage;\n            const aspectRatio = page.canvas_width / page.canvas_height;\n\n            return (\n              <button\n                key={page.id}\n                onClick={() => {\n                  onSelectPage(index);\n                  onClose();\n                }}\n                style={{\n                  background: isActive ? '#1e3a5f' : '#1e293b',\n                  border: isActive ? '2px solid #3b82f6' : '2px solid transparent',\n                  borderRadius: 8,\n                  padding: 8,\n                  cursor: 'pointer',\n                  display: 'flex',\n                  flexDirection: 'column',\n                  alignItems: 'center',\n                  gap: 8,\n                  transition: 'all 0.2s ease',\n                }}\n              >\n                {/* Mini page preview */}\n                <div\n                  style={{\n                    width: '100%',\n                    aspectRatio: `${aspectRatio}`,\n                    backgroundColor: page.background_color || '#ffffff',\n                    backgroundImage: page.background_image\n                      ? `url(${page.background_image})`\n                      : undefined,\n                    backgroundSize: 'cover',\n                    borderRadius: 4,\n                    position: 'relative',\n                    overflow: 'hidden',\n                  }}\n                >\n                  {/* Mini panel previews */}\n                  {page.panels.map((panel) => (\n                    <div\n                      key={panel.id}\n                      style={{\n                        position: 'absolute',\n                        left: `${panel.x_percent}%`,\n                        top: `${panel.y_percent}%`,\n                        width: `${panel.width_percent}%`,\n                        height: `${panel.height_percent}%`,\n                        border: '1px solid rgba(0,0,0,0.3)',\n                        backgroundColor: panel.artwork\n                          ? 'transparent'\n                          : panel.background_color || 'rgba(255,255,255,0.8)',\n                        backgroundImage: panel.artwork ? `url(${panel.artwork})` : undefined,\n                        backgroundSize: 'cover',\n                        backgroundPosition: 'center',\n                        transform: `rotate(${panel.rotation || 0}deg) skewX(${panel.skew_x || 0}deg) skewY(${panel.skew_y || 0}deg)`,\n                        transformOrigin: 'center center',\n                        borderRadius: panel.border_radius ? panel.border_radius / 4 : 0,\n                      }}\n                    />\n                  ))}\n                </div>\n\n                {/* Page number */}\n                <span\n                  style={{\n                    fontSize: 12,\n                    color: isActive ? '#60a5fa' : '#94a3b8',\n                    fontWeight: isActive ? 600 : 400,\n                  }}\n                >\n                  Page {index + 1}\n                </span>\n              </button>\n            );\n          })}\n        </div>\n      </div>\n    </>\n  );\n}\n\nexport default ComicThumbnailSidebar;\n","/**\n * ComicReader Component\n *\n * Main comic reading interface with page navigation, zoom, and fullscreen support.\n * Similar to KindleReader but optimized for visual comic content.\n */\n\nimport React, { useState, useEffect, useRef, useCallback } from 'react';\nimport {\n  ArrowLeft,\n  ChevronLeft,\n  ChevronRight,\n  ZoomIn,\n  ZoomOut,\n  Maximize2,\n  Minimize2,\n  Grid3X3,\n} from 'lucide-react';\nimport { ComicReaderData } from '../../services/libraryApi';\nimport { libraryApi } from '../../services/libraryApi';\nimport { ComicPageRenderer } from './ComicPageRenderer';\nimport { ComicThumbnailSidebar } from './ComicThumbnailSidebar';\n\ninterface ComicReaderProps {\n  contentId: string;\n  title: string;\n  comicData: ComicReaderData;\n  onBack: () => void;\n}\n\nexport function ComicReader({ contentId, title, comicData, onBack }: ComicReaderProps) {\n  const [currentPage, setCurrentPage] = useState(0);\n  const [zoom, setZoom] = useState(1);\n  const [showUI, setShowUI] = useState(true);\n  const [showThumbnails, setShowThumbnails] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n  const progressUpdateTimer = useRef<NodeJS.Timeout | null>(null);\n\n  const totalPages = comicData.total_pages;\n  const currentPageData = comicData.pages[currentPage];\n\n  // Navigation functions\n  const goToPage = useCallback(\n    (page: number) => {\n      const validPage = Math.max(0, Math.min(page, totalPages - 1));\n      setCurrentPage(validPage);\n    },\n    [totalPages]\n  );\n\n  const nextPage = useCallback(() => {\n    if (currentPage < totalPages - 1) {\n      goToPage(currentPage + 1);\n    }\n  }, [currentPage, totalPages, goToPage]);\n\n  const prevPage = useCallback(() => {\n    if (currentPage > 0) {\n      goToPage(currentPage - 1);\n    }\n  }, [currentPage, goToPage]);\n\n  // Zoom functions\n  const zoomIn = useCallback(() => {\n    setZoom((z) => Math.min(z + 0.25, 3));\n  }, []);\n\n  const zoomOut = useCallback(() => {\n    setZoom((z) => Math.max(z - 0.25, 0.5));\n  }, []);\n\n  const resetZoom = useCallback(() => {\n    setZoom(1);\n  }, []);\n\n  // Fullscreen toggle\n  const toggleFullscreen = useCallback(() => {\n    if (!document.fullscreenElement) {\n      containerRef.current?.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  }, []);\n\n  // Listen for fullscreen changes\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\n  }, []);\n\n  // Keyboard navigation\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Ignore if user is typing in an input\n      if (e.target instanceof HTMLInputElement || e.target instanceof HTMLTextAreaElement) {\n        return;\n      }\n\n      switch (e.key) {\n        case 'ArrowRight':\n        case ' ':\n        case 'PageDown':\n          e.preventDefault();\n          nextPage();\n          break;\n        case 'ArrowLeft':\n        case 'PageUp':\n          e.preventDefault();\n          prevPage();\n          break;\n        case 'Home':\n          e.preventDefault();\n          goToPage(0);\n          break;\n        case 'End':\n          e.preventDefault();\n          goToPage(totalPages - 1);\n          break;\n        case 'Escape':\n          if (showThumbnails) {\n            setShowThumbnails(false);\n          } else if (isFullscreen) {\n            document.exitFullscreen();\n          } else {\n            onBack();\n          }\n          break;\n        case '+':\n        case '=':\n          e.preventDefault();\n          zoomIn();\n          break;\n        case '-':\n          e.preventDefault();\n          zoomOut();\n          break;\n        case '0':\n          e.preventDefault();\n          resetZoom();\n          break;\n        case 't':\n        case 'T':\n          e.preventDefault();\n          setShowThumbnails((s) => !s);\n          break;\n        case 'f':\n        case 'F':\n          e.preventDefault();\n          toggleFullscreen();\n          break;\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [\n    nextPage,\n    prevPage,\n    goToPage,\n    totalPages,\n    showThumbnails,\n    isFullscreen,\n    onBack,\n    zoomIn,\n    zoomOut,\n    resetZoom,\n    toggleFullscreen,\n  ]);\n\n  // Progress tracking (debounced)\n  useEffect(() => {\n    if (progressUpdateTimer.current) {\n      clearTimeout(progressUpdateTimer.current);\n    }\n\n    progressUpdateTimer.current = setTimeout(() => {\n      const progress = ((currentPage + 1) / totalPages) * 100;\n      libraryApi\n        .updateProgress(\n          parseInt(contentId),\n          progress,\n          JSON.stringify({ page: currentPage, totalPages })\n        )\n        .catch(console.error);\n    }, 2000);\n\n    return () => {\n      if (progressUpdateTimer.current) {\n        clearTimeout(progressUpdateTimer.current);\n      }\n    };\n  }, [currentPage, totalPages, contentId]);\n\n  // Auto-hide UI after inactivity\n  useEffect(() => {\n    let hideTimer: NodeJS.Timeout;\n\n    const resetTimer = () => {\n      setShowUI(true);\n      clearTimeout(hideTimer);\n      hideTimer = setTimeout(() => {\n        if (!showThumbnails) {\n          setShowUI(false);\n        }\n      }, 3000);\n    };\n\n    window.addEventListener('mousemove', resetTimer);\n    window.addEventListener('touchstart', resetTimer);\n\n    resetTimer();\n\n    return () => {\n      clearTimeout(hideTimer);\n      window.removeEventListener('mousemove', resetTimer);\n      window.removeEventListener('touchstart', resetTimer);\n    };\n  }, [showThumbnails]);\n\n  const progressPercent = ((currentPage + 1) / totalPages) * 100;\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        position: 'fixed',\n        inset: 0,\n        backgroundColor: '#0a0f1a',\n        display: 'flex',\n        flexDirection: 'column',\n        overflow: 'hidden',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          position: 'absolute',\n          top: 0,\n          left: 0,\n          right: 0,\n          padding: '12px 16px',\n          background: 'linear-gradient(to bottom, rgba(10, 15, 26, 0.95), transparent)',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          zIndex: 100,\n          opacity: showUI ? 1 : 0,\n          transform: showUI ? 'translateY(0)' : 'translateY(-100%)',\n          transition: 'opacity 0.3s ease, transform 0.3s ease',\n          pointerEvents: showUI ? 'auto' : 'none',\n        }}\n      >\n        {/* Left side - back button and title */}\n        <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\n          <button\n            onClick={onBack}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: 8,\n              cursor: 'pointer',\n              color: '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n          >\n            <ArrowLeft size={20} />\n          </button>\n          <div>\n            <div style={{ fontSize: 16, fontWeight: 600, color: '#f8fafc' }}>{title}</div>\n            <div style={{ fontSize: 12, color: '#94a3b8' }}>by {comicData.creator}</div>\n          </div>\n        </div>\n\n        {/* Right side - controls */}\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          {/* Thumbnails toggle */}\n          <button\n            onClick={() => setShowThumbnails(true)}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: 8,\n              cursor: 'pointer',\n              color: '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n            title=\"Pages (T)\"\n          >\n            <Grid3X3 size={20} />\n          </button>\n\n          {/* Zoom controls */}\n          <button\n            onClick={zoomOut}\n            disabled={zoom <= 0.5}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: 8,\n              cursor: zoom <= 0.5 ? 'not-allowed' : 'pointer',\n              color: zoom <= 0.5 ? '#475569' : '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              opacity: zoom <= 0.5 ? 0.5 : 1,\n            }}\n            title=\"Zoom out (-)\"\n          >\n            <ZoomOut size={20} />\n          </button>\n\n          <button\n            onClick={resetZoom}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: '4px 12px',\n              cursor: 'pointer',\n              color: '#f8fafc',\n              fontSize: 14,\n              fontWeight: 500,\n            }}\n            title=\"Reset zoom (0)\"\n          >\n            {Math.round(zoom * 100)}%\n          </button>\n\n          <button\n            onClick={zoomIn}\n            disabled={zoom >= 3}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: 8,\n              cursor: zoom >= 3 ? 'not-allowed' : 'pointer',\n              color: zoom >= 3 ? '#475569' : '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n              opacity: zoom >= 3 ? 0.5 : 1,\n            }}\n            title=\"Zoom in (+)\"\n          >\n            <ZoomIn size={20} />\n          </button>\n\n          {/* Fullscreen toggle */}\n          <button\n            onClick={toggleFullscreen}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: 8,\n              cursor: 'pointer',\n              color: '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              justifyContent: 'center',\n            }}\n            title=\"Fullscreen (F)\"\n          >\n            {isFullscreen ? <Minimize2 size={20} /> : <Maximize2 size={20} />}\n          </button>\n        </div>\n      </div>\n\n      {/* Main content area */}\n      <div\n        style={{\n          flex: 1,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          padding: '60px 60px 80px',\n          position: 'relative',\n        }}\n        onClick={() => setShowUI((s) => !s)}\n      >\n        {currentPageData && <ComicPageRenderer page={currentPageData} zoom={zoom} fitToContainer />}\n      </div>\n\n      {/* Navigation click zones */}\n      <div\n        style={{\n          position: 'absolute',\n          top: 60,\n          bottom: 80,\n          left: 0,\n          width: '25%',\n          cursor: currentPage > 0 ? 'pointer' : 'default',\n          zIndex: 50,\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n          prevPage();\n        }}\n      >\n        {/* Left navigation indicator */}\n        {showUI && currentPage > 0 && (\n          <div\n            style={{\n              position: 'absolute',\n              top: '50%',\n              left: 16,\n              transform: 'translateY(-50%)',\n              background: 'rgba(0, 0, 0, 0.5)',\n              borderRadius: '50%',\n              padding: 12,\n              color: '#f8fafc',\n            }}\n          >\n            <ChevronLeft size={24} />\n          </div>\n        )}\n      </div>\n\n      <div\n        style={{\n          position: 'absolute',\n          top: 60,\n          bottom: 80,\n          right: 0,\n          width: '25%',\n          cursor: currentPage < totalPages - 1 ? 'pointer' : 'default',\n          zIndex: 50,\n        }}\n        onClick={(e) => {\n          e.stopPropagation();\n          nextPage();\n        }}\n      >\n        {/* Right navigation indicator */}\n        {showUI && currentPage < totalPages - 1 && (\n          <div\n            style={{\n              position: 'absolute',\n              top: '50%',\n              right: 16,\n              transform: 'translateY(-50%)',\n              background: 'rgba(0, 0, 0, 0.5)',\n              borderRadius: '50%',\n              padding: 12,\n              color: '#f8fafc',\n            }}\n          >\n            <ChevronRight size={24} />\n          </div>\n        )}\n      </div>\n\n      {/* Footer */}\n      <div\n        style={{\n          position: 'absolute',\n          bottom: 0,\n          left: 0,\n          right: 0,\n          padding: '16px 20px',\n          background: 'linear-gradient(to top, rgba(10, 15, 26, 0.95), transparent)',\n          zIndex: 100,\n          opacity: showUI ? 1 : 0,\n          transform: showUI ? 'translateY(0)' : 'translateY(100%)',\n          transition: 'opacity 0.3s ease, transform 0.3s ease',\n          pointerEvents: showUI ? 'auto' : 'none',\n        }}\n      >\n        {/* Progress bar */}\n        <div\n          style={{\n            height: 4,\n            backgroundColor: 'rgba(255, 255, 255, 0.2)',\n            borderRadius: 2,\n            marginBottom: 12,\n            overflow: 'hidden',\n          }}\n        >\n          <div\n            style={{\n              height: '100%',\n              width: `${progressPercent}%`,\n              backgroundColor: '#f59e0b',\n              borderRadius: 2,\n              transition: 'width 0.3s ease',\n            }}\n          />\n        </div>\n\n        {/* Page indicator and navigation */}\n        <div\n          style={{\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n          }}\n        >\n          <button\n            onClick={prevPage}\n            disabled={currentPage === 0}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: '8px 16px',\n              cursor: currentPage === 0 ? 'not-allowed' : 'pointer',\n              color: currentPage === 0 ? '#475569' : '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              fontSize: 14,\n              opacity: currentPage === 0 ? 0.5 : 1,\n            }}\n          >\n            <ChevronLeft size={16} />\n            Previous\n          </button>\n\n          <div style={{ textAlign: 'center' }}>\n            <div style={{ fontSize: 16, fontWeight: 600, color: '#f8fafc' }}>\n              Page {currentPage + 1} of {totalPages}\n            </div>\n            <div style={{ fontSize: 12, color: '#94a3b8' }}>\n              {Math.round(progressPercent)}% complete\n            </div>\n          </div>\n\n          <button\n            onClick={nextPage}\n            disabled={currentPage >= totalPages - 1}\n            style={{\n              background: 'rgba(255, 255, 255, 0.1)',\n              border: 'none',\n              borderRadius: 8,\n              padding: '8px 16px',\n              cursor: currentPage >= totalPages - 1 ? 'not-allowed' : 'pointer',\n              color: currentPage >= totalPages - 1 ? '#475569' : '#f8fafc',\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n              fontSize: 14,\n              opacity: currentPage >= totalPages - 1 ? 0.5 : 1,\n            }}\n          >\n            Next\n            <ChevronRight size={16} />\n          </button>\n        </div>\n\n        {/* Keyboard hints */}\n        <div\n          style={{\n            marginTop: 12,\n            fontSize: 11,\n            color: '#64748b',\n            textAlign: 'center',\n          }}\n        >\n          Press <kbd style={{ background: '#1e293b', padding: '2px 6px', borderRadius: 4 }}>+</kbd>/\n          <kbd style={{ background: '#1e293b', padding: '2px 6px', borderRadius: 4 }}>-</kbd> to\n          zoom, <kbd style={{ background: '#1e293b', padding: '2px 6px', borderRadius: 4 }}>0</kbd>{' '}\n          to reset,{' '}\n          <kbd style={{ background: '#1e293b', padding: '2px 6px', borderRadius: 4 }}>Esc</kbd> to go\n          back\n        </div>\n      </div>\n\n      {/* Thumbnail sidebar */}\n      {showThumbnails && (\n        <ComicThumbnailSidebar\n          pages={comicData.pages}\n          currentPage={currentPage}\n          onSelectPage={goToPage}\n          onClose={() => setShowThumbnails(false)}\n        />\n      )}\n    </div>\n  );\n}\n\nexport default ComicReader;\n","import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { libraryApi, type FullContent, type ComicReaderData } from '../services/libraryApi';\nimport { KindleReader } from '../components/reader';\nimport { ComicReader } from '../components/reader/ComicReader';\nimport { ArrowLeft, ZoomIn, ZoomOut, Maximize2, Download } from 'lucide-react';\nimport DOMPurify from 'dompurify';\n\n// Art Viewer Component for displaying images\nfunction ArtViewer({\n  title,\n  imageUrl,\n  creator,\n  onBack\n}: {\n  title: string;\n  imageUrl: string;\n  creator: string;\n  onBack: () => void;\n}) {\n  const [zoom, setZoom] = useState(1);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const containerRef = useRef<HTMLDivElement>(null);\n\n  const handleZoomIn = () => setZoom(prev => Math.min(prev + 0.25, 3));\n  const handleZoomOut = () => setZoom(prev => Math.max(prev - 0.25, 0.5));\n  const handleResetZoom = () => setZoom(1);\n\n  const toggleFullscreen = () => {\n    if (!document.fullscreenElement) {\n      containerRef.current?.requestFullscreen();\n      setIsFullscreen(true);\n    } else {\n      document.exitFullscreen();\n      setIsFullscreen(false);\n    }\n  };\n\n  useEffect(() => {\n    const handleFullscreenChange = () => {\n      setIsFullscreen(!!document.fullscreenElement);\n    };\n    document.addEventListener('fullscreenchange', handleFullscreenChange);\n    return () => document.removeEventListener('fullscreenchange', handleFullscreenChange);\n  }, []);\n\n  // Handle keyboard shortcuts\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'Escape' && !document.fullscreenElement) {\n        onBack();\n      } else if (e.key === '+' || e.key === '=') {\n        handleZoomIn();\n      } else if (e.key === '-') {\n        handleZoomOut();\n      } else if (e.key === '0') {\n        handleResetZoom();\n      }\n    };\n    window.addEventListener('keydown', handleKeyDown);\n    return () => window.removeEventListener('keydown', handleKeyDown);\n  }, [onBack]);\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        position: 'fixed',\n        inset: 0,\n        background: '#0a0f1a',\n        display: 'flex',\n        flexDirection: 'column',\n      }}\n    >\n      {/* Header */}\n      <div\n        style={{\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'space-between',\n          padding: '12px 20px',\n          background: '#111827',\n          borderBottom: '1px solid #1f2937',\n          zIndex: 10,\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: 16 }}>\n          <button\n            onClick={onBack}\n            style={{\n              background: 'transparent',\n              border: 'none',\n              color: '#94a3b8',\n              cursor: 'pointer',\n              padding: 8,\n              borderRadius: 8,\n              display: 'flex',\n              alignItems: 'center',\n              gap: 8,\n            }}\n          >\n            <ArrowLeft size={20} />\n          </button>\n          <div>\n            <div style={{ color: '#f8fafc', fontSize: 16, fontWeight: 600 }}>{title}</div>\n            <div style={{ color: '#64748b', fontSize: 13 }}>by {creator}</div>\n          </div>\n        </div>\n\n        {/* Controls */}\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\n          <button\n            onClick={handleZoomOut}\n            disabled={zoom <= 0.5}\n            style={{\n              background: '#1f2937',\n              border: 'none',\n              color: zoom <= 0.5 ? '#475569' : '#94a3b8',\n              cursor: zoom <= 0.5 ? 'not-allowed' : 'pointer',\n              padding: 8,\n              borderRadius: 8,\n              display: 'flex',\n              alignItems: 'center',\n            }}\n            title=\"Zoom out (-)\"\n          >\n            <ZoomOut size={18} />\n          </button>\n          <span\n            style={{\n              color: '#94a3b8',\n              fontSize: 13,\n              minWidth: 50,\n              textAlign: 'center',\n              cursor: 'pointer',\n            }}\n            onClick={handleResetZoom}\n            title=\"Reset zoom (0)\"\n          >\n            {Math.round(zoom * 100)}%\n          </span>\n          <button\n            onClick={handleZoomIn}\n            disabled={zoom >= 3}\n            style={{\n              background: '#1f2937',\n              border: 'none',\n              color: zoom >= 3 ? '#475569' : '#94a3b8',\n              cursor: zoom >= 3 ? 'not-allowed' : 'pointer',\n              padding: 8,\n              borderRadius: 8,\n              display: 'flex',\n              alignItems: 'center',\n            }}\n            title=\"Zoom in (+)\"\n          >\n            <ZoomIn size={18} />\n          </button>\n          <div style={{ width: 1, height: 24, background: '#334155', margin: '0 8px' }} />\n          <button\n            onClick={toggleFullscreen}\n            style={{\n              background: '#1f2937',\n              border: 'none',\n              color: '#94a3b8',\n              cursor: 'pointer',\n              padding: 8,\n              borderRadius: 8,\n              display: 'flex',\n              alignItems: 'center',\n            }}\n            title=\"Toggle fullscreen\"\n          >\n            <Maximize2 size={18} />\n          </button>\n          <a\n            href={imageUrl}\n            download\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            style={{\n              background: '#1f2937',\n              border: 'none',\n              color: '#94a3b8',\n              cursor: 'pointer',\n              padding: 8,\n              borderRadius: 8,\n              display: 'flex',\n              alignItems: 'center',\n              textDecoration: 'none',\n            }}\n            title=\"Download\"\n          >\n            <Download size={18} />\n          </a>\n        </div>\n      </div>\n\n      {/* Image Container */}\n      <div\n        style={{\n          flex: 1,\n          overflow: 'auto',\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          padding: 24,\n        }}\n      >\n        <img\n          src={imageUrl}\n          alt={title}\n          style={{\n            maxWidth: '100%',\n            maxHeight: '100%',\n            objectFit: 'contain',\n            transform: `scale(${zoom})`,\n            transition: 'transform 0.2s ease',\n            borderRadius: 8,\n            boxShadow: '0 8px 32px rgba(0,0,0,0.5)',\n          }}\n          draggable={false}\n        />\n      </div>\n\n      {/* Footer hint */}\n      <div\n        style={{\n          padding: '8px 20px',\n          background: '#111827',\n          borderTop: '1px solid #1f2937',\n          textAlign: 'center',\n          color: '#64748b',\n          fontSize: 12,\n        }}\n      >\n        Press <kbd style={{ background: '#1f2937', padding: '2px 6px', borderRadius: 4, marginInline: 4 }}>+</kbd> /\n        <kbd style={{ background: '#1f2937', padding: '2px 6px', borderRadius: 4, marginInline: 4 }}>-</kbd> to zoom,\n        <kbd style={{ background: '#1f2937', padding: '2px 6px', borderRadius: 4, marginInline: 4 }}>0</kbd> to reset,\n        <kbd style={{ background: '#1f2937', padding: '2px 6px', borderRadius: 4, marginInline: 4 }}>Esc</kbd> to go back\n      </div>\n    </div>\n  );\n}\n\n// Media Placeholder for music/film (to be implemented)\nfunction MediaPlaceholder({\n  title,\n  contentType,\n  creator,\n  onBack\n}: {\n  title: string;\n  contentType: string;\n  creator: string;\n  onBack: () => void;\n}) {\n  return (\n    <div\n      style={{\n        position: 'fixed',\n        inset: 0,\n        background: '#0a0f1a',\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        padding: 24,\n      }}\n    >\n      <button\n        onClick={onBack}\n        style={{\n          position: 'absolute',\n          top: 20,\n          left: 20,\n          background: '#1f2937',\n          border: 'none',\n          color: '#94a3b8',\n          cursor: 'pointer',\n          padding: '8px 16px',\n          borderRadius: 8,\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n        }}\n      >\n        <ArrowLeft size={18} />\n        Back\n      </button>\n\n      <div\n        style={{\n          textAlign: 'center',\n          maxWidth: 400,\n        }}\n      >\n        <div\n          style={{\n            width: 80,\n            height: 80,\n            background: '#1f2937',\n            borderRadius: '50%',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            margin: '0 auto 24px',\n            fontSize: 32,\n          }}\n        >\n          {contentType === 'music' ? '' : ''}\n        </div>\n        <h2 style={{ color: '#f8fafc', fontSize: 24, marginBottom: 8 }}>{title}</h2>\n        <p style={{ color: '#64748b', marginBottom: 4 }}>by {creator}</p>\n        <p style={{ color: '#94a3b8', marginTop: 16 }}>\n          {contentType === 'music' ? 'Music' : 'Film'} playback coming soon\n        </p>\n      </div>\n    </div>\n  );\n}\n\nexport function ReaderPage() {\n  const { contentId } = useParams<{ contentId: string }>();\n  const navigate = useNavigate();\n  const [content, setContent] = useState<FullContent | null>(null);\n  const [comicData, setComicData] = useState<ComicReaderData | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const progressUpdateTimer = useRef<NodeJS.Timeout | null>(null);\n\n  // Load content\n  useEffect(() => {\n    if (!contentId) return;\n\n    const loadContent = async () => {\n      try {\n        setLoading(true);\n        setError(null);\n        setComicData(null);\n\n        const data = await libraryApi.getFullContent(parseInt(contentId));\n        setContent(data);\n\n        // If it's a comic, also load the comic pages/panels data\n        if (data.content_type === 'comic') {\n          try {\n            const comic = await libraryApi.getComicReaderData(parseInt(contentId));\n            setComicData(comic);\n          } catch (comicErr) {\n            console.error('Failed to load comic data:', comicErr);\n            // Don't fail the whole load, just show an error for comic\n            setError('Failed to load comic pages. Please try again.');\n          }\n        }\n      } catch (err) {\n        setError(err instanceof Error ? err.message : 'Failed to load content');\n        console.error('Content load error:', err);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadContent();\n\n    // Cleanup on unmount\n    return () => {\n      if (progressUpdateTimer.current) {\n        clearTimeout(progressUpdateTimer.current);\n      }\n    };\n  }, [contentId]);\n\n  // Handle page changes for progress tracking (for books)\n  const handlePageChange = useCallback(\n    (page: number, totalPages: number) => {\n      if (!contentId) return;\n\n      const progress = totalPages > 1 ? ((page + 1) / totalPages) * 100 : 100;\n\n      // Debounce API calls\n      if (progressUpdateTimer.current) {\n        clearTimeout(progressUpdateTimer.current);\n      }\n\n      progressUpdateTimer.current = setTimeout(() => {\n        libraryApi\n          .updateProgress(\n            parseInt(contentId),\n            progress,\n            JSON.stringify({ page, totalPages })\n          )\n          .catch((err) => console.error('Failed to update progress:', err));\n      }, 2000);\n    },\n    [contentId]\n  );\n\n  // Handle back navigation\n  const handleBack = useCallback(() => {\n    navigate(-1);\n  }, [navigate]);\n\n  if (loading) {\n    return (\n      <div\n        style={{\n          position: 'fixed',\n          inset: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: '#0a0f1a',\n          color: '#94a3b8',\n          fontSize: 16,\n        }}\n      >\n        <div style={{ textAlign: 'center' }}>\n          <div\n            style={{\n              width: 40,\n              height: 40,\n              border: '3px solid #1f2937',\n              borderTopColor: '#f59e0b',\n              borderRadius: '50%',\n              margin: '0 auto 16px',\n              animation: 'spin 1s linear infinite',\n            }}\n          />\n          Loading content...\n        </div>\n        <style>{`\n          @keyframes spin {\n            to { transform: rotate(360deg); }\n          }\n        `}</style>\n      </div>\n    );\n  }\n\n  if (error || !content) {\n    return (\n      <div\n        style={{\n          position: 'fixed',\n          inset: 0,\n          display: 'flex',\n          alignItems: 'center',\n          justifyContent: 'center',\n          background: '#0a0f1a',\n          padding: 24,\n        }}\n      >\n        <div\n          style={{\n            maxWidth: 400,\n            background: '#ef444420',\n            border: '1px solid #ef4444',\n            borderRadius: 12,\n            padding: 24,\n            textAlign: 'center',\n          }}\n        >\n          <div\n            style={{\n              fontSize: 18,\n              fontWeight: 600,\n              color: '#fca5a5',\n              marginBottom: 8,\n            }}\n          >\n            {error || 'Content not found'}\n          </div>\n          <div style={{ fontSize: 14, color: '#94a3b8', marginBottom: 16 }}>\n            You may not have access to this content.\n          </div>\n          <button\n            onClick={() => navigate('/')}\n            style={{\n              background: '#f59e0b',\n              color: '#111827',\n              padding: '10px 20px',\n              borderRadius: 8,\n              border: 'none',\n              fontWeight: 600,\n              cursor: 'pointer',\n            }}\n          >\n            Go to Home\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  // Render different viewers based on content type\n\n  // Comic viewer\n  if (content.content_type === 'comic') {\n    if (comicData && comicData.pages.length > 0) {\n      return (\n        <ComicReader\n          contentId={contentId || ''}\n          title={content.title}\n          comicData={comicData}\n          onBack={handleBack}\n        />\n      );\n    } else {\n      // Comic data not loaded or no pages\n      return (\n        <div\n          style={{\n            position: 'fixed',\n            inset: 0,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            background: '#0a0f1a',\n            padding: 24,\n          }}\n        >\n          <div style={{ textAlign: 'center' }}>\n            <div style={{ fontSize: 48, marginBottom: 16 }}></div>\n            <div style={{ color: '#f8fafc', fontSize: 20, fontWeight: 600, marginBottom: 8 }}>\n              {content.title}\n            </div>\n            <div style={{ color: '#94a3b8', marginBottom: 24 }}>\n              {error || 'Comic pages not available'}\n            </div>\n            <button\n              onClick={handleBack}\n              style={{\n                background: '#f59e0b',\n                color: '#111827',\n                padding: '10px 20px',\n                borderRadius: 8,\n                border: 'none',\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              Go Back\n            </button>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  // Art viewer\n  if (content.content_type === 'art') {\n    // Art viewer - display the image\n    if (content.teaser_link) {\n      return (\n        <ArtViewer\n          title={content.title}\n          imageUrl={content.teaser_link}\n          creator={content.creator}\n          onBack={handleBack}\n        />\n      );\n    } else {\n      // No image available\n      return (\n        <div\n          style={{\n            position: 'fixed',\n            inset: 0,\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            background: '#0a0f1a',\n            padding: 24,\n          }}\n        >\n          <div style={{ textAlign: 'center' }}>\n            <div style={{ fontSize: 48, marginBottom: 16 }}></div>\n            <div style={{ color: '#f8fafc', fontSize: 20, fontWeight: 600, marginBottom: 8 }}>\n              {content.title}\n            </div>\n            <div style={{ color: '#94a3b8', marginBottom: 24 }}>\n              Image not available\n            </div>\n            <button\n              onClick={handleBack}\n              style={{\n                background: '#f59e0b',\n                color: '#111827',\n                padding: '10px 20px',\n                borderRadius: 8,\n                border: 'none',\n                fontWeight: 600,\n                cursor: 'pointer',\n              }}\n            >\n              Go Back\n            </button>\n          </div>\n        </div>\n      );\n    }\n  }\n\n  // Music/Film placeholder\n  if (content.content_type === 'music' || content.content_type === 'film') {\n    return (\n      <MediaPlaceholder\n        title={content.title}\n        contentType={content.content_type}\n        creator={content.creator}\n        onBack={handleBack}\n      />\n    );\n  }\n\n  // Default: Book reader (KindleReader)\n  // Sanitize the HTML content\n  const sanitizedContent = DOMPurify.sanitize(content.content_html, {\n    ALLOWED_TAGS: [\n      'p',\n      'br',\n      'strong',\n      'em',\n      'u',\n      'i',\n      'b',\n      'h1',\n      'h2',\n      'h3',\n      'h4',\n      'h5',\n      'h6',\n      'ul',\n      'ol',\n      'li',\n      'blockquote',\n      'pre',\n      'code',\n      'a',\n      'img',\n      'div',\n      'span',\n    ],\n    ALLOWED_ATTR: ['href', 'src', 'alt', 'title', 'class', 'id'],\n    FORBID_TAGS: [\n      'script',\n      'style',\n      'iframe',\n      'object',\n      'embed',\n      'form',\n      'input',\n    ],\n    FORBID_ATTR: ['onerror', 'onclick', 'onload', 'onmouseover'],\n    ALLOW_DATA_ATTR: false,\n  });\n\n  return (\n    <KindleReader\n      contentId={contentId || ''}\n      title={content.title}\n      htmlContent={sanitizedContent}\n      onBack={handleBack}\n    />\n  );\n}\n","import React, { forwardRef } from 'react';\nimport { sanitizeHtml } from '../../utils/sanitize';\n\ninterface ReaderContentProps {\n  htmlContent: string;\n  cssVars: Record<string, string>;\n}\n\nexport const ReaderContent = forwardRef<HTMLDivElement, ReaderContentProps>(\n  ({ htmlContent, cssVars }, ref) => {\n    return (\n      <div\n        ref={ref}\n        className=\"reader-content-container\"\n        style={{\n          position: 'fixed',\n          top: '60px',\n          left: 0,\n          right: 0,\n          bottom: '50px',\n          overflow: 'hidden',\n          padding: '20px 24px',\n          boxSizing: 'border-box',\n          background: 'var(--reader-bg)',\n          ...cssVars,\n        }}\n      >\n        <div\n          className=\"reader-content\"\n          dangerouslySetInnerHTML={{ __html: sanitizeHtml(htmlContent) }}\n          style={{\n            height: '100%',\n            columnWidth: '100vw',\n            columnGap: '48px',\n            columnFill: 'auto',\n            fontFamily: 'var(--reader-font-family)',\n            fontSize: 'var(--reader-font-size)',\n            lineHeight: 'var(--reader-line-height)',\n            color: 'var(--reader-text)',\n            textAlign: 'justify',\n            hyphens: 'auto',\n            wordBreak: 'break-word',\n            overflowX: 'hidden',\n            overflowY: 'hidden',\n          }}\n        />\n      </div>\n    );\n  }\n);\n\nReaderContent.displayName = 'ReaderContent';\n\nexport default ReaderContent;\n"],"names":["Download","createLucideIcon","d","key","List","Maximize2","Minimize2","Minus","Moon","Sun","cx","cy","r","TextAlignJustify","TextAlignStart","ZoomIn","x1","x2","y1","y2","ZoomOut","DEFAULT_READER_SETTINGS","fontSize","lineHeight","theme","fontFamily","margins","textAlign","columns","continuousScroll","FONT_SIZE_MAP","xsmall","small","medium","large","xlarge","LINE_HEIGHT_MAP","compact","normal","relaxed","THEME_COLORS","light","background","text","secondary","border","accent","sepia","green","dark","FONT_FAMILY_MAP","name","css","baskerville","bookerly","georgia","palatino","MARGIN_MAP","narrow","wide","STORAGE_KEY","useReaderSettings","settings","setSettings","useState","stored","localStorage","getItem","migrated","oldSettings","migrateSettings","JSON","parse","e","useEffect","setItem","stringify","updateSetting","useCallback","value","prev","resetSettings","cssVars","useMemo","themeClass","ReaderHeader","title","chapterTitle","onBack","onToggleSettings","onToggleTOC","visible","jsxs","className","style","position","top","left","right","height","borderBottom","display","alignItems","justifyContent","padding","zIndex","transition","transform","opacity","children","gap","jsx","onClick","color","cursor","borderRadius","ArrowLeft","size","overflow","fontWeight","margin","whiteSpace","textOverflow","maxWidth","Settings","ReaderFooter","currentPage","totalPages","percentComplete","bottom","borderTop","flexDirection","width","marginBottom","ReaderNavigation","onPrevious","onNext","onCenter","isFirstPage","isLastPage","showArrows","isMobile","headerHeight","footerHeight","sideWidth","centerLeft","centerRight","Fragment","stopPropagation","paddingLeft","role","ChevronLeft","paddingRight","ChevronRight","ReaderSettingsPanel","onClose","activeTab","setActiveTab","fontSizes","currentSizeIndex","indexOf","inset","animation","borderLeft","id","label","map","tab","flex","X","overflowY","flexWrap","keys","fontKey","minWidth","marginTop","type","min","max","length","onChange","parseInt","target","appearance","_","i","spacing","textTransform","themeKey","boxShadow","charAt","toUpperCase","slice","AlignLeft","AlignJustify","Object","marginLeft","viewBox","fill","stroke","strokeWidth","strokeLinecap","strokeLinejoin","defaultValue","disabled","MobileReaderSettings","borderTopLeftRadius","borderTopRightRadius","paddingBottom","maxHeight","Type","Plus","overflowX","WebkitOverflowScrolling","flexShrink","lh","TableOfContents","chapters","currentChapterId","onSelectChapter","borderRight","BookOpen","listStyle","chapter","level","onMouseEnter","currentTarget","onMouseLeave","KindleReader","contentId","htmlContent","navigate","useNavigate","containerRef","useRef","viewportRef","contentRef","showUI","setShowUI","showSettings","setShowSettings","showTOC","setShowTOC","setChapters","setCurrentPage","setTotalPages","pageWidth","setPageWidth","columnWidth","setColumnWidth","isPhone","useMobile","elementRef","isFullscreen","setIsFullscreen","isSupported","document","enterFullscreen","async","el","current","requestFullscreen","webkitRequestFullscreen","err","exitFullscreen","webkitExitFullscreen","toggleFullscreen","handleChange","fullscreenElement","webkitFullscreenElement","addEventListener","removeEventListener","useFullscreen","processedContent","doc","DOMParser","parseFromString","querySelectorAll","forEach","heading","index","body","innerHTML","injectChapterIds","detectedChapters","tagName","toLowerCase","_a","textContent","trim","elementId","push","pageIndex","detectChapters","calculateDimensions","viewport","content","viewportWidth","clientWidth","effectiveCols","requestAnimationFrame","scrollWidth","pages","Math","round","scrollTo","behavior","timer","setTimeout","handleResize","window","clearTimeout","goToPage","page","validPage","nextPage","prevPage","goToStart","goToEnd","currentChapter","getCurrentChapter","handleSelectChapter","toggleUI","handleBack","options","onSwipeLeft","onSwipeRight","onSwipeUp","onSwipeDown","threshold","velocityThreshold","enabled","touchStartRef","touchEndRef","handleTouchStart","touch","touches","x","clientX","y","clientY","time","Date","now","handleTouchMove","deltaX","deltaY","abs","preventDefault","handleTouchEnd","start","end","deltaTime","velocityX","velocityY","element","passive","useSwipeGesture","onFirst","onLast","onEscape","handleKeyDown","HTMLInputElement","HTMLTextAreaElement","HTMLSelectElement","ctrlKey","metaKey","useKeyboardNavigation","onLeftEdge","onRightEdge","edgeThreshold","swipeDistance","screenWidth","innerWidth","isEdge","changedTouches","useEdgeGesture","effectiveColumns","themeStyles","contentMaxWidth","ref","touchAction","scrollbarWidth","msOverflowStyle","dangerouslySetInnerHTML","__html","sanitizeHtml","boxSizing","columnCount","columnGap","columnFill","hyphens","WebkitHyphens","wordBreak","ComicThumbnailSidebar","onSelectPage","backgroundColor","gridTemplateColumns","isActive","aspectRatio","canvas_width","canvas_height","background_color","backgroundImage","background_image","backgroundSize","panels","panel","x_percent","y_percent","width_percent","height_percent","artwork","backgroundPosition","rotation","skew_x","skew_y","transformOrigin","border_radius","ComicReader","comicData","zoom","setZoom","showThumbnails","setShowThumbnails","progressUpdateTimer","total_pages","currentPageData","zoomIn","z","zoomOut","resetZoom","handleFullscreenChange","s","progress","libraryApi","updateProgress","catch","console","error","hideTimer","resetTimer","progressPercent","pointerEvents","creator","Grid3X3","ComicPageRenderer","fitToContainer","ArtViewer","imageUrl","handleZoomIn","handleZoomOut","handleResetZoom","href","download","rel","textDecoration","src","alt","objectFit","draggable","marginInline","MediaPlaceholder","contentType","ReaderPage","useParams","setContent","setComicData","loading","setLoading","setError","data","getFullContent","content_type","comic","getComicReaderData","comicErr","Error","message","loadContent","borderTopColor","teaser_link","sanitizedContent","DOMPurify","sanitize","content_html","ALLOWED_TAGS","ALLOWED_ATTR","FORBID_TAGS","FORBID_ATTR","ALLOW_DATA_ATTR","forwardRef","displayName"],"mappings":"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","x_google_ignoreList":[0,1,2,3,4,5,6,7,8,9,10]}