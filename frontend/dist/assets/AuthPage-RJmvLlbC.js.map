{"version":3,"file":"AuthPage-RJmvLlbC.js","sources":["../../src/pages/AuthPage.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { Link, useNavigate, useSearchParams } from 'react-router-dom';\nimport { Web3Auth } from '@web3auth/modal';\nimport { CHAIN_NAMESPACES, WALLET_ADAPTERS } from '@web3auth/base';\nimport { SolanaPrivateKeyProvider } from '@web3auth/solana-provider';\nimport { OpenloginAdapter } from '@web3auth/openlogin-adapter';\nimport { API_URL } from '../config';\nimport { useAuth } from '../hooks/useAuth';\n// CircleWalletSetup removed - Web3Auth handles wallet creation automatically\n\ntype Step = 'account' | 'wallet' | 'done';\n\ntype WalletChoice = 'web3auth' | 'own' | 'later';\n\nexport default function AuthPage() {\n  const [csrf, setCsrf] = useState('');\n  const [mode, setMode] = useState<'login'|'register'>('register');\n  const [username, setUsername] = useState('');\n  const [email, setEmail] = useState('');\n  const [password, setPassword] = useState('');\n  const [password2, setPassword2] = useState('');\n  const [msg, setMsg] = useState('');\n\n  const [step, setStep] = useState<Step>('account');\n  const [walletChoice, setWalletChoice] = useState<WalletChoice>('web3auth');\n  const [ownWallet, setOwnWallet] = useState('');\n  const [walletStatus, setWalletStatus] = useState('');\n  const navigate = useNavigate();\n  const [web3authInstance, setWeb3authInstance] = useState<any>(null);\n  const { refreshAuth } = useAuth();\n\n  // Beta invite code handling\n  const [searchParams] = useSearchParams();\n  const [inviteCode, setInviteCode] = useState('');\n  const [inviteValid, setInviteValid] = useState<boolean | null>(null);\n  const [inviteEmail, setInviteEmail] = useState('');\n  const [validatingInvite, setValidatingInvite] = useState(false);\n  const [tosAccepted, setTosAccepted] = useState(false);\n\n  const refreshCsrf = async () => {\n    try {\n      const r = await fetch(`${API_URL}/api/auth/csrf/`, { credentials:'include' });\n      const d = await r.json();\n      const token = d?.csrfToken || '';\n      setCsrf(token);\n      return token;\n    } catch {\n      setCsrf('');\n      return '';\n    }\n  };\n\n  useEffect(()=>{ refreshCsrf(); },[]);\n\n  // Validate invite code from URL parameter\n  useEffect(() => {\n    const inviteParam = searchParams.get('invite');\n    if (inviteParam) {\n      setInviteCode(inviteParam);\n      setMode('register'); // Switch to register mode if invite code is present\n      validateInviteCode(inviteParam);\n    }\n  }, [searchParams]);\n\n  const validateInviteCode = async (code: string) => {\n    if (!code || code.trim() === '') {\n      setInviteValid(null);\n      return;\n    }\n\n    setValidatingInvite(true);\n    try {\n      const response = await fetch(`${API_URL}/api/beta/validate/`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({ invite_code: code.trim().toUpperCase() }),\n      });\n\n      const data = await response.json();\n\n      if (data.valid) {\n        setInviteValid(true);\n        setInviteEmail(data.email || '');\n        // Pre-populate email if provided by invite\n        if (data.email && !email) {\n          setEmail(data.email);\n        }\n      } else {\n        setInviteValid(false);\n        setMsg(data.error || 'Invalid invite code');\n      }\n    } catch (error) {\n      console.error('Invite validation error:', error);\n      setInviteValid(false);\n      setMsg('Failed to validate invite code');\n    } finally {\n      setValidatingInvite(false);\n    }\n  };\n\n  const ensureAuthenticated = async () => {\n    try {\n      const st = await fetch(`${API_URL}/api/auth/status/`, { credentials:'include' });\n      const data = await st.json();\n      if (data?.authenticated) return true;\n      // Try programmatic login with provided credentials using custom endpoint\n      const res = await fetch(`${API_URL}/api/users/login/`, {\n        method:'POST',\n        credentials:'include',\n        headers:{\n          'Content-Type':'application/json',\n          'X-CSRFToken': csrf,\n          'X-Requested-With': 'XMLHttpRequest'\n        },\n        body: JSON.stringify({\n          username: username,\n          password: password\n        })\n      });\n      if (res.ok) {\n        await refreshCsrf();\n        return true;\n      }\n    } catch (_) {}\n    return false;\n  };\n\n  const submitAccount = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setMsg('');\n\n    // Beta mode: require invite code\n    if (!inviteCode || inviteCode.trim() === '') {\n      setMsg('Beta invite code is required. Please request access from the beta page.');\n      return;\n    }\n\n    if (!inviteValid) {\n      setMsg('Please provide a valid beta invite code.');\n      return;\n    }\n\n    // Refresh CSRF token right before submission to avoid stale token issues\n    const freshCsrf = await refreshCsrf();\n    if (!freshCsrf) {\n      setMsg('Failed to get CSRF token. Please refresh the page.');\n      return;\n    }\n\n    // Validate password match\n    if (password !== password2) {\n      setMsg('Passwords do not match');\n      return;\n    }\n\n    if (!password || password.length < 6) {\n      setMsg('Password must be at least 6 characters');\n      return;\n    }\n\n    // Require ToS acceptance\n    if (!tosAccepted) {\n      setMsg('Please accept the Terms of Service and Privacy Policy to create an account.');\n      return;\n    }\n\n    // Use DRF signup endpoint with invite code\n    try {\n      const res = await fetch(`${API_URL}/api/users/signup/`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': freshCsrf,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({\n          username: username,\n          email: email || inviteEmail, // Use invite email if not provided\n          invite_code: inviteCode.trim().toUpperCase(),\n          password: password,\n        }),\n      });\n\n      const data = await res.json();\n\n      if (res.ok) {\n        // Signup successful\n        await refreshCsrf();\n        const ok = await ensureAuthenticated();\n        if (!ok) {\n          setMsg('Signed up successfully! Please sign in with your credentials.');\n          setMode('login');\n          return;\n        }\n        // Refresh auth state after successful signup and login\n        refreshAuth();\n        // Circle W3S creates wallet automatically in background\n        // Skip wallet step and go directly to done\n        if (walletChoice === 'web3auth') {\n          // Show success message that wallet is being created\n          setMsg('Account created! Your Solana wallet is being set up automatically.');\n          setStep('done');\n        } else if (walletChoice === 'own') {\n          // User wants to link their own wallet\n          setStep('wallet');\n        } else {\n          // No wallet setup - go to home\n          window.location.href = '/';\n        }\n      } else {\n        // Handle errors from DRF\n        if (data.invite_code) {\n          setMsg(Array.isArray(data.invite_code) ? data.invite_code[0] : data.invite_code);\n        } else if (data.email) {\n          setMsg(Array.isArray(data.email) ? data.email[0] : data.email);\n        } else if (data.username) {\n          setMsg(Array.isArray(data.username) ? data.username[0] : data.username);\n        } else if (data.error) {\n          setMsg(data.error);\n        } else {\n          setMsg('Signup failed. Please check your information and try again.');\n        }\n      }\n    } catch (error) {\n      console.error('Signup error:', error);\n      setMsg('Network error. Please try again.');\n    }\n  };\n\n  const signIn = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setMsg('');\n    // Get fresh CSRF token\n    const freshCsrf = await refreshCsrf();\n    console.log('[Login] Got CSRF token:', freshCsrf ? 'yes' : 'no');\n    if (!freshCsrf) {\n      setMsg('Failed to get CSRF token. Please refresh the page.');\n      return;\n    }\n\n    try {\n      // Use custom DRF login endpoint\n      console.log('[Login] Sending login request...');\n      const res = await fetch(`${API_URL}/api/users/login/`, {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json',\n          'X-CSRFToken': freshCsrf,\n          'X-Requested-With': 'XMLHttpRequest',\n        },\n        body: JSON.stringify({\n          username: username,\n          password: password,\n        }),\n      });\n\n      console.log('[Login] Response status:', res.status);\n      console.log('[Login] Response headers:', [...res.headers.entries()]);\n\n      const data = await res.json();\n      console.log('[Login] Response data:', data);\n\n      if (res.ok) {\n        // Login successful\n        setMsg('Login successful! Redirecting...');\n        console.log('[Login] Cookies after login:', document.cookie);\n\n        // Wait a moment for session to be fully established, then hard reload to profile\n        // Hard reload ensures fresh auth state check\n        setTimeout(() => {\n          console.log('[Login] Redirecting to /profile...');\n          window.location.href = '/profile';\n        }, 500);\n      } else {\n        // Show error from backend\n        setMsg(data.error || 'Invalid username or password');\n      }\n    } catch (error) {\n      console.error('Login error:', error);\n      setMsg('Network error. Please try again.');\n    }\n  };\n\n  const linkWalletWithWeb3Auth = async () => {\n    setWalletStatus('Initializing Web3Auth...');\n    try {\n      if (!csrf) { await refreshCsrf(); }\n      const authOk = await ensureAuthenticated();\n      if (!authOk) { setWalletStatus('Error: Please sign in again, then retry.'); return; }\n      const clientId = import.meta.env.VITE_WEB3AUTH_CLIENT_ID || '';\n      console.log('[Web3Auth Debug] Client ID loaded:', clientId ? 'YES (length: ' + clientId.length + ')' : 'NO');\n      if (!clientId) { setWalletStatus('Error: Missing Web3Auth client ID. Please contact support.'); return; }\n      \n      const chainConfig = {\n        chainNamespace: CHAIN_NAMESPACES.SOLANA,\n        chainId: \"0x3\", // Solana devnet\n        rpcTarget: \"https://api.devnet.solana.com\",\n      };\n      \n      const privateKeyProvider = new SolanaPrivateKeyProvider({\n        config: { chainConfig },\n      });\n\n      setWalletStatus('Connecting to Web3Auth...');\n      const web3auth = new Web3Auth({\n        clientId,\n        web3AuthNetwork: 'sapphire_devnet',\n        chainConfig,\n        privateKeyProvider,\n        uiConfig: {\n          appName: 'renaissBlock',\n          mode: 'dark',\n          theme: {\n            primary: '#f59e0b',\n          },\n        },\n      });\n      \n      // Configure and add OpenLogin adapter\n      const openloginAdapter = new OpenloginAdapter({\n        privateKeyProvider,\n        adapterSettings: {\n          network: 'sapphire_devnet',\n          clientId,\n        },\n      });\n      web3auth.configureAdapter(openloginAdapter as any);\n      console.log('[Web3Auth Debug] OpenLogin adapter configured');\n      \n      setWalletStatus('Initializing Web3Auth modal...');\n      try {\n        // CRITICAL: Use initModal() instead of init() for Web3Auth Modal!\n        await web3auth.initModal();\n        console.log('[Web3Auth Debug] Modal init successful, status:', web3auth.status);\n        console.log('[Web3Auth Debug] Connected:', web3auth.connected);\n        console.log('[Web3Auth Debug] Provider:', !!web3auth.provider);\n      } catch (initError) {\n        console.error('[Web3Auth Debug] Modal init failed:', initError);\n        setWalletStatus(`Error during init: ${initError instanceof Error ? initError.message : String(initError)}`);\n        return;\n      }\n      \n      // IMPORTANT: If already connected, logout first to force fresh login\n      if (web3auth.connected) {\n        console.log('[Web3Auth Debug] Already connected, logging out to force fresh login...');\n        try {\n          await web3auth.logout();\n          console.log('[Web3Auth Debug] Logged out successfully');\n        } catch (logoutError) {\n          console.warn('[Web3Auth Debug] Logout failed (may not matter):', logoutError);\n        }\n      }\n      \n      // Now show modal for fresh login choice\n      setWalletStatus('Opening Web3Auth modal...');\n      console.log('[Web3Auth Debug] Attempting to connect, status:', web3auth.status);\n      console.log('[Web3Auth Debug] Available adapters:', Object.keys(web3auth.walletAdapters || {}));\n      \n      try {\n        // Use connect() to show modal with all login options\n        // User can choose which social account to use\n        const provider = await web3auth.connect();\n        console.log('[Web3Auth Debug] Connect successful, provider:', !!provider);\n      } catch (connectError) {\n        console.error('[Web3Auth Debug] Connect failed:', connectError);\n        console.error('[Web3Auth Debug] Full error:', connectError);\n        setWalletStatus(`Error: ${connectError instanceof Error ? connectError.message : String(connectError)}`);\n        return;\n      }\n      \n      const userInfo: any = await web3auth.getUserInfo();\n      const idToken = userInfo?.idToken || userInfo?.id_token;\n      if (!idToken) { setWalletStatus('Error: Could not obtain Web3Auth token'); return; }\n      \n      setWalletStatus('Linking wallet to your account...');\n      const res = await fetch(`${API_URL}/api/wallet/link/`, {\n        method:'POST', credentials:'include', headers:{ 'Content-Type':'application/json', 'X-CSRFToken': csrf, 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ web3auth_token: idToken })\n      });\n      if (res.ok) {\n        setWalletStatus('âœ… Wallet created and linked successfully!');\n        // Redirect to profile after wallet setup\n        setTimeout(() => window.location.href = '/profile', 1500);\n      } else {\n        const t = await res.text();\n        setWalletStatus(`Error linking wallet: ${t}`);\n      }\n    } catch (e) {\n      setWalletStatus(`Error: ${e instanceof Error ? e.message : String(e)}`);\n    }\n  };\n\n  const continueWithWeb3Auth = async () => {\n    setWalletStatus('Initializing Web3Auth...');\n    try {\n      if (!csrf) { await refreshCsrf(); }\n      const clientId = import.meta.env.VITE_WEB3AUTH_CLIENT_ID || '';\n      if (!clientId) { setWalletStatus('Error: Missing Web3Auth client ID'); return; }\n\n      const chainConfig = {\n        chainNamespace: CHAIN_NAMESPACES.SOLANA,\n        chainId: \"0x3\",\n        rpcTarget: \"https://api.devnet.solana.com\",\n      };\n      const privateKeyProvider = new SolanaPrivateKeyProvider({\n        config: { chainConfig },\n      });\n      \n      setWalletStatus('Connecting to Web3Auth...');\n      const web3auth = new Web3Auth({ \n        clientId,\n        web3AuthNetwork: 'sapphire_devnet',\n        chainConfig, \n        privateKeyProvider,\n        uiConfig: {\n          appName: 'renaissBlock',\n          mode: 'dark',\n          theme: {\n            primary: '#f59e0b',\n          },\n        },\n      });\n\n      // Configure and add OpenLogin adapter\n      const openloginAdapter = new OpenloginAdapter({\n        privateKeyProvider,\n        adapterSettings: {\n          network: 'sapphire_devnet',\n          clientId,\n        },\n      });\n      web3auth.configureAdapter(openloginAdapter as any);\n\n      setWalletStatus('Initializing Web3Auth modal...');\n      await web3auth.initModal();\n      \n      setWalletStatus('Opening Web3Auth modal...');\n      await web3auth.connect();\n      \n      const userInfo: any = await web3auth.getUserInfo();\n      const idToken = userInfo?.idToken || userInfo?.id_token;\n      if (!idToken) { setWalletStatus('Error: Could not obtain Web3Auth token'); return; }\n\n      setWalletStatus('Signing you in...');\n      // Create a session using Web3Auth on the backend\n      const res = await fetch(`${API_URL}/auth/web3/`, {\n        method:'POST', credentials:'include',\n        headers:{ 'Content-Type':'application/json', 'X-CSRFToken': csrf, 'X-Requested-With': 'XMLHttpRequest' },\n        body: JSON.stringify({ token: idToken })\n      });\n      if (!res.ok) {\n        const t = await res.text();\n        setWalletStatus(`Login failed: ${t}`);\n        return;\n      }\n      await refreshCsrf();\n      // Poll auth status once\n      const st = await fetch(`${API_URL}/api/auth/status/`, { credentials:'include' }).then(r=>r.json()).catch(()=>({authenticated:false}));\n      if (st?.authenticated) {\n        // If no wallet present, attempt linking via token (optional)\n        if (!st.wallet_address && idToken) {\n          try {\n            await fetch(`${API_URL}/api/wallet/link/`, {\n              method:'POST', credentials:'include',\n              headers:{ 'Content-Type':'application/json', 'X-CSRFToken': csrf, 'X-Requested-With': 'XMLHttpRequest' },\n              body: JSON.stringify({ web3auth_token: idToken })\n            });\n          } catch {}\n        }\n        setWalletStatus('âœ… Signed in successfully!');\n        setTimeout(() => window.location.href = '/profile', 1000);\n      } else {\n        setWalletStatus('Signed in, but session not detected yet. Please refresh the page.');\n      }\n    } catch (e) {\n      setWalletStatus(`Error: ${e instanceof Error ? e.message : String(e)}`);\n    }\n  };\n\n  const linkOwnWallet = async (e: React.FormEvent) => {\n    e.preventDefault();\n    setWalletStatus('');\n    if (!csrf) { await refreshCsrf(); }\n    const authOk = await ensureAuthenticated();\n    if (!authOk) { setWalletStatus('Please sign in again, then retry.'); return; }\n    const res = await fetch(`${API_URL}/api/wallet/link/`, {\n      method:'POST', credentials:'include', headers:{ 'Content-Type':'application/json', 'X-CSRFToken': csrf, 'X-Requested-With': 'XMLHttpRequest' }, body: JSON.stringify({ wallet_address: ownWallet })\n    });\n    if (res.ok) {\n      setWalletStatus('Wallet linked');\n      // Redirect to profile after wallet setup\n      setTimeout(() => window.location.href = '/profile', 500);\n    } else {\n      const t = await res.text();\n      setWalletStatus(`Failed: ${t}`);\n    }\n  };\n\n  const AccountStep = (\n    <div className=\"page\" style={{maxWidth:480, margin:'40px auto'}}>\n      <div style={{display:'flex', gap:8, marginBottom:16}}>\n        <button className={mode==='login'? 'chip active':'chip'} onClick={()=>setMode('login')}>Sign in</button>\n        <button className={mode==='register'? 'chip active':'chip'} onClick={()=>setMode('register')}>Create account</button>\n      </div>\n\n      {mode==='login' ? (\n        <div style={{display:'grid', gap:12}}>\n          <form onSubmit={signIn} style={{display:'grid', gap:12}}>\n            <input value={username} onChange={(e)=>setUsername(e.target.value)} placeholder=\"Username\" required />\n            <input type=\"password\" value={password} onChange={(e)=>setPassword(e.target.value)} placeholder=\"Password\" required />\n            <button type=\"submit\" style={{marginTop:6}}>Sign in</button>\n          </form>\n        </div>\n      ) : (\n        <form onSubmit={submitAccount} style={{display:'grid', gap:12}}>\n          {/* Beta Invite Code */}\n          <div style={{display:'grid', gap:6}}>\n            <input\n              value={inviteCode}\n              onChange={(e)=> {\n                const code = e.target.value;\n                setInviteCode(code);\n                if (code.trim().length >= 8) {\n                  validateInviteCode(code);\n                }\n              }}\n              placeholder=\"Beta Invite Code (required)\"\n              required\n              style={{\n                border: inviteValid === true ? '1px solid #10b981' : inviteValid === false ? '1px solid #ef4444' : undefined\n              }}\n            />\n            {validatingInvite && (\n              <div style={{fontSize:12, color:'#94a3b8'}}>Validating invite code...</div>\n            )}\n            {inviteValid === true && (\n              <div style={{fontSize:12, color:'#10b981'}}>âœ“ Valid invite code for {inviteEmail}</div>\n            )}\n            {inviteValid === false && (\n              <div style={{fontSize:12, color:'#ef4444'}}>âœ— Invalid or expired invite code</div>\n            )}\n          </div>\n\n          <input value={username} onChange={(e)=>setUsername(e.target.value)} placeholder=\"Username\" required />\n          <input\n            type=\"email\"\n            value={email}\n            onChange={(e)=>setEmail(e.target.value)}\n            placeholder={inviteEmail ? `Email (${inviteEmail})` : \"Email\"}\n            required\n          />\n          <input type=\"password\" value={password} onChange={(e)=>setPassword(e.target.value)} placeholder=\"Password\" required />\n          <input type=\"password\" value={password2} onChange={(e)=>setPassword2(e.target.value)} placeholder=\"Confirm password\" required />\n\n          {/* Terms of Service Acceptance */}\n          <div style={{marginTop:12, padding:12, background:'rgba(255,255,255,0.03)', borderRadius:8, border:'1px solid #334155'}}>\n            <label style={{display:'flex', alignItems:'flex-start', gap:10, fontSize:13, color:'#cbd5e1', cursor:'pointer'}}>\n              <input\n                type=\"checkbox\"\n                checked={tosAccepted}\n                onChange={(e)=> setTosAccepted(e.target.checked)}\n                required\n                style={{marginTop:3}}\n              />\n              <span>\n                I agree to the{' '}\n                <a href=\"/legal/terms\" target=\"_blank\" rel=\"noopener noreferrer\" style={{color:'#f59e0b', textDecoration:'none'}}>\n                  Terms of Service\n                </a>{' '}\n                and{' '}\n                <a href=\"/legal/privacy\" target=\"_blank\" rel=\"noopener noreferrer\" style={{color:'#f59e0b', textDecoration:'none'}}>\n                  Privacy Policy\n                </a>\n              </span>\n            </label>\n          </div>\n\n          <div style={{display:'grid', gap:8, marginTop:8}}>\n            <label style={{display:'flex', alignItems:'center', gap:8, fontSize:13, color:'#cbd5e1'}}>\n              <input type=\"checkbox\" checked={walletChoice==='web3auth'} onChange={(e)=> setWalletChoice(e.target.checked? 'web3auth' : 'later')} />\n              Set up a free Solana wallet for me (automatically created)\n              <Link to=\"/wallet-info\" style={{marginLeft:6, color:'#60a5fa'}}>Learn more</Link>\n            </label>\n            <div style={{display:'flex', gap:12, fontSize:13}}>\n              <button type=\"button\" onClick={()=> setWalletChoice('own')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>I'll use my own wallet</button>\n              <button type=\"button\" onClick={()=> setWalletChoice('later')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>I'll set up a wallet later</button>\n            </div>\n            {walletChoice==='own' && (\n              <input value={ownWallet} onChange={(e)=>setOwnWallet(e.target.value)} placeholder=\"Your Solana wallet address\" />\n            )}\n          </div>\n\n          <button type=\"submit\" style={{marginTop:6}}>Create account</button>\n        </form>\n      )}\n\n      <div style={{marginTop:10, fontSize:12, color:'#94a3b8'}}>{msg || 'Your session is secured with CSRF & cookies.'}</div>\n    </div>\n  );\n\n  const WalletStep = (\n    <div className=\"page\" style={{maxWidth:480, margin:'40px auto'}}>\n      <div style={{fontWeight:700, color:'#e5e7eb', marginBottom:8}}>Create your wallet</div>\n      {walletChoice==='web3auth' && (\n        <div style={{display:'grid', gap:10}}>\n          <div style={{fontSize:13, color:'#94a3b8'}}>We'll automatically create a Solana wallet for you. No seed phrases needed!</div>\n          <button onClick={linkWalletWithWeb3Auth}>Continue</button>\n          <div style={{display:'flex', gap:12}}>\n            <button onClick={()=> setStep('account')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>Back to account</button>\n            <button onClick={()=> setStep('done')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>Skip for now</button>\n          </div>\n          <div style={{fontSize:12, color:'#94a3b8'}}>{walletStatus}</div>\n        </div>\n      )}\n      {walletChoice==='own' && (\n        <form onSubmit={linkOwnWallet} style={{display:'grid', gap:10}}>\n          <input value={ownWallet} onChange={(e)=>setOwnWallet(e.target.value)} placeholder=\"Your Solana wallet address\" />\n          <div style={{display:'flex', gap:8}}>\n            <button type=\"submit\">Link wallet</button>\n            <button type=\"button\" onClick={()=> setStep('account')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>Back</button>\n            <button type=\"button\" onClick={()=> setStep('done')} style={{background:'transparent', border:'none', color:'#94a3b8', textDecoration:'underline', cursor:'pointer'}}>Skip</button>\n          </div>\n          <div style={{fontSize:12, color:'#94a3b8'}}>{walletStatus}</div>\n        </form>\n      )}\n    </div>\n  );\n\n  const DoneStep = (\n    <div className=\"page\" style={{maxWidth:480, margin:'40px auto', textAlign:'center'}}>\n      <div>\n        <div style={{fontSize:18, fontWeight:700, color:'#e5e7eb', marginBottom:8}}>\n          Welcome to renaissBlock! ðŸŽ‰\n        </div>\n        <div style={{fontSize:13, color:'#94a3b8', marginBottom:16}}>\n          {walletChoice === 'web3auth'\n            ? 'Your Web3Auth wallet has been created automatically. You can now receive NFTs and payments!'\n            : 'You can link a wallet anytime from your profile to receive NFTs and payments.'}\n        </div>\n        <div style={{display:'flex', gap:8, justifyContent:'center'}}>\n          <button onClick={()=> window.location.href = '/'}>Go to Home</button>\n          <button onClick={()=> window.location.href = '/profile'}>Go to Profile</button>\n        </div>\n      </div>\n    </div>\n  );\n\n  const stepIndex = step === 'account' ? 0 : step === 'wallet' ? 1 : 2;\n  const stepLabels = ['Account', 'Wallet', 'Done'];\n\n  const Stepper = (\n    <div style={{display:'flex', justifyContent:'center', gap:16, alignItems:'center', maxWidth:800, margin:'24px auto', padding:'0 20px'}}>\n      {stepLabels.map((label, i)=> {\n        const current = i === stepIndex;\n        const completed = i < stepIndex;\n        return (\n          <div key={label} style={{flex: 1, maxWidth: 200}}>\n            <div style={{display:'flex', flexDirection:'column', alignItems:'center', gap:8}}>\n              <div style={{width:32, height:32, borderRadius:999, border:'2px solid ' + (current || completed ? '#f59e0b' : '#334155'), background: current? '#f59e0b': completed? '#f59e0b' : 'transparent', color: current || completed? '#111':'#94a3b8', display:'grid', placeItems:'center', fontSize:14, fontWeight:700, transition: 'all 0.3s'}}>{i+1}</div>\n              <div style={{fontSize:13, color: current? '#f59e0b' : completed? '#cbd5e1' : '#64748b', fontWeight: current? 700:500, textAlign:'center'}}>{label}</div>\n            </div>\n            <div style={{height:2, marginTop:8, borderRadius:999, background: current? 'linear-gradient(90deg, #f59e0b 0%, rgba(245,158,11,0.3) 100%)' : completed ? '#f59e0b' : '#334155', transition: 'all 0.3s'}} />\n          </div>\n        );\n      })}\n    </div>\n  );\n\n  return (\n    <div>\n      {/* Only show stepper on Create account flow */}\n      {mode === 'register' && Stepper}\n      {step==='account' && AccountStep}\n      {step==='wallet' && WalletStep}\n      {step==='done' && DoneStep}\n    </div>\n  );\n}\n"],"names":["AuthPage","csrf","setCsrf","useState","mode","setMode","username","setUsername","email","setEmail","password","setPassword","password2","setPassword2","msg","setMsg","step","setStep","walletChoice","setWalletChoice","ownWallet","setOwnWallet","walletStatus","setWalletStatus","useNavigate","web3authInstance","setWeb3authInstance","refreshAuth","useAuth","searchParams","useSearchParams","inviteCode","setInviteCode","inviteValid","setInviteValid","inviteEmail","setInviteEmail","validatingInvite","setValidatingInvite","tosAccepted","setTosAccepted","refreshCsrf","async","r","fetch","API_URL","credentials","d","json","token","csrfToken","useEffect","inviteParam","get","validateInviteCode","code","trim","response","method","headers","body","JSON","stringify","invite_code","toUpperCase","data","valid","error","ensureAuthenticated","st","authenticated","ok","_","AccountStep","jsxs","className","style","maxWidth","margin","children","display","gap","marginBottom","jsx","onClick","onSubmit","e","preventDefault","freshCsrf","res","setTimeout","window","location","href","value","onChange","target","placeholder","required","type","marginTop","length","Array","isArray","border","fontSize","color","padding","background","borderRadius","alignItems","cursor","checked","rel","textDecoration","Link","to","marginLeft","WalletStep","fontWeight","clientId","chainConfig","chainNamespace","CHAIN_NAMESPACES","SOLANA","chainId","rpcTarget","privateKeyProvider","SolanaPrivateKeyProvider","config","web3auth","Web3Auth","web3AuthNetwork","uiConfig","appName","theme","primary","openloginAdapter","OpenloginAdapter","adapterSettings","network","configureAdapter","initModal","initError","Error","message","String","connected","logout","logoutError","connect","connectError","userInfo","getUserInfo","idToken","id_token","web3auth_token","t","text","wallet_address","DoneStep","textAlign","justifyContent","stepIndex","Stepper","map","label","i","current","completed","flex","flexDirection","width","height","placeItems","transition"],"mappings":"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"}