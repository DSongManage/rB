import{j as e}from"./web3auth-C90gi1IA.js";import{r as t,a,L as r}from"./router-zDWjfnwa.js";import{B as o,C as n,a as s,A as i}from"./index-Cj3Sp_jx.js";import{S as l,V as d}from"./VideoCard-R5VQjtuU.js";import{E as c}from"./eye-CUhOvgrV.js";import{T as u}from"./thumbs-up-CQVLSRDa.js";import"./vendor-Cfs_Iq82.js";import"./star-fJ5n-MoV.js";function p(e){return e>=1e6?`${(e/1e6).toFixed(1)}M`:e>=1e3?`${(e/1e3).toFixed(1)}K`:`${e}`}const b=t.memo(function({id:i,title:d,coverImageUrl:b,author:g,chapters:h,publishedChapters:f,totalViews:x,totalLikes:m,totalPrice:v,averageRating:j,ratingCount:y,timeText:w}){const[k,_]=t.useState(!1),S=a(),C=h.find(e=>e.content_id),$=f>1,z=x>=100,T=x>=1e3;return!(null!=j&&y>0)||(Number(j).toFixed(1),p(y)),e.jsxs("div",{className:"yt-card",style:{background:"#0f172a",border:"1px solid #1e293b",borderRadius:16,overflow:"hidden",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-4px)",e.currentTarget.style.boxShadow="0 8px 24px rgba(0,0,0,0.25)",e.currentTarget.style.borderColor="#334155"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="none",e.currentTarget.style.borderColor="#1e293b"},children:[e.jsxs("div",{onClick:()=>{$?_(!k):C&&S(`/content/${C.content_id}`)},style:{width:"100%",paddingTop:"56.25%",background:b?`url(${b})`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",backgroundSize:"cover",backgroundPosition:"center",position:"relative",cursor:"pointer"},children:[!b&&e.jsx("div",{style:{position:"absolute",inset:0,display:"grid",placeItems:"center",color:"rgba(255,255,255,0.3)"},children:e.jsx(o,{size:48})}),$&&e.jsxs("div",{style:{position:"absolute",top:8,right:8,background:"rgba(0,0,0,0.85)",backdropFilter:"blur(4px)",padding:"4px 10px",borderRadius:12,fontSize:12,fontWeight:600,color:"#f8fafc"},children:[f," chapters"]}),v>0&&e.jsxs("div",{style:{position:"absolute",top:$?40:8,right:8,background:"rgba(0,0,0,0.8)",backdropFilter:"blur(4px)",padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:700,color:"#10b981"},children:["$",v.toFixed(2)]})]}),e.jsxs("div",{style:{padding:16},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8},children:[e.jsx("div",{style:{fontSize:15,fontWeight:600,color:"#f8fafc",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:d}),x>0&&e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:3,fontSize:11,fontWeight:T?700:z?600:500,color:T?"#f59e0b":z?"#10b981":"#94a3b8",background:T?"rgba(245, 158, 11, 0.15)":z?"rgba(16, 185, 129, 0.1)":"transparent",padding:z?"2px 6px":"0",borderRadius:4,flexShrink:0},children:[e.jsx(c,{size:12}),p(x)]})]}),e.jsxs("div",{style:{fontSize:13,color:"#94a3b8",marginBottom:12,display:"flex",alignItems:"center",gap:6,flexWrap:"wrap"},children:[e.jsx(r,{to:`/profile/${g}`,style:{color:"#60a5fa",textDecoration:"none"},onClick:e=>e.stopPropagation(),children:g}),e.jsx("span",{children:"•"}),e.jsx(l,{rating:j,count:y,size:11}),e.jsx("span",{children:"•"}),e.jsxs("span",{style:{display:"inline-flex",alignItems:"center",gap:2},children:[e.jsx(u,{size:12})," ",p(m)]}),e.jsx("span",{children:"•"}),e.jsx("span",{children:w})]}),$&&e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>_(!k),style:{width:"100%",background:"#1e293b",border:"none",borderRadius:8,padding:"8px 12px",color:"#94a3b8",fontSize:13,fontWeight:500,cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsx("span",{children:"Chapters"}),k?e.jsx(n,{size:16}):e.jsx(s,{size:16})]}),k&&e.jsx("div",{style:{background:"#0d1117",borderRadius:8,padding:8,marginTop:8,maxHeight:200,overflowY:"auto"},children:h.map((t,a)=>e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"8px 10px",borderRadius:6,background:a%2==0?"transparent":"rgba(255,255,255,0.02)"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:13,color:"#e2e8f0",fontWeight:500,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:["Ch ",t.order+1,": ",t.title]}),e.jsxs("div",{style:{fontSize:11,color:"#64748b"},children:["$",t.price_usd.toFixed(2)," • ",t.view_count," views"]})]}),e.jsx("button",{onClick:e=>{var a;e.stopPropagation(),a=t.content_id,S(`/content/${a}`)},style:{background:"transparent",border:"1px solid #334155",borderRadius:6,padding:"4px 10px",color:"#94a3b8",fontSize:11,fontWeight:500,cursor:"pointer",marginLeft:8,flexShrink:0},children:"View"})]},t.id))})]})]})]})});function g({label:a,value:r,options:o,onChange:n}){var i;const[l,d]=t.useState(!1),c=t.useRef(null),u=(null==(i=o.find(e=>e.value===r))?void 0:i.label)||r;return t.useEffect(()=>{function e(e){c.current&&!c.current.contains(e.target)&&d(!1)}if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),e.jsxs("div",{className:"filter-dropdown",ref:c,children:[e.jsxs("button",{onClick:()=>d(!l),type:"button",children:[a,": ",u,e.jsx(s,{size:14,style:{transition:"transform 0.2s",transform:l?"rotate(180deg)":"rotate(0deg)"}})]}),l&&e.jsx("div",{className:"dropdown-menu",children:o.map(t=>e.jsx("button",{type:"button",className:t.value===r?"active":"",onClick:()=>{n(t.value),d(!1)},children:t.label},t.value))})]})}const h=[{label:"All",value:"all"},{label:"Books",value:"book"},{label:"Comics",value:"comic"},{label:"Art",value:"art"},{label:"Film",value:"film",comingSoon:!0},{label:"Music",value:"music",comingSoon:!0}],f=[{label:"All Genres",value:"all"},{label:"Fantasy",value:"fantasy"},{label:"Sci-Fi",value:"scifi"},{label:"Drama",value:"drama"},{label:"Comedy",value:"comedy"},{label:"Nonfiction",value:"nonfiction"}],x=[{label:"Newest",value:"newest"},{label:"Most Popular",value:"popular"},{label:"Highest Rated",value:"rated"},{label:"Best Sellers",value:"bestsellers"}];function m(){const[a,r]=t.useState([]),[o,n]=t.useState([]),[s,l]=t.useState("all"),[c,u]=t.useState("all"),[p,m]=t.useState("newest");t.useEffect(()=>{const e=new AbortController,t="all"!==c?`&genre=${c}`:"",a=fetch(`${i}/api/content/?sort=${p}${t}`,{credentials:"include",signal:e.signal}).then(e=>e.json()).then(e=>e&&Array.isArray(e.results)?e.results.filter(e=>"book"!==e.content_type):Array.isArray(e)?e.filter(e=>"book"!==e.content_type):[]),o=fetch(`${i}/api/book-projects/public/?sort=${p}${t}`,{credentials:"include",signal:e.signal}).then(e=>e.json()).then(e=>Array.isArray(e)?e:[]);return Promise.all([a,o]).then(([e,t])=>{r(e),n(t)}).catch(e=>{"AbortError"!==e.name&&(r([]),n([]))}),()=>e.abort()},[p,c]);const v=e=>{if(!e)return"Recently";const t=new Date(e),a=new Date,r=Math.floor((a.getTime()-t.getTime())/1e3);return r<60?"Just now":r<3600?`${Math.floor(r/60)} minutes ago`:r<86400?`${Math.floor(r/3600)} hours ago`:r<604800?`${Math.floor(r/86400)} days ago`:`${Math.floor(r/604800)} weeks ago`},j=t.useMemo(()=>{const e=e=>{if("book"===e.type){const t=e.data;switch(p){case"popular":case"bestsellers":return t.total_views||0;case"rated":return 1e4*(t.average_rating||0)+(t.rating_count||0);default:return t.created_at?new Date(t.created_at).getTime():0}}else{const t=e.data;switch(p){case"popular":case"bestsellers":return t.view_count||0;case"rated":return 1e4*(t.average_rating||0)+(t.rating_count||0);default:return t.created_at?new Date(t.created_at).getTime():0}}},t=[];return a.forEach(e=>{t.push({type:"content",data:e})}),o.forEach(e=>{t.push({type:"book",data:e})}),t.sort((t,a)=>e(a)-e(t)),t},[a,o,p]),y=t.useMemo(()=>"all"===s?j:j.filter(e=>"book"===e.type?"book"===s:e.data.content_type===s),[j,s]);return e.jsxs("div",{children:[e.jsxs("div",{className:"filter-bar",children:[e.jsx("div",{className:"filter-tabs",children:h.map(t=>e.jsxs("button",{className:"filter-tab "+(s===t.value?"active":""),onClick:()=>!t.comingSoon&&l(t.value),disabled:t.comingSoon,children:[t.label,t.comingSoon&&e.jsx("span",{className:"coming-soon-badge",children:"Soon"})]},t.value))}),e.jsx("div",{style:{flex:1}}),e.jsx(g,{label:"Genre",value:c,options:f,onChange:u}),e.jsx(g,{label:"Sort",value:p,options:x,onChange:m})]}),e.jsx("div",{className:"page",style:{padding:0,background:"transparent",border:"none",boxShadow:"none"},children:e.jsx("div",{className:"yt-grid",children:y.map(t=>{var a;if("book"===t.type){const a=t.data;return e.jsx(b,{id:a.id,title:a.title,coverImageUrl:a.cover_image_url||"",author:a.creator_username,chapters:a.chapters,publishedChapters:a.published_chapters,totalViews:a.total_views,totalLikes:a.total_likes,totalPrice:a.total_price,averageRating:a.average_rating,ratingCount:a.rating_count,timeText:v(a.created_at)},`book-${a.id}`)}{const r=t.data;return e.jsx(d,{id:r.id,title:r.title,author:r.creator_username||`Creator #${r.creator??0}`,likeCount:r.like_count,viewCount:r.view_count,averageRating:r.average_rating,ratingCount:r.rating_count,timeText:v(r.created_at),thumbnailUrl:r.teaser_link||"",price:r.price_usd,editions:r.editions,owned:r.owned,isCollaborative:r.is_collaborative,collaborators:null==(a=r.collaborators)?void 0:a.map(e=>e.username)},`content-${r.id}`)}})})})]})}export{m as default};
