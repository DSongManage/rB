{"version":3,"file":"ComicPageRenderer-MQBfulIT.js","sources":["../../src/components/reader/SpeechBubbleDisplay.tsx","../../src/components/reader/ComicPanelDisplay.tsx","../../src/components/reader/ComicPageRenderer.tsx"],"sourcesContent":["/**\n * SpeechBubbleDisplay Component\n *\n * Read-only display of speech bubbles in comic panels.\n * Supports various bubble types with appropriate styling.\n */\n\nimport React from 'react';\nimport { SpeechBubbleData } from '../../services/libraryApi';\n\ninterface SpeechBubbleDisplayProps {\n  bubble: SpeechBubbleData;\n}\n\nexport function SpeechBubbleDisplay({ bubble }: SpeechBubbleDisplayProps) {\n  // Get bubble border radius based on type\n  const getBubbleBorderRadius = (): string => {\n    switch (bubble.bubble_type) {\n      case 'oval':\n      case 'thought':\n        return '50%';\n      case 'shout':\n      case 'burst':\n        return '8px';\n      case 'narrative':\n      case 'caption':\n        return '4px';\n      case 'whisper':\n        return '40%';\n      case 'radio':\n        return '12px';\n      default:\n        return '50%';\n    }\n  };\n\n  // Get additional styling based on bubble type\n  const getBubbleTypeStyle = (): React.CSSProperties => {\n    const baseStyle: React.CSSProperties = {};\n\n    switch (bubble.bubble_type) {\n      case 'thought':\n        // Thought bubbles have a cloud-like appearance\n        baseStyle.boxShadow = '4px 4px 0 rgba(0,0,0,0.1)';\n        break;\n      case 'shout':\n        // Shout bubbles are more angular\n        baseStyle.fontWeight = 'bold';\n        break;\n      case 'whisper':\n        // Whisper bubbles are subtle\n        baseStyle.opacity = 0.9;\n        baseStyle.fontStyle = 'italic';\n        break;\n      case 'narrative':\n      case 'caption':\n        // Narrative boxes are rectangular\n        baseStyle.fontStyle = 'italic';\n        break;\n      case 'radio':\n        // Radio/electronic speech\n        baseStyle.border = `2px dashed ${bubble.border_color}`;\n        break;\n    }\n\n    return baseStyle;\n  };\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        left: `${bubble.x_percent}%`,\n        top: `${bubble.y_percent}%`,\n        width: `${bubble.width_percent}%`,\n        height: `${bubble.height_percent}%`,\n        zIndex: bubble.z_index,\n        backgroundColor: bubble.background_color || '#ffffff',\n        border: `${bubble.border_width}px solid ${bubble.border_color || '#000000'}`,\n        borderRadius: getBubbleBorderRadius(),\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        padding: '8%',\n        boxSizing: 'border-box',\n        overflow: 'hidden',\n        ...getBubbleTypeStyle(),\n      }}\n    >\n      <span\n        style={{\n          fontFamily: bubble.font_family || 'Comic Sans MS, cursive, sans-serif',\n          fontSize: `${bubble.font_size || 14}px`,\n          color: bubble.font_color || '#000000',\n          fontWeight: bubble.font_weight || 'normal',\n          fontStyle: bubble.font_style || 'normal',\n          textAlign: (bubble.text_align as 'left' | 'center' | 'right') || 'center',\n          lineHeight: 1.3,\n          wordWrap: 'break-word',\n          overflowWrap: 'break-word',\n          width: '100%',\n        }}\n      >\n        {bubble.text}\n      </span>\n    </div>\n  );\n}\n\nexport default SpeechBubbleDisplay;\n","/**\n * ComicPanelDisplay Component\n *\n * Read-only display of comic panels with artwork and speech bubbles.\n * Supports positioning, transforms (rotation, skew), and border styling.\n */\n\nimport React from 'react';\nimport { ComicPanelData } from '../../services/libraryApi';\nimport { SpeechBubbleDisplay } from './SpeechBubbleDisplay';\n\ninterface ComicPanelDisplayProps {\n  panel: ComicPanelData;\n}\n\nexport function ComicPanelDisplay({ panel }: ComicPanelDisplayProps) {\n  // Build CSS transform string\n  const buildTransform = (): string => {\n    const transforms: string[] = [];\n\n    if (panel.rotation) {\n      transforms.push(`rotate(${panel.rotation}deg)`);\n    }\n    if (panel.skew_x) {\n      transforms.push(`skewX(${panel.skew_x}deg)`);\n    }\n    if (panel.skew_y) {\n      transforms.push(`skewY(${panel.skew_y}deg)`);\n    }\n\n    return transforms.length > 0 ? transforms.join(' ') : 'none';\n  };\n\n  // Get border style (handle special styles like jagged, wavy)\n  const getBorderStyle = (): string => {\n    switch (panel.border_style) {\n      case 'jagged':\n      case 'wavy':\n        return 'solid'; // These would need CSS clip-path for proper effect\n      case 'none':\n        return 'none';\n      default:\n        return panel.border_style || 'solid';\n    }\n  };\n\n  return (\n    <div\n      style={{\n        position: 'absolute',\n        left: `${panel.x_percent}%`,\n        top: `${panel.y_percent}%`,\n        width: `${panel.width_percent}%`,\n        height: `${panel.height_percent}%`,\n        zIndex: panel.z_index,\n        transform: buildTransform(),\n        transformOrigin: 'center center',\n      }}\n    >\n      {/* Panel frame with border */}\n      <div\n        style={{\n          width: '100%',\n          height: '100%',\n          border:\n            panel.border_style !== 'none'\n              ? `${panel.border_width || 2}px ${getBorderStyle()} ${panel.border_color || '#000000'}`\n              : 'none',\n          borderRadius: panel.border_radius || 0,\n          backgroundColor: panel.background_color || '#ffffff',\n          position: 'relative',\n          overflow: 'hidden',\n          boxSizing: 'border-box',\n        }}\n      >\n        {/* Panel artwork */}\n        {panel.artwork && (\n          <img\n            src={panel.artwork}\n            alt=\"\"\n            style={{\n              position: 'absolute',\n              top: 0,\n              left: 0,\n              width: '100%',\n              height: '100%',\n              objectFit: (panel.artwork_fit as 'cover' | 'contain' | 'fill') || 'cover',\n            }}\n            draggable={false}\n          />\n        )}\n\n        {/* Speech bubbles - sorted by z-index */}\n        {panel.speech_bubbles &&\n          [...panel.speech_bubbles]\n            .sort((a, b) => a.z_index - b.z_index)\n            .map((bubble) => <SpeechBubbleDisplay key={bubble.id} bubble={bubble} />)}\n      </div>\n    </div>\n  );\n}\n\nexport default ComicPanelDisplay;\n","/**\n * ComicPageRenderer Component\n *\n * Renders a single comic page with all its panels.\n * Maintains aspect ratio and supports zoom.\n * When fitToContainer is true, scales to fit within parent bounds (like object-fit: contain).\n */\n\nimport React, { useRef, useState, useEffect } from 'react';\nimport { ComicPageData } from '../../services/libraryApi';\nimport { ComicPanelDisplay } from './ComicPanelDisplay';\n\ninterface ComicPageRendererProps {\n  page: ComicPageData;\n  zoom: number;\n  /** When true, scales page to fit within container bounds (like object-fit: contain) */\n  fitToContainer?: boolean;\n}\n\nexport function ComicPageRenderer({ page, zoom, fitToContainer = false }: ComicPageRendererProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [containerSize, setContainerSize] = useState({ width: 0, height: 0 });\n\n  // Calculate aspect ratio from canvas dimensions\n  const aspectRatio = page.canvas_width / page.canvas_height;\n\n  // Observe container size changes when fitToContainer is enabled\n  useEffect(() => {\n    if (!fitToContainer || !containerRef.current) return;\n\n    const observer = new ResizeObserver((entries) => {\n      const entry = entries[0];\n      if (entry) {\n        setContainerSize({\n          width: entry.contentRect.width,\n          height: entry.contentRect.height,\n        });\n      }\n    });\n\n    observer.observe(containerRef.current);\n    return () => observer.disconnect();\n  }, [fitToContainer]);\n\n  // Calculate fitted dimensions when fitToContainer is enabled\n  let pageWidth: number | string = zoom <= 1 ? `calc(100% * ${zoom})` : `${zoom * 100}%`;\n  let pageHeight: number | string = 'auto';\n  let useAspectRatio = true;\n\n  if (fitToContainer && containerSize.width > 0 && containerSize.height > 0) {\n    const containerAspect = containerSize.width / containerSize.height;\n\n    if (aspectRatio > containerAspect) {\n      // Page is wider than container - constrain by width\n      pageWidth = containerSize.width;\n      pageHeight = containerSize.width / aspectRatio;\n    } else {\n      // Page is taller than container - constrain by height\n      pageHeight = containerSize.height;\n      pageWidth = containerSize.height * aspectRatio;\n    }\n    useAspectRatio = false; // We're setting explicit dimensions\n  }\n\n  return (\n    <div\n      ref={containerRef}\n      style={{\n        width: '100%',\n        height: '100%',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        overflow: fitToContainer ? 'hidden' : (zoom > 1 ? 'auto' : 'hidden'),\n      }}\n    >\n      <div\n        style={{\n          width: pageWidth,\n          height: fitToContainer ? pageHeight : 'auto',\n          maxWidth: fitToContainer ? 'none' : (zoom <= 1 ? '100%' : 'none'),\n          aspectRatio: useAspectRatio ? `${aspectRatio}` : undefined,\n          maxHeight: fitToContainer ? 'none' : (zoom <= 1 ? '100%' : 'none'),\n          position: 'relative',\n          backgroundColor: page.background_color || '#ffffff',\n          backgroundImage: page.background_image ? `url(${page.background_image})` : undefined,\n          backgroundSize: 'cover',\n          backgroundPosition: 'center',\n          boxShadow: '0 4px 20px rgba(0, 0, 0, 0.3)',\n          transition: fitToContainer ? 'none' : 'width 0.2s ease, max-width 0.2s ease',\n        }}\n      >\n        {/* Render all panels sorted by z-index */}\n        {page.panels &&\n          [...page.panels]\n            .sort((a, b) => a.z_index - b.z_index)\n            .map((panel) => <ComicPanelDisplay key={panel.id} panel={panel} />)}\n      </div>\n    </div>\n  );\n}\n\nexport default ComicPageRenderer;\n"],"names":["SpeechBubbleDisplay","bubble","jsx","style","position","left","x_percent","top","y_percent","width","width_percent","height","height_percent","zIndex","z_index","backgroundColor","background_color","border","border_width","border_color","borderRadius","bubble_type","getBubbleBorderRadius","display","alignItems","justifyContent","padding","boxSizing","overflow","baseStyle","boxShadow","fontWeight","opacity","fontStyle","getBubbleTypeStyle","children","fontFamily","font_family","fontSize","font_size","color","font_color","font_weight","font_style","textAlign","text_align","lineHeight","wordWrap","overflowWrap","text","ComicPanelDisplay","panel","transform","transforms","rotation","push","skew_x","skew_y","length","join","buildTransform","transformOrigin","jsxs","border_style","getBorderStyle","border_radius","artwork","src","alt","objectFit","artwork_fit","draggable","speech_bubbles","sort","a","b","map","id","ComicPageRenderer","page","zoom","fitToContainer","containerRef","useRef","containerSize","setContainerSize","useState","aspectRatio","canvas_width","canvas_height","useEffect","current","observer","ResizeObserver","entries","entry","contentRect","observe","disconnect","pageWidth","pageHeight","useAspectRatio","ref","maxWidth","maxHeight","backgroundImage","background_image","backgroundSize","backgroundPosition","transition","panels"],"mappings":"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"}