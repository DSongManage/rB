import{j as e}from"./web3auth-BCRZXB2Y.js";import{r as t}from"./router-zDWjfnwa.js";import{c as i}from"./regionCalculator-D3m0QDUE.js";function n({bubble:t}){return e.jsx("div",{style:{position:"absolute",left:`${t.x_percent}%`,top:`${t.y_percent}%`,width:`${t.width_percent}%`,height:`${t.height_percent}%`,zIndex:t.z_index,backgroundColor:t.background_color||"#ffffff",border:`${t.border_width}px solid ${t.border_color||"#000000"}`,borderRadius:(()=>{switch(t.bubble_type){case"oval":case"thought":default:return"50%";case"shout":case"burst":return"8px";case"narrative":case"caption":return"4px";case"whisper":return"40%";case"radio":return"12px"}})(),display:"flex",alignItems:"center",justifyContent:"center",padding:"8%",boxSizing:"border-box",overflow:"hidden",...(()=>{const e={};switch(t.bubble_type){case"thought":e.boxShadow="4px 4px 0 rgba(0,0,0,0.1)";break;case"shout":e.fontWeight="bold";break;case"whisper":e.opacity=.9,e.fontStyle="italic";break;case"narrative":case"caption":e.fontStyle="italic";break;case"radio":e.border=`2px dashed ${t.border_color}`}return e})()},children:e.jsx("span",{style:{fontFamily:t.font_family||"Comic Sans MS, cursive, sans-serif",fontSize:`${t.font_size||14}px`,color:t.font_color||"#000000",fontWeight:t.font_weight||"normal",fontStyle:t.font_style||"normal",textAlign:t.text_align||"center",lineHeight:1.3,wordWrap:"break-word",overflowWrap:"break-word",width:"100%"},children:t.text})})}function o(e,t,i){return e.map(e=>`${e.x},${e.y}`).join(" ")}function r(e,t,i,n){if(0===t.length)return null;const o=e.centroid.x/i*100,r=e.centroid.y/n*100;let a=null,s=1/0;for(const c of t){const e=Number(c.x_percent),t=Number(c.y_percent),i=e+Number(c.width_percent)/2-o,n=t+Number(c.height_percent)/2-r,d=Math.sqrt(i*i+n*n);d<s&&(s=d,a=c)}return s<20?a:null}function a({page:a,zoom:s,fitToContainer:c=!1}){const d=t.useRef(null),[h,l]=t.useState({width:0,height:0}),u=a.canvas_width/a.canvas_height;t.useEffect(()=>{if(!c||!d.current)return;const e=new ResizeObserver(e=>{const t=e[0];t&&l({width:t.contentRect.width,height:t.contentRect.height})});return e.observe(d.current),()=>e.disconnect()},[c]);const _=t.useMemo(()=>a.divider_lines?a.divider_lines.map(e=>({id:e.id,line_type:e.line_type,start_x:e.start_x,start_y:e.start_y,end_x:e.end_x,end_y:e.end_y,control1_x:e.control1_x,control1_y:e.control1_y,control2_x:e.control2_x,control2_y:e.control2_y})):[],[a.divider_lines]),p=t.useMemo(()=>i(_,a.canvas_width,a.canvas_height),[_,a.canvas_width,a.canvas_height]),f=t.useMemo(()=>{const e=new Map,t=new Set,i=a.panels.filter(e=>e.artwork);for(const n of p){const o=r(n,i.filter(e=>!t.has(e.id)),a.canvas_width,a.canvas_height);o&&(e.set(n.id,o),t.add(o.id))}return e},[p,a.panels,a.canvas_width,a.canvas_height]);let g=s<=1?`calc(100% * ${s})`:100*s+"%",b="auto",x=!0,v=a.canvas_width,w=a.canvas_height;if(c&&h.width>0&&h.height>0){const e=.92*h.width,t=.92*h.height;u>e/t?(v=e,w=e/u):(w=t,v=t*u),g=v*s,b=w*s,x=!1}return c&&0!==h.width||(v=a.canvas_width,w=a.canvas_height),a.canvas_width,a.canvas_height,e.jsx("div",{ref:d,style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",overflow:s>1?"auto":"hidden"},children:e.jsxs("div",{style:{width:g,height:c?b:"auto",maxWidth:c?"none":s<=1?"100%":"none",aspectRatio:x?`${u}`:void 0,maxHeight:c?"none":s<=1?"100%":"none",position:"relative",backgroundColor:a.background_color||"#ffffff",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",transition:c?"none":"width 0.2s ease, max-width 0.2s ease",flexShrink:0},children:[e.jsxs("svg",{width:"100%",height:"100%",viewBox:`0 0 ${a.canvas_width} ${a.canvas_height}`,preserveAspectRatio:"xMidYMid meet",style:{position:"absolute",top:0,left:0,width:"100%",height:"100%"},children:[a.background_image&&e.jsx("image",{href:a.background_image,x:0,y:0,width:a.canvas_width,height:a.canvas_height,preserveAspectRatio:"xMidYMid slice"}),e.jsx("defs",{children:p.map(t=>e.jsx("clipPath",{id:`reader-clip-${t.id}`,children:e.jsx("polygon",{points:o(t.vertices,a.canvas_width,a.canvas_height)})},`clip-${t.id}`))}),p.map((t,i)=>{const n=f.get(t.id),r=null==n?void 0:n.artwork,s=(null==n?void 0:n.background_color)||"#ffffff",c=(null==n?void 0:n.border_color)||"#000000",d=(null==n?void 0:n.border_width)??2,h=(null==n?void 0:n.border_style)||"solid";return e.jsxs("g",{children:[e.jsx("polygon",{points:o(t.vertices,a.canvas_width,a.canvas_height),fill:s,stroke:"none"!==h?c:"none",strokeWidth:"none"!==h?d:0}),r&&e.jsx("image",{href:r,x:t.bounds.x,y:t.bounds.y,width:t.bounds.width,height:t.bounds.height,preserveAspectRatio:"xMidYMid slice",clipPath:`url(#reader-clip-${t.id})`})]},t.id)})]}),a.panels&&a.panels.flatMap(t=>(t.speech_bubbles||[]).map(t=>e.jsx(n,{bubble:t},t.id)))]})})}export{a as C};
