import{j as e}from"./web3auth-BkZxjmxM.js";import{r as t,L as n}from"./router-cVcvJ1e3.js";import{s as r}from"./regionCalculator-D3m0QDUE.js";import{c as o,C as i,a,l as s,p as l,q as d,A as c,r as p,X as u,j as f,k as x}from"./index-BYzJnJSi.js";import{i as g,t as h,j as b,k as y,l as m,m as j,n as v}from"./socialApi-Cb9Ttka4.js";import{T as k}from"./thumbs-up-DGd6HW0S.js";import{P as w}from"./pen-DsKOlKRC.js";import{T as S}from"./trash-2-DbJ4fhGs.js";import{S as C}from"./send-C6UydW2f.js";import{C as z}from"./check-D0lPLnyu.js";import{C as R}from"./circle-alert-DiDbGN_S.js";import{C as I}from"./ComicPageRenderer-CwRtV7NI.js";import{M as L}from"./message-circle-eFF5QS9d.js";
/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const T=o("reply",[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]]),A=o("share-2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);function W({contentId:n,initialLiked:r=!1,initialCount:o=0,size:i="md",showCount:a=!0,className:s="",onAuthRequired:l,isAuthenticated:d=!0}){const{liked:c,likeCount:p,isLoading:u,toggle:f}=function(e,n={}){const[r,o]=t.useState(n.initialLiked??!1),[i,a]=t.useState(n.initialCount??0),[s,l]=t.useState(!1),[d,c]=t.useState(null),p=t.useRef(!1),u=t.useRef(0),f=t.useCallback(async()=>{try{const t=await g(e);o(t.liked),a(t.like_count),c(null)}catch(t){}},[e]),x=t.useCallback(async()=>{if(p.current)return;const t=Date.now();if(t-u.current<500)return;u.current=t,p.current=!0;const n=r,s=i;o(!r),a(r?i-1:i+1),c(null),l(!0);try{const t=await h(e);o(t.liked),a(t.like_count)}catch(d){o(n),a(s);const e=d instanceof Error?d.message:"Failed to toggle like";e.includes("throttle")||c(e)}finally{l(!1),p.current=!1}},[e,r,i]);return t.useEffect(()=>{void 0!==n.initialLiked&&o(n.initialLiked),void 0!==n.initialCount&&a(n.initialCount)},[n.initialLiked,n.initialCount]),{liked:r,likeCount:i,isLoading:s,error:d,toggle:x,refresh:f}}(n,{initialLiked:r,initialCount:o}),x={sm:{icon:18,padding:"6px 10px",fontSize:12},md:{icon:22,padding:"8px 14px",fontSize:14},lg:{icon:26,padding:"10px 18px",fontSize:16}}[i];return e.jsxs("button",{onClick:async e=>{e.preventDefault(),e.stopPropagation(),d?await f():null==l||l()},disabled:u,className:s,style:{display:"inline-flex",alignItems:"center",gap:8,padding:x.padding,background:c?"rgba(59, 130, 246, 0.15)":"rgba(255, 255, 255, 0.05)",border:"1px solid "+(c?"rgba(59, 130, 246, 0.3)":"rgba(255, 255, 255, 0.1)"),borderRadius:10,cursor:u?"not-allowed":"pointer",opacity:u?.6:1,transition:"all 0.2s ease"},onMouseEnter:e=>{u||(e.currentTarget.style.background=c?"rgba(59, 130, 246, 0.25)":"rgba(255, 255, 255, 0.1)",e.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.background=c?"rgba(59, 130, 246, 0.15)":"rgba(255, 255, 255, 0.05)",e.currentTarget.style.transform="scale(1)"},"aria-label":c?"Unlike":"Like",children:[e.jsx(k,{size:x.icon,fill:c?"#3b82f6":"transparent",color:c?"#3b82f6":"#94a3b8",style:{transition:"all 0.2s ease"}}),a&&e.jsx("span",{style:{fontSize:x.fontSize,fontWeight:600,color:c?"#3b82f6":"#cbd5e1"},children:p>0?p.toLocaleString():"Like"})]})}function _({comment:r,onReply:o,onEdit:s,onDelete:l,onLoadReplies:d,isAuthenticated:c=!1,currentUsername:p,depth:u=0,maxDepth:f=3}){const[x,g]=t.useState(!1),[h,b]=t.useState(!1),[y,m]=t.useState(""),[j,v]=t.useState(r.text),[k,z]=t.useState(!1),[R,I]=t.useState(!1),[L,A]=t.useState([]),[W,E]=t.useState(!1),D=async()=>{if(!R&&r.replies_count>0){E(!0);try{const e=await d(r.id);A(e)}finally{E(!1)}}I(!R)},M=c&&u<f,$=Math.min(20*u,60),P={display:"inline-flex",alignItems:"center",gap:4,background:"transparent",border:"none",padding:"4px 8px",borderRadius:6,fontSize:12,color:"#64748b",cursor:"pointer",transition:"all 0.15s ease"};return e.jsxs("div",{style:{marginLeft:`${$}px`},children:[e.jsx("div",{style:{padding:"12px 0"},children:e.jsxs("div",{style:{display:"flex",gap:12},children:[r.author_avatar?e.jsx("img",{src:r.author_avatar,alt:r.author_username,style:{width:36,height:36,borderRadius:"50%",objectFit:"cover",flexShrink:0}}):e.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:14,fontWeight:600,flexShrink:0},children:r.author_username.charAt(0).toUpperCase()}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,flexWrap:"wrap",marginBottom:4},children:[e.jsxs(n,{to:`/profile/${r.author_username}`,style:{fontWeight:600,color:"#f1f5f9",textDecoration:"none",fontSize:13},children:["@",r.author_username]}),e.jsx("span",{style:{fontSize:11,color:"#64748b"},children:(e=>{const t=new Date,n=new Date(e),r=Math.floor((t.getTime()-n.getTime())/1e3);return r<60?"just now":r<3600?`${Math.floor(r/60)}m ago`:r<86400?`${Math.floor(r/3600)}h ago`:r<2592e3?`${Math.floor(r/86400)}d ago`:n.toLocaleDateString()})(r.created_at)}),r.edited&&e.jsx("span",{style:{fontSize:11,color:"#475569"},children:"(edited)"})]}),h?e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),j.trim()){z(!0);try{await s(r.id,j),b(!1)}finally{z(!1)}}},style:{marginTop:8},children:[e.jsx("textarea",{value:j,onChange:e=>v(e.target.value),rows:2,disabled:k,style:{width:"100%",padding:"10px 12px",background:"#0f172a",border:"1px solid #334155",borderRadius:8,color:"#f1f5f9",fontSize:13,resize:"none",outline:"none"}}),e.jsxs("div",{style:{display:"flex",gap:8,marginTop:8},children:[e.jsx("button",{type:"submit",disabled:k||!j.trim(),style:{padding:"6px 12px",background:"#8b5cf6",border:"none",borderRadius:6,color:"#fff",fontSize:12,fontWeight:500,cursor:"pointer",opacity:k||!j.trim()?.5:1},children:k?"Saving...":"Save"}),e.jsx("button",{type:"button",onClick:()=>{b(!1),v(r.text)},style:{padding:"6px 12px",background:"#334155",border:"none",borderRadius:6,color:"#94a3b8",fontSize:12,fontWeight:500,cursor:"pointer"},children:"Cancel"})]})]}):e.jsx("p",{style:{color:"#cbd5e1",fontSize:14,lineHeight:1.6,margin:0,whiteSpace:"pre-wrap"},children:r.text}),!h&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:4,marginTop:8},children:[M&&e.jsxs("button",{onClick:()=>g(!x),style:P,onMouseEnter:e=>e.currentTarget.style.color="#a78bfa",onMouseLeave:e=>e.currentTarget.style.color="#64748b",children:[e.jsx(T,{size:14}),"Reply"]}),r.can_edit&&e.jsxs("button",{onClick:()=>b(!0),style:P,onMouseEnter:e=>e.currentTarget.style.color="#a78bfa",onMouseLeave:e=>e.currentTarget.style.color="#64748b",children:[e.jsx(w,{size:14}),"Edit"]}),r.can_delete&&e.jsxs("button",{onClick:async()=>{confirm("Are you sure you want to delete this comment?")&&await l(r.id)},style:P,onMouseEnter:e=>e.currentTarget.style.color="#ef4444",onMouseLeave:e=>e.currentTarget.style.color="#64748b",children:[e.jsx(S,{size:14}),"Delete"]}),r.replies_count>0&&e.jsx("button",{onClick:D,style:{...P,color:"#8b5cf6"},children:R?e.jsxs(e.Fragment,{children:[e.jsx(i,{size:14}),"Hide replies"]}):e.jsxs(e.Fragment,{children:[e.jsx(a,{size:14}),W?"Loading...":`${r.replies_count} replies`]})})]}),x&&e.jsxs("form",{onSubmit:async e=>{if(e.preventDefault(),y.trim()){z(!0);try{await o(y,r.id),m(""),g(!1),await D()}finally{z(!1)}}},style:{marginTop:12},children:[e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"flex-end"},children:[e.jsx("textarea",{value:y,onChange:e=>m(e.target.value),placeholder:`Reply to @${r.author_username}...`,rows:2,disabled:k,style:{flex:1,padding:"10px 12px",background:"#0f172a",border:"1px solid #334155",borderRadius:8,color:"#f1f5f9",fontSize:13,resize:"none",outline:"none"}}),e.jsx("button",{type:"submit",disabled:k||!y.trim(),style:{padding:"10px 14px",background:y.trim()?"#8b5cf6":"#334155",border:"none",borderRadius:8,color:y.trim()?"#fff":"#64748b",cursor:k||!y.trim()?"not-allowed":"pointer"},children:e.jsx(C,{size:16})})]}),e.jsx("button",{type:"button",onClick:()=>{g(!1),m("")},style:{background:"transparent",border:"none",color:"#64748b",fontSize:12,cursor:"pointer",marginTop:6},children:"Cancel"})]})]})]})}),R&&L.length>0&&e.jsx("div",{style:{borderLeft:"2px solid #1e293b",marginLeft:18},children:L.map(t=>e.jsx(_,{comment:t,onReply:o,onEdit:s,onDelete:l,onLoadReplies:d,isAuthenticated:c,currentUsername:p,depth:u+1,maxDepth:f},t.id))})]})}function E({contentId:n,isAuthenticated:r=!1,currentUsername:o,onAuthRequired:i}){const[a,l]=t.useState(""),[d,c]=t.useState(!1),{comments:p,isLoading:u,error:f,hasMore:x,totalCount:g,loadMore:h,addComment:k,editComment:w,removeComment:S,loadReplies:z}=function(e){const[n,r]=t.useState([]),[o,i]=t.useState(!1),[a,s]=t.useState(null),[l,d]=t.useState(1),[c,p]=t.useState(!1),[u,f]=t.useState(0),x=t.useRef(!1),g=t.useRef(!1),h=t.useCallback(async(t,n=!1)=>{if(!x.current){x.current=!0,i(!0),s(null);try{const o=await b(e,t,!0);r(e=>n?[...e,...o.results]:o.results),p(null!==o.next),f(o.count),d(t)}catch(o){const e=o instanceof Error?o.message:"Failed to load comments";e.includes("throttle")||s(e)}finally{i(!1),x.current=!1}}},[e]),k=t.useCallback(async()=>{await h(1,!1)},[h]),w=t.useCallback(async()=>{o||!c||x.current||await h(l+1,!0)},[h,o,c,l]),S=t.useCallback(async(t,n)=>{const o=await y(e,t,n);return n?r(e=>e.map(e=>e.id===n?{...e,replies_count:e.replies_count+1}:e)):(r(e=>[o,...e]),f(e=>e+1)),o},[e]),C=t.useCallback(async(e,t)=>{const n=await m(e,t);r(t=>t.map(t=>t.id===e?n:t))},[]),z=t.useCallback(async e=>{await j(e),r(t=>t.filter(t=>t.id!==e)),f(e=>e-1)},[]),R=t.useCallback(async e=>await v(e),[]);return t.useEffect(()=>{g.current||(g.current=!0,h(1,!1))},[e]),t.useEffect(()=>()=>{g.current=!1},[e]),{comments:n,isLoading:o,error:a,hasMore:c,totalCount:u,loadMore:w,refresh:k,addComment:S,editComment:C,removeComment:z,loadReplies:R}}(n),R=async(e,t)=>{await k(e,t)};return e.jsxs("div",{style:{background:"#0f172a",borderRadius:16,border:"1px solid #1e293b",overflow:"hidden"},children:[e.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid #1e293b",display:"flex",alignItems:"center",gap:10},children:[e.jsx(s,{size:20,color:"#8b5cf6"}),e.jsx("h3",{style:{margin:0,fontSize:18,fontWeight:700,color:"#f1f5f9"},children:"Comments"}),g>0&&e.jsx("span",{style:{background:"#1e293b",color:"#94a3b8",padding:"4px 10px",borderRadius:12,fontSize:13,fontWeight:500},children:g})]}),e.jsxs("div",{style:{padding:"20px 24px"},children:[e.jsx("form",{onSubmit:async e=>{if(e.preventDefault(),r){if(a.trim()){c(!0);try{await k(a),l("")}finally{c(!1)}}}else null==i||i()},style:{marginBottom:24},children:e.jsxs("div",{style:{display:"flex",gap:12,alignItems:"flex-start"},children:[e.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:r?"linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)":"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:16,fontWeight:600,flexShrink:0},children:o?o.charAt(0).toUpperCase():"?"}),e.jsxs("div",{style:{flex:1},children:[e.jsx("textarea",{value:a,onChange:e=>l(e.target.value),placeholder:r?"Share your thoughts...":"Sign in to leave a comment",rows:3,disabled:!r||d,onClick:()=>{r||null==i||i()},style:{width:"100%",padding:"12px 14px",background:"#1e293b",border:"1px solid #334155",borderRadius:12,color:"#f1f5f9",fontSize:14,resize:"none",outline:"none",transition:"border-color 0.2s",cursor:r?"text":"pointer"},onFocus:e=>{r&&(e.target.style.borderColor="#8b5cf6")},onBlur:e=>e.target.style.borderColor="#334155"}),r&&e.jsx("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:12},children:e.jsxs("button",{type:"submit",disabled:d||!a.trim(),style:{display:"flex",alignItems:"center",gap:8,padding:"10px 20px",background:a.trim()?"linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%)":"#334155",border:"none",borderRadius:10,color:a.trim()?"#fff":"#64748b",fontSize:14,fontWeight:600,cursor:d||!a.trim()?"not-allowed":"pointer",opacity:d?.7:1,transition:"all 0.2s ease"},children:[e.jsx(C,{size:16}),d?"Posting...":"Post Comment"]})})]})]})}),f&&e.jsx("p",{style:{fontSize:13,color:"#ef4444",marginBottom:16,padding:"10px 14px",background:"rgba(239, 68, 68, 0.1)",borderRadius:8},children:f}),u&&0===p.length?e.jsx("div",{style:{textAlign:"center",padding:"32px 0",color:"#64748b",fontSize:14},children:"Loading comments..."}):0===p.length?e.jsx("div",{style:{textAlign:"center",padding:"32px 0",color:"#64748b",fontSize:14},children:"No comments yet. Be the first to comment!"}):e.jsxs(e.Fragment,{children:[e.jsx("div",{children:p.map(t=>e.jsx("div",{style:{borderBottom:"1px solid #1e293b"},children:e.jsx(_,{comment:t,onReply:R,onEdit:w,onDelete:S,onLoadReplies:z,isAuthenticated:r,currentUsername:o})},t.id))}),x&&e.jsx("button",{onClick:h,disabled:u,style:{width:"100%",marginTop:16,padding:"12px",background:"transparent",border:"1px solid #334155",borderRadius:10,color:"#8b5cf6",fontSize:14,fontWeight:600,cursor:u?"not-allowed":"pointer",opacity:u?.6:1,transition:"all 0.2s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(139, 92, 246, 0.1)",e.currentTarget.style.borderColor="#8b5cf6"},onMouseLeave:e=>{e.currentTarget.style.background="transparent",e.currentTarget.style.borderColor="#334155"},children:u?"Loading...":"Load More Comments"})]})]})]})}function D({chapterId:n,contentId:r,price:o,alreadyOwned:i=!1,compact:a=!1,onSuccess:s,className:c=""}){const{addToCart:p,cart:u,error:f,isInCart:x}=l(),[g,h]=t.useState(!1),[b,y]=t.useState(null),[m,j]=t.useState(!1),v=x(n||r||0,n?"chapter":"content"),k=!!(u&&u.item_count>=u.max_items);return i?e.jsxs("button",{disabled:!0,className:`rb-cart-btn rb-cart-btn--owned ${c}`,style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:a?"6px 12px":"10px 16px",backgroundColor:"var(--bg-success, #064e3b)",color:"var(--text-success, #10b981)",border:"1px solid var(--border-success, #10b981)",borderRadius:"8px",cursor:"not-allowed",fontSize:a?"13px":"14px",fontWeight:500},children:[e.jsx(z,{size:a?14:16}),"Owned"]}):v||m?e.jsxs("button",{disabled:!0,className:`rb-cart-btn rb-cart-btn--in-cart ${c}`,style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:a?"6px 12px":"10px 16px",backgroundColor:"var(--bg-info, #1e3a5f)",color:"var(--text-info, #60a5fa)",border:"1px solid var(--border-info, #3b82f6)",borderRadius:"8px",cursor:"not-allowed",fontSize:a?"13px":"14px",fontWeight:500},children:[e.jsx(z,{size:a?14:16}),m?"Added!":"In Cart"]}):e.jsxs("div",{style:{display:"inline-flex",flexDirection:"column",gap:"4px"},children:[e.jsxs("button",{onClick:async function(){if(i||v||k||g)return;h(!0),y(null),await p(n,r)?(j(!0),setTimeout(()=>j(!1),2e3),null==s||s()):y(f||"Failed to add to cart"),h(!1)},disabled:g||k,className:`rb-cart-btn rb-cart-btn--add ${c}`,style:{display:"inline-flex",alignItems:"center",gap:"6px",padding:a?"6px 12px":"10px 16px",backgroundColor:g||k?"var(--bg-disabled, #475569)":"var(--accent, #3b82f6)",color:"white",border:"none",borderRadius:"8px",cursor:g||k?"not-allowed":"pointer",fontSize:a?"13px":"14px",fontWeight:500,transition:"all 0.2s ease"},children:[e.jsx(d,{size:a?14:16}),g?"Adding...":a?`$${o}`:`Add to Cart - $${o}`]}),b&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:"var(--text-error, #ef4444)",fontSize:"12px"},children:[e.jsx(R,{size:12}),b]}),k&&e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px",color:"var(--text-warning, #f59e0b)",fontSize:"12px"},children:[e.jsx(R,{size:12}),"Cart full (max ",null==u?void 0:u.max_items,")"]})]})}function M({open:o,onClose:i,teaserUrl:a,contentType:s,contentId:l,price:d,editions:g,isCollaborative:h=!1,collaborators:b=[],creatorUsername:y,creatorAvatar:m,title:j,likeCount:v=0,userHasLiked:k=!1,commentCount:w=0}){const S=s||"book",[C,z]=t.useState(""),[R,T]=t.useState(!0),[_,M]=t.useState(!1),[$,P]=t.useState(!1),[N,B]=t.useState(!1),[F,U]=t.useState(),[O,q]=t.useState(null),[H,Y]=t.useState(0);t.useEffect(()=>{o&&fetch(`${c}/api/auth/status/`,{credentials:"include"}).then(e=>e.ok?e.json():null).then(e=>{B(!!(null==e?void 0:e.username)),U(null==e?void 0:e.username)}).catch(()=>{})},[o]),t.useEffect(()=>{const e=e=>{"Escape"===e.key&&o&&i()};return o&&(window.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{window.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[o,i]),t.useEffect(()=>{let e=!0;return o&&"book"===S&&a?(T(!0),fetch(a,{credentials:"include"}).then(e=>e.ok?e.text():"").then(t=>{e&&(z(String(t||"")),T(!1))}).catch(()=>{e&&(z("<p>Preview unavailable</p>"),T(!1))})):T(!1),()=>{e=!1}},[o,S,a]),t.useEffect(()=>{let e=!0;return o&&"comic"===S&&l&&(T(!0),Y(0),p.getComicPreviewData(l).then(t=>{e&&(q(t),T(!1))}).catch(()=>{e&&(q(null),T(!1))})),()=>{e=!1}},[o,S,l]);const X=t.useMemo(()=>r(C),[C]),J=void 0!==g&&g>0,G=d&&d>0?`$${d.toFixed(2)}`:"Free";return o?e.jsx("div",{style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.9)",backdropFilter:"blur(8px)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:2e3,padding:20},onClick:e=>{e.target===e.currentTarget&&i()},children:e.jsxs("div",{style:{display:"flex",gap:0,maxWidth:1200,width:"100%",height:"90vh",maxHeight:800},children:[e.jsxs("div",{style:{flex:1,background:"#0f172a",borderRadius:"16px 0 0 16px",overflow:"hidden",display:"flex",flexDirection:"column",position:"relative"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",borderBottom:"1px solid #1e293b",background:"#0b1220"},children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[e.jsx("span",{style:{color:"#f1f5f9",fontWeight:600,fontSize:16},children:j||"Preview"}),void 0!==g&&e.jsx("span",{style:{background:g>0?"rgba(16, 185, 129, 0.15)":"rgba(239, 68, 68, 0.15)",color:g>0?"#10b981":"#ef4444",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600},children:g>0?`${g} available`:"Sold out"})]}),e.jsx("button",{onClick:i,style:{background:"transparent",border:"none",color:"#94a3b8",cursor:"pointer",padding:8,borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(u,{size:24})})]}),e.jsxs("div",{style:{flex:1,overflow:"auto",padding:16},children:["book"===S&&e.jsx("div",{style:{width:"100%",height:"100%",overflow:"auto",padding:16,background:"#0b1220",borderRadius:8,position:"relative"},children:R?e.jsx("div",{style:{color:"#94a3b8",textAlign:"center",padding:40},children:"Loading preview..."}):X?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"content-display",dangerouslySetInnerHTML:{__html:X}}),e.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",display:"flex",flexWrap:"wrap",alignContent:"flex-start",justifyContent:"center",gap:"60px 80px",padding:40,overflow:"hidden"},children:Array.from({length:30}).map((t,n)=>e.jsx("div",{style:{color:"rgba(148, 163, 184, 0.08)",fontSize:16,fontWeight:600,transform:"rotate(-25deg)",whiteSpace:"nowrap",userSelect:"none",letterSpacing:2},children:"renaissBlock"},n))})]}):e.jsx("div",{style:{color:"#94a3b8",textAlign:"center",padding:40},children:"No preview available"})}),"art"===S&&e.jsxs("div",{style:{display:"grid",placeItems:"center",height:"100%",position:"relative"},children:[e.jsx("img",{src:a,alt:"preview",style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain",borderRadius:8}}),e.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",display:"flex",flexWrap:"wrap",alignContent:"center",justifyContent:"center",gap:"40px 60px",overflow:"hidden"},children:Array.from({length:40}).map((t,n)=>e.jsx("div",{style:{color:"rgba(255, 255, 255, 0.2)",fontSize:14,fontWeight:700,transform:"rotate(-30deg)",whiteSpace:"nowrap",userSelect:"none",letterSpacing:3,textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"renaissBlock"},n))})]}),"film"===S&&e.jsx("video",{src:a,controls:!0,style:{width:"100%",height:"100%",borderRadius:8}}),"music"===S&&e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:e.jsx("audio",{src:a,controls:!0,style:{width:"100%",maxWidth:500}})}),"comic"===S&&e.jsx("div",{style:{display:"flex",flexDirection:"column",height:"100%",position:"relative"},children:R?e.jsx("div",{style:{color:"#94a3b8",textAlign:"center",padding:40},children:"Loading comic preview..."}):O&&O.pages.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center"},children:e.jsx(I,{page:O.pages[H],zoom:1,fitToContainer:!0})}),H>0&&e.jsx("button",{onClick:()=>Y(e=>Math.max(0,e-1)),style:{position:"absolute",left:16,top:"50%",transform:"translateY(-50%)",background:"rgba(0,0,0,0.7)",border:"none",borderRadius:"50%",width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",zIndex:10},children:e.jsx(f,{size:28})}),H<O.pages.length-1&&e.jsx("button",{onClick:()=>Y(e=>Math.min(O.pages.length-1,e+1)),style:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",background:"rgba(0,0,0,0.7)",border:"none",borderRadius:"50%",width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",color:"#fff",zIndex:10},children:e.jsx(x,{size:28})}),e.jsx("div",{style:{position:"absolute",inset:0,pointerEvents:"none",display:"flex",flexWrap:"wrap",alignContent:"center",justifyContent:"center",gap:"40px 60px",overflow:"hidden"},children:Array.from({length:20}).map((t,n)=>e.jsx("div",{style:{color:"rgba(255, 255, 255, 0.15)",fontSize:14,fontWeight:700,transform:"rotate(-30deg)",whiteSpace:"nowrap",userSelect:"none",letterSpacing:3,textShadow:"0 1px 2px rgba(0,0,0,0.5)"},children:"renaissBlock"},n))})]}),e.jsxs("div",{style:{padding:"12px 16px",background:"rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:8,marginTop:12},children:[e.jsxs("span",{style:{color:"#94a3b8",fontSize:13},children:["Page ",H+1," of ",O.preview_pages]}),e.jsxs("span",{style:{color:"#f59e0b",fontSize:13,fontWeight:600},children:["Preview (",O.preview_pages," of ",O.total_pages," pages)"]})]})]}):e.jsx("div",{style:{color:"#94a3b8",textAlign:"center",padding:40},children:"No comic preview available"})})]}),l&&J&&e.jsxs("div",{style:{padding:"16px 20px",borderTop:"1px solid #1e293b",background:"#0b1220",display:"flex",alignItems:"center",justifyContent:"center",gap:12},children:[N&&d&&d>0&&e.jsx(D,{contentId:l,price:d.toFixed(2)}),e.jsx("button",{onClick:async()=>{if(l){M(!0);try{const e=function(){const e=document.cookie.match(/csrftoken=([^;]+)/);return e?e[1]:""}(),t=await fetch(`${c}/api/checkout/session/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":e},credentials:"include",body:JSON.stringify({content_id:l})}),n=await t.json();if(!t.ok)return void("NOT_MINTED"===(null==n?void 0:n.code)?alert("Content not available for purchase"):"SOLD_OUT"===(null==n?void 0:n.code)?alert("This content is sold out"):"ALREADY_OWNED"===(null==n?void 0:n.code)?alert("You already own this content"):"NO_BUYER_WALLET"===(null==n?void 0:n.code)?alert("Please set up your wallet in your profile before purchasing"):"NO_CREATOR_WALLET"===(null==n?void 0:n.code)?alert("Creator wallet not configured. Please contact support."):"STRIPE_ERROR"===(null==n?void 0:n.code)?alert("Payment system error. Please try again."):alert((null==n?void 0:n.error)||"Checkout failed"));(null==n?void 0:n.checkout_url)?window.location.href=n.checkout_url:alert("No checkout URL received")}catch{alert("Failed to initiate checkout. Please try again.")}finally{M(!1)}}},disabled:_,style:{background:_?"#475569":"linear-gradient(135deg, #10b981 0%, #059669 100%)",color:"#fff",border:"none",borderRadius:10,padding:"14px 40px",cursor:_?"not-allowed":"pointer",fontSize:16,fontWeight:700,transition:"all 0.2s"},children:_?"Processing...":`Buy Now ${G}`})]})]}),e.jsxs("div",{style:{width:$?380:72,background:"#0b1220",borderRadius:"0 16px 16px 0",borderLeft:"1px solid #1e293b",display:"flex",flexDirection:"column",transition:"width 0.3s ease",overflow:"hidden"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 0",gap:8,borderBottom:$?"1px solid #1e293b":"none"},children:[e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4},children:[l&&e.jsx(W,{contentId:l,initialCount:v,initialLiked:k,isAuthenticated:N,onAuthRequired:()=>window.location.href="/auth",size:"lg",showCount:!1}),e.jsx("span",{style:{fontSize:12,color:"#94a3b8",fontWeight:500},children:v>0?v.toLocaleString():"Like"})]}),e.jsxs("button",{onClick:()=>P(!$),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,background:$?"rgba(139, 92, 246, 0.15)":"transparent",border:"none",padding:"12px 16px",borderRadius:12,cursor:"pointer",transition:"all 0.2s"},children:[e.jsx(L,{size:28,color:$?"#a78bfa":"#94a3b8",fill:$?"#a78bfa":"transparent"}),e.jsx("span",{style:{fontSize:12,color:$?"#a78bfa":"#94a3b8",fontWeight:500},children:w>0?w.toLocaleString():"Comments"})]}),e.jsxs("button",{onClick:async()=>{const e=`${window.location.origin}/content/${l}`;if(navigator.share)try{await navigator.share({title:j||"Check this out",url:e})}catch{}else await navigator.clipboard.writeText(e),alert("Link copied to clipboard!")},style:{display:"flex",flexDirection:"column",alignItems:"center",gap:4,background:"transparent",border:"none",padding:"12px 16px",borderRadius:12,cursor:"pointer"},children:[e.jsx(A,{size:28,color:"#94a3b8"}),e.jsx("span",{style:{fontSize:12,color:"#94a3b8",fontWeight:500},children:"Share"})]})]}),(y||h&&b.length>0)&&e.jsxs("div",{style:{padding:"16px 12px",borderBottom:$?"1px solid #1e293b":"none"},children:[y&&e.jsxs(n,{to:`/profile/${y}`,onClick:e=>e.stopPropagation(),style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8,textDecoration:"none",marginBottom:h?12:0},children:[e.jsx("div",{style:{width:44,height:44,borderRadius:"50%",background:m?`url(${m}) center/cover`:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:18,fontWeight:600},children:!m&&y.charAt(0).toUpperCase()}),e.jsxs("span",{style:{fontSize:12,color:"#60a5fa",fontWeight:600,textAlign:"center",wordBreak:"break-word"},children:["@",y]})]}),h&&b.length>0&&e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[e.jsx("span",{style:{fontSize:10,color:"#64748b",textTransform:"uppercase",fontWeight:600},children:"Collaborators"}),b.slice(0,3).map(t=>e.jsxs(n,{to:`/profile/${t.username}`,onClick:e=>e.stopPropagation(),style:{fontSize:11,color:"#60a5fa",textDecoration:"none"},children:["@",t.username]},t.username)),b.length>3&&e.jsxs("span",{style:{fontSize:11,color:"#64748b"},children:["+",b.length-3," more"]})]})]}),$&&l&&e.jsx("div",{style:{flex:1,overflow:"auto",padding:16},children:e.jsx(E,{contentId:l,isAuthenticated:N,currentUsername:F,onAuthRequired:()=>window.location.href="/auth"})})]})]})}):null}export{D as A,M as P};
