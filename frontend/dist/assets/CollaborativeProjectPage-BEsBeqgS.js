var e=Object.defineProperty,t=(t,r,i)=>((t,r,i)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i)(t,"symbol"!=typeof r?r+"":r,i);import{j as r}from"./web3auth-BkZxjmxM.js";import{r as i,R as n,g as o,a as s,f as a}from"./router-cVcvJ1e3.js";import{c as l,U as d,l as c,R as p,D as u,b as g,f,a as x,k as h,A as b,X as y,S as v,m,d as j,F as S,h as k,I as w,r as _,s as z,t as C,C as R,e as I}from"./index-kwDhYR8e.js";import{F as T}from"./file-text-DLybjh7Q.js";import{C as W}from"./check-BqsjhBq6.js";import{C as A,T as B}from"./triangle-alert-iTd3Dq7z.js";import{L as P}from"./loader-circle-hc8JHQJU.js";import{P as U}from"./plus-D65iTqd2.js";import{C as D}from"./calendar-Dh_Pkuvj.js";import{P as $,C as M,S as F,V as E,M as N,a as L,b as O,B as H,c as q}from"./volume-2-DqYc1tB7.js";import{T as Y}from"./type-B0aaUhZZ.js";import{B as V}from"./briefcase-DJlDs8Ro.js";import{V as X}from"./video-AIeDIJTa.js";import{E as G}from"./eye-B1lxMiYG.js";import{P as J}from"./palette-BMU1Uf5q.js";import{P as K}from"./pen-Bp-GmyXt.js";import{C as Z}from"./circle-check-BCjS8Jf0.js";import{S as Q}from"./send-CBpIkk4c.js";import{U as ee,b as te,C as re,R as ie,E as ne,a as oe,P as se}from"./CollaborativeComicEditor-CiqmDwIo.js";import{S as ae}from"./sparkles-Bdgux6Nb.js";import{U as le}from"./user-plus-DfMOmGcP.js";import{M as de}from"./message-circle-D0t8S0qV.js";import{C as ce}from"./circle-alert-xA--wFyS.js";import{s as pe}from"./regionCalculator-D3m0QDUE.js";import"./vendor-Cfs_Iq82.js";import"./trash-2-BaI_h9n1.js";import"./grid-3x3-CoYbStYg.js";import"./settings-b4d_tBdy.js";
/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ue=l("activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]),ge=l("circle-dot",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}]]),fe=l("clipboard-list",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]),xe=l("coins",[["circle",{cx:"8",cy:"8",r:"6",key:"3yglwk"}],["path",{d:"M18.09 10.37A6 6 0 1 1 10.34 18",key:"t5s6rm"}],["path",{d:"M7 6h1v4",key:"1obek4"}],["path",{d:"m16.71 13.88.7.71-2.82 2.82",key:"1rbuyh"}]]),he=l("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),be=l("list-todo",[["path",{d:"M13 5h8",key:"a7qcls"}],["path",{d:"M13 12h8",key:"h98zly"}],["path",{d:"M13 19h8",key:"c3s6r1"}],["path",{d:"m3 17 2 2 4-4",key:"1jhpwq"}],["rect",{x:"3",y:"4",width:"6",height:"6",rx:"1",key:"cif1o7"}]]),ye=l("lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]),ve=l("user-minus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]),me=[{id:"overview",label:"Overview",icon:r.jsx(he,{size:18})},{id:"content",label:"Content",icon:r.jsx(T,{size:18})},{id:"team",label:"Team",icon:r.jsx(d,{size:18})},{id:"activity",label:"Activity",icon:r.jsx(c,{size:18})},{id:"publish",label:"Publish",icon:r.jsx(p,{size:18})}];function je({activeTab:e,onTabChange:t,badges:i={},isFullyApproved:n=!1}){return r.jsx("div",{style:{display:"flex",gap:4,background:"var(--panel)",padding:4,borderRadius:12,border:"1px solid var(--panel-border)"},children:me.map(o=>{const s=e===o.id,a="activity"===o.id?i.activity:"team"===o.id?i.team:void 0,l="publish"===o.id&&n;return r.jsxs("button",{onClick:()=>t(o.id),style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:s?"var(--bg)":l?"rgba(16, 185, 129, 0.1)":"transparent",border:s?"1px solid var(--panel-border)":l?"1px solid rgba(16, 185, 129, 0.3)":"1px solid transparent",borderRadius:8,color:s?"var(--text)":l?"#10b981":"#94a3b8",cursor:"pointer",fontSize:14,fontWeight:s?600:500,transition:"all 0.2s ease",position:"relative"},children:[r.jsx("span",{style:{display:"flex",alignItems:"center"},children:o.icon}),r.jsx("span",{children:o.label}),void 0!==a&&a>0&&r.jsx("span",{style:{background:"#ef4444",color:"#fff",fontSize:10,fontWeight:700,padding:"2px 6px",borderRadius:10,minWidth:18,textAlign:"center"},children:a>99?"99+":a})]},o.id)})})}const Se=["#8b5cf6","#f59e0b","#10b981","#3b82f6","#ef4444","#ec4899","#06b6d4","#f97316"];function ke({collaborators:e,size:t=200}){const i=t/2,n=t/2,o=t/2-10,s=.6*o;let a=-90;const l=e.map((e,t)=>{const r=Number(e.revenue_percentage),i=a,n=a+r/100*360;return a=n,{...e,color:Se[t%Se.length],startAngle:i,endAngle:n,percentage:r}}),d=(e,t,r,i)=>{const n=i*Math.PI/180;return{x:e+r*Math.cos(n),y:t+r*Math.sin(n)}},c=(e,t,r,o)=>{const s=d(i,n,r,e),a=d(i,n,r,t),l=d(i,n,o,t),c=d(i,n,o,e),p=t-e>180?1:0;return`\n      M ${s.x} ${s.y}\n      A ${r} ${r} 0 ${p} 1 ${a.x} ${a.y}\n      L ${l.x} ${l.y}\n      A ${o} ${o} 0 ${p} 0 ${c.x} ${c.y}\n      Z\n    `};return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:24},children:[r.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[l.map((e,t)=>r.jsx("path",{d:c(e.startAngle,e.endAngle,o,s),fill:e.color,stroke:"var(--panel)",strokeWidth:2,style:{transition:"opacity 0.2s",cursor:"pointer"},onMouseEnter:e=>{e.target.style.opacity="0.8"},onMouseLeave:e=>{e.target.style.opacity="1"},children:r.jsxs("title",{children:[e.username,": ",e.percentage,"%"]})},e.id)),r.jsx("text",{x:i,y:n-8,textAnchor:"middle",fill:"var(--text)",fontSize:24,fontWeight:700,children:e.length}),r.jsx("text",{x:i,y:n+14,textAnchor:"middle",fill:"#94a3b8",fontSize:11,children:1===e.length?"Creator":"Creators"})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:l.map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:12,height:12,borderRadius:3,background:e.color,flexShrink:0}}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),r.jsxs("div",{style:{fontSize:14,fontWeight:700,color:e.color},children:[Number(e.percentage).toFixed(2),"%"]})]},e.id))})]})}function we({project:e,currentUser:t,onProjectUpdate:n}){var o,s,a,l,u,g;const[f,x]=i.useState(!1),[h,b]=i.useState(e.description||""),y=e.created_by===t.id,v=(null==(o=e.collaborators)?void 0:o.filter(e=>"accepted"===e.status))||[],m=e=>e.approved_current_version&&e.approved_revenue_split&&!1!==e.warranty_of_originality_acknowledged,j=v.filter(m).length,S=(null==(s=e.can_mint_status)?void 0:s.can_mint)??!1,k=(null==(a=e.can_mint_status)?void 0:a.blockers)??[];return r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:20},children:[r.jsxs("div",{style:{gridColumn:"span 12",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16},children:[r.jsx("h3",{style:{margin:0,color:"var(--text)",fontSize:18,fontWeight:600},children:"Project Proposal"}),y&&!f&&r.jsx("button",{onClick:()=>x(!0),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"6px 12px",color:"#94a3b8",cursor:"pointer",fontSize:12},children:"Edit"})]}),f?r.jsxs("div",{children:[r.jsx("textarea",{value:h,onChange:e=>b(e.target.value),placeholder:"Describe your project proposal, goals, and expectations...",style:{width:"100%",minHeight:120,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,lineHeight:1.6,resize:"vertical"}}),r.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[r.jsx("button",{onClick:()=>{x(!1)},style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:6,padding:"8px 16px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13},children:"Save"}),r.jsx("button",{onClick:()=>{b(e.description||""),x(!1)},style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"8px 16px",color:"#94a3b8",cursor:"pointer",fontSize:13},children:"Cancel"})]})]}):r.jsx("p",{style:{color:e.description?"#94a3b8":"#64748b",fontSize:14,margin:0,lineHeight:1.7,fontStyle:e.description?"normal":"italic"},children:e.description||"No description provided. Click Edit to add one."}),r.jsxs("div",{style:{display:"flex",gap:24,marginTop:20,paddingTop:16,borderTop:"1px solid var(--panel-border)"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Created by"}),r.jsxs("div",{style:{fontSize:13,color:"var(--text)",fontWeight:600},children:["@",e.created_by_username]})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Created on"}),r.jsx("div",{style:{fontSize:13,color:"var(--text)"},children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Content Type"}),r.jsx("div",{style:{fontSize:13,color:"var(--text)"},children:e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)})]})]})]}),r.jsxs("div",{style:{gridColumn:"span 6",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:16,fontWeight:600},children:"Revenue Split"}),e.collaborators&&e.collaborators.length>0?r.jsx(ke,{collaborators:e.collaborators.map(e=>({id:e.id,username:e.username,role:e.role,revenue_percentage:e.revenue_percentage})),size:180}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No collaborators yet."}),e.collaborators&&r.jsxs("div",{style:{marginTop:20,padding:12,background:"var(--bg)",borderRadius:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:13,color:"#94a3b8"},children:"Total"}),r.jsxs("span",{style:{fontSize:16,fontWeight:700,color:100===e.collaborators.reduce((e,t)=>e+Number(t.revenue_percentage),0)?"#10b981":"#ef4444"},children:[e.collaborators.reduce((e,t)=>e+Number(t.revenue_percentage),0).toFixed(2),"%"]})]})]}),r.jsxs("div",{style:{gridColumn:"span 6",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:16,fontWeight:600},children:"Approval Progress"}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[r.jsxs("span",{style:{fontSize:13,color:"#94a3b8"},children:[j," of ",v.length," approved"]}),r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:[v.length>0?Math.round(j/v.length*100):0,"%"]})]}),r.jsx("div",{style:{height:8,background:"var(--bg)",borderRadius:4,overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:v.length>0?j/v.length*100+"%":"0%",background:e.is_fully_approved?"linear-gradient(90deg, #10b981 0%, #059669 100%)":"linear-gradient(90deg, #f59e0b 0%, #d97706 100%)",borderRadius:4,transition:"width 0.3s ease"}})})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:v.map(e=>{const i=m(e);return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:i?"rgba(16, 185, 129, 0.1)":"var(--bg)",border:"1px solid "+(i?"rgba(16, 185, 129, 0.2)":"var(--panel-border)"),borderRadius:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:i?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #64748b 0%, #475569 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:600},children:i?"âœ“":e.username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,e.user===t.id&&r.jsx("span",{style:{color:"#94a3b8",fontWeight:400},children:" (you)"})]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]})]}),r.jsx("div",{style:{fontSize:11,fontWeight:600,color:i?"#10b981":"#f59e0b",background:i?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",padding:"4px 8px",borderRadius:4},children:i?"Approved":"Pending"})]},e.id)})}),S?r.jsxs("div",{style:{marginTop:16,padding:12,background:"rgba(16, 185, 129, 0.1)",border:"1px solid #10b981",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[r.jsx("span",{style:{fontSize:18},children:"âœ“"}),r.jsx("span",{style:{fontSize:14,fontWeight:600,color:"#10b981"},children:"Fully Approved - Ready to Mint!"})]}):k.length>0&&r.jsxs("div",{style:{marginTop:16,padding:12,background:"rgba(245, 158, 11, 0.1)",border:"1px solid #f59e0b",borderRadius:8},children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"#f59e0b",marginBottom:8},children:"Not ready to mint:"}),r.jsxs("ul",{style:{margin:0,paddingLeft:20,fontSize:12,color:"#94a3b8"},children:[k.slice(0,3).map((e,t)=>r.jsx("li",{children:e},t)),k.length>3&&r.jsxs("li",{children:["...and ",k.length-3," more"]})]})]})]}),r.jsxs("div",{style:{gridColumn:"span 12",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16},children:[r.jsx(_e,{label:"Sections",value:(null==(l=e.sections)?void 0:l.length)||0,icon:r.jsx(T,{size:20})}),r.jsx(_e,{label:"Comments",value:(null==(u=e.recent_comments)?void 0:u.length)||0,icon:r.jsx(c,{size:20})}),r.jsx(_e,{label:"Team Members",value:(null==(g=e.collaborators)?void 0:g.length)||0,icon:r.jsx(d,{size:20})}),r.jsx(_e,{label:"Progress",value:`${e.progress_percentage||0}%`,icon:r.jsx(p,{size:20})})]})]})}function _e({label:e,value:t,icon:i}){return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,display:"flex",alignItems:"center",gap:12},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:8,background:"var(--bg)",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8"},children:i}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--text)"},children:t}),r.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:e})]})]})}function ze({collaborators:e,sections:t,projectCreatorId:i}){const n=e=>{const r=t.filter(t=>t.owner===e.user),i=r.filter(e=>e.content_html&&e.content_html.trim().length>0);return{assigned:r.length,completed:i.length}},o=e=>{const t=n(e),i=(e=>{if(!e.delivery_deadline)return null;const t=new Date(e.delivery_deadline),r=new Date,i=Math.ceil((t.getTime()-r.getTime())/864e5);return i<0?{status:"overdue",days:Math.abs(i),color:"#ef4444"}:i<=3?{status:"soon",days:i,color:"#f59e0b"}:{status:"ok",days:i,color:"#10b981"}})(e);if("overdue"===(null==i?void 0:i.status))return{icon:r.jsx(A,{size:14}),text:`${i.days}d overdue`,color:"#ef4444",bg:"#ef444420"};if(t.assigned>0&&t.completed===t.assigned)return{icon:r.jsx(g,{size:14}),text:`${t.completed}/${t.assigned} complete`,color:"#10b981",bg:"#10b98120"};if(t.assigned>0){const e=t.assigned-t.completed;return"soon"===(null==i?void 0:i.status)?{icon:r.jsx(B,{size:14}),text:`${e} section${e>1?"s":""} due in ${i.days}d`,color:"#f59e0b",bg:"#f59e0b20"}:{icon:r.jsx(f,{size:14}),text:`${t.completed}/${t.assigned} sections`,color:"#3b82f6",bg:"#3b82f620"}}return{icon:r.jsx(T,{size:14}),text:"No sections assigned",color:"#64748b",bg:"#64748b20"}};return r.jsxs("div",{style:{background:"#0f172a",border:"1px solid #1e293b",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:20},children:[r.jsx(d,{size:20,style:{color:"#8b5cf6"}}),r.jsx("h3",{style:{margin:0,color:"#f8fafc",fontSize:16,fontWeight:600},children:"Team Overview"}),r.jsxs("span",{style:{background:"#334155",color:"#94a3b8",padding:"2px 10px",borderRadius:12,fontSize:12,fontWeight:500},children:[e.filter(e=>"accepted"===e.status).length," active"]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.filter(e=>"accepted"===e.status).map(e=>{const t=n(e),s=o(e),a=e.user===i,l=e.is_lead;return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,background:"#1e293b",borderRadius:10,borderLeft:`3px solid ${s.color}`},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:`linear-gradient(135deg, ${a?"#f59e0b":"#3b82f6"} 0%, ${a?"#d97706":"#2563eb"} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:14,flexShrink:0},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["@",e.username]}),a&&r.jsx("span",{style:{background:"#f59e0b",color:"#000",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700},children:"OWNER"}),l&&!a&&r.jsx("span",{style:{background:"#8b5cf6",color:"#fff",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700},children:"LEAD"})]}),r.jsxs("div",{style:{color:"#94a3b8",fontSize:12,marginTop:2,display:"flex",alignItems:"center",gap:8},children:[r.jsx("span",{children:e.role}),r.jsx("span",{style:{color:"#64748b"},children:"â€¢"}),r.jsxs("span",{style:{color:"#10b981"},children:[e.revenue_percentage,"%"]})]})]}),t.assigned>0&&r.jsx("div",{style:{width:80},children:r.jsx("div",{style:{height:6,background:"#334155",borderRadius:3,overflow:"hidden"},children:r.jsx("div",{style:{width:t.completed/t.assigned*100+"%",height:"100%",background:t.completed===t.assigned?"#10b981":"#3b82f6",transition:"width 0.3s ease"}})})}),r.jsxs("div",{style:{background:s.bg,color:s.color,padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500,display:"flex",alignItems:"center",gap:6,whiteSpace:"nowrap"},children:[r.jsx("span",{children:s.icon}),s.text]}),r.jsxs("div",{style:{display:"flex",gap:4,flexShrink:0},title:`Content: ${e.approved_current_version?"Approved":"Pending"}, Revenue: ${e.approved_revenue_split?"Approved":"Pending"}`,children:[r.jsx("div",{style:{width:24,height:24,borderRadius:4,background:e.approved_current_version?"#10b98120":"#64748b20",color:e.approved_current_version?"#10b981":"#64748b",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.approved_current_version?r.jsx(W,{size:12}):"â—‹"}),r.jsx("div",{style:{width:24,height:24,borderRadius:4,background:e.approved_revenue_split?"#10b98120":"#64748b20",color:e.approved_revenue_split?"#10b981":"#64748b",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.approved_revenue_split?r.jsx(u,{size:12}):"â—‹"})]})]},e.id)}),e.filter(e=>"invited"===e.status).length>0&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{borderTop:"1px solid #334155",margin:"8px 0",paddingTop:12},children:r.jsx("span",{style:{color:"#64748b",fontSize:12,fontWeight:600},children:"PENDING INVITES"})}),e.filter(e=>"invited"===e.status).map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,background:"#1e293b",borderRadius:10,borderLeft:"3px solid #f59e0b",opacity:.7},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8",fontWeight:700,fontSize:14,flexShrink:0},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{color:"#94a3b8",fontWeight:500,fontSize:14},children:["@",e.username]}),r.jsxs("div",{style:{color:"#64748b",fontSize:12},children:[e.role," â€¢ ",e.revenue_percentage,"%"]})]}),r.jsx("span",{style:{background:"#f59e0b20",color:"#f59e0b",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500},children:"Awaiting response"})]},e.id))]})]}),r.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #334155",display:"flex",gap:16,flexWrap:"wrap"},children:[r.jsxs("div",{style:{fontSize:12,color:"#64748b",display:"flex",alignItems:"center",gap:4},children:[r.jsx(W,{size:14,style:{color:"#10b981"}})," Content Approved"]}),r.jsxs("div",{style:{fontSize:12,color:"#64748b",display:"flex",alignItems:"center",gap:4},children:[r.jsx(u,{size:14,style:{color:"#10b981"}})," Revenue Approved"]}),r.jsxs("div",{style:{fontSize:12,color:"#64748b",display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:"â—‹"})," Pending"]})]})]})}function Ce({status:e,isOverdue:t}){if(t&&"signed_off"!==e&&"cancelled"!==e)return r.jsxs("span",{style:{background:"#ef444430",color:"#f87171",padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:"ðŸš¨"})," Overdue"]});const i={pending:{bg:"#64748b20",color:"#94a3b8",label:"Pending"},in_progress:{bg:"#3b82f620",color:"#60a5fa",label:"In Progress"},complete:{bg:"#f59e0b20",color:"#fbbf24",label:"Awaiting Sign-off"},signed_off:{bg:"#10b98120",color:"#34d399",label:"Signed Off"},cancelled:{bg:"#ef444420",color:"#f87171",label:"Cancelled"}}[e];return r.jsx("span",{style:{background:i.bg,color:i.color,padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600},children:i.label})}async function Re(){try{const e=await fetch(`${b}/api/auth/csrf/`,{credentials:"include"}),t=await e.json();return(null==t?void 0:t.csrfToken)||""}catch{return""}}function Ie({collaboratorRole:e,currentUserId:t,isProjectOwner:n,projectId:o,onTaskUpdate:s}){const[a,l]=i.useState(new Set),[d,c]=i.useState(null),[p,u]=i.useState(""),[g,f]=i.useState({}),[b,y]=i.useState({}),[v,m]=i.useState({}),j=e.user===t,S=e.contract_tasks||[],k=e=>{l(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return 0===S.length?r.jsx("div",{style:{padding:20,background:"#1e293b",borderRadius:12,textAlign:"center",color:"#64748b",fontSize:13},children:"No contract tasks defined for this collaborator."}):r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx(fe,{size:20,style:{color:"#94a3b8"}}),r.jsxs("h3",{style:{margin:0,color:"#f8fafc",fontSize:16,fontWeight:600},children:["Contract Tasks for @",e.username]})]}),r.jsxs("div",{style:{marginTop:6,color:"#94a3b8",fontSize:12},children:[e.role," â€¢ ",e.revenue_percentage,"% revenue share"]})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{color:e.all_tasks_complete?"#10b981":"#f59e0b",fontSize:18,fontWeight:700},children:[e.tasks_signed_off,"/",e.tasks_total]}),r.jsx("div",{style:{color:"#64748b",fontSize:11},children:"signed off"})]})]}),r.jsx("div",{style:{height:6,background:"#0f172a",borderRadius:3,marginBottom:20,overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:e.tasks_signed_off/e.tasks_total*100+"%",background:e.all_tasks_complete?"#10b981":"linear-gradient(90deg, #f59e0b, #fbbf24)",borderRadius:3,transition:"width 0.3s ease"}})}),e.has_active_breach&&r.jsxs("div",{style:{background:"#ef444420",border:"1px solid #ef4444",borderRadius:8,padding:12,marginBottom:16,display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:18},children:"ðŸš¨"}),r.jsxs("div",{style:{color:"#f87171",fontSize:13},children:[r.jsx("strong",{children:"Deadline Breach:"})," One or more tasks are past their deadline.",n&&" You may cancel, extend deadlines, or waive the breach."]})]}),p&&r.jsx("div",{style:{background:"#ef444420",border:"1px solid #ef4444",color:"#f87171",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:p}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:S.map(e=>{var t,i,l;const p=a.has(e.id),S=j&&"in_progress"===e.status,w=n&&"complete"===e.status,_=n&&"complete"===e.status,z=d===e.id;return r.jsxs("div",{style:{background:"#0f172a",border:"1px solid "+(e.is_overdue?"#ef4444":"#334155"),borderRadius:10,overflow:"hidden"},children:[r.jsxs("div",{onClick:()=>k(e.id),style:{padding:16,cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:6},children:[r.jsx(Ce,{status:e.status,isOverdue:e.is_overdue}),r.jsx("span",{style:{color:"#f8fafc",fontSize:14,fontWeight:600},children:e.title})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,color:"#64748b",fontSize:12},children:[r.jsxs("span",{children:["Due: ",new Date(e.deadline).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),void 0!==e.days_until_deadline&&"signed_off"!==e.status&&r.jsx("span",{style:{color:e.days_until_deadline<0?"#f87171":e.days_until_deadline<3?"#fbbf24":"#64748b"},children:e.days_until_deadline<0?`${Math.abs(e.days_until_deadline)} days overdue`:0===e.days_until_deadline?"Due today":`${e.days_until_deadline} days left`})]})]}),p?r.jsx(x,{size:18,style:{color:"#64748b"}}):r.jsx(h,{size:18,style:{color:"#64748b"}})]}),p&&r.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #334155"},children:[e.description&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("div",{style:{color:"#94a3b8",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:"Description"}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.6},children:e.description})]}),e.completion_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsxs("div",{style:{color:"#94a3b8",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:["Completion Notes from @",e.marked_complete_by_username]}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.6,background:"#1e293b",padding:10,borderRadius:6},children:e.completion_notes})]}),e.signoff_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsxs("div",{style:{color:"#10b981",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:["Signed Off by @",e.signed_off_by_username]}),r.jsx("div",{style:{color:"#34d399",fontSize:13,lineHeight:1.6,background:"#10b98120",padding:10,borderRadius:6},children:e.signoff_notes})]}),e.rejection_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("div",{style:{color:"#f87171",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:"Revision Requested"}),r.jsx("div",{style:{color:"#fca5a5",fontSize:13,lineHeight:1.6,background:"#ef444420",padding:10,borderRadius:6},children:e.rejection_notes})]}),S&&r.jsxs("div",{style:{marginTop:16},children:[r.jsx("textarea",{placeholder:"Add notes about what you completed (optional)...",value:g[e.id]||"",onChange:t=>f(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #334155",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:60,marginBottom:10}}),r.jsx("button",{onClick:()=>(async e=>{c(e),u("");try{const t=await Re(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/mark-complete/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({completion_notes:g[e]||""})});if(r.ok)s();else{const e=await r.json();u(e.error||"Failed to mark task complete")}}catch(t){u(t.message||"Failed to mark task complete")}finally{c(null)}})(e.id),disabled:z,style:{width:"100%",padding:"12px 20px",borderRadius:8,border:"none",background:"#10b981",color:"#fff",fontSize:14,fontWeight:600,cursor:z?"not-allowed":"pointer",opacity:z?.6:1},children:z?"Submitting...":"Mark as Complete"})]}),w&&r.jsxs("div",{style:{marginTop:16},children:[r.jsx("textarea",{placeholder:"Add feedback or approval notes (optional)...",value:b[e.id]||"",onChange:t=>y(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #334155",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:60,marginBottom:10}}),r.jsxs("div",{style:{display:"flex",gap:10},children:[r.jsx("button",{onClick:()=>(async e=>{c(e),u("");try{const t=await Re(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/sign-off/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({signoff_notes:b[e]||""})});if(r.ok)s();else{const e=await r.json();u(e.error||"Failed to sign off on task")}}catch(t){u(t.message||"Failed to sign off on task")}finally{c(null)}})(e.id),disabled:z,style:{flex:2,padding:"12px 20px",borderRadius:8,border:"none",background:"#10b981",color:"#fff",fontSize:14,fontWeight:600,cursor:z?"not-allowed":"pointer",opacity:z?.6:1},children:z?"Processing...":"Sign Off"}),r.jsx("button",{onClick:()=>k(e.id),style:{flex:1,padding:"12px 20px",borderRadius:8,border:"1px solid #ef4444",background:"transparent",color:"#ef4444",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Request Changes"})]})]}),_&&void 0!==v[e.id]&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("textarea",{placeholder:"Explain what needs to be revised...",value:v[e.id]||"",onChange:t=>m(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #ef4444",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:80,marginBottom:10}}),r.jsx("button",{onClick:()=>(async e=>{var t;if(null==(t=v[e])?void 0:t.trim()){c(e),u("");try{const t=await Re(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/reject-completion/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({rejection_reason:v[e]})});if(r.ok)s(),m(t=>({...t,[e]:""}));else{const e=await r.json();u(e.error||"Failed to reject task")}}catch(r){u(r.message||"Failed to reject task")}finally{c(null)}}else u("Please provide a reason for rejection")})(e.id),disabled:z||!(null==(t=v[e.id])?void 0:t.trim()),style:{width:"100%",padding:"12px 20px",borderRadius:8,border:"none",background:"#ef4444",color:"#fff",fontSize:14,fontWeight:600,cursor:z||!(null==(i=v[e.id])?void 0:i.trim())?"not-allowed":"pointer",opacity:z||!(null==(l=v[e.id])?void 0:l.trim())?.6:1},children:z?"Sending...":"Request Changes"})]})]})]},e.id)})})]})}const Te=({icon:e,size:t=20})=>{const i={size:t,strokeWidth:1.5};switch(e){case"pen":return r.jsx(K,{...i});case"users":return r.jsx(d,{...i});case"palette":return r.jsx(J,{...i});case"image":return r.jsx(w,{...i});case"check-circle":return r.jsx(g,{...i});case"spell-check":case"file-text":return r.jsx(T,{...i});case"microphone":return r.jsx(q,{...i});case"brush":return r.jsx(H,{...i});case"paint-brush":return r.jsx(O,{...i});case"eye":return r.jsx(G,{...i});case"music":return r.jsx(k,{...i});case"sliders":return r.jsx(L,{...i});case"mic":return r.jsx(N,{...i});case"volume-2":return r.jsx(E,{...i});case"film":return r.jsx(S,{...i});case"video":return r.jsx(X,{...i});case"scissors":return r.jsx(F,{...i});case"play-circle":return r.jsx(M,{...i});case"briefcase":return r.jsx(V,{...i});case"type":return r.jsx(Y,{...i});case"pen-tool":return r.jsx($,{...i});default:return r.jsx(m,{...i})}},We=(e=14)=>{const t=new Date;return t.setDate(t.getDate()+e),t.toISOString().slice(0,16)};function Ae({project:e,currentUser:t,onProjectUpdate:n}){const[o,s]=i.useState(!1),[a,l]=i.useState(""),[d,c]=i.useState(10),[p,u]=i.useState(""),[g,f]=i.useState(!1),[x,h]=i.useState([]),[S,k]=i.useState(null),[w,_]=i.useState(!1),[z,C]=i.useState(!1),[R,I]=i.useState([]),[T,$]=i.useState(!0),[M,F]=i.useState(!0),[E,N]=i.useState(!1),[L,O]=i.useState(!1),[H,q]=i.useState(null),[Y,V]=i.useState(""),[X,G]=i.useState(null),[J,K]=i.useState(""),[Z,Q]=i.useState(!1),[ee,te]=i.useState(""),[re,ie]=i.useState([]),[ne,oe]=i.useState(!1),[se,ae]=i.useState(null),[le,de]=i.useState(!1),[ce,pe]=i.useState(!1),[ue,ge]=i.useState(""),xe=i.useRef(null),he=i.useRef(null),be=e.created_by===t.id,ye=e.sections||[],ve=e.collaborators||[],me=ve.find(t=>t.user===e.created_by),je=(null==me?void 0:me.revenue_percentage)||100,Se=Math.max(0,je-1);i.useEffect(()=>!ee.trim()||ee.length<2?(ie([]),void de(!1)):(xe.current&&clearTimeout(xe.current),xe.current=setTimeout(async()=>{oe(!0);try{const e=new URLSearchParams({q:ee,page_size:"8"}),r=await fetch(`${b}/api/users/search/?${e.toString()}`,{credentials:"include"});if(r.ok){const e=await r.json(),i=new Set([t.id,...ve.map(e=>e.user)]),n=(e.results||[]).filter(e=>!i.has(e.id));ie(n),de(n.length>0)}}catch(e){}finally{oe(!1)}},300),()=>{xe.current&&clearTimeout(xe.current)}),[ee,t.id,ve]),i.useEffect(()=>{const e=e=>{he.current&&!he.current.contains(e.target)&&de(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),i.useEffect(()=>{if(!o)return;(async()=>{_(!0);try{const t=e.content_type,r=await fetch(`${b}/api/role-definitions/?project_type=${t}`,{credentials:"include"});if(r.ok){const e=await r.json();h(e)}}catch(t){}finally{_(!1)}})()},[o,e.content_type]);const ke=(e,t,r)=>{I(R.map(i=>i.id===e?{...i,[t]:r}:i))},we=d>=50,_e=je-d,Ce=async()=>{if(se){Q(!1),f(!0),u("");try{await j.inviteCollaborator(e.id,{user_id:se.id,role:a.trim(),role_definition_id:S||void 0,revenue_percentage:d,can_edit_text:T,can_edit_images:M,can_edit_audio:E,can_edit_video:L,tasks:R.length>0?R.map(e=>({title:e.title,description:e.description,deadline:new Date(e.deadline).toISOString()})):void 0});const t=await j.getCollaborativeProject(e.id);null==n||n(t),s(!1),ae(null),te(""),l(""),c(10),k(null),C(!1),I([]),$(!0),F(!0),N(!1),O(!1)}catch(t){u(t.message||"Failed to invite collaborator")}finally{f(!1)}}else u("Please select a user to invite")},Re=async(t,r,i)=>{q(t),V("");try{const o=await j.respondToCounterProposal(e.id,{collaborator_id:t,action:r,message:i});if(o.project)null==n||n(o.project);else{const t=await j.getCollaborativeProject(e.id);null==n||n(t)}"decline"===r&&(G(null),K(""))}catch(o){V(o.message||`Failed to ${r} counter-proposal`)}finally{q(null)}};return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:20},children:"Team Members"}),be&&!o&&r.jsx("button",{onClick:()=>s(!0),style:{background:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",border:"none",borderRadius:8,padding:"10px 20px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:14},children:"+ Invite Collaborator"})]}),o&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,overflow:"hidden"},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Invite New Collaborator"}),r.jsx("div",{children:r.jsxs("div",{ref:he,style:{position:"relative",maxWidth:500},children:[r.jsx("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6},children:"Find Collaborator"}),se?r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,padding:"8px 12px",background:"var(--bg)",border:"1px solid #8b5cf6",borderRadius:8,boxSizing:"border-box"},children:[r.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:se.avatar_url?`url(${se.avatar_url}) center/cover`:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,color:"#fff"},children:!se.avatar_url&&se.username.slice(0,1).toUpperCase()}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:["@",se.username]}),se.display_name&&r.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:se.display_name})]}),r.jsx("button",{onClick:()=>{ae(null),te("")},style:{background:"transparent",border:"none",padding:4,cursor:"pointer",color:"#94a3b8",display:"flex",alignItems:"center"},children:r.jsx(y,{size:18})})]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{position:"relative"},children:[r.jsx(v,{size:16,style:{position:"absolute",left:12,top:"50%",transform:"translateY(-50%)",color:"#64748b"}}),r.jsx("input",{type:"text",value:ee,onChange:e=>te(e.target.value),onFocus:()=>re.length>0&&de(!0),placeholder:"Search by @username or name...",style:{width:"100%",boxSizing:"border-box",padding:"10px 12px 10px 38px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14}}),ne&&r.jsx("div",{style:{position:"absolute",right:12,top:"50%",transform:"translateY(-50%)",color:"#64748b",fontSize:12},children:"..."})]}),le&&re.length>0&&r.jsx("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:8,boxShadow:"0 10px 40px rgba(0,0,0,0.3)",zIndex:100,maxHeight:300,overflowY:"auto"},children:re.map(e=>r.jsxs("div",{onClick:()=>(e=>{ae(e),te(""),de(!1),ie([])})(e),style:{display:"flex",alignItems:"center",gap:10,padding:"10px 12px",cursor:"pointer",borderBottom:"1px solid var(--panel-border)",transition:"background 0.15s"},onMouseEnter:e=>e.currentTarget.style.background="rgba(139, 92, 246, 0.1)",onMouseLeave:e=>e.currentTarget.style.background="transparent",children:[r.jsx("div",{style:{width:36,height:36,borderRadius:"50%",background:e.avatar_url?`url(${e.avatar_url}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:14,fontWeight:600,color:"#fff"},children:!e.avatar_url&&e.username.slice(0,1).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),e.display_name&&r.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:e.display_name})]})]},e.id))}),!ne&&ee.length>=2&&0===re.length&&r.jsxs("div",{style:{position:"absolute",top:"100%",left:0,right:0,marginTop:4,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:8,boxShadow:"0 10px 40px rgba(0,0,0,0.3)",zIndex:100,padding:16},children:[r.jsxs("div",{style:{color:"#94a3b8",fontSize:13,textAlign:"center",marginBottom:8},children:['No collaborators found for "',ee,'"']}),r.jsxs("div",{style:{color:"#64748b",fontSize:11,textAlign:"center",marginBottom:12},children:["Only users with ",r.jsx("strong",{style:{color:"#f59e0b"},children:"public profiles"})," appear in search."]}),r.jsx("button",{onClick:async()=>{if(ee.trim()){pe(!0),ge("");try{const e=new URLSearchParams({exact_username:ee.trim()}),r=await fetch(`${b}/api/users/search/?${e.toString()}`,{credentials:"include"});if(r.ok){const e=(await r.json()).results||[],i=new Set([t.id,...ve.map(e=>e.user)]),n=e.filter(e=>!i.has(e.id));n.length>0?(ae(n[0]),te(""),de(!1),ge("")):e.length>0?ge("This user is already a collaborator on this project."):ge(`No user found with username "${ee}". Please check the spelling.`)}else ge("Failed to look up user. Please try again.")}catch(e){ge("Failed to look up user. Please try again.")}finally{pe(!1)}}},disabled:ce,style:{width:"100%",padding:"10px 16px",background:"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",border:"none",borderRadius:6,color:"#fff",fontSize:13,fontWeight:600,cursor:ce?"not-allowed":"pointer",opacity:ce?.7:1,display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:ce?r.jsxs(r.Fragment,{children:[r.jsx(P,{size:14,style:{animation:"spin 1s linear infinite"}}),"Looking up..."]}):r.jsxs(r.Fragment,{children:[r.jsx(m,{size:14}),"Invite @",ee," by exact username"]})}),ue&&r.jsx("div",{style:{marginTop:10,padding:10,background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:6,color:"#f87171",fontSize:12,textAlign:"center"},children:ue})]}),r.jsx("div",{style:{marginTop:6,fontSize:11,color:"#64748b"},children:"Only users with public profiles can be found"})]})]})}),r.jsxs("div",{style:{marginTop:20},children:[r.jsxs("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:10},children:["Their Role ",r.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),w?r.jsxs("div",{style:{color:"#64748b",fontSize:13,padding:16,display:"flex",alignItems:"center",gap:8},children:[r.jsx(P,{size:16,style:{animation:"spin 1s linear infinite"}}),"Loading roles for ",e.content_type," projects..."]}):r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(130px, 1fr))",gap:10,marginBottom:12},children:[x.map(e=>r.jsxs("button",{type:"button",onClick:()=>(e=>{var t,r,i,n,o;if(k(e),C(!1),e){const s=x.find(t=>t.id===e);if(s){l(s.name);const e=s.default_permissions,a=(null==(t=e.edit)?void 0:t.types)||[];$(a.includes("text")||(null==(r=e.create)?void 0:r.includes("text"))),F(a.includes("image")||(null==(i=e.create)?void 0:i.includes("image"))),N(a.includes("audio")||(null==(n=e.create)?void 0:n.includes("audio"))),O(a.includes("video")||(null==(o=e.create)?void 0:o.includes("video")))}}else l("")})(e.id),style:{background:S===e.id?"rgba(139, 92, 246, 0.15)":"var(--bg)",border:"2px solid "+(S===e.id?"#8b5cf6":"var(--panel-border)"),borderRadius:10,padding:"12px 10px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:6,transition:"all 0.2s ease",position:"relative"},children:[S===e.id&&r.jsx("div",{style:{position:"absolute",top:6,right:6,background:"#8b5cf6",borderRadius:"50%",width:16,height:16,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx(W,{size:10,color:"#fff",strokeWidth:3})}),r.jsx("div",{style:{width:36,height:36,borderRadius:8,background:`${e.color}20`,display:"flex",alignItems:"center",justifyContent:"center",color:e.color},children:r.jsx(Te,{icon:e.icon,size:20})}),r.jsx("span",{style:{color:S===e.id?"#8b5cf6":"var(--text)",fontSize:12,fontWeight:600,textAlign:"center"},children:e.name}),r.jsxs("span",{style:{color:"#64748b",fontSize:9,textAlign:"center",lineHeight:1.2,display:"-webkit-box",WebkitLineClamp:2,WebkitBoxOrient:"vertical",overflow:"hidden"},children:[e.description.slice(0,50),e.description.length>50?"...":""]})]},e.id)),r.jsxs("button",{type:"button",onClick:()=>{k(null),C(!0),l("")},style:{background:z?"rgba(139, 92, 246, 0.15)":"var(--bg)",border:"2px solid "+(z?"#8b5cf6":"var(--panel-border)"),borderRadius:10,padding:"12px 10px",cursor:"pointer",display:"flex",flexDirection:"column",alignItems:"center",gap:6,transition:"all 0.2s ease"},children:[r.jsx("div",{style:{width:36,height:36,borderRadius:8,background:"rgba(148, 163, 184, 0.2)",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8"},children:r.jsx(U,{size:20,strokeWidth:1.5})}),r.jsx("span",{style:{color:z?"#8b5cf6":"#94a3b8",fontSize:12,fontWeight:600},children:"Custom Role"}),r.jsx("span",{style:{color:"#64748b",fontSize:9,textAlign:"center"},children:"Define your own"})]})]}),z&&r.jsx("input",{type:"text",value:a,onChange:e=>l(e.target.value),placeholder:"Enter custom role name...",style:{width:"100%",boxSizing:"border-box",background:"var(--bg)",border:"1px solid #8b5cf6",borderRadius:8,padding:"10px 12px",color:"var(--text)",fontSize:14}}),S&&!z&&r.jsx("div",{style:{background:"rgba(139, 92, 246, 0.1)",border:"1px solid rgba(139, 92, 246, 0.3)",borderRadius:8,padding:12},children:(()=>{var e,t,i,n;const o=x.find(e=>e.id===S);return o?r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{color:"#8b5cf6",fontSize:13,fontWeight:600,marginBottom:4},children:o.name}),r.jsx("div",{style:{color:"#94a3b8",fontSize:12,marginBottom:8},children:o.description}),r.jsxs("div",{style:{display:"flex",flexWrap:"wrap",gap:6},children:[(null==(e=o.default_permissions.create)?void 0:e.length)>0&&r.jsxs("span",{style:{background:"rgba(16,185,129,0.15)",color:"#10b981",fontSize:10,padding:"2px 8px",borderRadius:4},children:["Can create: ",o.default_permissions.create.join(", ")]}),(null==(i=null==(t=o.default_permissions.edit)?void 0:t.types)?void 0:i.length)>0&&r.jsxs("span",{style:{background:"rgba(59,130,246,0.15)",color:"#3b82f6",fontSize:10,padding:"2px 8px",borderRadius:4},children:["Can edit: ",o.default_permissions.edit.types.join(", ")," (",o.default_permissions.edit.scope,")"]}),(null==(n=o.default_permissions.review)?void 0:n.length)>0&&r.jsxs("span",{style:{background:"rgba(168,85,247,0.15)",color:"#a855f7",fontSize:10,padding:"2px 8px",borderRadius:4},children:["Can review: ",o.default_permissions.review.join(", ")]})]})]}):null})()})]})]}),r.jsxs("div",{style:{marginTop:20},children:[r.jsxs("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6},children:["Revenue Split: ",d,"%"]}),r.jsx("input",{type:"range",min:1,max:Se>0?Se:1,value:Math.min(d,Se||1),onChange:e=>c(Number(e.target.value)),disabled:Se<=0,style:{width:"100%",boxSizing:"border-box",accentColor:"#f59e0b"}}),r.jsxs("div",{style:{marginTop:12,padding:12,background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:8,color:"#f59e0b",fontWeight:600,fontSize:13},children:[r.jsx(B,{size:16}),"Impact on your share"]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:14},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"Your current share:"}),r.jsxs("span",{style:{color:"var(--text)",fontWeight:600},children:[je,"%"]}),r.jsx("span",{style:{color:"#64748b"},children:"â†’"}),r.jsxs("span",{style:{color:"#10b981",fontWeight:700},children:[je-d,"%"]}),r.jsxs("span",{style:{color:"#ef4444",fontSize:12},children:["(-",d,"%)"]})]}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:6},children:"This percentage comes from your share only and does not affect other collaborators."})]})]}),r.jsxs("div",{style:{marginTop:24,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{color:"var(--text)",fontSize:15,fontWeight:600,display:"flex",alignItems:"center",gap:8},children:[r.jsx(fe,{size:18,style:{color:"#8b5cf6"}}),"Contract Tasks"]}),r.jsx("div",{style:{color:"#94a3b8",fontSize:12,marginTop:4},children:"Define specific deliverables with deadlines. These become binding after acceptance."})]}),r.jsxs("button",{onClick:()=>{I([...R,{id:Math.random().toString(36).substr(2,9),title:"",description:"",deadline:We()}])},style:{background:"rgba(139, 92, 246, 0.15)",border:"1px solid #8b5cf6",color:"#8b5cf6",padding:"8px 16px",borderRadius:8,fontWeight:600,cursor:"pointer",fontSize:13,display:"flex",alignItems:"center",gap:6,whiteSpace:"nowrap"},children:[r.jsx(U,{size:14}),"Add Task"]})]}),0===R.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"2px dashed var(--panel-border)",borderRadius:8,background:"rgba(0, 0, 0, 0.1)"},children:[r.jsx(D,{size:32,style:{margin:"0 auto 12px",opacity:.5}}),r.jsx("div",{children:"No tasks defined yet"}),r.jsx("div",{style:{fontSize:11,marginTop:4},children:"Add tasks to create a concrete contract with clear deliverables"})]}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:R.map((e,t)=>r.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:10,padding:16},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[r.jsxs("div",{style:{flex:1,display:"grid",gap:12},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr auto",gap:12},children:[r.jsxs("div",{children:[r.jsxs("label",{style:{display:"block",color:"#94a3b8",fontSize:11,marginBottom:4,fontWeight:600},children:["Task ",t+1,": Title ",r.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),r.jsx("input",{type:"text",value:e.title,onChange:t=>ke(e.id,"title",t.target.value),placeholder:"e.g., Character designs for Chapter 1",style:{width:"100%",boxSizing:"border-box",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:6,padding:10,color:"var(--text)",fontSize:13}})]}),r.jsxs("div",{children:[r.jsxs("label",{style:{display:"block",color:"#94a3b8",fontSize:11,marginBottom:4,fontWeight:600},children:["Deadline ",r.jsx("span",{style:{color:"#ef4444"},children:"*"})]}),r.jsx("input",{type:"datetime-local",value:e.deadline,onChange:t=>ke(e.id,"deadline",t.target.value),style:{background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:6,padding:10,color:"var(--text)",fontSize:13}})]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",color:"#94a3b8",fontSize:11,marginBottom:4,fontWeight:600},children:"Description (optional)"}),r.jsx("textarea",{value:e.description,onChange:t=>ke(e.id,"description",t.target.value),placeholder:"Detailed requirements, expectations, or notes...",rows:2,style:{width:"100%",boxSizing:"border-box",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:6,padding:10,color:"var(--text)",fontSize:13,fontFamily:"inherit",resize:"vertical"}})]})]}),r.jsx("button",{onClick:()=>{return t=e.id,void I(R.filter(e=>e.id!==t));var t},title:"Remove task",style:{background:"transparent",border:"none",color:"#ef4444",fontSize:18,cursor:"pointer",padding:4,marginTop:20},children:r.jsx(y,{size:18})})]})},e.id))}),R.length>0&&r.jsxs("div",{style:{marginTop:16,padding:12,background:"rgba(245, 158, 11, 0.1)",borderRadius:8,display:"flex",alignItems:"center",gap:8,border:"1px solid rgba(245, 158, 11, 0.3)"},children:[r.jsx(B,{size:16,style:{color:"#f59e0b",flexShrink:0}}),r.jsx("span",{style:{color:"#f59e0b",fontSize:12},children:"Tasks become immutable after the collaborator accepts. Changes require mutual agreement."})]})]}),p&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13},children:p}),r.jsxs("div",{style:{marginTop:20,display:"flex",gap:12},children:[r.jsx("button",{onClick:()=>{if(se)if(a.trim())if(d<=0||d>Se)u(`Percentage must be between 1 and ${Se}%`);else{for(const e of R){if(!e.title.trim())return void u("All contract tasks must have a title");if(!e.deadline)return void u("All contract tasks must have a deadline")}u(""),we?Q(!0):Ce()}else u("Please select a role for the collaborator");else u("Please select a user to invite")},disabled:g||!se||!a.trim(),style:{background:se&&a.trim()?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#374151",border:"none",borderRadius:8,padding:"10px 24px",color:"#fff",fontWeight:600,cursor:!g&&se&&a.trim()?"pointer":"not-allowed",fontSize:14,opacity:g?.7:1},children:g?"Sending Invitation...":"Send Invitation"}),r.jsx("button",{onClick:()=>{s(!1),ae(null),te(""),u(""),l(""),k(null),C(!1),I([]),$(!0),F(!0),N(!1),O(!1)},style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 24px",color:"#94a3b8",cursor:"pointer",fontSize:14},children:"Cancel"})]})]}),Z&&r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:r.jsxs("div",{style:{background:"linear-gradient(135deg, #1e293b 0%, #0f172a 100%)",border:"2px solid #f59e0b",borderRadius:16,padding:32,maxWidth:500,width:"90%",boxShadow:"0 20px 60px rgba(245, 158, 11, 0.3)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:20},children:[r.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:"rgba(245, 158, 11, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx(B,{size:28,style:{color:"#f59e0b"}})}),r.jsx("h3",{style:{margin:0,color:"#f59e0b",fontSize:20,fontWeight:700},children:"Voting Power Warning"})]}),r.jsxs("div",{style:{background:"rgba(245, 158, 11, 0.1)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:12,padding:16,marginBottom:20},children:[r.jsxs("div",{style:{color:"#f8fafc",fontSize:15,lineHeight:1.6},children:["By allocating ",r.jsxs("strong",{style:{color:"#f59e0b"},children:[d,"%"]})," revenue share to this collaborator, you will:"]}),r.jsxs("ul",{style:{margin:"12px 0 0 0",paddingLeft:20,color:"#e2e8f0",fontSize:14,lineHeight:1.8},children:[d>=50&&_e<=50&&r.jsxs("li",{children:[r.jsx("strong",{style:{color:"#ef4444"},children:"Lose majority voting control"})," (",je,"% â†’ ",_e,"%)"]}),r.jsx("li",{children:"Require their approval for all project decisions"}),r.jsx("li",{children:"Need their agreement for revenue changes"}),50===d&&r.jsx("li",{style:{color:"#f59e0b"},children:"50/50 splits can lead to deadlocks on decisions"})]})]}),r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:8,padding:12,marginBottom:24},children:[r.jsx("div",{style:{color:"#fca5a5",fontSize:13,fontWeight:600,marginBottom:4},children:"Important:"}),r.jsx("div",{style:{color:"#f87171",fontSize:12},children:"Voting power equals revenue percentage. Allocations of 50% or more give collaborators significant control over project decisions including unpublishing after mint."})]}),r.jsx("div",{style:{color:"#94a3b8",fontSize:14,marginBottom:20},children:"Are you sure you want to proceed with this allocation?"}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:()=>Q(!1),style:{flex:1,padding:"12px 20px",borderRadius:8,border:"1px solid #64748b",background:"transparent",color:"#94a3b8",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Go Back"}),r.jsx("button",{onClick:Ce,disabled:g,style:{flex:1,padding:"12px 20px",borderRadius:8,border:"none",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",color:"#000",fontSize:14,fontWeight:700,cursor:g?"not-allowed":"pointer",opacity:g?.7:1},children:g?"Sending...":"I Understand, Proceed"})]})]})}),r.jsx(ze,{collaborators:ve,sections:ye,projectCreatorId:e.created_by}),ve.filter(e=>"accepted"===e.status&&e.tasks_total>0).length>0&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:18,display:"flex",alignItems:"center",gap:10},children:[r.jsx(fe,{size:20,style:{color:"#8b5cf6"}})," Contract Tasks"]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:20},children:ve.filter(e=>"accepted"===e.status&&e.tasks_total>0).map(i=>r.jsx(Ie,{collaboratorRole:i,currentUserId:t.id,isProjectOwner:be,projectId:e.id,onTaskUpdate:async()=>{const t=await j.getCollaborativeProject(e.id);null==n||n(t)}},i.id))})]}),ve.some(e=>null!=e.proposed_percentage&&!isNaN(Number(e.proposed_percentage))&&Math.abs(Number(e.proposed_percentage)-Number(e.revenue_percentage))>.001)&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Counter-Proposals"}),Y&&r.jsx("div",{style:{marginBottom:16,padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13},children:Y}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:ve.filter(e=>null!=e.proposed_percentage&&!isNaN(Number(e.proposed_percentage))&&Math.abs(Number(e.proposed_percentage)-Number(e.revenue_percentage))>.001).map(e=>{const t=H===e.id,i=Number(e.proposed_percentage)-Number(e.revenue_percentage);return r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8,border:"1px solid rgba(245, 158, 11, 0.3)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{fontSize:14,color:"var(--text)",fontWeight:600},children:["@",e.username]}),r.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:"proposes"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{fontSize:13,color:"#94a3b8",textDecoration:"line-through"},children:[e.revenue_percentage,"%"]}),r.jsxs("span",{style:{fontSize:16,color:"#f59e0b",fontWeight:700},children:[e.proposed_percentage,"%"]}),r.jsxs("span",{style:{fontSize:11,color:i>0?"#ef4444":"#10b981",fontWeight:500},children:["(",i>0?"+":"",i.toFixed(1),"%)"]})]})]}),e.counter_message&&r.jsxs("div",{style:{marginTop:8,fontSize:13,color:"#94a3b8",fontStyle:"italic"},children:['"',e.counter_message,'"']}),be&&r.jsx("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid rgba(148, 163, 184, 0.2)"},children:X===e.id?r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.05)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:8,padding:12},children:[r.jsx("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:8},children:"Add a note (optional):"}),r.jsx("textarea",{value:J,onChange:e=>K(e.target.value),placeholder:"Explain why you're declining...",maxLength:500,style:{width:"100%",minHeight:70,padding:10,background:"var(--bg)",border:"1px solid #334155",borderRadius:6,color:"#f8fafc",fontSize:13,resize:"vertical",marginBottom:10}}),r.jsxs("div",{style:{display:"flex",gap:8,justifyContent:"flex-end"},children:[r.jsx("button",{onClick:()=>{G(null),K("")},style:{padding:"8px 14px",background:"transparent",border:"1px solid #475569",borderRadius:6,color:"#94a3b8",fontSize:13,fontWeight:600,cursor:"pointer"},children:"Cancel"}),r.jsxs("button",{onClick:()=>Re(e.id,"decline",J||void 0),disabled:t,style:{padding:"8px 14px",background:"#ef4444",border:"none",borderRadius:6,color:"#fff",fontSize:13,fontWeight:600,cursor:t?"not-allowed":"pointer",opacity:t?.7:1,display:"flex",alignItems:"center",gap:6},children:[t?r.jsx(P,{size:14,style:{animation:"spin 1s linear infinite"}}):r.jsx(A,{size:14}),"Send Decline"]})]})]}):r.jsxs("div",{style:{display:"flex",gap:10},children:[r.jsxs("button",{onClick:()=>Re(e.id,"accept"),disabled:t,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:6,padding:"8px 16px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:6,color:"#fff",fontSize:13,fontWeight:600,cursor:t?"not-allowed":"pointer",opacity:t?.7:1},children:[t?r.jsx(P,{size:14,style:{animation:"spin 1s linear infinite"}}):r.jsx(W,{size:14}),"Accept"]}),r.jsxs("button",{onClick:()=>G(e.id),disabled:t,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:6,padding:"8px 16px",background:"transparent",border:"1px solid #ef4444",borderRadius:6,color:"#ef4444",fontSize:13,fontWeight:600,cursor:t?"not-allowed":"pointer",opacity:t?.7:1},children:[r.jsx(A,{size:14}),"Decline"]})]})})]},e.id)})})]})]})}const Be=new Map;function Pe(e){return Be.has(e)||Be.set(e,{activities:[],onlineUsers:[],currentlyEditing:[],lastUpdated:null,isPolling:!1,error:null}),Be.get(e)}const Ue=15e3,De=6e4,$e=50,Me=3,Fe=new Map,Ee=new Map;async function Ne(){try{const e=await fetch(`${b}/api/auth/csrf/`,{credentials:"include"}),t=await e.json();return(null==t?void 0:t.csrfToken)||""}catch(e){return""}}async function Le(e,t={}){const r=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...t.headers},...t});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error((null==e?void 0:e.error)||(null==e?void 0:e.detail)||`API request failed: ${r.status}`)}return r.json()}async function Oe(e,t=20){try{const r=await Le(`${b}/api/collaborative-projects/${e}/activities/?limit=${t}`),i=Pe(e);return i.activities=r.slice(0,$e),i.lastUpdated=new Date,i.error=null,Ge.emit("activity:updated",{projectId:e,activities:r}),r}catch(r){const t=Pe(e);return t.error=r,t.activities}}async function He(e){try{const t=await Le(`${b}/api/collaborative-projects/${e}/online-users/`),r=Pe(e),i=Date.now(),n=t.map(e=>({...e,is_online:new Date(e.last_seen).getTime()+De>i}));return r.onlineUsers=n,Ge.emit("activity:online-users",{projectId:e,onlineUsers:n}),n}catch(t){return Pe(e).onlineUsers}}async function qe(e){try{const t=await Le(`${b}/api/collaborative-projects/${e}/currently-editing/`);return Pe(e).currentlyEditing=t,Ge.emit("activity:currently-editing",{projectId:e,editing:t}),t}catch(t){return Pe(e).currentlyEditing}}async function Ye(e){try{const t=await Ne();await Le(`${b}/api/collaborative-projects/${e}/heartbeat/`,{method:"POST",headers:{"X-CSRFToken":t}})}catch(t){}}async function Ve(e){if(Pe(e).isPolling)try{await Promise.all([Oe(e,20),He(e),qe(e)]),await Ye(e),Ee.set(e,0)}catch(t){const r=(Ee.get(e)||0)+1;Ee.set(e,r),r>=Me&&(Xe(e),Ge.emit("activity:polling-error",{projectId:e,error:t,retryCount:r}))}}function Xe(e){const t=Pe(e);if(!t.isPolling)return;t.isPolling=!1;const r=Fe.get(e);r&&(clearInterval(r),Fe.delete(e)),Ge.emit("activity:polling-stopped",{projectId:e})}const Ge=new class{constructor(){t(this,"listeners",new Map)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const r=this.listeners.get(e);r&&r.delete(t)}emit(e,t){const r=this.listeners.get(e);r&&r.forEach(e=>{try{e(t)}catch(r){}})}clear(){this.listeners.clear()}};function Je(e){return{section_updated:"ðŸ“",comment_added:"ðŸ’¬",collaborator_joined:"ðŸ‘‹",collaborator_left:"ðŸ‘‹",approval_given:"âœ…",approval_requested:"ðŸ””",ready_for_mint:"ðŸŽ‰",project_minted:"ðŸª™",media_uploaded:"ðŸ“",invitation_sent:"ðŸ“¬"}[e]||"ðŸ“Œ"}function Ke(e){return{section_updated:"#3b82f6",comment_added:"#06b6d4",collaborator_joined:"#10b981",collaborator_left:"#64748b",approval_given:"#10b981",approval_requested:"#f59e0b",ready_for_mint:"#ec4899",project_minted:"#fbbf24",media_uploaded:"#8b5cf6",invitation_sent:"#f59e0b"}[e]||"#64748b"}function Ze(e){const t=new Date(e),r=new Date,i=Math.floor((r.getTime()-t.getTime())/1e3);return i<60?"just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<604800?`${Math.floor(i/86400)}d ago`:t.toLocaleDateString()}const Qe={getProjectActivities:Oe,getOnlineUsers:He,getCurrentlyEditing:qe,sendHeartbeat:Ye,startEditingSection:async function(e,t){try{const r=await Ne();await Le(`${b}/api/collaborative-projects/${e}/start-editing/`,{method:"POST",headers:{"X-CSRFToken":r},body:JSON.stringify({section_id:t})}),await qe(e)}catch(r){}},stopEditingSection:async function(e,t){try{const r=await Ne();await Le(`${b}/api/collaborative-projects/${e}/stop-editing/`,{method:"POST",headers:{"X-CSRFToken":r},body:JSON.stringify({section_id:t})}),await qe(e)}catch(r){}},logActivity:async function(e,t,r,i){try{const n=await Ne(),o=await Le(`${b}/api/collaborative-projects/${e}/log-activity/`,{method:"POST",headers:{"X-CSRFToken":n},body:JSON.stringify({activity_type:t,description:r,metadata:i})}),s=Pe(e);return s.activities=[o,...s.activities].slice(0,$e),Ge.emit("activity:new",{projectId:e,activity:o}),Ge.emit("activity:updated",{projectId:e,activities:s.activities}),o}catch(n){return null}},startPolling:function(e){const t=Pe(e);if(t.isPolling)return;t.isPolling=!0,Ee.set(e,0),Ve(e);const r=setInterval(()=>Ve(e),Ue);Fe.set(e,r),Ge.emit("activity:polling-started",{projectId:e})},stopPolling:Xe,isPolling:function(e){return Pe(e).isPolling},getState:function(e){return{...Pe(e)}},getCachedActivities:function(e){return[...Pe(e).activities]},getCachedOnlineUsers:function(e){return[...Pe(e).onlineUsers]},getCachedCurrentlyEditing:function(e){return[...Pe(e).currentlyEditing]},reset:function(e){Xe(e),Be.delete(e)},resetAll:function(){Fe.forEach((e,t)=>{Xe(t)}),Be.clear(),Ge.clear()},events:Ge,getActivityIcon:Je,getActivityColor:Ke,getTimeAgo:Ze,isUserEditingSection:function(e,t,r){return Pe(e).currentlyEditing.some(e=>e.user_id===t&&e.section_id===r)},getEditorsForSection:function(e,t){return Pe(e).currentlyEditing.filter(e=>e.section_id===t)}};function et(e){const{projectId:t,autoStart:r=!1,onNewActivity:n}=e,[o,s]=i.useState([]),[a,l]=i.useState([]),[d,c]=i.useState([]),[p,u]=i.useState(!1),[g,f]=i.useState(!1),[x,h]=i.useState(null),b=i.useRef(null),y=i.useCallback(async()=>{u(!0),h(null);try{const[e,r,i]=await Promise.all([Qe.getProjectActivities(t),Qe.getOnlineUsers(t),Qe.getCurrentlyEditing(t)]);s(e),l(r),c(i)}catch(e){h(e)}finally{u(!1)}},[t]),v=i.useCallback(async e=>{try{await Qe.startEditingSection(t,e),b.current=e}catch(r){throw h(r),r}},[t]),m=i.useCallback(async e=>{try{await Qe.stopEditingSection(t,e),b.current===e&&(b.current=null)}catch(r){throw h(r),r}},[t]),j=i.useCallback(async(e,r,i)=>{try{await Qe.logActivity(t,e,r,i)}catch(n){throw h(n),n}},[t]),S=i.useCallback(()=>{Qe.startPolling(t),f(!0)},[t]),k=i.useCallback(()=>{Qe.stopPolling(t),f(!1)},[t]),w=i.useCallback(e=>a.some(t=>t.user_id===e&&t.is_online),[a]),_=i.useCallback(e=>d.some(t=>t.section_id===e),[d]),z=i.useCallback(e=>d.filter(t=>t.section_id===e),[d]);return i.useEffect(()=>{const e=Ge.on("activity:updated",({projectId:e,activities:r})=>{e===t&&s(r)}),r=Ge.on("activity:new",({projectId:e,activity:r})=>{e===t&&n&&n(r)}),i=Ge.on("activity:online-users",({projectId:e,onlineUsers:r})=>{e===t&&l(r)}),o=Ge.on("activity:currently-editing",({projectId:e,editing:r})=>{e===t&&c(r)}),a=Ge.on("activity:polling-started",({projectId:e})=>{e===t&&f(!0)}),d=Ge.on("activity:polling-stopped",({projectId:e})=>{e===t&&f(!1)}),p=Ge.on("activity:polling-error",({projectId:e,error:r})=>{e===t&&(h(r),f(!1))});return()=>{e(),r(),i(),o(),a(),d(),p()}},[t,n]),i.useEffect(()=>(r&&(S(),y()),()=>{r&&(k(),null!==b.current&&Qe.stopEditingSection(t,b.current))}),[r,S,k,y,t]),{activities:o,onlineUsers:a,currentlyEditing:d,isLoading:p,isPolling:g,error:x,refresh:y,startEditing:v,stopEditing:m,logActivity:j,startPolling:S,stopPolling:k,isUserOnline:w,isSectionBeingEdited:_,getEditorsForSection:z}}function tt(e){switch(e){case"overdue":return"Overdue";case"today":return"Today";case"tomorrow":return"Tomorrow";case"this_week":return"This Week";case"this_month":return"This Month";case"older":return"Earlier";case"future":return"Upcoming";default:return"Other"}}function rt(e){const t=new Map;e.forEach(e=>{var r;let i;i="task"===e.type&&(null==(r=e.task)?void 0:r.is_overdue)?"overdue":function(e){const t=new Date,r=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=new Date(r);i.setDate(i.getDate()+1);const n=new Date(r);n.setDate(n.getDate()+2);const o=new Date(r);o.setDate(o.getDate()+7);const s=new Date(r);s.setMonth(s.getMonth()+1);const a=new Date(e.getFullYear(),e.getMonth(),e.getDate());return a<r?"older":a.getTime()===r.getTime()?"today":a.getTime()===i.getTime()?"tomorrow":a<o?"this_week":a<s?"this_month":"future"}(e.timestamp),t.has(i)||t.set(i,[]),t.get(i).push(e)});const r=[];return["overdue","today","tomorrow","this_week","this_month","future","older"].forEach(e=>{const i=t.get(e);i&&i.length>0&&r.push({group:e,label:tt(e),items:i})}),r}const it={overdue:{background:"rgba(239, 68, 68, 0.1)",borderColor:"#ef4444",textColor:"#f87171",icon:B,statusLabel:"Overdue",statusBg:"#ef444420"},due_today:{background:"rgba(245, 158, 11, 0.12)",borderColor:"#f59e0b",textColor:"#fbbf24",icon:f,statusLabel:"Due Today",statusBg:"#f59e0b20"},due_soon:{background:"rgba(245, 158, 11, 0.08)",borderColor:"#f59e0b",textColor:"#fbbf24",icon:f,statusLabel:"Due Soon",statusBg:"#f59e0b20"},pending:{background:"var(--bg)",borderColor:"#3b82f6",textColor:"var(--text)",icon:ge,statusLabel:"Pending",statusBg:"#3b82f620"},complete:{background:"rgba(245, 158, 11, 0.06)",borderColor:"#f59e0b",textColor:"#fbbf24",icon:Z,statusLabel:"Awaiting Sign-off",statusBg:"#f59e0b20"},signed_off:{background:"rgba(16, 185, 129, 0.08)",borderColor:"#10b981",textColor:"#34d399",icon:Z,statusLabel:"Signed Off",statusBg:"#10b98120"}};function nt({task:e,onViewDetails:t}){const i=function(e){if("signed_off"===e.status)return"signed_off";if("complete"===e.status)return"complete";if("cancelled"===e.status)return"pending";if(e.is_overdue)return"overdue";const t=e.days_until_deadline;if(void 0!==t){if(0===t)return"due_today";if(t<=3)return"due_soon"}return"pending"}(e),n=it[i],o=n.icon,s=new Date(e.deadline),a=s.toLocaleDateString("en-US",{month:"short",day:"numeric",year:s.getFullYear()!==(new Date).getFullYear()?"numeric":void 0});return r.jsx("div",{onClick:t,style:{background:n.background,borderLeft:`4px solid ${n.borderColor}`,borderRadius:8,padding:16,cursor:t?"pointer":"default",transition:"background 0.15s ease"},onMouseEnter:e=>{t&&(e.currentTarget.style.background="overdue"===i?"rgba(239, 68, 68, 0.15)":"due_today"===i||"due_soon"===i?"rgba(245, 158, 11, 0.15)":"rgba(59, 130, 246, 0.08)")},onMouseLeave:e=>{e.currentTarget.style.background=n.background},children:r.jsxs("div",{style:{display:"flex",alignItems:"flex-start",gap:12},children:[r.jsx("div",{style:{width:36,height:36,borderRadius:8,background:n.statusBg,display:"flex",alignItems:"center",justifyContent:"center",flexShrink:0},children:r.jsx(o,{size:18,style:{color:n.borderColor}})}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[r.jsx("h4",{style:{margin:0,fontSize:14,fontWeight:600,color:n.textColor,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsx("span",{style:{fontSize:12,color:n.textColor,whiteSpace:"nowrap",flexShrink:0},children:a})]}),r.jsxs("div",{style:{marginTop:4,display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{fontSize:12,color:"#94a3b8"},children:["@",e.collaborator_username]}),r.jsx("span",{style:{fontSize:12,color:"#64748b"},children:e.collaborator_role})]}),e.description&&e.description.length<=100&&r.jsx("p",{style:{margin:"8px 0 0",fontSize:13,color:"#94a3b8",lineHeight:1.4},children:e.description}),r.jsxs("div",{style:{marginTop:10,display:"flex",alignItems:"center",justifyContent:"space-between",gap:12},children:[r.jsx("span",{style:{fontSize:12,fontWeight:500,color:n.borderColor},children:(()=>{if("signed_off"===e.status)return e.signed_off_at?function(e){const t=new Date,r=e.getTime()-t.getTime(),i=Math.round(r/6e4),n=Math.round(r/36e5),o=Math.round(r/864e5);if(r<0){const e=Math.abs(o),t=Math.abs(n),r=Math.abs(i);return e>=1?`${e} day${e>1?"s":""} ago`:t>=1?`${t} hour${t>1?"s":""} ago`:r>=1?`${r} min${r>1?"s":""} ago`:"just now"}return o>=1?`in ${o} day${o>1?"s":""}`:n>=1?`in ${n} hour${n>1?"s":""}`:i>=1?`in ${i} min${i>1?"s":""}`:"now"}(new Date(e.signed_off_at)):"Completed";if("complete"===e.status)return"Awaiting review";if(e.is_overdue){const t=e.days_until_deadline?Math.abs(e.days_until_deadline):0;return`${t} day${1!==t?"s":""} overdue`}return void 0!==e.days_until_deadline?0===e.days_until_deadline?"Due today":1===e.days_until_deadline?"Due tomorrow":`${e.days_until_deadline} days left`:a})()}),r.jsx("span",{style:{fontSize:11,fontWeight:600,padding:"3px 8px",borderRadius:4,background:n.statusBg,color:n.borderColor,textTransform:"uppercase",letterSpacing:"0.02em"},children:"in_progress"===e.status?"In Progress":n.statusLabel})]})]})]})})}const ot={section_updated:{icon:z,color:"#3b82f6",label:"Section Updated"},comment_added:{icon:de,color:"#06b6d4",label:"Comment Added"},collaborator_joined:{icon:le,color:"#10b981",label:"Joined"},collaborator_left:{icon:ve,color:"#64748b",label:"Left"},approval_given:{icon:g,color:"#10b981",label:"Approved"},approval_requested:{icon:_,color:"#f59e0b",label:"Approval Requested"},ready_for_mint:{icon:ae,color:"#ec4899",label:"Ready for Mint"},project_minted:{icon:xe,color:"#fbbf24",label:"Minted"},media_uploaded:{icon:ee,color:"#8b5cf6",label:"Media Uploaded"},invitation_sent:{icon:Q,color:"#f59e0b",label:"Invitation Sent"}};function st({activity:e,compact:t=!1}){const i=ot[e.activity_type]||{icon:ue,color:"#64748b"},n=i.icon,o=Ze(e.created_at);return r.jsxs("div",{style:{display:"flex",alignItems:t?"center":"flex-start",gap:t?10:12,padding:t?"10px 14px":"14px 16px",background:"var(--bg)",borderLeft:`3px solid ${i.color}`,borderRadius:8,transition:"background 0.15s ease"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(255, 255, 255, 0.03)"},onMouseLeave:e=>{e.currentTarget.style.background="var(--bg)"},children:[r.jsxs("div",{style:{position:"relative",flexShrink:0},children:[r.jsx("div",{style:{width:t?32:40,height:t?32:40,borderRadius:"50%",background:e.avatar?`url(${e.avatar}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:t?12:14,fontWeight:700},children:!e.avatar&&e.username.charAt(0).toUpperCase()}),r.jsx("div",{style:{position:"absolute",bottom:-2,right:-2,width:t?16:18,height:t?16:18,borderRadius:"50%",background:i.color,border:"2px solid var(--bg)",display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx(n,{size:t?8:10,style:{color:"#fff"}})})]}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{fontSize:t?12:13,fontWeight:500,color:"var(--text)",lineHeight:1.4,marginBottom:t?2:4},children:e.description}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:t?10:11,color:"#64748b",flexWrap:"wrap"},children:[r.jsxs("span",{style:{color:i.color,fontWeight:600},children:["@",e.username]}),e.section_title&&r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{color:"#475569"},children:"in"}),r.jsx("span",{style:{color:"#94a3b8"},children:e.section_title})]}),r.jsx("span",{style:{color:"#475569"},children:"â€¢"}),r.jsx("span",{children:o})]})]})]})}const at={overdue:{color:"#ef4444",bgColor:"rgba(239, 68, 68, 0.15)"},today:{color:"#f59e0b",bgColor:"rgba(245, 158, 11, 0.1)"},tomorrow:{color:"#3b82f6",bgColor:"rgba(59, 130, 246, 0.1)"},this_week:{color:"#8b5cf6",bgColor:"rgba(139, 92, 246, 0.1)"},this_month:{color:"#06b6d4",bgColor:"rgba(6, 182, 212, 0.1)"},future:{color:"#10b981",bgColor:"rgba(16, 185, 129, 0.1)"},older:{color:"#64748b",bgColor:"rgba(100, 116, 139, 0.1)"}};function lt({items:e,isLoading:t=!1,onTaskClick:i}){const n=rt(e),o=e.filter(e=>"task"===e.type).length,s=e.filter(e=>"activity"===e.type).length,a=e.filter(e=>{var t;return"task"===e.type&&(null==(t=e.task)?void 0:t.is_overdue)}).length;return t?r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",padding:60,color:"#94a3b8"},children:"Loading timeline..."}):0===e.length?r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:48,textAlign:"center"},children:[r.jsx("div",{style:{width:64,height:64,borderRadius:"50%",background:"rgba(139, 92, 246, 0.1)",display:"flex",alignItems:"center",justifyContent:"center",margin:"0 auto 16px"},children:r.jsx(be,{size:28,style:{color:"#8b5cf6"}})}),r.jsx("h3",{style:{margin:"0 0 8px",color:"var(--text)",fontSize:16,fontWeight:600},children:"No Timeline Items"}),r.jsx("p",{style:{margin:0,color:"#64748b",fontSize:14},children:"Tasks and activities will appear here as your team collaborates."})]}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[r.jsxs("div",{style:{display:"flex",gap:16,flexWrap:"wrap"},children:[a>0&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:8},children:[r.jsx(be,{size:16,style:{color:"#ef4444"}}),r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"#ef4444"},children:[a," overdue"]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx(be,{size:16,style:{color:"#3b82f6"}}),r.jsxs("span",{style:{fontSize:13,color:"#94a3b8"},children:[o," task",1!==o?"s":""]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx(ue,{size:16,style:{color:"#8b5cf6"}}),r.jsxs("span",{style:{fontSize:13,color:"#94a3b8"},children:[s," activit",1!==s?"ies":"y"]})]})]}),n.map(e=>r.jsx(dt,{group:e,onTaskClick:i},e.group))]})}function dt({group:e,onTaskClick:t}){const i=at[e.group]||at.older;return r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:12},children:[r.jsx("div",{style:{padding:"6px 14px",background:i.bgColor,borderRadius:6,fontSize:12,fontWeight:700,color:i.color,textTransform:"uppercase",letterSpacing:"0.04em"},children:e.label}),r.jsx("div",{style:{flex:1,height:1,background:"var(--panel-border)"}}),r.jsxs("span",{style:{fontSize:12,color:"#64748b"},children:[e.items.length," item",1!==e.items.length?"s":""]})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:10},children:e.items.map(e=>r.jsx("div",{children:"task"===e.type&&e.task?r.jsx(nt,{task:e.task,onViewDetails:t?()=>t(e.task.id):void 0}):"activity"===e.type&&e.activity?r.jsx(st,{activity:e.activity}):null},e.id))})]})}function ct({project:e,currentUser:t}){const{activities:n,onlineUsers:o,isPolling:s}=et({projectId:e.id,autoStart:!0}),a=i.useMemo(()=>function(e,t){const r=[];return e.forEach(e=>{e.contract_tasks&&e.contract_tasks.length>0&&e.contract_tasks.forEach(t=>{let i;i=t.signed_off_at?new Date(t.signed_off_at):t.marked_complete_at?new Date(t.marked_complete_at):new Date(t.deadline);const n=t.is_overdue?0:1;r.push({id:`task-${t.id}`,type:"task",timestamp:i,sortPriority:n,task:{id:t.id,title:t.title,description:t.description,deadline:t.deadline,status:t.status,is_overdue:t.is_overdue,days_until_deadline:t.days_until_deadline,collaborator_username:e.username,collaborator_id:e.user,collaborator_role:e.role,marked_complete_at:t.marked_complete_at,signed_off_at:t.signed_off_at}})})}),t.forEach(e=>{r.push({id:`activity-${e.id}`,type:"activity",timestamp:new Date(e.created_at),sortPriority:2,activity:e})}),r.sort((e,t)=>e.sortPriority!==t.sortPriority?e.sortPriority-t.sortPriority:"task"===e.type&&"task"===t.type?e.timestamp.getTime()-t.timestamp.getTime():t.timestamp.getTime()-e.timestamp.getTime())}(e.collaborators||[],n),[e.collaborators,n]);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsx(ue,{size:20,style:{color:"#8b5cf6"}}),r.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:20,fontWeight:600},children:"Project Timeline"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"8px 14px",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:s?"#10b981":"#64748b",boxShadow:s?"0 0 6px rgba(16, 185, 129, 0.5)":"none"}}),r.jsxs("span",{style:{fontSize:13,color:"#94a3b8"},children:[o.length," collaborator",1!==o.length?"s":""," online"]})]})]}),o.length>0&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"12px 16px",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:10},children:[r.jsx("span",{style:{fontSize:12,color:"#64748b",marginRight:8},children:"Online now:"}),r.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:o.map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"4px 10px",background:"rgba(16, 185, 129, 0.1)",borderRadius:20},children:[r.jsx("div",{style:{width:6,height:6,borderRadius:"50%",background:"#10b981"}}),r.jsxs("span",{style:{fontSize:12,color:"#10b981",fontWeight:500},children:["@",e.username]})]},e.user_id))})]}),r.jsx(lt,{items:a})]})}function pt({project:e,currentUser:t,onProjectUpdate:n}){const[o,s]=i.useState("customize"),[a,l]=i.useState(!1),[d,c]=i.useState(""),[p,u]=i.useState(!1),[g,f]=i.useState(e.teaser_percent||10),[x,h]=i.useState(e.watermark_preview||!1),[b,y]=i.useState(parseFloat(String(e.price_usd))||1),[v,m]=i.useState(e.editions||1),[S,k]=i.useState(e.authors_note||""),w=e.collaborators||[],_=w.filter(e=>"accepted"===e.status),z=e.sections||[],C=w.find(e=>e.user===t.id),R=e.created_by===t.id,I=Boolean(e.title&&e.title.trim().length>=3&&!e.title.startsWith("Collaboration Invite")),T=z.length>0,W=z.filter(e=>"text"===e.section_type),A="book"!==e.content_type||W.some(e=>(e.content_html||""||"").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim().length>=50),B=z.filter(e=>"text"!==e.section_type),P=!["art","music","video"].includes(e.content_type)||B.some(e=>e.media_file),U=b>0,D=v>=1,$=_.filter(e=>(e.tasks_total||0)>0),M=0===$.length||$.every(e=>e.all_tasks_complete),F=$.reduce((e,t)=>e+((t.tasks_total||0)-(t.tasks_signed_off||0)),0),E=e.has_active_breach||_.some(e=>e.has_active_breach),N=_.every(e=>!1!==e.warranty_of_originality_acknowledged),L=[{id:"title",label:"Valid project title",checked:I,hint:I?void 0:"Set a title (min 3 characters, not a placeholder)"},{id:"content",label:"book"===e.content_type?"Book has text content (min 50 characters)":`${e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)} has media files`,checked:T&&("book"===e.content_type?A:P),hint:T?"book"!==e.content_type||A?void 0:"Add at least 50 characters of text":"Add at least one section"},{id:"price",label:"Price set (greater than $0)",checked:U,hint:U?void 0:"Set a price for your NFT"},{id:"editions",label:"Edition count set",checked:D,hint:D?void 0:"Set at least 1 edition"},{id:"splits",label:"Revenue splits total 100%",checked:Math.abs(w.reduce((e,t)=>e+parseFloat(String(t.revenue_percentage)),0)-100)<.01},{id:"tasks",label:"All contract tasks signed off",checked:M,hint:M?void 0:`${F} task${1===F?"":"s"} still need sign-off`},{id:"invited",label:"All collaborators responded",checked:w.every(e=>"accepted"===e.status||"declined"===e.status)},{id:"approved",label:"All collaborators approved",checked:e.is_fully_approved},{id:"no_disputes",label:"No active disputes",checked:!e.has_active_dispute,hint:e.has_active_dispute?"Resolve all disputes before minting":void 0},{id:"no_breaches",label:"No uncured breaches",checked:!E,hint:E?"All breaches must be cured or resolved":void 0},{id:"warranty",label:"All collaborators acknowledged warranty of originality",checked:N,hint:N?void 0:"All collaborators must acknowledge their work is original"}],O=L.every(e=>e.checked);i.useEffect(()=>{"minted"===e.status?s("share"):e.is_fully_approved&&s("mint")},[e.status,e.is_fully_approved]);const H=[{id:"customize",label:"Customize"},{id:"approve",label:"Approve"},{id:"mint",label:"Mint"},{id:"share",label:"Share"}],q=H.findIndex(e=>e.id===o),Y=.9*b*v*((null==C?void 0:C.revenue_percentage)||0)/100;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${H.length}, 1fr)`,gap:8,alignItems:"end"},children:H.map((t,i)=>{const n=t.id===o,a=i<q||"minted"===e.status,l=i<=q||"minted"===e.status;return r.jsxs("div",{onClick:()=>l&&s(t.id),style:{cursor:l?"pointer":"default"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:24,height:24,borderRadius:999,border:"1px solid var(--panel-border)",background:n?"var(--accent)":a?"#10b981":"var(--panel)",color:n||a?"#111":"var(--text-dim)",display:"grid",placeItems:"center",fontSize:12,fontWeight:700},children:a?"âœ“":i+1}),r.jsx("div",{style:{fontSize:13,color:n?"var(--text)":"var(--text-dim)",fontWeight:n?700:600},children:t.label})]}),r.jsx("div",{style:{height:3,marginTop:6,borderRadius:999,background:n?"radial-gradient(60% 100% at 50% 100%, rgba(245,158,11,0.9), rgba(245,158,11,0.2))":a?"#10b981":"transparent",boxShadow:n?"0 0 8px rgba(245,158,11,0.7)":"none"}})]},t.id)})}),q>0&&"share"!==o&&r.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:r.jsx("button",{onClick:()=>s(H[q-1].id),style:{background:"transparent",border:"1px solid var(--panel-border)",color:"var(--text-dim)",borderRadius:8,padding:"6px 12px",cursor:"pointer",fontSize:13},children:"Back"})}),d&&r.jsx("div",{style:{padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13},children:d}),"customize"===o&&r.jsx(ut,{isProjectLead:R,teaserPercent:g,setTeaserPercent:f,watermark:x,setWatermark:h,price:b,setPrice:y,editions:v,setEditions:m,authorsNote:S,setAuthorsNote:k,onNext:R?async()=>{if(R){u(!0),c("");try{const t=await j.updateCustomization(e.id,{price_usd:b,editions:v,teaser_percent:g,watermark_preview:x,authors_note:S});null==n||n(t),s("approve")}catch(t){c(t.message||"Failed to save customization")}finally{u(!1)}}}:()=>s("approve"),saving:p,authorName:e.created_by_username||"Creator"}),"approve"===o&&r.jsx(gt,{project:e,currentUser:t,currentUserRole:C,acceptedCollaborators:_,checklistItems:L,price:b,editions:v,userEstimatedEarnings:Y,onApproveVersion:async()=>{try{const t=await j.approveCurrentVersion(e.id);null==n||n(t)}catch(t){c(t.message||"Failed to approve")}},onApproveRevenue:async()=>{try{const t=await j.approveProject(e.id,{approve_content:(null==C?void 0:C.approved_current_version)||!1,approve_revenue:!0});null==n||n(t)}catch(t){c(t.message||"Failed to approve revenue split")}},onNext:()=>s("mint")}),"mint"===o&&r.jsx(ft,{project:e,isProjectLead:R,allChecked:O,checklistItems:L,price:b,editions:v,minting:a,onMint:async()=>{if(O&&R){l(!0),c("");try{await j.mintProject(e.id);const t=await j.getCollaborativeProject(e.id);null==n||n(t),s("share")}catch(t){c(t.message||"Failed to mint project")}finally{l(!1)}}}}),"share"===o&&r.jsx(xt,{project:e})]})}function ut({isProjectLead:e,teaserPercent:t,setTeaserPercent:i,watermark:o,setWatermark:s,price:a,setPrice:l,editions:d,setEditions:c,authorsNote:p,setAuthorsNote:g,onNext:f,saving:x,authorName:h}){const b=p.trim().split(/\s+/).filter(e=>e.length>0).length;const y=b>100,[v,m]=n.useState(a>0?a.toString():""),[j,S]=n.useState(d.toString()),k=a*d,w=.1*k,_=k-w;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[!e&&r.jsxs("div",{style:{padding:16,background:"linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(245, 158, 11, 0.05) 100%)",border:"1px solid rgba(245, 158, 11, 0.3)",borderRadius:12,color:"#f59e0b",fontSize:14,display:"flex",alignItems:"center",gap:12},children:[r.jsx(ye,{size:20}),r.jsx("span",{children:"Only the project owner can modify these settings."})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:16,overflow:"hidden"},children:[r.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--panel-border)",background:"linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, transparent 100%)"},children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16,fontWeight:600,display:"flex",alignItems:"center",gap:10},children:[r.jsx(G,{size:20,style:{color:"#3b82f6"}}),"Free Preview"]}),r.jsx("p",{style:{margin:"6px 0 0",color:"#94a3b8",fontSize:13},children:"How much of your content can non-buyers see?"})]}),r.jsxs("div",{style:{padding:24},children:[r.jsx("div",{style:{marginBottom:24},children:r.jsxs("div",{style:{display:"flex",height:48,borderRadius:12,overflow:"hidden",border:"1px solid var(--panel-border)",background:"var(--bg)"},children:[r.jsx("div",{style:{width:`${t}%`,background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",display:"flex",alignItems:"center",justifyContent:"center",transition:"width 0.3s ease",minWidth:t>0?60:0},children:t>0&&r.jsxs("span",{style:{color:"#fff",fontSize:13,fontWeight:600},children:["Free ",t,"%"]})}),r.jsx("div",{style:{flex:1,background:"linear-gradient(135deg, rgba(245, 158, 11, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%)",display:"flex",alignItems:"center",justifyContent:"center",borderLeft:t>0&&t<100?"2px dashed var(--panel-border)":"none"},children:t<100&&r.jsxs("span",{style:{color:"#f59e0b",fontSize:13,fontWeight:600,display:"flex",alignItems:"center",gap:6},children:[r.jsx(ye,{size:14})," Paid ",100-t,"%"]})})]})}),r.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:12,marginBottom:20},children:[{label:"Sample",value:10,description:"Just a taste"},{label:"Preview",value:25,description:"First quarter"},{label:"Generous",value:50,description:"Half the content"},{label:"Most",value:75,description:"Almost all"}].map(n=>r.jsxs("button",{onClick:()=>e&&i(n.value),disabled:!e,style:{padding:"12px 8px",background:t===n.value?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"var(--bg)",border:t===n.value?"none":"1px solid var(--panel-border)",borderRadius:10,cursor:e?"pointer":"not-allowed",opacity:e?1:.6,transition:"all 0.2s ease"},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:t===n.value?"#111":"var(--text)"},children:n.label}),r.jsxs("div",{style:{fontSize:11,color:t===n.value?"#333":"#64748b",marginTop:2},children:[n.value,"%"]})]},n.value))}),r.jsxs("div",{style:{marginBottom:16},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[r.jsx("span",{style:{fontSize:12,color:"#64748b"},children:"Custom amount"}),r.jsxs("span",{style:{fontSize:12,color:"var(--text)",fontWeight:500},children:[t,"%"]})]}),r.jsx("input",{type:"range",min:0,max:100,step:5,value:t,onChange:e=>i(parseInt(e.target.value)),disabled:!e,style:{width:"100%",height:6,borderRadius:3,appearance:"none",background:`linear-gradient(to right, #10b981 0%, #10b981 ${t}%, var(--panel-border) ${t}%, var(--panel-border) 100%)`,cursor:e?"pointer":"not-allowed",opacity:e?1:.6}})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"14px 16px",background:"var(--bg)",borderRadius:10,cursor:e?"pointer":"not-allowed",opacity:e?1:.6},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:14,color:"var(--text)",fontWeight:500},children:"Watermark preview"}),r.jsx("div",{style:{fontSize:12,color:"#64748b",marginTop:2},children:"Add subtle branding to free preview content"})]}),r.jsxs("div",{style:{width:44,height:24,borderRadius:12,background:o?"#10b981":"var(--panel-border)",position:"relative",transition:"background 0.2s ease"},children:[r.jsx("div",{style:{width:20,height:20,borderRadius:10,background:"#fff",position:"absolute",top:2,left:o?22:2,transition:"left 0.2s ease",boxShadow:"0 1px 3px rgba(0,0,0,0.2)"}}),r.jsx("input",{type:"checkbox",checked:o,onChange:e=>s(e.target.checked),disabled:!e,style:{opacity:0,position:"absolute",width:"100%",height:"100%",cursor:"inherit"}})]})]})]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:16,overflow:"hidden"},children:[r.jsxs("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--panel-border)",background:"linear-gradient(135deg, rgba(16, 185, 129, 0.05) 0%, transparent 100%)"},children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16,fontWeight:600,display:"flex",alignItems:"center",gap:10},children:[r.jsx(u,{size:20,style:{color:"#10b981"}}),"Pricing"]}),r.jsx("p",{style:{margin:"6px 0 0",color:"#94a3b8",fontSize:13},children:"Set your price and edition count"})]}),r.jsxs("div",{style:{padding:24},children:[r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[r.jsxs("div",{children:[r.jsx("label",{style:{fontSize:13,color:"#94a3b8",display:"block",marginBottom:10},children:"Price per edition"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("span",{style:{position:"absolute",left:16,top:"50%",transform:"translateY(-50%)",color:"#64748b",fontSize:18,fontWeight:500},children:"$"}),r.jsx("input",{type:"text",inputMode:"decimal",placeholder:"0.00",value:v,onChange:e=>(e=>{m(e);const t=parseFloat(e);!isNaN(t)&&t>=0?l(t):""!==e&&"."!==e||l(0)})(e.target.value.replace(/[^0-9.]/g,"")),onBlur:()=>{const e=parseFloat(v);!isNaN(e)&&e>0?(m(e.toFixed(2)),l(e)):(m(""),l(0))},disabled:!e,style:{width:"100%",padding:"14px 16px 14px 36px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:10,color:"var(--text)",fontSize:18,fontWeight:500,outline:"none",transition:"border-color 0.2s ease",cursor:e?"text":"not-allowed",opacity:e?1:.6}}),r.jsx("span",{style:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",color:"#64748b",fontSize:12},children:"USD"})]})]}),r.jsxs("div",{children:[r.jsx("label",{style:{fontSize:13,color:"#94a3b8",display:"block",marginBottom:10},children:"Number of editions"}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("input",{type:"text",inputMode:"numeric",placeholder:"1",value:j,onChange:e=>(e=>{S(e);const t=parseInt(e);!isNaN(t)&&t>=1&&c(t)})(e.target.value.replace(/[^0-9]/g,"")),onBlur:()=>{const e=parseInt(j);!isNaN(e)&&e>=1?(S(e.toString()),c(e)):(S("1"),c(1))},disabled:!e,style:{width:"100%",padding:"14px 50px 14px 16px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:10,color:"var(--text)",fontSize:18,fontWeight:500,outline:"none",transition:"border-color 0.2s ease",cursor:e?"text":"not-allowed",opacity:e?1:.6}}),r.jsx("span",{style:{position:"absolute",right:16,top:"50%",transform:"translateY(-50%)",color:"#64748b",fontSize:12},children:"copies"})]})]})]}),a>0&&r.jsx("div",{style:{marginTop:20,padding:16,background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(16, 185, 129, 0.05) 100%)",borderRadius:12,border:"1px solid rgba(16, 185, 129, 0.2)"},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Potential earnings (if all sell)"}),r.jsxs("div",{style:{fontSize:24,fontWeight:700,color:"#10b981",marginTop:4},children:["$",_.toFixed(2)]})]}),r.jsxs("div",{style:{textAlign:"right",fontSize:12,color:"#64748b"},children:[r.jsxs("div",{children:["Gross: $",k.toFixed(2)]}),r.jsxs("div",{children:["Platform fee (10%): -$",w.toFixed(2)]})]})]})}),r.jsx("p",{style:{margin:"16px 0 0",fontSize:12,color:"#64748b"},children:"Changing price or editions will reset all revenue split approvals."})]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:16,overflow:"hidden"},children:[r.jsx("div",{style:{padding:"20px 24px",borderBottom:"1px solid var(--panel-border)",background:"linear-gradient(135deg, rgba(139, 92, 246, 0.05) 0%, transparent 100%)"},children:r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16,fontWeight:600,display:"flex",alignItems:"center",gap:10},children:[r.jsx(te,{size:20,style:{color:"#8b5cf6"}}),"Author's Note",r.jsx("span",{style:{fontSize:12,fontWeight:400,color:"#64748b"},children:"(optional)"})]}),r.jsx("p",{style:{margin:"6px 0 0",color:"#94a3b8",fontSize:13},children:"Share a personal message with your audience"})]}),r.jsxs("span",{style:{fontSize:12,color:y?"#ef4444":"#64748b",background:y?"rgba(239, 68, 68, 0.1)":"var(--bg)",padding:"4px 10px",borderRadius:20},children:[b,"/",100]})]})}),r.jsxs("div",{style:{padding:24},children:[r.jsx("textarea",{value:p,onChange:e=>g(e.target.value),placeholder:"Share the story behind this work, thank your collaborators, or leave a message for your readers...",disabled:!e,style:{width:"100%",minHeight:120,padding:16,background:"var(--bg)",border:"1px solid "+(y?"#ef4444":"var(--panel-border)"),borderRadius:12,color:"var(--text)",fontSize:14,lineHeight:1.6,resize:"vertical",fontFamily:"inherit",cursor:e?"text":"not-allowed",opacity:e?1:.6,outline:"none",transition:"border-color 0.2s ease"}}),y&&r.jsxs("div",{style:{fontSize:12,color:"#ef4444",marginTop:8,display:"flex",alignItems:"center",gap:6},children:[r.jsx(ce,{size:14}),"Please keep your note under ",100," words."]})]})]}),r.jsx(re,{authorName:h}),r.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:r.jsx("button",{onClick:f,disabled:e&&x||y,style:{padding:"14px 40px",background:x||y?"#374151":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:12,color:x||y?"#9ca3af":"#111",fontWeight:700,fontSize:15,cursor:x||y?"not-allowed":"pointer",boxShadow:x||y?"none":"0 4px 14px rgba(245, 158, 11, 0.4)",transition:"all 0.2s ease"},children:e?x?"Saving...":"Save & Continue":"Continue to Approve"})})]})}function gt({project:e,currentUser:t,currentUserRole:i,acceptedCollaborators:n,checklistItems:o,price:s,editions:a,userEstimatedEarnings:l,onApproveVersion:d,onApproveRevenue:c,onNext:p}){const u=(null==i?void 0:i.approved_current_version)&&(null==i?void 0:i.approved_revenue_split);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{background:e.is_fully_approved?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",border:"1px solid "+(e.is_fully_approved?"#10b981":"#f59e0b"),borderRadius:12,padding:20,display:"flex",alignItems:"center",gap:16},children:[r.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:e.is_fully_approved?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24},children:e.is_fully_approved?r.jsx(W,{size:24}):r.jsx(f,{size:24})}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:18,fontWeight:700,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:e.is_fully_approved?"All Approved!":"Awaiting Approvals"}),r.jsx("div",{style:{fontSize:14,color:"#94a3b8",marginTop:4},children:e.is_fully_approved?"All collaborators have approved. Proceed to mint.":"Waiting for all collaborators to approve content and revenue split."})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Your Approval"}),u?r.jsxs("div",{style:{textAlign:"center",padding:24,background:"rgba(16, 185, 129, 0.1)",borderRadius:8},children:[r.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:r.jsx(W,{size:48,style:{color:"#10b981"}})}),r.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#10b981"},children:"You've approved this project"})]}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Content Approval"}),r.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:12},children:"Confirm you're happy with all content in this project."}),r.jsx("button",{onClick:d,disabled:null==i?void 0:i.approved_current_version,style:{width:"100%",padding:"10px 16px",background:(null==i?void 0:i.approved_current_version)?"#374151":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:(null==i?void 0:i.approved_current_version)?"not-allowed":"pointer",fontSize:13},children:(null==i?void 0:i.approved_current_version)?"âœ“ Content Approved":"Approve Content"})]}),r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Revenue Split Approval"}),r.jsxs("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:12},children:["$",s.toFixed(2)," x ",a," editions = $",(s*a).toFixed(2)," gross. Your share: ",(null==i?void 0:i.revenue_percentage)||0,"% = $",l.toFixed(2)," (after 10% platform fee)"]}),r.jsx("button",{onClick:c,disabled:null==i?void 0:i.approved_revenue_split,style:{width:"100%",padding:"10px 16px",background:(null==i?void 0:i.approved_revenue_split)?"#374151":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:(null==i?void 0:i.approved_revenue_split)?"not-allowed":"pointer",fontSize:13},children:(null==i?void 0:i.approved_revenue_split)?"âœ“ Revenue Approved":"Approve Revenue Split"})]})]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Team Approval Status"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:n.map(e=>{const t=e.approved_current_version&&e.approved_revenue_split;return r.jsxs("div",{style:{padding:12,background:t?"rgba(16, 185, 129, 0.1)":"var(--bg)",border:"1px solid "+(t?"#10b981":"var(--panel-border)"),borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:t?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #64748b 0%, #475569 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:600},children:t?"âœ“":e.username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[e.role," - ",e.revenue_percentage,"%"]})]})]}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsxs("span",{style:{fontSize:10,padding:"3px 6px",borderRadius:4,background:e.approved_current_version?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",color:e.approved_current_version?"#10b981":"#64748b"},children:[e.approved_current_version?"âœ“":"â—‹"," Content"]}),r.jsxs("span",{style:{fontSize:10,padding:"3px 6px",borderRadius:4,background:e.approved_revenue_split?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",color:e.approved_revenue_split?"#10b981":"#64748b"},children:[e.approved_revenue_split?"âœ“":"â—‹"," Revenue"]})]})]},e.id)})})]})]}),e.is_fully_approved&&r.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:r.jsx("button",{onClick:p,style:{padding:"12px 32px",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,color:"#111",fontWeight:700,fontSize:14,cursor:"pointer"},children:"Next"})})]})}function ft({project:e,isProjectLead:t,allChecked:n,checklistItems:o,price:s,editions:a,minting:l,onMint:d}){const[c,p]=i.useState(!1),u=s*a,g=.1*u,f=u-g;return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:18},children:"Review & Mint"}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("h4",{style:{margin:"0 0 12px",color:"var(--text)",fontSize:14},children:"Pre-mint Checklist"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:o.map(e=>r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,padding:10,background:e.checked?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.05)",borderRadius:6,border:e.checked?"none":"1px solid rgba(239, 68, 68, 0.2)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:20,height:20,borderRadius:"50%",background:e.checked?"#10b981":"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:10},children:e.checked?"âœ“":"!"}),r.jsx("span",{style:{fontSize:13,color:e.checked?"#10b981":"var(--text)"},children:e.label})]}),!e.checked&&e.hint&&r.jsx("span",{style:{fontSize:11,color:"#ef4444",marginLeft:30},children:e.hint})]},e.id))})]}),r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8,marginBottom:24},children:[r.jsx("h4",{style:{margin:"0 0 12px",color:"var(--text)",fontSize:14},children:"Financial Summary"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,fontSize:13,color:"#94a3b8"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Price per edition:"}),r.jsxs("span",{style:{color:"var(--text)"},children:["$",s.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Editions:"}),r.jsx("span",{style:{color:"var(--text)"},children:a})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Gross Revenue (if all sold):"}),r.jsxs("span",{style:{color:"var(--text)"},children:["$",u.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Platform Fee (10%):"}),r.jsxs("span",{style:{color:"#ef4444"},children:["-$",g.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid var(--panel-border)",paddingTop:8},children:[r.jsx("span",{style:{fontWeight:600},children:"Creator Pool:"}),r.jsxs("span",{style:{color:"#10b981",fontWeight:600},children:["$",f.toFixed(2)]})]})]})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12},children:[r.jsx("a",{href:"/legal/terms",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Terms of Service"}),r.jsx("a",{href:"/legal/creator-agreement",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Creator Agreement"}),r.jsx("a",{href:"/legal/content-policy",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Content Policy"})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,marginTop:12,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:c,onChange:e=>p(e.target.checked)}),r.jsx("span",{style:{fontSize:13,color:"var(--text)"},children:"I agree to the Terms and understand fees"})]})]}),t?r.jsx("button",{onClick:d,disabled:!n||!c||l,style:{width:"100%",padding:"14px 24px",background:n&&c?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"#374151",border:"none",borderRadius:8,color:"#fff",fontWeight:700,fontSize:16,cursor:n&&c&&!l?"pointer":"not-allowed",opacity:n&&c?1:.5},children:l?"Minting...":"Mint & Publish NFT"}):r.jsx("div",{style:{textAlign:"center",padding:16,background:"rgba(245, 158, 11, 0.1)",borderRadius:8,color:"#f59e0b",fontSize:14},children:"Waiting for project owner to mint the NFT."}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:12,textAlign:"center"},children:"Once minted, content cannot be changed."})]})}function xt({project:e}){const t=`${window.location.origin}/collaborations/${e.id}`,[n,o]=i.useState(!1);return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,textAlign:"center"},children:[r.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:16},children:r.jsx(C,{size:64,style:{color:"#f59e0b"}})}),r.jsx("h3",{style:{margin:"0 0 8px",color:"var(--text)",fontSize:24},children:"Successfully Minted!"}),r.jsx("p",{style:{fontSize:14,color:"#94a3b8",marginBottom:24},children:"Your collaborative NFT is now live. Share it with the world!"}),r.jsxs("div",{style:{display:"flex",gap:8,maxWidth:500,margin:"0 auto 24px"},children:[r.jsx("input",{value:t,readOnly:!0,style:{flex:1,padding:"10px 14px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13}}),r.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t),o(!0),setTimeout(()=>o(!1),2e3)},style:{padding:"10px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13},children:n?"Copied!":"Copy Link"})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",gap:16},children:r.jsx("a",{href:`https://twitter.com/intent/tweet?text=Check out our collaborative NFT!&url=${encodeURIComponent(t)}`,target:"_blank",rel:"noreferrer",style:{padding:"10px 20px",background:"#1DA1F2",borderRadius:8,color:"#fff",fontWeight:600,textDecoration:"none",fontSize:13},children:"Share on X"})})]})}function ht(e){const{projectId:t,sectionId:r,includeResolved:n=!1,pollingInterval:o=0}=e,[s,a]=i.useState([]),[l,d]=i.useState([]),[c,p]=i.useState({}),[u,g]=i.useState(0),[f,x]=i.useState(0),[h,b]=i.useState(!1),[y,v]=i.useState(null);i.useEffect(()=>{const e=function(e){const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,{...e,replies:[]})}),e.forEach(e=>{const i=t.get(e.id);if(e.parent_comment){const n=t.get(e.parent_comment);n?n.replies.push(i):r.push(i)}else r.push(i)}),r}(s),t=function(e){const t={general:[]};return e.forEach(e=>{if(e.section){const r=e.section.toString();t[r]||(t[r]=[]),t[r].push(e)}else t.general.push(e)}),t}(s);d(e),p(t),g(s.filter(e=>!e.resolved).length),x(s.length)},[s]);const m=i.useCallback(async()=>{b(!0),v(null);try{let e;e=r?await j.getComments(t,r):await j.getComments(t),n||(e=e.filter(e=>!e.resolved)),a(e)}catch(e){v(e)}finally{b(!1)}},[t,r,n]),S=i.useCallback(async(e,i,n,o,s)=>{const l={project:t,content:e,mentions:i,attachments:n,parent_comment:o,section:s||r};try{const e=await j.addComment(l);return a(t=>[...t,e]),e}catch(d){throw v(d),d}},[t,r]),k=i.useCallback(async(e,t)=>{try{const r=await j.updateComment(e,t);return a(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw v(r),r}},[]),w=i.useCallback(async e=>{try{a(t=>t.filter(t=>t.id!==e)),await j.deleteComment(e)}catch(t){throw v(t),await m(),t}},[m]),_=i.useCallback(async e=>{try{const t=await j.resolveComment(e);return a(r=>r.map(r=>r.id===e?t:r)),t}catch(t){throw v(t),t}},[]),z=i.useCallback(async e=>{try{const t=await j.unresolveComment(e);return a(r=>r.map(r=>r.id===e?t:r)),t}catch(t){throw v(t),t}},[]),C=i.useCallback(async(e,t)=>{try{const r=await j.addReaction(e,t);a(t=>t.map(t=>t.id===e?{...t,reactions:[...t.reactions||[],r]}:t))}catch(r){throw v(r),r}},[]),R=i.useCallback(async(e,t)=>{try{await j.removeReaction(e,t),a(r=>r.map(r=>r.id===e?{...r,reactions:(r.reactions||[]).filter(e=>e.id!==t)}:r))}catch(r){throw v(r),r}},[]),I=i.useCallback(e=>s.find(t=>t.id===e),[s]),T=i.useCallback(e=>s.filter(t=>t.parent_comment===e),[s]);return i.useEffect(()=>{m()},[m]),i.useEffect(()=>{if(o<=0)return;const e=setInterval(()=>{m()},o);return()=>clearInterval(e)},[o,m]),{comments:l,commentsBySection:c,unresolvedCount:u,totalCount:f,isLoading:h,error:y,refresh:m,addComment:S,updateComment:k,deleteComment:w,resolveComment:_,unresolveComment:z,addReaction:C,removeReaction:R,getCommentById:I,getReplies:T}}function bt({userId:e,onlineUsers:t,size:i="medium",showLabel:n=!1,showLastSeen:o=!1}){const s=t.find(t=>t.user_id===e),a=(null==s?void 0:s.is_online)??!1,l=null==s?void 0:s.last_seen,d={small:6,medium:8,large:10}[i];return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},title:a?"Online":l?`Last seen ${Ze(l)}`:"Offline",children:[r.jsx("div",{"aria-label":a?"Online":"Offline",style:{width:d,height:d,borderRadius:"50%",background:a?"#10b981":"#64748b",boxShadow:a?"0 0 8px rgba(16, 185, 129, 0.5)":"none",transition:"all 0.3s"}}),n&&r.jsx("span",{style:{fontSize:"small"===i?10:"medium"===i?11:12,color:a?"#10b981":"#64748b",fontWeight:600},children:a?"Online":"Offline"}),!a&&o&&l&&r.jsx("span",{style:{fontSize:"small"===i?9:"medium"===i?10:11,color:"#64748b"},children:Ze(l)})]})}function yt({sectionId:e,currentlyEditing:t,currentUserId:i}){const n=t.filter(t=>t.section_id===e&&t.user_id!==i);if(0===n.length)return null;const o=n[0],s=n.length-1;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,padding:"6px 12px",background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",fontWeight:600},role:"status","aria-live":"polite",children:[r.jsx("span",{style:{display:"inline-block",animation:"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite"},children:"â³"}),r.jsxs("span",{children:["@",o.username," is editing",s>0&&` +${s} other${s>1?"s":""}`]}),r.jsx("style",{children:"\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      "})]})}function vt({activities:e,maxItems:t=20,showAvatar:i=!0,compact:n=!1}){const o=e.slice(0,t);return 0===o.length?r.jsxs("div",{style:{padding:n?16:32,textAlign:"center",color:"#64748b"},children:[r.jsx("div",{style:{fontSize:n?32:48,marginBottom:8},children:"ðŸ“‹"}),r.jsx("div",{style:{fontSize:n?12:14,fontWeight:600,marginBottom:4},children:"No activity yet"}),r.jsx("div",{style:{fontSize:n?11:12,color:"#64748b"},children:"Project activities will appear here"})]}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:n?6:8},children:o.map(e=>r.jsx(mt,{activity:e,showAvatar:i,compact:n},e.id))})}function mt({activity:e,showAvatar:t=!0,compact:i=!1}){const n=Je(e.activity_type),o=Ke(e.activity_type),s=Ze(e.created_at);return r.jsxs("div",{style:{display:"flex",alignItems:i?"center":"flex-start",gap:i?8:12,padding:i?"8px 12px":"12px 16px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderLeft:`3px solid ${o}`,borderRadius:8,transition:"all 0.2s",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.background="var(--panel)",e.currentTarget.style.borderLeftColor=o},onMouseLeave:e=>{e.currentTarget.style.background="var(--bg)",e.currentTarget.style.borderLeftColor=o},children:[t?r.jsxs("div",{style:{position:"relative",width:i?28:36,height:i?28:36,borderRadius:"50%",background:e.avatar?`url(${e.avatar}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:i?12:14,fontWeight:700,flexShrink:0},children:[!e.avatar&&e.username.charAt(0).toUpperCase(),r.jsx("div",{style:{position:"absolute",bottom:-2,right:-2,width:i?14:16,height:i?14:16,borderRadius:"50%",background:`${o}`,border:"2px solid var(--bg)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:i?8:9},children:n})]}):r.jsx("div",{style:{width:i?24:32,height:i?24:32,borderRadius:8,background:`${o}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:i?14:16,flexShrink:0},children:n}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{fontSize:i?12:13,fontWeight:600,color:"var(--text)",marginBottom:i?2:4,lineHeight:1.4},children:e.description}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:i?10:11,color:"#64748b"},children:[r.jsxs("span",{children:["@",e.username]}),e.section_title&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"â€¢"}),r.jsx("span",{style:{color:"#94a3b8"},children:e.section_title})]}),r.jsx("span",{children:"â€¢"}),r.jsx("span",{children:s})]})]}),!t&&!i&&r.jsx("div",{style:{padding:"2px 8px",background:`${o}20`,color:o,fontSize:10,fontWeight:700,borderRadius:4,textTransform:"uppercase",flexShrink:0},children:e.activity_type.replace(/_/g," ")})]})}function jt({projectId:e,sectionId:t,parentCommentId:n,collaborators:o,placeholder:s="Add a comment...",autoFocus:a=!1,onSubmit:l,onCancel:d,initialValue:c="",submitButtonText:p="Comment",compact:u=!1}){const[g,f]=i.useState(c),[x,h]=i.useState([]),[b,y]=i.useState([]),[v,m]=i.useState(!1),[j,S]=i.useState(!1),[k,w]=i.useState(""),[_,z]=i.useState([]),[C,R]=i.useState(0),[I,T]=i.useState(null),W=i.useRef(null),A=i.useRef(null),B=o.filter(e=>"accepted"===e.status).map(e=>({userId:e.user,username:e.username,displayName:e.display_name||e.username,avatar:void 0})),P=e=>{var t;if(null===I)return;const r=g.slice(0,I),i=g.slice((null==(t=W.current)?void 0:t.selectionStart)||g.length),n=`${r}@${e.username} ${i}`;f(n),S(!1),x.includes(e.userId)||h([...x,e.userId]),setTimeout(()=>{var t,r;const i=I+e.username.length+2;null==(t=W.current)||t.setSelectionRange(i,i),null==(r=W.current)||r.focus()},0)},U=async()=>{if(g.trim()||0!==b.length){m(!0);try{await l(g,x,b.length>0?b:void 0),f(""),h([]),y([])}catch(e){}finally{m(!1)}}};return i.useEffect(()=>{a&&W.current&&W.current.focus()},[a]),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:u?8:12,padding:u?12:16,position:"relative"},children:[r.jsxs("div",{style:{position:"relative"},children:[r.jsx("textarea",{ref:W,value:g,onChange:e=>{const t=e.target.value;f(t);const r=e.target.selectionStart,i=t.slice(0,r),n=i.lastIndexOf("@");if(-1!==n){const e=i.slice(n+1);if(!e.includes(" ")&&!e.includes("\n")){const t=e.toLowerCase();w(t),T(n);const r=B.filter(e=>e.username.toLowerCase().includes(t)||e.displayName.toLowerCase().includes(t));return z(r),S(r.length>0),void R(0)}}S(!1)},onKeyDown:e=>{j?"ArrowDown"===e.key?(e.preventDefault(),R(e=>e<_.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),R(e=>e>0?e-1:e)):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),_[C]&&P(_[C])):"Escape"===e.key&&S(!1):"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),U())},placeholder:s,style:{width:"100%",minHeight:u?60:80,maxHeight:200,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,padding:10,color:"var(--text)",fontSize:u?12:13,lineHeight:1.5,resize:"vertical",outline:"none",fontFamily:"inherit"}}),j&&r.jsx("div",{style:{position:"absolute",bottom:"100%",left:0,marginBottom:4,minWidth:200,maxWidth:300,background:"#1e293b",border:"1px solid #334155",borderRadius:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",maxHeight:200,overflowY:"auto",zIndex:1e3},children:_.map((e,t)=>r.jsxs("div",{onClick:()=>P(e),style:{padding:"8px 12px",cursor:"pointer",background:t===C?"#334155":"transparent",display:"flex",alignItems:"center",gap:8,transition:"background 0.2s"},onMouseEnter:()=>R(t),children:[r.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:11,fontWeight:700},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#e5e7eb",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["@",e.username]}),e.displayName!==e.username&&r.jsx("div",{style:{fontSize:11,color:"#94a3b8",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.displayName})]})]},e.userId))})]}),b.length>0&&r.jsx("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:b.map((e,t)=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:6,fontSize:12},children:[r.jsx("span",{children:"ðŸ“Ž"}),r.jsx("span",{style:{flex:1,color:"var(--text)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),r.jsxs("span",{style:{color:"#64748b",fontSize:11},children:[(e.size/1024).toFixed(1)," KB"]}),r.jsx("button",{onClick:()=>(e=>{y(b.filter((t,r)=>r!==e))})(t),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",fontSize:16,padding:0,lineHeight:1},children:"Ã—"})]},`${e.name}-${e.size}`))}),r.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[r.jsxs("div",{children:[r.jsx("input",{ref:A,type:"file",multiple:!0,style:{display:"none"},onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);y([...b,...t])}}}),r.jsx("button",{onClick:()=>{var e;return null==(e=A.current)?void 0:e.click()},disabled:v,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:u?"4px 10px":"6px 12px",color:"#94a3b8",cursor:v?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:600,display:"flex",alignItems:"center",gap:6},children:"ðŸ“Ž Attach"})]}),r.jsxs("div",{style:{display:"flex",gap:8},children:[d&&r.jsx("button",{onClick:d,disabled:v,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:u?"4px 12px":"6px 16px",color:"#94a3b8",cursor:v?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:600},children:"Cancel"}),r.jsx("button",{onClick:U,disabled:v||!g.trim()&&0===b.length,style:{background:v||!g.trim()&&0===b.length?"#374151":"#3b82f6",border:"none",borderRadius:6,padding:u?"4px 12px":"6px 16px",color:"#fff",cursor:v||!g.trim()&&0===b.length?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:700},children:v?"Posting...":p})]})]}),!u&&r.jsxs("div",{style:{marginTop:8,fontSize:10,color:"#64748b"},children:["Tip: Use @ to mention collaborators â€¢ ",navigator.platform.includes("Mac")?"Cmd":"Ctrl","+Enter to submit"]})]})}const St=["ðŸ‘","ðŸ‘Ž","â¤ï¸","ðŸ˜Š","ðŸŽ‰","ðŸ”¥","ðŸ‘€","ðŸ¤”"];function kt({comment:e,currentUserId:t,onReaction:n,onRemoveReaction:o}){const[s,a]=i.useState(!1),[l,d]=i.useState(!1),c=i.useRef(null),p={};e.reactions&&e.reactions.forEach(e=>{p[e.emoji]||(p[e.emoji]=[]),p[e.emoji].push(e)});const u=e=>{var r;return null==(r=p[e])?void 0:r.find(e=>e.user_id===t)},g=async e=>{const t=u(e);d(!0);try{t?await o(t.id):await n(e)}catch(r){}finally{d(!1),a(!1)}};return i.useEffect(()=>{if(!s)return;const e=e=>{c.current&&!c.current.contains(e.target)&&a(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[s]),r.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:6,marginTop:8},children:[Object.entries(p).map(([e,t])=>{const i=!!u(e);return r.jsxs("button",{onClick:()=>g(e),disabled:l,title:t.map(e=>e.username).join(", "),style:{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",background:i?"rgba(59, 130, 246, 0.2)":"rgba(100, 116, 139, 0.1)",border:"1px solid "+(i?"#3b82f6":"#334155"),borderRadius:12,cursor:l?"not-allowed":"pointer",fontSize:14,transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[r.jsx("span",{children:e}),r.jsx("span",{style:{fontSize:11,fontWeight:600,color:i?"#3b82f6":"#94a3b8"},children:t.length})]},e)}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>a(!s),disabled:l,style:{padding:"4px 8px",background:"transparent",border:"1px solid #334155",borderRadius:12,cursor:l?"not-allowed":"pointer",fontSize:14,color:"#94a3b8",transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.color="#3b82f6")},onMouseLeave:e=>{e.currentTarget.style.borderColor="#334155",e.currentTarget.style.color="#94a3b8"},children:"+"}),s&&r.jsx("div",{ref:c,style:{position:"absolute",bottom:"100%",left:0,marginBottom:4,background:"#1e293b",border:"1px solid #334155",borderRadius:12,padding:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4,zIndex:100},children:St.map(e=>r.jsx("button",{onClick:()=>g(e),disabled:l,style:{width:40,height:40,padding:0,background:u(e)?"rgba(59, 130, 246, 0.2)":"transparent",border:u(e)?"1px solid #3b82f6":"1px solid transparent",borderRadius:8,cursor:l?"not-allowed":"pointer",fontSize:20,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.background="rgba(59, 130, 246, 0.1)",e.currentTarget.style.transform="scale(1.1)")},onMouseLeave:t=>{t.currentTarget.style.background=u(e)?"rgba(59, 130, 246, 0.2)":"transparent",t.currentTarget.style.transform="scale(1)"},children:e},e))})]})]})}function wt({comment:e,projectId:t,currentUserId:n,collaborators:o,depth:s=0,maxDepth:a=3,onReply:l,onEdit:d,onDelete:c,onResolve:p,onUnresolve:u,onReaction:g,onRemoveReaction:f}){const[x,h]=i.useState(!1),[b,y]=i.useState(!1),[v,m]=i.useState(!1),[j,S]=i.useState(!1),k=e.author===n,w=s<a;return r.jsxs("div",{style:{display:"flex",gap:12,opacity:e.resolved?.6:1,transition:"opacity 0.2s"},children:[s>0&&r.jsx("div",{style:{width:2,background:"#334155",flexShrink:0,marginLeft:16}}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{background:"var(--bg)",border:"1px solid "+(e.resolved?"#10b981":"var(--panel-border)"),borderRadius:8,padding:12},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:e.author_avatar?`url(${e.author_avatar}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:700},children:!e.author_avatar&&e.author_username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.author_username]}),e.edited&&r.jsx("span",{style:{marginLeft:6,fontSize:11,color:"#64748b",cursor:e.edit_history?"pointer":"default"},onClick:()=>e.edit_history&&S(!j),title:e.edit_history?"Click to see edit history":void 0,children:"(edited)"})]}),r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:"â€¢"}),r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:Ze(e.created_at)}),e.section_title&&r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:"â€¢"}),r.jsx("span",{style:{fontSize:10,color:"#94a3b8",background:"rgba(59, 130, 246, 0.1)",padding:"2px 6px",borderRadius:4},children:e.section_title})]}),e.resolved&&r.jsx("span",{style:{fontSize:10,color:"#10b981",background:"rgba(16, 185, 129, 0.1)",padding:"2px 6px",borderRadius:4,fontWeight:600},title:e.resolved_by_username?`Resolved by @${e.resolved_by_username}`:"Resolved",children:"âœ“ Resolved"})]}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>m(!v),style:{background:"transparent",border:"none",color:"#94a3b8",cursor:"pointer",fontSize:18,padding:"2px 6px",lineHeight:1},children:"â‹®"}),v&&r.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:4,background:"#1e293b",border:"1px solid #334155",borderRadius:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",minWidth:150,zIndex:100},children:[k&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>{y(!0),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:"#e5e7eb",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"âœï¸ Edit"}),r.jsx("button",{onClick:async()=>{confirm("Are you sure you want to delete this comment?")&&await c(e.id),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:"#ef4444",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"ðŸ—‘ï¸ Delete"})]}),r.jsx("button",{onClick:async()=>{e.resolved?await u(e.id):await p(e.id),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:e.resolved?"#94a3b8":"#10b981",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:e.resolved?"â†©ï¸ Unresolve":"âœ“ Resolve"})]})]})]}),j&&e.edit_history&&e.edit_history.length>0&&r.jsxs("div",{style:{marginBottom:8,padding:8,background:"rgba(100, 116, 139, 0.1)",border:"1px solid #334155",borderRadius:6,fontSize:11,color:"#94a3b8"},children:[r.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Edit History:"}),e.edit_history.map(e=>r.jsxs("div",{style:{marginBottom:4},children:[r.jsxs("span",{style:{color:"#64748b"},children:[new Date(e.edited_at).toLocaleString(),":"]})," ",e.content]},e.edited_at))]}),b?r.jsx(jt,{projectId:t,collaborators:o,onSubmit:async t=>{await(async t=>{await d(e.id,t),y(!1)})(t)},onCancel:()=>y(!1),initialValue:e.content,submitButtonText:"Save",compact:!0}):r.jsx("div",{style:{fontSize:13,color:"#cbd5e1",lineHeight:1.6,marginBottom:8,whiteSpace:"pre-wrap"},children:e.content}),e.attachments&&e.attachments.length>0&&r.jsx("div",{style:{marginTop:8,marginBottom:8,display:"flex",flexDirection:"column",gap:6},children:e.attachments.map(e=>r.jsxs("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:6,fontSize:12,color:"#3b82f6",textDecoration:"none",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.1)"},children:[r.jsx("span",{children:"ðŸ“Ž"}),r.jsx("span",{style:{flex:1},children:e.filename}),r.jsxs("span",{style:{fontSize:11,color:"#94a3b8"},children:[(e.file_size/1024).toFixed(1)," KB"]})]},e.id))}),r.jsx(kt,{comment:e,currentUserId:n,onReaction:t=>g(e.id,t),onRemoveReaction:t=>f(e.id,t)}),!b&&r.jsx("div",{style:{marginTop:8,display:"flex",gap:12,fontSize:12},children:w&&r.jsx("button",{onClick:()=>h(!x),style:{background:"transparent",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:12,fontWeight:600,padding:0},children:"Reply"})})]}),x&&r.jsx("div",{style:{marginTop:12},children:r.jsx(jt,{projectId:t,parentCommentId:e.id,collaborators:o,placeholder:`Reply to @${e.author_username}...`,onSubmit:async(t,r,i)=>{await l(e.id,t,r,i),h(!1)},onCancel:()=>h(!1),submitButtonText:"Reply",compact:!0,autoFocus:!0})}),e.replies&&e.replies.length>0&&r.jsx("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:12},children:e.replies.map(e=>r.jsx(wt,{comment:e,projectId:t,currentUserId:n,collaborators:o,depth:s+1,maxDepth:a,onReply:l,onEdit:d,onDelete:c,onResolve:p,onUnresolve:u,onReaction:g,onRemoveReaction:f},e.id))})]})]})}function _t({project:e,pendingCollaborators:t,onClose:n,onSubmit:o}){const[s,a]=i.useState(new Set(t.map(e=>e.user))),[l,d]=i.useState(""),[c,p]=i.useState(7);return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:n,children:r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,maxWidth:500,width:"90%",maxHeight:"80vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{style:{margin:0,marginBottom:20,fontSize:20,fontWeight:700,color:"var(--text)"},children:"Request Approval from Team"}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:12},children:"Send approval request to:"}),0===t.length?r.jsx("div",{style:{padding:16,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8,fontSize:13,color:"#10b981",textAlign:"center"},children:"All collaborators have already approved!"}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:t.map(e=>r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:12,background:s.has(e.user)?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid "+(s.has(e.user)?"#3b82f6":"var(--panel-border)"),borderRadius:8,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:t=>{s.has(e.user)||(t.currentTarget.style.background="rgba(59, 130, 246, 0.05)")},onMouseLeave:t=>{s.has(e.user)||(t.currentTarget.style.background="var(--bg)")},children:[r.jsx("input",{type:"checkbox",checked:s.has(e.user),onChange:()=>(e=>{const t=new Set(s);t.has(e)?t.delete(e):t.add(e),a(t)})(e.user),style:{cursor:"pointer"}}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]})]},e.user))})]}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Message (optional):"}),r.jsx("textarea",{value:l,onChange:e=>d(e.target.value),placeholder:"Hi team! I think we're ready to mint this. Please review and approve if you're satisfied.",style:{width:"100%",minHeight:100,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"}})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Approval deadline:"}),r.jsxs("select",{value:c,onChange:e=>p(Number(e.target.value)),style:{width:"100%",padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,cursor:"pointer",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"},children:[r.jsx("option",{value:1,children:"1 day"}),r.jsx("option",{value:3,children:"3 days"}),r.jsx("option",{value:7,children:"7 days"}),r.jsx("option",{value:14,children:"14 days"}),r.jsx("option",{value:30,children:"30 days"})]})]}),r.jsx("div",{style:{marginBottom:20,padding:12,background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:8,fontSize:12,color:"#94a3b8",lineHeight:1.5},children:"Selected collaborators will receive a notification and email with your message. They can approve anytime before the deadline."}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:n,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"Cancel"}),r.jsx("button",{onClick:()=>{0!==s.size?o(Array.from(s),l,c):alert("Please select at least one collaborator to request approval from.")},disabled:0===t.length||0===s.size,style:{flex:1,padding:"12px 20px",background:0===t.length||0===s.size?"#374151":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:0===t.length||0===s.size?"not-allowed":"pointer",boxShadow:0===t.length||0===s.size?"none":"0 4px 12px rgba(59, 130, 246, 0.3)",transition:"all 0.2s"},onMouseEnter:e=>{t.length>0&&s.size>0&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(59, 130, 246, 0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=0===t.length||0===s.size?"none":"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"Send Approval Request"})]})]})})}function zt({project:e,currentUserId:t,onClose:n,onApprove:o}){var s,a,l,d,c,p;const[u,g]=i.useState(!1),[f,x]=i.useState(!1),[h,b]=i.useState(""),y=null==(s=e.collaborators)?void 0:s.find(e=>e.user===t),v=(null==y?void 0:y.approved_current_version)&&(null==y?void 0:y.approved_revenue_split),m=u&&f,j=(null==(a=e.sections)?void 0:a.length)||0,S=(null==(l=e.sections)?void 0:l.filter(e=>"text"===e.section_type?e.content_html&&""!==e.content_html.trim():!!e.media_file).length)||0,k=(null==(d=e.collaborators)?void 0:d.reduce((e,t)=>e+t.revenue_percentage,0))||0,w=Math.abs(k-100)<.01;return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},onClick:n,children:r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,maxWidth:600,width:"100%",maxHeight:"90vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{style:{margin:0,marginBottom:8,fontSize:22,fontWeight:700,color:"var(--text)"},children:v?"Review Your Approval":"Approve Project"}),r.jsx("p",{style:{margin:0,marginBottom:24,fontSize:14,color:"#94a3b8"},children:v?"You've already approved this project. Review the details below.":"Review the project details and approve if everything looks good."}),r.jsxs("div",{style:{marginBottom:24,padding:16,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:16,fontWeight:700,color:"var(--text)"},children:e.title}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Type:"})," ",e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)]}),r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Sections:"})," ",S," / ",j," completed",S===j&&j>0&&r.jsx("span",{style:{color:"#10b981",marginLeft:8},children:"âœ“"})]}),r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Collaborators:"})," ",(null==(c=e.collaborators)?void 0:c.filter(e=>"accepted"===e.status).length)||0]})]})]}),r.jsxs("div",{style:{marginBottom:24,padding:16,background:w?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid "+(w?"#10b981":"#ef4444"),borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Revenue Split"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:null==(p=e.collaborators)?void 0:p.filter(e=>"accepted"===e.status).map(e=>{const i=e.user===t;return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,background:i?"rgba(59, 130, 246, 0.1)":"transparent",border:i?"1px solid #3b82f6":"none",borderRadius:6},children:[r.jsxs("div",{children:[r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,i&&" (you)"]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),r.jsxs("div",{style:{fontSize:16,fontWeight:700,color:i?"#3b82f6":"#10b981"},children:[e.revenue_percentage,"%"]})]},e.id)})}),r.jsxs("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid var(--panel-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:13,fontWeight:700,color:"var(--text)"},children:"Total:"}),r.jsxs("span",{style:{fontSize:16,fontWeight:700,color:w?"#10b981":"#ef4444"},children:[k.toFixed(1),"%"]})]}),!w&&r.jsx("div",{style:{marginTop:12,fontSize:12,color:"#ef4444",fontWeight:600},children:"Revenue splits must total 100%"})]}),!v&&r.jsxs("div",{style:{marginBottom:24,padding:16,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Approval Checklist"}),r.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,marginBottom:12,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:u,onChange:e=>g(e.target.checked),style:{marginTop:2,cursor:"pointer"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:4},children:"I approve the current version of the content"}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:"I have reviewed all sections and am satisfied with the quality and content."})]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:f,onChange:e=>x(e.target.checked),style:{marginTop:2,cursor:"pointer"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:4},children:"I approve the revenue split"}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:["I agree to the revenue distribution shown above (",null==y?void 0:y.revenue_percentage,"% for me)."]})]})]})]}),!v&&r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Feedback (optional):"}),r.jsx("textarea",{value:h,onChange:e=>b(e.target.value),placeholder:"Any comments or suggestions for the team...",style:{width:"100%",minHeight:80,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"}})]}),!v&&r.jsx("div",{style:{marginBottom:20,padding:12,background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",lineHeight:1.5},children:"By approving, you confirm that you're ready for this project to be minted as an NFT. This approval cannot be undone."}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:n,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:v?"Close":"Cancel"}),!v&&r.jsx("button",{onClick:()=>{m?o(h.trim()||void 0):alert("Please check both approval boxes before proceeding.")},disabled:!m||!w,style:{flex:1,padding:"12px 20px",background:m&&w?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#374151",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:m&&w?"pointer":"not-allowed",boxShadow:m&&w?"0 4px 12px rgba(16, 185, 129, 0.3)":"none",transition:"all 0.2s"},onMouseEnter:e=>{m&&w&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(16, 185, 129, 0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=m&&w?"0 4px 12px rgba(16, 185, 129, 0.3)":"none"},children:"Approve Project"})]}),v&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8,fontSize:13,color:"#10b981",textAlign:"center",fontWeight:600},children:"You have already approved this project"})]})})}const Ct={validating:{label:"Validating Project",description:"Checking project data and approvals...",icon:"ðŸ”"},uploading:{label:"Uploading to IPFS",description:"Storing content on decentralized storage...",icon:"â˜ï¸"},creating_contract:{label:"Creating Smart Contract",description:"Deploying NFT contract on blockchain...",icon:"ðŸ“œ"},minting:{label:"Minting NFT",description:"Creating your unique NFT token...",icon:"âœ¨"},finalizing:{label:"Finalizing",description:"Completing the process and updating records...",icon:"ðŸŽ¯"},completed:{label:"Minting Complete!",description:"Your NFT has been successfully created.",icon:"ðŸŽ‰"},error:{label:"Minting Failed",description:"An error occurred during the minting process.",icon:"âŒ"}};function Rt({project:e,onClose:t,onComplete:n}){const[o,s]=i.useState("validating"),[a,l]=i.useState(null),[d,c]=i.useState(null),p=["validating","uploading","creating_contract","minting","finalizing"],u=p.indexOf(o),g="completed"===o?100:(u+1)/p.length*100;i.useEffect(()=>{if("error"===o||"completed"===o)return;const t=setTimeout(()=>{const t=p.indexOf(o);t<p.length-1?s(p[t+1]):(s("completed"),c({id:`nft-${e.id}`,tokenId:`${Math.floor(1e4*Math.random())}`,contractAddress:"0x"+Array(40).fill(0).map(()=>Math.floor(16*Math.random()).toString(16)).join(""),ipfsHash:"Qm"+Array(44).fill(0).map(()=>"abcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(36*Math.random())]).join("")}),n&&n(`nft-${e.id}`))},2e3+1e3*Math.random());return()=>clearTimeout(t)},[o]);return r.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:e=>{e.target===e.currentTarget&&(()=>{if("completed"!==o&&"error"!==o&&!confirm("Minting is still in progress. Are you sure you want to close this window?"))return;t()})()},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:32,maxWidth:500,width:"90%"},onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[r.jsx("div",{style:{fontSize:48,marginBottom:16},children:Ct[o].icon}),r.jsx("h2",{style:{margin:0,marginBottom:8,fontSize:24,fontWeight:700,color:"var(--text)"},children:Ct[o].label}),r.jsx("p",{style:{margin:0,fontSize:14,color:"#94a3b8"},children:Ct[o].description})]}),"completed"!==o&&"error"!==o&&r.jsxs("div",{style:{marginBottom:32},children:[r.jsx("div",{style:{height:8,background:"#1e293b",borderRadius:4,overflow:"hidden",marginBottom:8},children:r.jsx("div",{style:{height:"100%",width:`${g}%`,background:"linear-gradient(90deg, #3b82f6 0%, #2563eb 100%)",transition:"width 0.5s ease"}})}),r.jsxs("div",{style:{fontSize:12,color:"#94a3b8",textAlign:"center"},children:[Math.round(g),"% complete"]})]}),r.jsx("div",{style:{marginBottom:24},children:p.map((e,t)=>{const i=t<u,n=e===o,s=t>u;return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,marginBottom:8,background:n?"rgba(59, 130, 246, 0.1)":i?"rgba(16, 185, 129, 0.1)":"transparent",border:"1px solid "+(n?"#3b82f6":i?"#10b981":"var(--panel-border)"),borderRadius:8,opacity:s?.5:1,transition:"all 0.3s"},children:[r.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:i?"#10b981":n?"#3b82f6":"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:700,flexShrink:0},children:i?"âœ“":t+1}),r.jsx("div",{style:{flex:1},children:r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:Ct[e].label})}),n&&r.jsx("div",{style:{fontSize:16,animation:"spin 1s linear infinite"},children:"â³"})]},e)})}),"error"===o&&a&&r.jsx("div",{style:{marginBottom:24,padding:16,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,fontSize:13,color:"#ef4444",lineHeight:1.5},children:a}),"completed"===o&&d&&r.jsxs("div",{style:{marginBottom:24,padding:16,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"#10b981"},children:"NFT Details"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"Token ID:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontWeight:600},children:d.tokenId})]}),r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"Contract:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontSize:10,wordBreak:"break-all"},children:d.contractAddress})]}),r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"IPFS:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontSize:10,wordBreak:"break-all"},children:d.ipfsHash})]})]})]}),"completed"===o&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsx("button",{onClick:()=>{alert("Navigate to NFT view")},style:{width:"100%",padding:"14px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(16, 185, 129, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 12px rgba(16, 185, 129, 0.3)"},children:"View NFT"}),r.jsx("button",{onClick:t,style:{width:"100%",padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"Close"})]}),"error"===o&&r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:()=>{s("validating"),l(null)},style:{flex:1,padding:"12px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"Retry"}),r.jsx("button",{onClick:t,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Close"})]}),"completed"!==o&&"error"!==o&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:8,fontSize:12,color:"#94a3b8",textAlign:"center",lineHeight:1.5},children:"This process may take a few minutes. Please don't close this window."})]}),r.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "})]})}function It({project:e,currentUserId:t,onApprovalRequest:n,onApprove:o,onMint:s}){var a;const[l,d]=i.useState(!1),[c,p]=i.useState(!1),[u,g]=i.useState(!1),[f,x]=i.useState([]),h=e.created_by===t,b=(null==(a=e.collaborators)?void 0:a.filter(e=>"accepted"===e.status))||[],y=b.filter(e=>e.approved_current_version&&e.approved_revenue_split),v=b.filter(e=>!e.approved_current_version||!e.approved_revenue_split),m=b.find(e=>e.user===t),j=(null==m?void 0:m.approved_current_version)&&(null==m?void 0:m.approved_revenue_split),S=b.length>0?y.length/b.length:0;i.useEffect(()=>{var t,r,i;const n=[],o=e.sections&&e.sections.length>0,s=(null==(t=e.sections)?void 0:t.every(e=>"text"===e.section_type?e.content_html&&""!==e.content_html.trim():!!e.media_file))??!1;n.push({id:"sections",label:"All sections completed",checked:o&&s,required:!0});const a=(null==(r=e.collaborators)?void 0:r.reduce((e,t)=>e+t.revenue_percentage,0))||0,l=Math.abs(a-100)<.01;n.push({id:"revenue",label:"Revenue splits agreed (totals 100%)",checked:l,required:!0});const d=(null==(i=e.collaborators)?void 0:i.every(e=>"accepted"===e.status))??!0;n.push({id:"collaborators",label:"All collaborators invited/accepted",checked:d,required:!0});const c=e.is_fully_approved;n.push({id:"approvals",label:"Approval from all collaborators",checked:c,required:!0}),x(n)},[e]);const k=f.filter(e=>e.required).every(e=>e.checked),w=f.slice(0,3).every(e=>e.checked)&&!j,_=k&&e.is_fully_approved,z=h&&f.slice(0,3).every(e=>e.checked);return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"8px",fontSize:"13px",marginBottom:"20px",border:"1px solid #3b82f6"},children:["ðŸŒ ",r.jsx("strong",{children:"Devnet Mode:"})," This NFT will be minted on Solana devnet for testing. Not a real NFT."]}),r.jsx("h2",{style:{margin:0,marginBottom:20,fontSize:20,fontWeight:700,color:"var(--text)"},children:"Ready to Mint?"}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Pre-mint Checklist:"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:f.map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:10,background:e.checked?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",border:"1px solid "+(e.checked?"#10b981":"#334155"),borderRadius:8},children:[r.jsx("span",{style:{fontSize:16},children:e.checked?"âœ…":"â³"}),r.jsx("span",{style:{fontSize:13,color:e.checked?"#10b981":"#94a3b8",fontWeight:600},children:e.label})]},e.id))})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("span",{style:{fontSize:14,fontWeight:700,color:"var(--text)"},children:"Approval Progress:"}),r.jsxs("span",{style:{fontSize:14,fontWeight:700,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:[y.length," / ",b.length]})]}),r.jsx("div",{style:{height:8,background:"#1e293b",borderRadius:4,overflow:"hidden",marginBottom:12},children:r.jsx("div",{style:{height:"100%",width:100*S+"%",background:e.is_fully_approved?"linear-gradient(90deg, #10b981 0%, #059669 100%)":"linear-gradient(90deg, #f59e0b 0%, #d97706 100%)",transition:"width 0.3s"}})}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:b.map(e=>{const i=e.approved_current_version&&e.approved_revenue_split,n=e.user===t;return r.jsxs("div",{style:{padding:10,background:i?"rgba(16, 185, 129, 0.1)":"rgba(251, 191, 36, 0.1)",border:"1px solid "+(i?"rgba(16, 185, 129, 0.3)":"rgba(251, 191, 36, 0.3)"),borderRadius:8,display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:16},children:i?"âœ…":"â³"}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,n&&" (you)"]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),!i&&n&&r.jsx("button",{onClick:()=>p(!0),style:{padding:"4px 12px",background:"#3b82f6",border:"none",borderRadius:6,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"},children:"Approve"})]},e.id)})})]}),r.jsxs("div",{style:{marginBottom:24,padding:12,background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",lineHeight:1.5},children:["âš ï¸ ",r.jsx("strong",{children:"Note:"})," Once minting starts, content cannot be changed. Make sure everything is perfect!"]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[w&&r.jsx("button",{onClick:()=>d(!0),style:{width:"100%",padding:"12px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"ðŸ“¨ Request Approval"}),!j&&f.slice(0,3).every(e=>e.checked)&&r.jsx("button",{onClick:()=>p(!0),style:{width:"100%",padding:"12px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)"},children:"âœ“ Approve Project"}),_&&r.jsx("button",{onClick:async()=>{if(!_)return;if(confirm("Are you sure you want to mint this project as an NFT? This action cannot be undone.")){g(!0);try{s&&await s()}catch(e){}}},style:{width:"100%",padding:"16px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:16,fontWeight:700,cursor:"pointer",boxShadow:"0 6px 16px rgba(16, 185, 129, 0.4)"},children:"ðŸš€ Mint NFT"}),!_&&z&&h&&v.length>0&&r.jsx("button",{onClick:async()=>{if(!z)return;if(confirm(`WARNING: Force minting will proceed without approval from all collaborators.\n\n${v.length} collaborator(s) haven't approved yet.\n\nAre you sure you want to continue?`)){g(!0);try{s&&await s()}catch(e){}}},style:{width:"100%",padding:"12px 20px",background:"transparent",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13,fontWeight:600,cursor:"pointer"},children:"âš ï¸ Force Mint (Creator Override)"})]}),l&&r.jsx(_t,{project:e,pendingCollaborators:v,onClose:()=>d(!1),onSubmit:()=>{d(!1),n&&n()}}),c&&r.jsx(zt,{project:e,currentUserId:t,onClose:()=>p(!1),onApprove:()=>{p(!1),o&&o()}}),u&&r.jsx(Rt,{project:e,onClose:()=>g(!1)})]})}function Tt({project:e,currentUser:t,onSectionUpdate:n,onCommentAdd:o,onProjectUpdate:s}){const[a,l]=i.useState(e.sections||[]),[d,c]=i.useState(e.collaborators||[]),[p,u]=i.useState(null),[g,f]=i.useState(!1),[x,h]=i.useState(null),[b,y]=i.useState(""),[v,m]=i.useState(!1),[S,k]=i.useState(!1),[w,_]=i.useState(!1),[z,C]=i.useState(!1),[R,I]=i.useState(!1),[T,W]=i.useState("comments"),{activities:A,onlineUsers:B,currentlyEditing:P,startEditing:U,stopEditing:D,logActivity:$}=et({projectId:e.id,autoStart:!0}),{comments:M,unresolvedCount:F,totalCount:E,isLoading:N,addComment:L,updateComment:O,deleteComment:H,resolveComment:q,unresolveComment:Y,addReaction:V,removeReaction:X}=ht({projectId:e.id,includeResolved:R,pollingInterval:3e4}),G=d.find(e=>e.user===t.id),J=i.useCallback(e=>{if(!G)return!1;return(G.can_edit||[]).includes(e)},[G]),K=i.useCallback(e=>e.owner===t.id,[t.id]);i.useEffect(()=>{Z()},[e.id]);const Z=async()=>{try{const t=await j.getProjectSections(e.id);l(t)}catch(t){y(t.message||"Failed to load sections")}},Q=async(e,t,r,i)=>{try{await L(t,r,i,e),await $("comment_added","Replied to a comment",{parent_comment_id:e})}catch(n){y(n.message||"Failed to reply to comment")}},ee=e=>{switch(e){case"text":return"#3b82f6";case"image":return"#8b5cf6";case"audio":return"#f59e0b";case"video":return"#ef4444";default:return"#64748b"}},te={total:d.filter(e=>"accepted"===e.status).length,approved:d.filter(e=>"accepted"===e.status&&e.approved_current_version&&e.approved_revenue_split).length},re=e.is_fully_approved,ie=(null==G?void 0:G.approved_current_version)&&(null==G?void 0:G.approved_revenue_split);return r.jsxs("div",{style:{width:"100%",height:"90vh",display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 0"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:24,fontWeight:700},children:e.title}),r.jsxs("div",{style:{marginTop:4,fontSize:14,color:"#94a3b8"},children:[e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)," Project"," â€¢ ","Status: ",e.status.replace(/_/g," ")]})]}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:async()=>{_(!0)},style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"8px 16px",color:"var(--text)",cursor:"pointer",fontSize:14,fontWeight:600},children:"ðŸ‘ï¸ Preview"}),G&&!ie&&r.jsx("button",{onClick:async()=>{try{const t=await j.approveCurrentVersion(e.id);null==s||s(t),alert("Version approved! ðŸŽ‰"),await $("approval_given","Approved current version",{project_status:t.status})}catch(t){y(t.message||"Failed to approve version")}},style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,padding:"8px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14},children:"âœ“ Approve Version"}),re&&"ready_for_mint"===e.status&&r.jsx("button",{style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,padding:"8px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14},children:"ðŸš€ Ready to Mint"})]})]}),b&&r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,padding:12,color:"#ef4444",fontSize:14},children:[b,r.jsx("button",{onClick:()=>y(""),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",float:"right",fontWeight:700,fontSize:18},children:"Ã—"})]}),r.jsxs("div",{style:{display:"flex",gap:16,flex:1,overflow:"hidden"},children:[r.jsxs("div",{style:{width:280,display:"flex",flexDirection:"column",gap:12,overflow:"auto"},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[r.jsxs("h3",{style:{margin:0,fontSize:14,fontWeight:700,color:"var(--text)"},children:["Collaborators (",d.length,")"]}),e.created_by===t.id&&r.jsx("button",{onClick:()=>k(!0),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"4px 8px",color:"#94a3b8",cursor:"pointer",fontSize:11},children:"+ Invite"})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:d.map(e=>r.jsxs("div",{style:{padding:10,background:e.user===t.id?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx(bt,{userId:e.user,onlineUsers:B,size:"small"}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,e.user===t.id&&" (you)"]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[e.role," â€¢ ",e.revenue_percentage,"%"]})]})]}),"accepted"===e.status&&r.jsx("div",{style:{marginTop:6,fontSize:10,color:"#94a3b8"},children:e.approved_current_version&&e.approved_revenue_split?r.jsx("span",{style:{color:"#10b981"},children:"âœ“ Approved"}):r.jsx("span",{children:"â³ Pending approval"})})]},e.id))})]}),r.jsxs("div",{style:{background:re?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",border:"1px solid "+(re?"#10b981":"#f59e0b"),borderRadius:12,padding:12},children:[r.jsx("div",{style:{fontSize:12,fontWeight:600,color:re?"#10b981":"#f59e0b",marginBottom:6},children:re?"âœ“ Fully Approved":"â³ Awaiting Approvals"}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[te.approved," of ",te.total," collaborators approved"]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,flex:1,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,borderBottom:"1px solid var(--panel-border)",paddingBottom:8},children:[r.jsxs("button",{onClick:()=>W("comments"),style:{background:"comments"===T?"#3b82f6":"transparent",color:"comments"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:12,fontWeight:600,cursor:"pointer",flex:1},children:["Comments (",E,")",F>0&&r.jsx("span",{style:{marginLeft:4,fontSize:10,background:"#f59e0b",padding:"2px 5px",borderRadius:8},children:F})]}),r.jsxs("button",{onClick:()=>W("activity"),style:{background:"activity"===T?"#3b82f6":"transparent",color:"activity"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:12,fontWeight:600,cursor:"pointer",flex:1},children:["Activity (",A.length,")"]}),r.jsxs("button",{onClick:()=>W("minting"),style:{background:"minting"===T?"#10b981":"transparent",color:"minting"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:11,fontWeight:600,cursor:"pointer",flex:1},children:[re?"âœ“":"â³"," Mint"]})]}),"comments"===T&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:8},children:[r.jsx("button",{onClick:()=>m(!v),style:{background:"#3b82f6",border:"none",borderRadius:6,padding:"6px 12px",color:"#fff",cursor:"pointer",fontSize:11,fontWeight:600,flex:1},children:"+ Add Comment"}),r.jsxs("button",{onClick:()=>I(!R),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"6px 12px",color:"#94a3b8",cursor:"pointer",fontSize:10,fontWeight:600},children:[R?"Hide":"Show"," Resolved"]})]}),F>0&&r.jsxs("div",{style:{marginBottom:12,padding:"6px 10px",background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:6,fontSize:11,color:"#f59e0b",fontWeight:600,textAlign:"center"},children:[F," unresolved comment",1!==F?"s":""]}),v&&r.jsx("div",{style:{marginBottom:12},children:r.jsx(jt,{projectId:e.id,collaborators:d,onSubmit:async(e,t,r)=>{try{const i=await L(e,t,r);null==o||o(i),await $("comment_added",`Added a comment: ${e.substring(0,50)}${e.length>50?"...":""}`,{comment_id:i.id}),m(!1)}catch(i){y(i.message||"Failed to add comment")}},onCancel:()=>m(!1),compact:!0,autoFocus:!0})}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12,overflow:"auto",flex:1},children:N&&0===M.length?r.jsx("div",{style:{padding:20,textAlign:"center",color:"#94a3b8",fontSize:12},children:"Loading comments..."}):0===M.length?r.jsxs("div",{style:{padding:20,textAlign:"center",color:"#64748b",fontSize:12},children:[r.jsx("div",{style:{fontSize:32,marginBottom:8},children:"ðŸ’¬"}),r.jsx("div",{children:"No comments yet"}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:4},children:"Be the first to comment!"})]}):M.map(i=>r.jsx(wt,{comment:i,projectId:e.id,currentUserId:t.id,collaborators:d,onReply:Q,onEdit:O,onDelete:H,onResolve:q,onUnresolve:Y,onReaction:V,onRemoveReaction:X},i.id))})]}),"activity"===T&&r.jsx("div",{style:{overflow:"auto",flex:1},children:r.jsx(vt,{activities:A,maxItems:20,compact:!0})}),"minting"===T&&r.jsx("div",{style:{overflow:"auto",flex:1},children:r.jsx(It,{project:e,currentUserId:t.id,onApprovalRequest:async()=>{try{const t=await j.getCollaborativeProject(e.id);null==s||s(t),await $("approval_requested","Requested approval from collaborators")}catch(t){y(t.message||"Failed to request approval")}},onApprove:async()=>{try{const t=await j.approveProject(e.id,{approve_content:!0,approve_revenue:!0});null==s||s(t),await $("approval_given","Approved project for minting")}catch(t){y(t.message||"Failed to approve project")}},onMint:async()=>{try{const t=await j.mintProject(e.id),r=await j.getCollaborativeProject(e.id);null==s||s(r),await $("project_minted",`Project minted as NFT (Token ID: ${t.token_id})`),alert(`Project successfully minted! NFT Token ID: ${t.token_id}`)}catch(t){y(t.message||"Failed to mint project")}}})})]})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:12,overflow:"auto"},children:[0===a.length?r.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:32,textAlign:"center",color:"#94a3b8"},children:r.jsx("div",{style:{fontSize:16,marginBottom:16},children:"No sections yet. Add your first section to get started!"})}):a.map((i,o)=>r.jsx(Wt,{section:i,sectionNumber:o+1,canEdit:K(i)||e.created_by===t.id,isOwner:K(i),isEditing:p===i.id,onStartEdit:async()=>{u(i.id),await U(i.id)},onStopEdit:async()=>{p===i.id&&(await D(i.id),u(null))},onUpdate:e=>(async(e,t)=>{f(!0);try{const r=await j.updateProjectSection(e,t);l(a.map(t=>t.id===e?r:t)),h(new Date),null==n||n(r),await $("section_updated",`Updated ${r.section_type} section: ${r.title}`,{section_id:e,section_type:r.section_type})}catch(r){y(r.message||"Failed to update section")}finally{f(!1)}})(i.id,e),onDelete:()=>(async e=>{if(confirm("Are you sure you want to delete this section?"))try{await j.deleteProjectSection(e),l(a.filter(t=>t.id!==e))}catch(t){y(t.message||"Failed to delete section")}})(i.id),onMediaUpload:e=>(async(e,t)=>{f(!0);try{const r=await j.updateProjectSection(e,{media_file:t});l(a.map(t=>t.id===e?r:t)),h(new Date),null==n||n(r)}catch(r){y(r.message||"Failed to upload media")}finally{f(!1)}})(i.id,e),saving:g,currentlyEditing:P,currentUserId:t.id},i.id)),r.jsxs("div",{style:{background:"var(--panel)",border:"1px dashed var(--panel-border)",borderRadius:12,padding:16},children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:12},children:"Add Section"}),r.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["text","image","audio","video"].map(t=>{const i=J(t);return r.jsxs("button",{onClick:()=>(async t=>{if(J(t))try{const r=await j.createProjectSection({project:e.id,section_type:t,title:`New ${t} section`,content_html:"text"===t?"":void 0,order:a.length});l([...a,r]),u(r.id),null==n||n(r)}catch(r){y(r.message||"Failed to create section")}else y(`You don't have permission to create ${t} sections`)})(t),disabled:!i,style:{background:i?ee(t):"#374151",border:"none",borderRadius:8,padding:"8px 16px",color:"#fff",cursor:i?"pointer":"not-allowed",fontSize:12,fontWeight:600,opacity:i?1:.5},children:["text"===t&&"ðŸ“","image"===t&&"ðŸ–¼ï¸","audio"===t&&"ðŸŽµ","video"===t&&"ðŸŽ¬"," ",t.charAt(0).toUpperCase()+t.slice(1)]},t)})})]}),g&&r.jsx("div",{style:{fontSize:12,color:"#f59e0b",textAlign:"right"},children:"Saving..."}),!g&&x&&r.jsxs("div",{style:{fontSize:12,color:"#10b981",textAlign:"right"},children:["Saved ",At(x)]})]})]})]})}function Wt({section:e,sectionNumber:t,canEdit:n,isOwner:o,isEditing:s,onStartEdit:a,onStopEdit:l,onUpdate:d,onDelete:c,onMediaUpload:p,saving:u,currentlyEditing:g,currentUserId:f}){const[x,h]=i.useState(e.title),[b,y]=i.useState(e.content_html||""),v=g.filter(t=>t.section_id===e.id&&t.user_id!==f).length>0;i.useEffect(()=>{if(!n||"text"!==e.section_type)return;const t=setTimeout(()=>{x===e.title&&b===e.content_html||d({title:x,content_html:b})},3e3);return()=>clearTimeout(t)},[x,b,e.id]);const m=e=>{switch(e){case"text":return"#3b82f6";case"image":return"#8b5cf6";case"audio":return"#f59e0b";case"video":return"#ef4444";default:return"#64748b"}};return r.jsxs("div",{style:{background:"var(--panel)",border:`2px solid ${n?m(e.section_type):"var(--panel-border)"}`,borderRadius:12,padding:20,position:"relative"},onClick:()=>n&&!s&&a(),children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12,flexWrap:"wrap",gap:12},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flex:1},children:[r.jsx("span",{style:{fontSize:20},children:(e=>{switch(e){case"text":return"ðŸ“";case"image":return"ðŸ–¼ï¸";case"audio":return"ðŸŽµ";case"video":return"ðŸŽ¬";default:return"ðŸ“„"}})(e.section_type)}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:["Section ",t,": ",e.section_type,!n&&r.jsxs("span",{style:{marginLeft:8,fontSize:11,color:"#ef4444"},children:["ðŸ”’ @",e.owner_username,"'s section"]})]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:["Owner: @",e.owner_username]})]})]}),r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[v&&r.jsx(yt,{sectionId:e.id,currentlyEditing:g,currentUserId:f}),n&&r.jsx("button",{onClick:e=>{e.stopPropagation(),l&&l(),c()},style:{background:"transparent",border:"1px solid #ef4444",borderRadius:6,padding:"4px 12px",color:"#ef4444",cursor:"pointer",fontSize:11},children:"Delete"})]})]}),n?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Section title",style:{width:"100%",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 12px",color:"var(--text)",fontSize:14,fontWeight:600,marginBottom:12,outline:"none"}}),"text"===e.section_type&&r.jsx("div",{style:{minHeight:200},children:r.jsx(ie,{value:b,onChange:y,theme:"snow",style:{height:200,marginBottom:50},modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote","code-block"],["link"],["clean"]]}})}),"text"!==e.section_type&&r.jsxs("div",{children:[e.media_file?r.jsxs("div",{style:{marginBottom:12},children:["image"===e.section_type&&r.jsx("img",{src:e.media_file,alt:e.title,style:{maxWidth:"100%",borderRadius:8}}),"audio"===e.section_type&&r.jsx("audio",{controls:!0,style:{width:"100%"},children:r.jsx("source",{src:e.media_file})}),"video"===e.section_type&&r.jsx("video",{controls:!0,style:{maxWidth:"100%",borderRadius:8},children:r.jsx("source",{src:e.media_file})})]}):r.jsx("div",{style:{border:"2px dashed var(--panel-border)",borderRadius:8,padding:32,textAlign:"center",marginBottom:12},children:r.jsxs("div",{style:{fontSize:14,color:"#94a3b8",marginBottom:12},children:["No ",e.section_type," uploaded"]})}),r.jsxs("label",{style:{display:"block",background:m(e.section_type),border:"none",borderRadius:8,padding:"10px 16px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13,textAlign:"center"},children:[e.media_file?"Replace":"Upload"," ",e.section_type,r.jsx("input",{type:"file",accept:"image"===e.section_type?"image/*":"audio"===e.section_type?"audio/*":"video"===e.section_type?"video/*":"*",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&p(r)}})]})]})]}):r.jsx("div",{style:{background:"rgba(100, 100, 100, 0.1)",borderRadius:8,padding:16,opacity:.6},children:r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:["text"===e.section_type&&r.jsx("div",{dangerouslySetInnerHTML:{__html:pe(e.content_html)||"No content yet"}}),"image"===e.section_type&&e.media_file&&r.jsx("img",{src:e.media_file,alt:e.title,style:{maxWidth:"100%",borderRadius:8}}),"audio"===e.section_type&&e.media_file&&r.jsx("audio",{controls:!0,style:{width:"100%"},children:r.jsx("source",{src:e.media_file})}),"video"===e.section_type&&e.media_file&&r.jsx("video",{controls:!0,style:{maxWidth:"100%",borderRadius:8},children:r.jsx("source",{src:e.media_file})}),!e.media_file&&"text"!==e.section_type&&r.jsx("div",{style:{textAlign:"center",padding:20},children:"No media uploaded yet"})]})})]})}function At(e){const t=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const i=Math.floor(r/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function Bt({project:e,currentUser:t,onProjectUpdate:n}){var o;const[s,a]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[u,g]=i.useState(null),[f,x]=i.useState(""),h=(e.collaborators||[]).find(e=>e.user===t.id),b=(null==(o=null==h?void 0:h.can_edit)?void 0:o.includes("text"))??(null==h?void 0:h.can_edit_text)??!1;i.useEffect(()=>{y()},[e.id]);const y=async()=>{try{const t=(await j.getProjectSections(e.id)).filter(e=>"text"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,content_html:e.content_html||"",synopsis:e.synopsis||"",order:e.order,owner:e.owner,owner_username:e.owner_username}));a(t),t.length>0&&!l&&d(t[0].id)}catch(t){x(t.message||"Failed to load chapters")}},v=s.find(e=>e.id===l),m=v&&(v.owner===t.id||b);return r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:280,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16},children:["Chapters (",s.length,")"]}),b&&r.jsx("button",{onClick:async()=>{if(b)try{const t=await j.createProjectSection({project:e.id,section_type:"text",title:`Chapter ${s.length+1}`,content_html:"",order:s.length}),r={id:t.id,title:t.title,content_html:t.content_html||"",synopsis:t.synopsis||"",order:t.order,owner:t.owner,owner_username:t.owner_username};a([...s,r]),d(r.id)}catch(t){x(t.message||"Failed to add chapter")}else x("You don't have permission to add chapters")},style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:6,padding:"6px 12px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:12},children:"+ Add"})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:8},children:0===s.length?r.jsxs("div",{style:{textAlign:"center",padding:24,color:"#64748b",fontSize:13},children:["No chapters yet.",b&&' Click "+ Add" to create one.']}):s.map((e,i)=>{const n=l===e.id,o=e.owner===t.id;return r.jsx("div",{onClick:()=>d(e.id),style:{padding:12,background:n?"rgba(245, 158, 11, 0.1)":"var(--bg)",border:n?"1px solid #f59e0b":"1px solid var(--panel-border)",borderRadius:8,cursor:"pointer",transition:"all 0.2s"},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:n?"#f59e0b":"var(--text)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title||`Chapter ${i+1}`}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8",marginTop:2,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{style:{width:14,height:14,borderRadius:"50%",background:o?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:8,fontWeight:700},children:e.owner_username.charAt(0).toUpperCase()}),"@",e.owner_username,o&&r.jsx("span",{style:{color:"#f59e0b"},children:"(you)"})]})]})})},e.id)})})]}),r.jsxs("div",{style:{flex:1,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:20,display:"flex",flexDirection:"column"},children:[f&&r.jsxs("div",{style:{padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13,marginBottom:16},children:[f,r.jsx("button",{onClick:()=>x(""),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",float:"right",fontWeight:700},children:"x"})]}),v?r.jsx(Pt,{chapter:v,canEdit:m||!1,onUpdate:(e,t,r)=>(async(e,t,r,i)=>{p(!0);try{const n={title:t,content_html:r};void 0!==i&&(n.synopsis=i);const o=await j.updateProjectSection(e,n);a(s.map(t=>t.id===e?{...t,title:o.title,content_html:o.content_html||"",synopsis:o.synopsis||""}:t)),g(new Date)}catch(n){x(n.message||"Failed to save chapter")}finally{p(!1)}})(v.id,e,t,r),onDelete:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this chapter?"))try{await j.deleteProjectSection(e);const r=s.filter(t=>t.id!==e);a(r),l===e&&d((null==(t=r[0])?void 0:t.id)||null)}catch(r){x(r.message||"Failed to delete chapter")}})(v.id),saving:c,lastSaved:u}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:s.length>0?"Select a chapter to edit":"Add your first chapter to get started"})]})]})}function Pt({chapter:e,canEdit:t,onUpdate:n,onDelete:o,saving:s,lastSaved:a}){const[l,d]=i.useState(e.title),[c,p]=i.useState(e.content_html),[u,g]=i.useState(e.synopsis),[f,x]=i.useState(!1);i.useEffect(()=>{d(e.title),p(e.content_html),g(e.synopsis)},[e.id]),i.useEffect(()=>{if(!t)return;const r=setTimeout(()=>{l===e.title&&c===e.content_html&&u===e.synopsis||n(l,c,u)},2e3);return()=>clearTimeout(r)},[l,c,u]);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,gap:16},children:[r.jsx("input",{type:"text",value:l,onChange:e=>d(e.target.value),disabled:!t,placeholder:"Chapter Title",style:{flex:1,background:"transparent",border:"none",borderBottom:"2px solid var(--panel-border)",color:"var(--text)",fontSize:20,fontWeight:700,padding:"8px 0",outline:"none"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[s&&r.jsx("span",{style:{fontSize:12,color:"#f59e0b"},children:"Saving..."}),!s&&a&&r.jsxs("span",{style:{fontSize:12,color:"#10b981"},children:["Saved ",Ut(a)]}),t&&r.jsx("button",{onClick:o,style:{background:"transparent",border:"1px solid #ef4444",borderRadius:6,padding:"6px 12px",color:"#ef4444",cursor:"pointer",fontSize:12},children:"Delete"})]})]}),r.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"#94a3b8"},children:["Written by @",e.owner_username,!t&&r.jsx("span",{style:{color:"#ef4444",marginLeft:8},children:"(Read-only - you can only edit your own chapters)"})]}),r.jsxs("div",{style:{marginBottom:12},children:[r.jsxs("button",{onClick:()=>x(!f),style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:12,cursor:"pointer",padding:"4px 0",display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{style:{fontSize:10,transform:f?"rotate(90deg)":"rotate(0)",transition:"transform 0.2s"},children:"â–¶"}),"Synopsis ",u?`(${u.split(/\s+/).filter(e=>e).length} words)`:"(optional)"]}),f&&r.jsxs("div",{style:{marginTop:8},children:[r.jsx("textarea",{value:u,onChange:e=>t&&g(e.target.value),placeholder:"Brief summary of this chapter (optional, max 150 words)...",disabled:!t,maxLength:1e3,style:{width:"100%",minHeight:80,background:t?"var(--bg)":"rgba(100,100,100,0.05)",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 14px",color:t?"var(--text)":"#64748b",fontSize:13,resize:"vertical",cursor:t?"text":"not-allowed",outline:"none"}}),r.jsxs("div",{style:{fontSize:10,color:"#64748b",marginTop:4},children:[u.split(/\s+/).filter(e=>e).length,"/150 words recommended"]})]})]}),r.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:300},children:r.jsx(ie,{theme:"snow",value:c,onChange:p,readOnly:!t,modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote","code-block"],["link"],["clean"]]},style:{flex:1,display:"flex",flexDirection:"column"}})})]})}function Ut(e){const t=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;return`${Math.floor(r/60)}h ago`}function Dt({project:e,currentUser:t,onProjectUpdate:n}){var o;const[s,a]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[u,g]=i.useState(""),f=i.useRef(null),x=(e.collaborators||[]).find(e=>e.user===t.id),h=(null==(o=null==x?void 0:x.can_edit)?void 0:o.includes("image"))??(null==x?void 0:x.can_edit_images)??!1;i.useEffect(()=>{b()},[e.id]);const b=async()=>{try{const t=(await j.getProjectSections(e.id)).filter(e=>"image"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",order:e.order,owner:e.owner,owner_username:e.owner_username}));a(t),t.length>0&&!l&&d(t[0].id)}catch(t){g(t.message||"Failed to load art pieces")}},y=s.find(e=>e.id===l),v=y&&(y.owner===t.id||h);return r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:280,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Gallery (",s.length,")"]}),h&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add",r.jsx("input",{ref:f,type:"file",accept:"image/png,image/jpeg,image/webp,image/gif",onChange:async t=>{var r;if(!h)return void g("You don't have permission to upload images");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["image/png","image/jpeg","image/webp","image/gif"].includes(i.type))if(i.size>52428800)g("File size must be under 50MB");else{p(!0),g("");try{const t=await j.createProjectSection({project:e.id,section_type:"image",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Art",order:s.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",order:t.order,owner:t.owner,owner_username:t.owner_username};a([...s,r]),d(r.id)}catch(n){g(n.message||"Failed to upload art")}finally{p(!1),f.current&&(f.current.value="")}}else g("Please upload a PNG, JPG, WebP, or GIF image")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===s.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No art pieces yet.",h&&' Click "+ Add" to upload your first piece.']}):s.map(e=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:8,cursor:"pointer",display:"flex",gap:10,alignItems:"center"},children:[r.jsx("div",{style:{width:48,height:48,borderRadius:6,background:"#334155",backgroundImage:e.media_file?`url(${e.media_file})`:void 0,backgroundSize:"cover",backgroundPosition:"center",flexShrink:0}}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[u&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:u}),y?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[v?r.jsx("input",{type:"text",value:y.title,onChange:e=>(async(e,t)=>{try{await j.updateProjectSection(e,{title:t}),a(s.map(r=>r.id===e?{...r,title:t}:r))}catch(r){g(r.message||"Failed to update title")}})(y.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:18,fontWeight:600,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:18,fontWeight:600,margin:0},children:y.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Uploaded by @",y.owner_username]})]}),v&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this art piece?"))try{await j.deleteProjectSection(e);const r=s.filter(t=>t.id!==e);a(r),l===e&&d((null==(t=r[0])?void 0:t.id)||null)}catch(r){g(r.message||"Failed to delete art piece")}})(y.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#0f172a",borderRadius:8,overflow:"hidden"},children:y.media_file?r.jsx("img",{src:y.media_file,alt:y.title,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No image available"})})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===s.length?"Upload an image to get started":"Select an art piece to view"})]})]})}function $t({project:e,currentUser:t,onProjectUpdate:n}){var o;const[s,a]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[u,g]=i.useState(!1),[f,x]=i.useState(0),[h,b]=i.useState(0),[y,v]=i.useState(""),m=i.useRef(null),S=i.useRef(null),k=(e.collaborators||[]).find(e=>e.user===t.id),w=(null==(o=null==k?void 0:k.can_edit)?void 0:o.includes("audio"))??(null==k?void 0:k.can_edit_audio)??!1;i.useEffect(()=>{_()},[e.id]);const _=async()=>{try{const t=(await j.getProjectSections(e.id)).filter(e=>"audio"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",duration:void 0,order:e.order,owner:e.owner,owner_username:e.owner_username}));a(t),t.length>0&&!l&&d(t[0].id)}catch(t){v(t.message||"Failed to load tracks")}},z=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,C=s.find(e=>e.id===l),R=C&&(C.owner===t.id||w);return i.useEffect(()=>{g(!1),x(0),b(0)},[l]),r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:320,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Tracks (",s.length,")"]}),w&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add Track",r.jsx("input",{ref:m,type:"file",accept:"audio/*,.mp3,.wav,.ogg,.m4a,.aac",onChange:async t=>{var r;if(!w)return void v("You don't have permission to upload audio");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac"].includes(i.type)||i.name.match(/\.(mp3|wav|ogg|m4a|aac)$/i))if(i.size>52428800)v("File size must be under 50MB");else{p(!0),v("");try{const t=await j.createProjectSection({project:e.id,section_type:"audio",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Track",order:s.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",duration:void 0,order:t.order,owner:t.owner,owner_username:t.owner_username};a([...s,r]),d(r.id)}catch(n){v(n.message||"Failed to upload track")}finally{p(!1),m.current&&(m.current.value="")}}else v("Please upload an MP3, WAV, OGG, M4A, or AAC audio file")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===s.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No tracks yet.",w&&' Click "+ Add Track" to upload your first track.']}):s.map((e,t)=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:12,cursor:"pointer",display:"flex",gap:12,alignItems:"center"},children:[r.jsx("div",{style:{width:32,height:32,borderRadius:6,background:l===e.id?"#f59e0b":"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:l===e.id?"#000":"#94a3b8",fontSize:12,fontWeight:700,flexShrink:0},children:t+1}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username,e.duration&&` - ${z(e.duration)}`]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[y&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:y}),C?r.jsxs(r.Fragment,{children:[r.jsx("audio",{ref:S,src:C.media_file,onTimeUpdate:()=>{S.current&&x(S.current.currentTime)},onLoadedMetadata:()=>{S.current&&b(S.current.duration)},onEnded:()=>g(!1)}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[R?r.jsx("input",{type:"text",value:C.title,onChange:e=>(async(e,t)=>{try{await j.updateProjectSection(e,{title:t}),a(s.map(r=>r.id===e?{...r,title:t}:r))}catch(r){v(r.message||"Failed to update title")}})(C.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:24,fontWeight:700,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:24,fontWeight:700,margin:0},children:C.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:13,marginTop:4},children:["Uploaded by @",C.owner_username]})]}),R&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this track?"))try{await j.deleteProjectSection(e);const r=s.filter(t=>t.id!==e);a(r),l===e&&(d((null==(t=r[0])?void 0:t.id)||null),g(!1))}catch(r){v(r.message||"Failed to delete track")}})(C.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:32},children:[r.jsx("div",{style:{width:200,height:200,borderRadius:12,background:"linear-gradient(135deg, #334155 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:64},children:"ðŸŽµ"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,width:"100%",maxWidth:400},children:[r.jsx("button",{onClick:()=>{S.current&&(u?S.current.pause():S.current.play(),g(!u))},disabled:!C.media_file,style:{width:64,height:64,borderRadius:"50%",background:C.media_file?"#f59e0b":"#334155",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:C.media_file?"pointer":"not-allowed",fontSize:24},children:u?"â¸ï¸":"â–¶ï¸"}),r.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",gap:12},children:[r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:z(f)}),r.jsx("input",{type:"range",min:0,max:h||100,value:f,onChange:e=>{const t=parseFloat(e.target.value);S.current&&(S.current.currentTime=t,x(t))},style:{flex:1,accentColor:"#f59e0b"}}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40,textAlign:"right"},children:z(h)})]})]})]})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===s.length?"Upload an audio track to get started":"Select a track to play"})]})]})}function Mt({project:e,currentUser:t,onProjectUpdate:n}){var o;const[s,a]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[u,g]=i.useState(!1),[f,x]=i.useState(0),[h,b]=i.useState(0),[y,v]=i.useState(""),m=i.useRef(null),S=i.useRef(null),k=(e.collaborators||[]).find(e=>e.user===t.id),w=(null==(o=null==k?void 0:k.can_edit)?void 0:o.includes("video"))??(null==k?void 0:k.can_edit_video)??!1;i.useEffect(()=>{_()},[e.id]);const _=async()=>{try{const t=(await j.getProjectSections(e.id)).filter(e=>"video"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",duration:void 0,order:e.order,owner:e.owner,owner_username:e.owner_username}));a(t),t.length>0&&!l&&d(t[0].id)}catch(t){v(t.message||"Failed to load video clips")}},z=()=>{S.current&&(u?S.current.pause():S.current.play(),g(!u))},C=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,R=s.find(e=>e.id===l),I=R&&(R.owner===t.id||w);return i.useEffect(()=>{g(!1),x(0),b(0)},[l]),r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:320,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Video Clips (",s.length,")"]}),w&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add Clip",r.jsx("input",{ref:m,type:"file",accept:"video/*,.mp4,.mov,.webm,.avi",onChange:async t=>{var r;if(!w)return void v("You don't have permission to upload videos");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["video/mp4","video/quicktime","video/webm","video/x-msvideo"].includes(i.type)||i.name.match(/\.(mp4|mov|webm|avi)$/i))if(i.size>52428800)v("File size must be under 50MB");else{p(!0),v("");try{const t=await j.createProjectSection({project:e.id,section_type:"video",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Clip",order:s.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",duration:void 0,order:t.order,owner:t.owner,owner_username:t.owner_username};a([...s,r]),d(r.id)}catch(n){v(n.message||"Failed to upload video")}finally{p(!1),m.current&&(m.current.value="")}}else v("Please upload an MP4, MOV, WebM, or AVI video file")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===s.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No video clips yet.",w&&' Click "+ Add Clip" to upload your first video.']}):s.map((e,t)=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:8,cursor:"pointer",display:"flex",gap:10,alignItems:"center"},children:[r.jsx("div",{style:{width:64,height:36,borderRadius:4,background:"#334155",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("span",{style:{fontSize:16},children:"ðŸŽ¬"})}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username,e.duration&&` - ${C(e.duration)}`]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[y&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:y}),R?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[I?r.jsx("input",{type:"text",value:R.title,onChange:e=>(async(e,t)=>{try{await j.updateProjectSection(e,{title:t}),a(s.map(r=>r.id===e?{...r,title:t}:r))}catch(r){v(r.message||"Failed to update title")}})(R.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:18,fontWeight:600,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:18,fontWeight:600,margin:0},children:R.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Uploaded by @",R.owner_username]})]}),I&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this video clip?"))try{await j.deleteProjectSection(e);const r=s.filter(t=>t.id!==e);a(r),l===e&&(d((null==(t=r[0])?void 0:t.id)||null),g(!1))}catch(r){v(r.message||"Failed to delete video clip")}})(R.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:16},children:[r.jsx("div",{style:{flex:1,background:"#0f172a",borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:R.media_file?r.jsx("video",{ref:S,src:R.media_file,onTimeUpdate:()=>{S.current&&x(S.current.currentTime)},onLoadedMetadata:()=>{S.current&&b(S.current.duration)},onEnded:()=>g(!1),onClick:z,style:{maxWidth:"100%",maxHeight:"100%",cursor:"pointer"}}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No video available"})}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:"12px 16px",background:"#0f172a",borderRadius:8},children:[r.jsx("button",{onClick:z,disabled:!R.media_file,style:{width:40,height:40,borderRadius:"50%",background:R.media_file?"#f59e0b":"#334155",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:R.media_file?"pointer":"not-allowed",fontSize:16},children:u?"â¸ï¸":"â–¶ï¸"}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:C(f)}),r.jsx("input",{type:"range",min:0,max:h||100,value:f,onChange:e=>{const t=parseFloat(e.target.value);S.current&&(S.current.currentTime=t,x(t))},style:{flex:1,accentColor:"#f59e0b"}}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:C(h)}),r.jsx("button",{onClick:()=>{S.current&&(document.fullscreenElement?document.exitFullscreen():S.current.requestFullscreen())},disabled:!R.media_file,style:{background:"transparent",border:"1px solid #334155",color:"#94a3b8",padding:"8px 12px",borderRadius:6,cursor:R.media_file?"pointer":"not-allowed",fontSize:12},children:"Fullscreen"})]})]})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===s.length?"Upload a video clip to get started":"Select a clip to play"})]})]})}function Ft({project:e,currentUser:t,reviewableTypes:n,onCommentAdd:o}){const[s,a]=i.useState([]),[l,d]=i.useState([]),[p,u]=i.useState(null),[f,x]=i.useState(""),[h,b]=i.useState(!1),[y,v]=i.useState(!0);i.useEffect(()=>{m()},[e.id]);const m=async()=>{v(!0);try{const[t,r]=await Promise.all([j.getProjectSections(e.id),j.getComments(e.id)]),i=t.filter(e=>n.includes(e.section_type));a(i),d(r),i.length>0&&u(i[0].id)}catch(t){}finally{v(!1)}},S=s.find(e=>e.id===p),_=l.filter(e=>!e.parent_comment),z=e=>{switch(e){case"text":default:return r.jsx(T,{size:16});case"image":return r.jsx(w,{size:16});case"audio":return r.jsx(k,{size:16});case"video":return r.jsx(X,{size:16})}};return y?r.jsx("div",{style:{padding:40,textAlign:"center",color:"#94a3b8"},children:"Loading content..."}):r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"250px 1fr 300px",gap:20,height:"100%"},children:[r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:16,overflow:"auto"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,color:"#f8fafc",fontWeight:600},children:[r.jsx(G,{size:18}),"Review Content"]}),r.jsxs("div",{style:{fontSize:11,color:"#64748b",marginBottom:12},children:["You have read-only access to review the following content types: ",n.join(", ")]}),0===s.length?r.jsx("div",{style:{color:"#64748b",fontSize:13,textAlign:"center",padding:20},children:"No content available for review yet."}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:s.map(e=>r.jsxs("button",{onClick:()=>u(e.id),style:{display:"flex",alignItems:"center",gap:10,padding:12,background:p===e.id?"rgba(245,158,11,0.15)":"#0f172a",border:"1px solid "+(p===e.id?"#f59e0b":"#334155"),borderRadius:8,cursor:"pointer",textAlign:"left"},children:[r.jsx("span",{style:{color:p===e.id?"#f59e0b":"#94a3b8"},children:z(e.section_type)}),r.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[r.jsx("div",{style:{color:p===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["by @",e.owner_username]})]})]},e.id))})]}),r.jsx("div",{style:{background:"#1e293b",borderRadius:12,padding:20,overflow:"auto"},children:S?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{children:[r.jsx("h3",{style:{color:"#f8fafc",margin:0,fontSize:18},children:S.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Written by @",S.owner_username]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"rgba(16,185,129,0.15)",borderRadius:6,color:"#10b981",fontSize:11,fontWeight:600},children:[r.jsx(G,{size:14}),"Read Only"]})]}),"text"===S.section_type&&r.jsx("div",{style:{color:"#cbd5e1",fontSize:15,lineHeight:1.8},dangerouslySetInnerHTML:{__html:pe(S.content_html)||"<em>No content yet</em>"}}),"image"===S.section_type&&S.media_file&&r.jsx("div",{style:{textAlign:"center"},children:r.jsx("img",{src:S.media_file,alt:S.title,style:{maxWidth:"100%",borderRadius:8}})}),"audio"===S.section_type&&S.media_file&&r.jsxs("audio",{controls:!0,style:{width:"100%"},children:[r.jsx("source",{src:S.media_file}),"Your browser does not support the audio element."]}),"video"===S.section_type&&S.media_file&&r.jsxs("video",{controls:!0,style:{width:"100%",borderRadius:8},children:[r.jsx("source",{src:S.media_file}),"Your browser does not support the video element."]})]}):r.jsx("div",{style:{color:"#64748b",textAlign:"center",padding:40},children:"Select a section to review"})}),r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,color:"#f8fafc",fontWeight:600},children:[r.jsx(c,{size:18}),"Comments (",_.length,")"]}),r.jsx("div",{style:{flex:1,overflow:"auto",marginBottom:16},children:0===_.length?r.jsx("div",{style:{color:"#64748b",fontSize:13,textAlign:"center",padding:20},children:"No comments yet. Be the first to leave feedback!"}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:_.map(e=>r.jsxs("div",{style:{padding:12,background:"#0f172a",borderRadius:8,borderLeft:e.resolved?"3px solid #10b981":"3px solid #334155"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[r.jsxs("span",{style:{color:"#f59e0b",fontWeight:600,fontSize:12},children:["@",e.author_username]}),e.resolved&&r.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,color:"#10b981",fontSize:10},children:[r.jsx(g,{size:12}),"Resolved"]})]}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.5},children:e.content}),r.jsx("div",{style:{color:"#64748b",fontSize:10,marginTop:6},children:new Date(e.created_at).toLocaleString()})]},e.id))})}),r.jsxs("div",{style:{borderTop:"1px solid #334155",paddingTop:16},children:[r.jsx("textarea",{value:f,onChange:e=>x(e.target.value),placeholder:"Leave feedback or suggestions...",style:{width:"100%",background:"#0f172a",border:"1px solid #334155",borderRadius:8,padding:12,color:"#f8fafc",fontSize:13,fontFamily:"inherit",resize:"none",minHeight:80}}),r.jsxs("button",{onClick:async()=>{if(f.trim()){b(!0);try{const t=await j.addComment({project:e.id,content:f});d([...l,t]),x(""),o&&o(t)}catch(t){}finally{b(!1)}}},disabled:h||!f.trim(),style:{width:"100%",marginTop:8,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"10px 16px",background:h||!f.trim()?"#334155":"#f59e0b",border:"none",borderRadius:8,color:h||!f.trim()?"#64748b":"#000",fontWeight:600,fontSize:13,cursor:h||!f.trim()?"not-allowed":"pointer"},children:[r.jsx(Q,{size:14}),h?"Submitting...":"Submit Comment"]})]})]})]})}function Et({project:e,currentUser:t,defaultExpanded:n=!1}){const[o,s]=i.useState(n),[a,l]=i.useState(!1),{comments:d,unresolvedCount:p,totalCount:u,isLoading:g,addComment:f,updateComment:h,deleteComment:b,resolveComment:y,unresolveComment:v,addReaction:m,removeReaction:j}=ht({projectId:e.id,includeResolved:a,pollingInterval:3e4});return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,overflow:"hidden"},children:[r.jsxs("button",{onClick:()=>s(!o),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"16px 20px",background:"transparent",border:"none",cursor:"pointer",borderBottom:o?"1px solid var(--panel-border)":"none"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsx(c,{size:20,style:{color:"#06b6d4"}}),r.jsx("span",{style:{fontSize:16,fontWeight:600,color:"var(--text)"},children:"Comments"}),p>0&&r.jsx("span",{style:{background:"#ef4444",color:"#fff",fontSize:11,fontWeight:700,padding:"2px 8px",borderRadius:10},children:p}),r.jsxs("span",{style:{fontSize:13,color:"#64748b"},children:["(",u," total)"]})]}),r.jsx("div",{style:{display:"flex",alignItems:"center",gap:8},children:o?r.jsx(R,{size:20,style:{color:"#94a3b8"}}):r.jsx(x,{size:20,style:{color:"#94a3b8"}})})]}),o&&r.jsxs("div",{style:{padding:20},children:[r.jsx("div",{style:{marginBottom:20},children:r.jsx(jt,{projectId:e.id,onSubmit:async(e,t)=>{try{await f(e,t)}catch(r){}},collaborators:e.collaborators||[],placeholder:"Add a comment about the content..."})}),r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,paddingBottom:12,borderBottom:"1px solid var(--panel-border)"},children:[r.jsx("span",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:a?"All Comments":"Unresolved Comments"}),r.jsx("button",{onClick:()=>l(!a),style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,cursor:"pointer",fontSize:12,color:"#94a3b8"},children:a?r.jsxs(r.Fragment,{children:[r.jsx(ne,{size:14}),"Hide resolved"]}):r.jsxs(r.Fragment,{children:[r.jsx(G,{size:14}),"Show resolved"]})})]}),g?r.jsx("div",{style:{textAlign:"center",padding:20,color:"#94a3b8"},children:"Loading comments..."}):d.length>0?r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:d.map(i=>r.jsx(wt,{comment:i,projectId:e.id,currentUserId:t.id,collaborators:e.collaborators||[],onReply:async(e,t,r)=>{await f(t,r,void 0,e)},onEdit:async(e,t)=>{await h(e,t)},onDelete:async e=>{await b(e)},onResolve:async e=>{await y(e)},onUnresolve:async e=>{await v(e)},onReaction:async(e,t)=>{await m(e,t)},onRemoveReaction:async(e,t)=>{await j(e,t)}},i.id))}):r.jsxs("div",{style:{textAlign:"center",padding:32,color:"#64748b"},children:[r.jsx(c,{size:32,style:{color:"#475569",marginBottom:12}}),r.jsx("div",{style:{fontSize:14,fontWeight:500},children:a?"No comments yet":"No unresolved comments"}),r.jsx("div",{style:{fontSize:13,marginTop:4},children:a?"Start the conversation about this content!":"All comments have been resolved"})]})]})]})}function Nt({project:e,currentUser:t,onSectionUpdate:i,onCommentAdd:n,onProjectUpdate:o}){var s,a,l,d;const c=(e.collaborators||[]).find(e=>e.user===t.id),p=function(e,t){return e.created_by===t}(e,t.id);if(p)return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[Lt(e,t,i,n,o),r.jsx(Et,{project:e,currentUser:t})]});const u=function(e){if(!e)return null;const t=e.effective_permissions||e.permissions;if(t&&"object"==typeof t&&Object.keys(t).length>0)return{create:t.create||[],edit:t.edit||{scope:"none",types:[]},review:t.review||[],ui_components:e.ui_components||[]};const r=[],i=[];return e.can_edit_text&&(r.push("text"),i.push("text")),e.can_edit_images&&(r.push("image"),i.push("image")),e.can_edit_audio&&(r.push("audio"),i.push("audio")),e.can_edit_video&&(r.push("video"),i.push("video")),{create:r,edit:{scope:"own",types:i},review:[],ui_components:e.ui_components||[]}}(c),g=function(e){if(!e)return"none";const t=e.create.length>0||e.edit.types&&e.edit.types.length>0,r=e.review.length>0&&!t;return t?"creator":r?"reviewer":"none"}(u);if("none"===g||!u)return r.jsxs("div",{style:{padding:40,textAlign:"center",color:"#94a3b8"},children:[r.jsx(ce,{size:48,style:{marginBottom:16,color:"#f59e0b"}}),r.jsx("h3",{style:{color:"#f8fafc",marginBottom:8},children:"No Content Access"}),r.jsxs("p",{style:{fontSize:14},children:["You don't have permission to view or edit content in this project yet.",r.jsx("br",{}),"Contact the project owner to update your permissions."]})]});if("reviewer"===g)return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[r.jsx(Ft,{project:e,currentUser:t,reviewableTypes:u.review,onCommentAdd:n}),r.jsx(Et,{project:e,currentUser:t})]});const f=u.ui_components||[];f.includes("chapter_editor")||u.create.includes("text")||null==(s=u.edit.types)||s.includes("text"),f.includes("image_uploader")||u.create.includes("image")||null==(a=u.edit.types)||a.includes("image"),f.includes("audio_uploader")||u.create.includes("audio")||null==(l=u.edit.types)||l.includes("audio"),f.includes("video_uploader")||u.create.includes("video")||null==(d=u.edit.types)||d.includes("video");return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:24},children:[(()=>{switch(e.content_type){case"comic":return r.jsx(oe,{project:e,currentUser:t,onProjectUpdate:o});case"art":return r.jsx(Dt,{project:e,currentUser:t,onProjectUpdate:o});case"music":return r.jsx($t,{project:e,currentUser:t,onProjectUpdate:o});case"video":return r.jsx(Mt,{project:e,currentUser:t,onProjectUpdate:o});case"book":return r.jsx(Bt,{project:e,currentUser:t,onProjectUpdate:o});default:return r.jsx(Ot,{project:e,currentUser:t,permissions:u,onProjectUpdate:o})}})(),r.jsx(Et,{project:e,currentUser:t})]})}function Lt(e,t,i,n,o){switch(e.content_type){case"book":return r.jsx(Bt,{project:e,currentUser:t,onProjectUpdate:o});case"art":return r.jsx(Dt,{project:e,currentUser:t,onProjectUpdate:o});case"music":return r.jsx($t,{project:e,currentUser:t,onProjectUpdate:o});case"video":return r.jsx(Mt,{project:e,currentUser:t,onProjectUpdate:o});case"comic":return r.jsx(oe,{project:e,currentUser:t,onProjectUpdate:o});default:return r.jsx(Tt,{project:e,currentUser:t,onSectionUpdate:i,onCommentAdd:n,onProjectUpdate:o})}}function Ot({project:e,currentUser:t,permissions:i,onProjectUpdate:o}){var s,a,l,d;const[c,p]=n.useState("text"),u=(null==i?void 0:i.create.includes("text"))||(null==(s=null==i?void 0:i.edit.types)?void 0:s.includes("text")),g=(null==i?void 0:i.create.includes("image"))||(null==(a=null==i?void 0:i.edit.types)?void 0:a.includes("image")),f=(null==i?void 0:i.create.includes("audio"))||(null==(l=null==i?void 0:i.edit.types)?void 0:l.includes("audio")),x=(null==i?void 0:i.create.includes("video"))||(null==(d=null==i?void 0:i.edit.types)?void 0:d.includes("video"));n.useEffect(()=>{u?p("text"):g?p("image"):f?p("audio"):x&&p("video")},[u,g,f,x]);const h=[{key:"text",label:"Text",icon:r.jsx(T,{size:16}),available:u},{key:"image",label:"Images",icon:r.jsx(J,{size:16}),available:g},{key:"audio",label:"Audio",icon:r.jsx(k,{size:16}),available:f},{key:"video",label:"Video",icon:r.jsx(X,{size:16}),available:x}].filter(e=>e.available);return r.jsxs("div",{children:[h.length>1&&r.jsx("div",{style:{display:"flex",gap:8,marginBottom:16,borderBottom:"1px solid #334155",paddingBottom:12},children:h.map(e=>r.jsxs("button",{onClick:()=>p(e.key),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:c===e.key?"rgba(245,158,11,0.15)":"transparent",border:"1px solid "+(c===e.key?"#f59e0b":"#334155"),borderRadius:8,color:c===e.key?"#f59e0b":"#94a3b8",fontSize:13,fontWeight:600,cursor:"pointer"},children:[e.icon,e.label]},e.key))}),"text"===c&&u&&r.jsx(Bt,{project:e,currentUser:t,onProjectUpdate:o}),"image"===c&&g&&r.jsx(Dt,{project:e,currentUser:t,onProjectUpdate:o}),"audio"===c&&f&&r.jsx($t,{project:e,currentUser:t,onProjectUpdate:o}),"video"===c&&x&&r.jsx(Mt,{project:e,currentUser:t,onProjectUpdate:o})]})}function Ht(){var e,t,n,l,d,c;const{projectId:p}=o(),u=s(),[g,f]=a(),{isMobile:x,isPhone:h}=I(),[y,v]=i.useState(null),[m,S]=i.useState(null),[k,w]=i.useState(!0),[_,z]=i.useState(""),[C,R]=i.useState(!1),[T,W]=i.useState(""),[A,P]=i.useState(!1),U=g.get("tab")||"overview";i.useEffect(()=>{D()},[p]);const D=async()=>{if(!p)return z("Invalid project ID"),void w(!1);w(!0),z("");try{const e=await j.getCollaborativeProject(parseInt(p,10));v(e);const t=await fetch(`${b}/api/auth/status/`,{credentials:"include"}),r=await t.json();r.authenticated&&r.user?S({id:r.user.id,username:r.user.username,display_name:r.user.display_name}):z("You must be logged in to access this project")}catch(e){z(e.message||"Failed to load project")}finally{w(!1)}},$=e=>{v(e)},M=async()=>{if(y&&T.trim()&&T.trim()!==y.title){P(!0);try{const e=await fetch(`${b}/api/auth/csrf/`,{credentials:"include"}),t=await e.json(),r=(null==t?void 0:t.csrfToken)||"",i=await fetch(`${b}/api/collaborative-projects/${y.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":r,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({title:T.trim()})});if(i.ok){const e=await i.json();v(e),R(!1)}else{await i.json()}}catch(e){}finally{P(!1)}}else R(!1)},F=()=>{R(!1),W("")},E=null==(e=null==y?void 0:y.title)?void 0:e.startsWith("Collaboration Invite");if(k)return r.jsx("div",{className:"page",style:{maxWidth:1400,margin:"0 auto",padding:24},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"60vh",color:"#94a3b8",fontSize:16},children:"Loading project..."})});if(_)return r.jsx("div",{className:"page",style:{maxWidth:1400,margin:"0 auto",padding:24},children:r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:12,padding:24,color:"#ef4444",textAlign:"center"},children:[r.jsx("div",{style:{display:"flex",justifyContent:"center",marginBottom:16},children:r.jsx(B,{size:48})}),r.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Error Loading Project"}),r.jsx("div",{style:{fontSize:14,marginBottom:24},children:_}),r.jsx("button",{onClick:()=>u("/profile"),style:{background:"#ef4444",border:"none",borderRadius:8,padding:"10px 20px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:14},children:"Back to Dashboard"})]})});if(!y||!m)return null;const N=(null==(t=y.recent_comments)?void 0:t.filter(e=>!e.resolved).length)||0,L=(null==(n=y.collaborators)?void 0:n.filter(e=>!("accepted"!==e.status||e.approved_current_version&&e.approved_revenue_split)).length)||0;return r.jsxs("div",{className:"page",style:{maxWidth:"content"===U?"none":1400,width:"100%",margin:"0 auto",padding:x?"12px 8px":"content"===U?"24px 16px":24},children:[r.jsx("div",{style:{display:"flex",flexDirection:h?"column":"row",justifyContent:"space-between",alignItems:h?"stretch":"flex-start",marginBottom:x?16:20,gap:h?12:0},children:r.jsxs("div",{children:[r.jsxs("button",{onClick:()=>u("/profile"),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:x?"6px 12px":"8px 16px",color:"var(--text)",cursor:"pointer",fontSize:x?13:14,marginBottom:x?8:12},children:["â† ",h?"Back":"Back to Dashboard"]}),C?r.jsxs("div",{style:{display:"flex",flexDirection:h?"column":"row",alignItems:h?"stretch":"center",gap:h?8:12,marginBottom:8},children:[r.jsx("input",{type:"text",value:T,onChange:e=>W(e.target.value),placeholder:"Enter project title...",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&M(),"Escape"===e.key&&F()},style:{fontSize:x?20:28,fontWeight:700,background:"var(--panel)",border:"2px solid #f59e0b",borderRadius:8,padding:x?"6px 12px":"8px 16px",color:"var(--text)",minWidth:h?"auto":400,width:h?"100%":"auto"}}),r.jsx("button",{onClick:M,disabled:A||!T.trim(),style:{background:"#10b981",border:"none",borderRadius:8,padding:"10px 20px",color:"#fff",fontWeight:600,cursor:A?"not-allowed":"pointer",opacity:A?.6:1},children:A?"Saving...":"Save"}),r.jsx("button",{onClick:F,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 20px",color:"#94a3b8",cursor:"pointer"},children:"Cancel"})]}):r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsx("h1",{style:{margin:0,fontSize:28,fontWeight:700,color:E?"#f59e0b":"var(--text)"},children:y.title}),y.created_by===m.id&&r.jsx("button",{onClick:()=>{W((null==y?void 0:y.title)||""),R(!0)},title:"Edit project title",style:{background:"transparent",border:"none",padding:4,cursor:"pointer",fontSize:18,color:"#94a3b8"},children:r.jsx(se,{size:16})})]}),E&&!C&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8,padding:"8px 12px",background:"rgba(245, 158, 11, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:13,color:"#f59e0b"},children:[r.jsx(B,{size:16}),r.jsx("span",{children:y.created_by===m.id?"This project has a placeholder title. Click the edit button to set a proper title before publishing.":"This project has a placeholder title. Only the owner can change the title."})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:[r.jsxs("span",{style:{background:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600},children:[y.content_type.charAt(0).toUpperCase()+y.content_type.slice(1)," Project"]}),r.jsx("span",{style:{background:(null==(l=y.can_mint_status)?void 0:l.can_mint)?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",color:(null==(d=y.can_mint_status)?void 0:d.can_mint)?"#10b981":"#f59e0b",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600},children:(null==(c=y.can_mint_status)?void 0:c.can_mint)?"Ready to Mint":"Not Ready to Mint"})]})]})}),r.jsx("div",{style:{marginBottom:20},children:r.jsx(je,{activeTab:U,onTabChange:e=>{f({tab:e})},badges:{activity:N,team:L},isFullyApproved:y.is_fully_approved})}),r.jsxs("div",{style:{minHeight:"60vh"},children:["overview"===U&&r.jsx(we,{project:y,currentUser:m,onProjectUpdate:$}),"content"===U&&r.jsx(Nt,{project:y,currentUser:m,onSectionUpdate:e=>{},onCommentAdd:e=>{},onProjectUpdate:$}),"team"===U&&r.jsx(Ae,{project:y,currentUser:m,onProjectUpdate:$}),"activity"===U&&r.jsx(ct,{project:y,currentUser:m}),"publish"===U&&r.jsx(pt,{project:y,currentUser:m,onProjectUpdate:$})]})]})}export{Ht as default};
