var e=Object.defineProperty,t=(t,r,i)=>((t,r,i)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[r]=i)(t,"symbol"!=typeof r?r+"":r,i);import{j as r}from"./web3auth-BGmWjNJV.js";import{r as i,c as n,e as o,a,d as s}from"./router-CzH47hF_.js";import{c as l,U as d,f as c,A as p,b as u,C as g,M as f,h as x}from"./index-BruiCpVl.js";import{F as h}from"./file-text-DTugYsr1.js";import{a as b,C as y,R as v}from"./CopyrightPreview-D3gxBD9L.js";import{s as m}from"./sanitize-MG3ZWMPS.js";import{E as j}from"./eye-BgUPhxbd.js";import{S}from"./send-BnKC7KWa.js";import{V as k}from"./video-CDnPXpoI.js";import{C as w}from"./circle-alert-ChgXig3G.js";import{P as _}from"./palette-dz6FYv_e.js";import"./vendor-Cfs_Iq82.js";
/**
 * @license lucide-react v0.553.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=l("layout-dashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]),C=[{id:"overview",label:"Overview",icon:r.jsx(z,{size:18})},{id:"content",label:"Content",icon:r.jsx(h,{size:18})},{id:"team",label:"Team",icon:r.jsx(d,{size:18})},{id:"activity",label:"Activity",icon:r.jsx(c,{size:18})},{id:"publish",label:"Publish",icon:r.jsx(b,{size:18})}];function R({activeTab:e,onTabChange:t,badges:i={},isFullyApproved:n=!1}){return r.jsx("div",{style:{display:"flex",gap:4,background:"var(--panel)",padding:4,borderRadius:12,border:"1px solid var(--panel-border)"},children:C.map(o=>{const a=e===o.id,s="activity"===o.id?i.activity:"team"===o.id?i.team:void 0,l="publish"===o.id&&n;return r.jsxs("button",{onClick:()=>t(o.id),style:{display:"flex",alignItems:"center",gap:8,padding:"10px 16px",background:a?"var(--bg)":l?"rgba(16, 185, 129, 0.1)":"transparent",border:a?"1px solid var(--panel-border)":l?"1px solid rgba(16, 185, 129, 0.3)":"1px solid transparent",borderRadius:8,color:a?"var(--text)":l?"#10b981":"#94a3b8",cursor:"pointer",fontSize:14,fontWeight:a?600:500,transition:"all 0.2s ease",position:"relative"},children:[r.jsx("span",{style:{display:"flex",alignItems:"center"},children:o.icon}),r.jsx("span",{children:o.label}),void 0!==s&&s>0&&r.jsx("span",{style:{background:"#ef4444",color:"#fff",fontSize:10,fontWeight:700,padding:"2px 6px",borderRadius:10,minWidth:18,textAlign:"center"},children:s>99?"99+":s})]},o.id)})})}const I=["#8b5cf6","#f59e0b","#10b981","#3b82f6","#ef4444","#ec4899","#06b6d4","#f97316"];function T({collaborators:e,size:t=200}){const i=t/2,n=t/2,o=t/2-10,a=.6*o;let s=-90;const l=e.map((e,t)=>{const r=Number(e.revenue_percentage),i=s,n=s+r/100*360;return s=n,{...e,color:I[t%I.length],startAngle:i,endAngle:n,percentage:r}}),d=(e,t,r,i)=>{const n=i*Math.PI/180;return{x:e+r*Math.cos(n),y:t+r*Math.sin(n)}},c=(e,t,r,o)=>{const a=d(i,n,r,e),s=d(i,n,r,t),l=d(i,n,o,t),c=d(i,n,o,e),p=t-e>180?1:0;return`\n      M ${a.x} ${a.y}\n      A ${r} ${r} 0 ${p} 1 ${s.x} ${s.y}\n      L ${l.x} ${l.y}\n      A ${o} ${o} 0 ${p} 0 ${c.x} ${c.y}\n      Z\n    `};return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:24},children:[r.jsxs("svg",{width:t,height:t,viewBox:`0 0 ${t} ${t}`,children:[l.map((e,t)=>r.jsx("path",{d:c(e.startAngle,e.endAngle,o,a),fill:e.color,stroke:"var(--panel)",strokeWidth:2,style:{transition:"opacity 0.2s",cursor:"pointer"},onMouseEnter:e=>{e.target.style.opacity="0.8"},onMouseLeave:e=>{e.target.style.opacity="1"},children:r.jsxs("title",{children:[e.username,": ",e.percentage,"%"]})},e.id)),r.jsx("text",{x:i,y:n-8,textAnchor:"middle",fill:"var(--text)",fontSize:24,fontWeight:700,children:e.length}),r.jsx("text",{x:i,y:n+14,textAnchor:"middle",fill:"#94a3b8",fontSize:11,children:1===e.length?"Creator":"Creators"})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:l.map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:12,height:12,borderRadius:3,background:e.color,flexShrink:0}}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),r.jsxs("div",{style:{fontSize:14,fontWeight:700,color:e.color},children:[Number(e.percentage).toFixed(2),"%"]})]},e.id))})]})}function W({project:e,currentUser:t,onProjectUpdate:n}){var o,a,s,l;const[p,u]=i.useState(!1),[g,f]=i.useState(e.description||""),x=e.created_by===t.id,y=(null==(o=e.collaborators)?void 0:o.filter(e=>"accepted"===e.status))||[],v=y.filter(e=>e.approved_current_version&&e.approved_revenue_split).length;return r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(12, 1fr)",gap:20},children:[r.jsxs("div",{style:{gridColumn:"span 12",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16},children:[r.jsx("h3",{style:{margin:0,color:"var(--text)",fontSize:18,fontWeight:600},children:"Project Proposal"}),x&&!p&&r.jsx("button",{onClick:()=>u(!0),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"6px 12px",color:"#94a3b8",cursor:"pointer",fontSize:12},children:"Edit"})]}),p?r.jsxs("div",{children:[r.jsx("textarea",{value:g,onChange:e=>f(e.target.value),placeholder:"Describe your project proposal, goals, and expectations...",style:{width:"100%",minHeight:120,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,lineHeight:1.6,resize:"vertical"}}),r.jsxs("div",{style:{display:"flex",gap:8,marginTop:12},children:[r.jsx("button",{onClick:()=>{u(!1)},style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:6,padding:"8px 16px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13},children:"Save"}),r.jsx("button",{onClick:()=>{f(e.description||""),u(!1)},style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"8px 16px",color:"#94a3b8",cursor:"pointer",fontSize:13},children:"Cancel"})]})]}):r.jsx("p",{style:{color:e.description?"#94a3b8":"#64748b",fontSize:14,margin:0,lineHeight:1.7,fontStyle:e.description?"normal":"italic"},children:e.description||"No description provided. Click Edit to add one."}),r.jsxs("div",{style:{display:"flex",gap:24,marginTop:20,paddingTop:16,borderTop:"1px solid var(--panel-border)"},children:[r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Created by"}),r.jsxs("div",{style:{fontSize:13,color:"var(--text)",fontWeight:600},children:["@",e.created_by_username]})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Created on"}),r.jsx("div",{style:{fontSize:13,color:"var(--text)"},children:new Date(e.created_at).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})})]}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:11,color:"#64748b",marginBottom:4},children:"Content Type"}),r.jsx("div",{style:{fontSize:13,color:"var(--text)"},children:e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)})]})]})]}),r.jsxs("div",{style:{gridColumn:"span 6",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:16,fontWeight:600},children:"Revenue Split"}),e.collaborators&&e.collaborators.length>0?r.jsx(T,{collaborators:e.collaborators.map(e=>({id:e.id,username:e.username,role:e.role,revenue_percentage:e.revenue_percentage})),size:180}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No collaborators yet."}),e.collaborators&&r.jsxs("div",{style:{marginTop:20,padding:12,background:"var(--bg)",borderRadius:8,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:13,color:"#94a3b8"},children:"Total"}),r.jsxs("span",{style:{fontSize:16,fontWeight:700,color:100===e.collaborators.reduce((e,t)=>e+Number(t.revenue_percentage),0)?"#10b981":"#ef4444"},children:[e.collaborators.reduce((e,t)=>e+Number(t.revenue_percentage),0).toFixed(2),"%"]})]})]}),r.jsxs("div",{style:{gridColumn:"span 6",background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:16,fontWeight:600},children:"Approval Progress"}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[r.jsxs("span",{style:{fontSize:13,color:"#94a3b8"},children:[v," of ",y.length," approved"]}),r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:[y.length>0?Math.round(v/y.length*100):0,"%"]})]}),r.jsx("div",{style:{height:8,background:"var(--bg)",borderRadius:4,overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:y.length>0?v/y.length*100+"%":"0%",background:e.is_fully_approved?"linear-gradient(90deg, #10b981 0%, #059669 100%)":"linear-gradient(90deg, #f59e0b 0%, #d97706 100%)",borderRadius:4,transition:"width 0.3s ease"}})})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:y.map(e=>{const i=e.approved_current_version&&e.approved_revenue_split;return r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 12px",background:i?"rgba(16, 185, 129, 0.1)":"var(--bg)",border:"1px solid "+(i?"rgba(16, 185, 129, 0.2)":"var(--panel-border)"),borderRadius:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:i?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #64748b 0%, #475569 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:600},children:i?"âœ“":e.username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,e.user===t.id&&r.jsx("span",{style:{color:"#94a3b8",fontWeight:400},children:" (you)"})]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]})]}),r.jsx("div",{style:{fontSize:11,fontWeight:600,color:i?"#10b981":"#f59e0b",background:i?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",padding:"4px 8px",borderRadius:4},children:i?"Approved":"Pending"})]},e.id)})}),e.is_fully_approved&&r.jsxs("div",{style:{marginTop:16,padding:12,background:"rgba(16, 185, 129, 0.1)",border:"1px solid #10b981",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"center",gap:8},children:[r.jsx("span",{style:{fontSize:18},children:"âœ“"}),r.jsx("span",{style:{fontSize:14,fontWeight:600,color:"#10b981"},children:"Fully Approved - Ready to Mint!"})]})]}),r.jsxs("div",{style:{gridColumn:"span 12",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:16},children:[r.jsx(A,{label:"Sections",value:(null==(a=e.sections)?void 0:a.length)||0,icon:r.jsx(h,{size:20})}),r.jsx(A,{label:"Comments",value:(null==(s=e.recent_comments)?void 0:s.length)||0,icon:r.jsx(c,{size:20})}),r.jsx(A,{label:"Team Members",value:(null==(l=e.collaborators)?void 0:l.length)||0,icon:r.jsx(d,{size:20})}),r.jsx(A,{label:"Progress",value:`${e.progress_percentage||0}%`,icon:r.jsx(b,{size:20})})]})]})}function A({label:e,value:t,icon:i}){return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,display:"flex",alignItems:"center",gap:12},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:8,background:"var(--bg)",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8"},children:i}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:20,fontWeight:700,color:"var(--text)"},children:t}),r.jsx("div",{style:{fontSize:12,color:"#94a3b8"},children:e})]})]})}function B({collaborators:e,sections:t,projectCreatorId:i}){const n=e=>{const r=t.filter(t=>t.owner===e.user),i=r.filter(e=>e.content_html&&e.content_html.trim().length>0);return{assigned:r.length,completed:i.length}},o=e=>{const t=n(e),r=(e=>{if(!e.delivery_deadline)return null;const t=new Date(e.delivery_deadline),r=new Date,i=Math.ceil((t.getTime()-r.getTime())/864e5);return i<0?{status:"overdue",days:Math.abs(i),color:"#ef4444"}:i<=3?{status:"soon",days:i,color:"#f59e0b"}:{status:"ok",days:i,color:"#10b981"}})(e);if("overdue"===(null==r?void 0:r.status))return{icon:"âŒ",text:`${r.days}d overdue`,color:"#ef4444",bg:"#ef444420"};if(t.assigned>0&&t.completed===t.assigned)return{icon:"âœ…",text:`${t.completed}/${t.assigned} complete`,color:"#10b981",bg:"#10b98120"};if(t.assigned>0){const e=t.assigned-t.completed;return"soon"===(null==r?void 0:r.status)?{icon:"ğŸ”¶",text:`${e} section${e>1?"s":""} due in ${r.days}d`,color:"#f59e0b",bg:"#f59e0b20"}:{icon:"â³",text:`${t.completed}/${t.assigned} sections`,color:"#3b82f6",bg:"#3b82f620"}}return{icon:"ğŸ“",text:"No sections assigned",color:"#64748b",bg:"#64748b20"}};return r.jsxs("div",{style:{background:"#0f172a",border:"1px solid #1e293b",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:20},children:[r.jsx("span",{style:{fontSize:20},children:"ğŸ‘¥"}),r.jsx("h3",{style:{margin:0,color:"#f8fafc",fontSize:16,fontWeight:600},children:"Team Overview"}),r.jsxs("span",{style:{background:"#334155",color:"#94a3b8",padding:"2px 10px",borderRadius:12,fontSize:12,fontWeight:500},children:[e.filter(e=>"accepted"===e.status).length," active"]})]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[e.filter(e=>"accepted"===e.status).map(e=>{const t=n(e),a=o(e),s=e.user===i,l=e.is_lead;return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,background:"#1e293b",borderRadius:10,borderLeft:`3px solid ${a.color}`},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:`linear-gradient(135deg, ${s?"#f59e0b":"#3b82f6"} 0%, ${s?"#d97706":"#2563eb"} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontWeight:700,fontSize:14,flexShrink:0},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["@",e.username]}),s&&r.jsx("span",{style:{background:"#f59e0b",color:"#000",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700},children:"OWNER"}),l&&!s&&r.jsx("span",{style:{background:"#8b5cf6",color:"#fff",padding:"2px 8px",borderRadius:4,fontSize:10,fontWeight:700},children:"LEAD"})]}),r.jsxs("div",{style:{color:"#94a3b8",fontSize:12,marginTop:2,display:"flex",alignItems:"center",gap:8},children:[r.jsx("span",{children:e.role}),r.jsx("span",{style:{color:"#64748b"},children:"â€¢"}),r.jsxs("span",{style:{color:"#10b981"},children:[e.revenue_percentage,"%"]})]})]}),t.assigned>0&&r.jsx("div",{style:{width:80},children:r.jsx("div",{style:{height:6,background:"#334155",borderRadius:3,overflow:"hidden"},children:r.jsx("div",{style:{width:t.completed/t.assigned*100+"%",height:"100%",background:t.completed===t.assigned?"#10b981":"#3b82f6",transition:"width 0.3s ease"}})})}),r.jsxs("div",{style:{background:a.bg,color:a.color,padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500,display:"flex",alignItems:"center",gap:6,whiteSpace:"nowrap"},children:[r.jsx("span",{children:a.icon}),a.text]}),r.jsxs("div",{style:{display:"flex",gap:4,flexShrink:0},title:`Content: ${e.approved_current_version?"Approved":"Pending"}, Revenue: ${e.approved_revenue_split?"Approved":"Pending"}`,children:[r.jsx("div",{style:{width:24,height:24,borderRadius:4,background:e.approved_current_version?"#10b98120":"#64748b20",color:e.approved_current_version?"#10b981":"#64748b",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.approved_current_version?"âœ“":"â—‹"}),r.jsx("div",{style:{width:24,height:24,borderRadius:4,background:e.approved_revenue_split?"#10b98120":"#64748b20",color:e.approved_revenue_split?"#10b981":"#64748b",display:"flex",alignItems:"center",justifyContent:"center",fontSize:12},children:e.approved_revenue_split?"ğŸ’°":"â—‹"})]})]},e.id)}),e.filter(e=>"invited"===e.status).length>0&&r.jsxs(r.Fragment,{children:[r.jsx("div",{style:{borderTop:"1px solid #334155",margin:"8px 0",paddingTop:12},children:r.jsx("span",{style:{color:"#64748b",fontSize:12,fontWeight:600},children:"PENDING INVITES"})}),e.filter(e=>"invited"===e.status).map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,background:"#1e293b",borderRadius:10,borderLeft:"3px solid #f59e0b",opacity:.7},children:[r.jsx("div",{style:{width:40,height:40,borderRadius:"50%",background:"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:"#94a3b8",fontWeight:700,fontSize:14,flexShrink:0},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{color:"#94a3b8",fontWeight:500,fontSize:14},children:["@",e.username]}),r.jsxs("div",{style:{color:"#64748b",fontSize:12},children:[e.role," â€¢ ",e.revenue_percentage,"%"]})]}),r.jsx("span",{style:{background:"#f59e0b20",color:"#f59e0b",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:500},children:"Awaiting response"})]},e.id))]})]}),r.jsxs("div",{style:{marginTop:16,paddingTop:16,borderTop:"1px solid #334155",display:"flex",gap:16,flexWrap:"wrap"},children:[r.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[r.jsx("span",{style:{color:"#10b981"},children:"âœ“"})," Content Approved"]}),r.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[r.jsx("span",{style:{color:"#10b981"},children:"ğŸ’°"})," Revenue Approved"]}),r.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[r.jsx("span",{children:"â—‹"})," Pending"]})]})]})}function P({status:e,isOverdue:t}){if(t&&"signed_off"!==e&&"cancelled"!==e)return r.jsxs("span",{style:{background:"#ef444430",color:"#f87171",padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{children:"ğŸš¨"})," Overdue"]});const i={pending:{bg:"#64748b20",color:"#94a3b8",label:"Pending"},in_progress:{bg:"#3b82f620",color:"#60a5fa",label:"In Progress"},complete:{bg:"#f59e0b20",color:"#fbbf24",label:"Awaiting Sign-off"},signed_off:{bg:"#10b98120",color:"#34d399",label:"Signed Off"},cancelled:{bg:"#ef444420",color:"#f87171",label:"Cancelled"}}[e];return r.jsx("span",{style:{background:i.bg,color:i.color,padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600},children:i.label})}async function U(){try{const e=await fetch(`${p}/api/auth/csrf/`,{credentials:"include"}),t=await e.json();return(null==t?void 0:t.csrfToken)||""}catch{return""}}function F({collaboratorRole:e,currentUserId:t,isProjectOwner:n,projectId:o,onTaskUpdate:a}){const[s,l]=i.useState(new Set),[d,c]=i.useState(null),[p,u]=i.useState(""),[g,f]=i.useState({}),[x,h]=i.useState({}),[b,y]=i.useState({}),v=e.user===t,m=e.contract_tasks||[],j=e=>{l(t=>{const r=new Set(t);return r.has(e)?r.delete(e):r.add(e),r})};return 0===m.length?r.jsx("div",{style:{padding:20,background:"#1e293b",borderRadius:12,textAlign:"center",color:"#64748b",fontSize:13},children:"No contract tasks defined for this collaborator."}):r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:20},children:"ğŸ“‹"}),r.jsxs("h3",{style:{margin:0,color:"#f8fafc",fontSize:16,fontWeight:600},children:["Contract Tasks for @",e.username]})]}),r.jsxs("div",{style:{marginTop:6,color:"#94a3b8",fontSize:12},children:[e.role," â€¢ ",e.revenue_percentage,"% revenue share"]})]}),r.jsxs("div",{style:{textAlign:"right"},children:[r.jsxs("div",{style:{color:e.all_tasks_complete?"#10b981":"#f59e0b",fontSize:18,fontWeight:700},children:[e.tasks_signed_off,"/",e.tasks_total]}),r.jsx("div",{style:{color:"#64748b",fontSize:11},children:"signed off"})]})]}),r.jsx("div",{style:{height:6,background:"#0f172a",borderRadius:3,marginBottom:20,overflow:"hidden"},children:r.jsx("div",{style:{height:"100%",width:e.tasks_signed_off/e.tasks_total*100+"%",background:e.all_tasks_complete?"#10b981":"linear-gradient(90deg, #f59e0b, #fbbf24)",borderRadius:3,transition:"width 0.3s ease"}})}),e.has_active_breach&&r.jsxs("div",{style:{background:"#ef444420",border:"1px solid #ef4444",borderRadius:8,padding:12,marginBottom:16,display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:18},children:"ğŸš¨"}),r.jsxs("div",{style:{color:"#f87171",fontSize:13},children:[r.jsx("strong",{children:"Deadline Breach:"})," One or more tasks are past their deadline.",n&&" You may cancel, extend deadlines, or waive the breach."]})]}),p&&r.jsx("div",{style:{background:"#ef444420",border:"1px solid #ef4444",color:"#f87171",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:p}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:m.map(e=>{var t,i,l;const p=s.has(e.id),m=v&&"in_progress"===e.status,S=n&&"complete"===e.status,k=n&&"complete"===e.status,w=d===e.id;return r.jsxs("div",{style:{background:"#0f172a",border:"1px solid "+(e.is_overdue?"#ef4444":"#334155"),borderRadius:10,overflow:"hidden"},children:[r.jsxs("div",{onClick:()=>j(e.id),style:{padding:16,cursor:"pointer",display:"flex",justifyContent:"space-between",alignItems:"flex-start",gap:12},children:[r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10,marginBottom:6},children:[r.jsx(P,{status:e.status,isOverdue:e.is_overdue}),r.jsx("span",{style:{color:"#f8fafc",fontSize:14,fontWeight:600},children:e.title})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,color:"#64748b",fontSize:12},children:[r.jsxs("span",{children:["Due: ",new Date(e.deadline).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})]}),void 0!==e.days_until_deadline&&"signed_off"!==e.status&&r.jsx("span",{style:{color:e.days_until_deadline<0?"#f87171":e.days_until_deadline<3?"#fbbf24":"#64748b"},children:e.days_until_deadline<0?`${Math.abs(e.days_until_deadline)} days overdue`:0===e.days_until_deadline?"Due today":`${e.days_until_deadline} days left`})]})]}),r.jsx("span",{style:{color:"#64748b",fontSize:18},children:p?"â–¼":"â–¶"})]}),p&&r.jsxs("div",{style:{padding:"0 16px 16px",borderTop:"1px solid #334155"},children:[e.description&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("div",{style:{color:"#94a3b8",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:"Description"}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.6},children:e.description})]}),e.completion_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsxs("div",{style:{color:"#94a3b8",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:["Completion Notes from @",e.marked_complete_by_username]}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.6,background:"#1e293b",padding:10,borderRadius:6},children:e.completion_notes})]}),e.signoff_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsxs("div",{style:{color:"#10b981",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:["Signed Off by @",e.signed_off_by_username]}),r.jsx("div",{style:{color:"#34d399",fontSize:13,lineHeight:1.6,background:"#10b98120",padding:10,borderRadius:6},children:e.signoff_notes})]}),e.rejection_notes&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("div",{style:{color:"#f87171",fontSize:11,marginBottom:4,textTransform:"uppercase"},children:"Revision Requested"}),r.jsx("div",{style:{color:"#fca5a5",fontSize:13,lineHeight:1.6,background:"#ef444420",padding:10,borderRadius:6},children:e.rejection_notes})]}),m&&r.jsxs("div",{style:{marginTop:16},children:[r.jsx("textarea",{placeholder:"Add notes about what you completed (optional)...",value:g[e.id]||"",onChange:t=>f(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #334155",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:60,marginBottom:10}}),r.jsx("button",{onClick:()=>(async e=>{c(e),u("");try{const t=await U(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/mark-complete/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({completion_notes:g[e]||""})});if(r.ok)a();else{const e=await r.json();u(e.error||"Failed to mark task complete")}}catch(t){u(t.message||"Failed to mark task complete")}finally{c(null)}})(e.id),disabled:w,style:{width:"100%",padding:"12px 20px",borderRadius:8,border:"none",background:"#10b981",color:"#fff",fontSize:14,fontWeight:600,cursor:w?"not-allowed":"pointer",opacity:w?.6:1},children:w?"Submitting...":"Mark as Complete"})]}),S&&r.jsxs("div",{style:{marginTop:16},children:[r.jsx("textarea",{placeholder:"Add feedback or approval notes (optional)...",value:x[e.id]||"",onChange:t=>h(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #334155",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:60,marginBottom:10}}),r.jsxs("div",{style:{display:"flex",gap:10},children:[r.jsx("button",{onClick:()=>(async e=>{c(e),u("");try{const t=await U(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/sign-off/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({signoff_notes:x[e]||""})});if(r.ok)a();else{const e=await r.json();u(e.error||"Failed to sign off on task")}}catch(t){u(t.message||"Failed to sign off on task")}finally{c(null)}})(e.id),disabled:w,style:{flex:2,padding:"12px 20px",borderRadius:8,border:"none",background:"#10b981",color:"#fff",fontSize:14,fontWeight:600,cursor:w?"not-allowed":"pointer",opacity:w?.6:1},children:w?"Processing...":"Sign Off"}),r.jsx("button",{onClick:()=>j(e.id),style:{flex:1,padding:"12px 20px",borderRadius:8,border:"1px solid #ef4444",background:"transparent",color:"#ef4444",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Request Changes"})]})]}),k&&void 0!==b[e.id]&&r.jsxs("div",{style:{marginTop:12},children:[r.jsx("textarea",{placeholder:"Explain what needs to be revised...",value:b[e.id]||"",onChange:t=>y(r=>({...r,[e.id]:t.target.value})),style:{width:"100%",background:"#1e293b",border:"1px solid #ef4444",borderRadius:6,padding:10,color:"#f8fafc",fontSize:13,resize:"vertical",minHeight:80,marginBottom:10}}),r.jsx("button",{onClick:()=>(async e=>{var t;if(null==(t=b[e])?void 0:t.trim()){c(e),u("");try{const t=await U(),r=await fetch(`/api/collaborative-projects/${o}/tasks/${e}/reject-completion/`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":t,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({rejection_reason:b[e]})});if(r.ok)a(),y(t=>({...t,[e]:""}));else{const e=await r.json();u(e.error||"Failed to reject task")}}catch(r){u(r.message||"Failed to reject task")}finally{c(null)}}else u("Please provide a reason for rejection")})(e.id),disabled:w||!(null==(t=b[e.id])?void 0:t.trim()),style:{width:"100%",padding:"12px 20px",borderRadius:8,border:"none",background:"#ef4444",color:"#fff",fontSize:14,fontWeight:600,cursor:w||!(null==(i=b[e.id])?void 0:i.trim())?"not-allowed":"pointer",opacity:w||!(null==(l=b[e.id])?void 0:l.trim())?.6:1},children:w?"Sending...":"Request Changes"})]})]})]},e.id)})})]})}function $({project:e,currentUser:t,onProjectUpdate:n}){const[o,a]=i.useState(!1),[s,l]=i.useState(""),[d,c]=i.useState(""),[p,g]=i.useState(10),[f,x]=i.useState(""),[h,b]=i.useState(!1),y=e.created_by===t.id,v=e.sections||[],m=e.collaborators||[],j=100-m.reduce((e,t)=>e+t.revenue_percentage,0);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:20},children:"Team Members"}),y&&r.jsx("button",{onClick:()=>a(!o),style:{background:o?"transparent":"linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%)",border:o?"1px solid var(--panel-border)":"none",borderRadius:8,padding:"10px 20px",color:o?"#94a3b8":"#fff",fontWeight:600,cursor:"pointer",fontSize:14},children:o?"Cancel":"+ Invite Collaborator"})]}),o&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Invite New Collaborator"}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6},children:"User ID"}),r.jsx("input",{type:"text",value:s,onChange:e=>l(e.target.value),placeholder:"Enter user ID",style:{width:"100%",padding:"10px 12px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6},children:"Role"}),r.jsx("input",{type:"text",value:d,onChange:e=>c(e.target.value),placeholder:"e.g. Illustrator, Editor, Co-Author",style:{width:"100%",padding:"10px 12px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14}})]})]}),r.jsxs("div",{style:{marginTop:16},children:[r.jsxs("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:6},children:["Revenue Split: ",p,"%",r.jsxs("span",{style:{color:"#64748b",marginLeft:8},children:["(Available: ",j,"%)"]})]}),r.jsx("input",{type:"range",min:1,max:j,value:p,onChange:e=>g(Number(e.target.value)),style:{width:"100%"}})]}),r.jsxs("div",{style:{marginTop:16},children:[r.jsx("label",{style:{display:"block",fontSize:12,color:"#94a3b8",marginBottom:8},children:"Permissions"}),r.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["Text","Images","Audio","Video"].map(e=>r.jsx("span",{style:{background:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:500},children:e},e))}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:6},children:"Default: All content types. You can customize permissions after inviting."})]}),f&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13},children:f}),r.jsxs("div",{style:{marginTop:20,display:"flex",gap:12},children:[r.jsx("button",{onClick:async()=>{const t=parseInt(s.trim(),10);if(t&&!isNaN(t))if(d.trim())if(p<=0||p>j)x(`Percentage must be between 1 and ${j}%`);else{b(!0),x("");try{await u.inviteCollaborator(e.id,{user_id:t,role:d.trim(),revenue_percentage:p,can_edit_text:!0,can_edit_images:!0,can_edit_audio:!0,can_edit_video:!0});const r=await u.getCollaborativeProject(e.id);null==n||n(r),a(!1),l(""),c(""),g(10)}catch(r){x(r.message||"Failed to invite collaborator")}finally{b(!1)}}else x("Please enter a role");else x("Please enter a valid user ID")},disabled:h,style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,padding:"10px 24px",color:"#fff",fontWeight:600,cursor:h?"not-allowed":"pointer",fontSize:14,opacity:h?.7:1},children:h?"Inviting...":"Send Invitation"}),r.jsx("button",{onClick:()=>a(!1),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 24px",color:"#94a3b8",cursor:"pointer",fontSize:14},children:"Cancel"})]})]}),r.jsx(B,{collaborators:m,sections:v,projectCreatorId:e.created_by}),m.filter(e=>"accepted"===e.status&&e.tasks_total>0).length>0&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:18,display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{children:"ğŸ“‹"})," Contract Tasks"]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:20},children:m.filter(e=>"accepted"===e.status&&e.tasks_total>0).map(i=>r.jsx(F,{collaboratorRole:i,currentUserId:t.id,isProjectOwner:y,projectId:e.id,onTaskUpdate:async()=>{const t=await u.getCollaborativeProject(e.id);null==n||n(t)}},i.id))})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Permission Matrix"}),r.jsx("div",{style:{overflowX:"auto"},children:r.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",fontSize:13},children:[r.jsx("thead",{children:r.jsxs("tr",{style:{borderBottom:"1px solid var(--panel-border)"},children:[r.jsx("th",{style:{textAlign:"left",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Collaborator"}),r.jsx("th",{style:{textAlign:"center",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Text"}),r.jsx("th",{style:{textAlign:"center",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Images"}),r.jsx("th",{style:{textAlign:"center",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Audio"}),r.jsx("th",{style:{textAlign:"center",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Video"}),r.jsx("th",{style:{textAlign:"center",padding:"12px 8px",color:"#94a3b8",fontWeight:600},children:"Invite Others"})]})}),r.jsx("tbody",{children:m.filter(e=>"accepted"===e.status).map(e=>{var i,n,o,a;return r.jsxs("tr",{style:{borderBottom:"1px solid var(--panel-border)",background:e.user===t.id?"rgba(59, 130, 246, 0.05)":"transparent"},children:[r.jsx("td",{style:{padding:"12px 8px",color:"var(--text)"},children:r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:e.is_lead?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:11,fontWeight:600},children:e.username.charAt(0).toUpperCase()}),r.jsxs("span",{children:["@",e.username,e.user===t.id&&r.jsx("span",{style:{color:"#94a3b8",marginLeft:4},children:"(you)"})]})]})}),r.jsx("td",{style:{textAlign:"center",padding:"12px 8px"},children:r.jsx(D,{allowed:(null==(i=e.can_edit)?void 0:i.includes("text"))??e.can_edit_text})}),r.jsx("td",{style:{textAlign:"center",padding:"12px 8px"},children:r.jsx(D,{allowed:(null==(n=e.can_edit)?void 0:n.includes("image"))??e.can_edit_images})}),r.jsx("td",{style:{textAlign:"center",padding:"12px 8px"},children:r.jsx(D,{allowed:(null==(o=e.can_edit)?void 0:o.includes("audio"))??e.can_edit_audio})}),r.jsx("td",{style:{textAlign:"center",padding:"12px 8px"},children:r.jsx(D,{allowed:(null==(a=e.can_edit)?void 0:a.includes("video"))??e.can_edit_video})}),r.jsx("td",{style:{textAlign:"center",padding:"12px 8px"},children:r.jsx(D,{allowed:e.can_invite_others||e.is_lead})})]},e.id)})})]})})]}),m.some(e=>void 0!==e.proposed_percentage)&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Counter-Proposals"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:m.filter(e=>void 0!==e.proposed_percentage).map(e=>r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8,border:"1px solid rgba(245, 158, 11, 0.3)"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{fontSize:14,color:"var(--text)",fontWeight:600},children:["@",e.username]}),r.jsx("span",{style:{fontSize:12,color:"#94a3b8"},children:"proposes"})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsxs("span",{style:{fontSize:13,color:"#94a3b8",textDecoration:"line-through"},children:[e.revenue_percentage,"%"]}),r.jsxs("span",{style:{fontSize:16,color:"#f59e0b",fontWeight:700},children:[e.proposed_percentage,"%"]})]})]}),e.counter_message&&r.jsxs("div",{style:{marginTop:8,fontSize:13,color:"#94a3b8",fontStyle:"italic"},children:['"',e.counter_message,'"']})]},e.id))})]})]})}function D({allowed:e}){return r.jsx("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",width:24,height:24,borderRadius:4,background:e?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",color:e?"#10b981":"#ef4444",fontSize:12},children:e?"âœ“":"Ã—"})}const E=new Map;function M(e){return E.has(e)||E.set(e,{activities:[],onlineUsers:[],currentlyEditing:[],lastUpdated:null,isPolling:!1,error:null}),E.get(e)}const N=15e3,L=6e4,O=50,H=3,q=new Map,Y=new Map;async function V(){try{const e=await fetch(`${p}/api/auth/csrf/`,{credentials:"include"}),t=await e.json();return(null==t?void 0:t.csrfToken)||""}catch(e){return""}}async function X(e,t={}){const r=await fetch(e,{credentials:"include",headers:{"Content-Type":"application/json",...t.headers},...t});if(!r.ok){const e=await r.json().catch(()=>({}));throw new Error((null==e?void 0:e.error)||(null==e?void 0:e.detail)||`API request failed: ${r.status}`)}return r.json()}async function G(e,t=20){try{const r=await X(`${p}/api/collaborative-projects/${e}/activities/?limit=${t}`),i=M(e);return i.activities=r.slice(0,O),i.lastUpdated=new Date,i.error=null,te.emit("activity:updated",{projectId:e,activities:r}),r}catch(r){const t=M(e);return t.error=r,t.activities}}async function J(e){try{const t=await X(`${p}/api/collaborative-projects/${e}/online-users/`),r=M(e),i=Date.now(),n=t.map(e=>({...e,is_online:new Date(e.last_seen).getTime()+L>i}));return r.onlineUsers=n,te.emit("activity:online-users",{projectId:e,onlineUsers:n}),n}catch(t){return M(e).onlineUsers}}async function K(e){try{const t=await X(`${p}/api/collaborative-projects/${e}/currently-editing/`);return M(e).currentlyEditing=t,te.emit("activity:currently-editing",{projectId:e,editing:t}),t}catch(t){return M(e).currentlyEditing}}async function Q(e){try{const t=await V();await X(`${p}/api/collaborative-projects/${e}/heartbeat/`,{method:"POST",headers:{"X-CSRFToken":t}})}catch(t){}}async function Z(e){if(M(e).isPolling)try{await Promise.all([G(e,20),J(e),K(e)]),await Q(e),Y.set(e,0)}catch(t){const r=(Y.get(e)||0)+1;Y.set(e,r),r>=H&&(ee(e),te.emit("activity:polling-error",{projectId:e,error:t,retryCount:r}))}}function ee(e){const t=M(e);if(!t.isPolling)return;t.isPolling=!1;const r=q.get(e);r&&(clearInterval(r),q.delete(e)),te.emit("activity:polling-stopped",{projectId:e})}const te=new class{constructor(){t(this,"listeners",new Map)}on(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const r=this.listeners.get(e);r&&r.delete(t)}emit(e,t){const r=this.listeners.get(e);r&&r.forEach(e=>{try{e(t)}catch(r){}})}clear(){this.listeners.clear()}};function re(e){return{section_updated:"ğŸ“",comment_added:"ğŸ’¬",collaborator_joined:"ğŸ‘‹",collaborator_left:"ğŸ‘‹",approval_given:"âœ…",approval_requested:"ğŸ””",ready_for_mint:"ğŸ‰",project_minted:"ğŸª™",media_uploaded:"ğŸ“",invitation_sent:"ğŸ“¬"}[e]||"ğŸ“Œ"}function ie(e){return{section_updated:"#3b82f6",comment_added:"#06b6d4",collaborator_joined:"#10b981",collaborator_left:"#64748b",approval_given:"#10b981",approval_requested:"#f59e0b",ready_for_mint:"#ec4899",project_minted:"#fbbf24",media_uploaded:"#8b5cf6",invitation_sent:"#f59e0b"}[e]||"#64748b"}function ne(e){const t=new Date(e),r=new Date,i=Math.floor((r.getTime()-t.getTime())/1e3);return i<60?"just now":i<3600?`${Math.floor(i/60)}m ago`:i<86400?`${Math.floor(i/3600)}h ago`:i<604800?`${Math.floor(i/86400)}d ago`:t.toLocaleDateString()}const oe={getProjectActivities:G,getOnlineUsers:J,getCurrentlyEditing:K,sendHeartbeat:Q,startEditingSection:async function(e,t){try{const r=await V();await X(`${p}/api/collaborative-projects/${e}/start-editing/`,{method:"POST",headers:{"X-CSRFToken":r},body:JSON.stringify({section_id:t})}),await K(e)}catch(r){}},stopEditingSection:async function(e,t){try{const r=await V();await X(`${p}/api/collaborative-projects/${e}/stop-editing/`,{method:"POST",headers:{"X-CSRFToken":r},body:JSON.stringify({section_id:t})}),await K(e)}catch(r){}},logActivity:async function(e,t,r,i){try{const n=await V(),o=await X(`${p}/api/collaborative-projects/${e}/log-activity/`,{method:"POST",headers:{"X-CSRFToken":n},body:JSON.stringify({activity_type:t,description:r,metadata:i})}),a=M(e);return a.activities=[o,...a.activities].slice(0,O),te.emit("activity:new",{projectId:e,activity:o}),te.emit("activity:updated",{projectId:e,activities:a.activities}),o}catch(n){return null}},startPolling:function(e){const t=M(e);if(t.isPolling)return;t.isPolling=!0,Y.set(e,0),Z(e);const r=setInterval(()=>Z(e),N);q.set(e,r),te.emit("activity:polling-started",{projectId:e})},stopPolling:ee,isPolling:function(e){return M(e).isPolling},getState:function(e){return{...M(e)}},getCachedActivities:function(e){return[...M(e).activities]},getCachedOnlineUsers:function(e){return[...M(e).onlineUsers]},getCachedCurrentlyEditing:function(e){return[...M(e).currentlyEditing]},reset:function(e){ee(e),E.delete(e)},resetAll:function(){q.forEach((e,t)=>{ee(t)}),E.clear(),te.clear()},events:te,getActivityIcon:re,getActivityColor:ie,getTimeAgo:ne,isUserEditingSection:function(e,t,r){return M(e).currentlyEditing.some(e=>e.user_id===t&&e.section_id===r)},getEditorsForSection:function(e,t){return M(e).currentlyEditing.filter(e=>e.section_id===t)}};function ae(e){const{projectId:t,autoStart:r=!1,onNewActivity:n}=e,[o,a]=i.useState([]),[s,l]=i.useState([]),[d,c]=i.useState([]),[p,u]=i.useState(!1),[g,f]=i.useState(!1),[x,h]=i.useState(null),b=i.useRef(null),y=i.useCallback(async()=>{u(!0),h(null);try{const[e,r,i]=await Promise.all([oe.getProjectActivities(t),oe.getOnlineUsers(t),oe.getCurrentlyEditing(t)]);a(e),l(r),c(i)}catch(e){h(e)}finally{u(!1)}},[t]),v=i.useCallback(async e=>{try{await oe.startEditingSection(t,e),b.current=e}catch(r){throw h(r),r}},[t]),m=i.useCallback(async e=>{try{await oe.stopEditingSection(t,e),b.current===e&&(b.current=null)}catch(r){throw h(r),r}},[t]),j=i.useCallback(async(e,r,i)=>{try{await oe.logActivity(t,e,r,i)}catch(n){throw h(n),n}},[t]),S=i.useCallback(()=>{oe.startPolling(t),f(!0)},[t]),k=i.useCallback(()=>{oe.stopPolling(t),f(!1)},[t]),w=i.useCallback(e=>s.some(t=>t.user_id===e&&t.is_online),[s]),_=i.useCallback(e=>d.some(t=>t.section_id===e),[d]),z=i.useCallback(e=>d.filter(t=>t.section_id===e),[d]);return i.useEffect(()=>{const e=te.on("activity:updated",({projectId:e,activities:r})=>{e===t&&a(r)}),r=te.on("activity:new",({projectId:e,activity:r})=>{e===t&&n&&n(r)}),i=te.on("activity:online-users",({projectId:e,onlineUsers:r})=>{e===t&&l(r)}),o=te.on("activity:currently-editing",({projectId:e,editing:r})=>{e===t&&c(r)}),s=te.on("activity:polling-started",({projectId:e})=>{e===t&&f(!0)}),d=te.on("activity:polling-stopped",({projectId:e})=>{e===t&&f(!1)}),p=te.on("activity:polling-error",({projectId:e,error:r})=>{e===t&&(h(r),f(!1))});return()=>{e(),r(),i(),o(),s(),d(),p()}},[t,n]),i.useEffect(()=>(r&&(S(),y()),()=>{r&&(k(),null!==b.current&&oe.stopEditingSection(t,b.current))}),[r,S,k,y,t]),{activities:o,onlineUsers:s,currentlyEditing:d,isLoading:p,isPolling:g,error:x,refresh:y,startEditing:v,stopEditing:m,logActivity:j,startPolling:S,stopPolling:k,isUserOnline:w,isSectionBeingEdited:_,getEditorsForSection:z}}function se(e){const{projectId:t,sectionId:r,includeResolved:n=!1,pollingInterval:o=0}=e,[a,s]=i.useState([]),[l,d]=i.useState([]),[c,p]=i.useState({}),[g,f]=i.useState(0),[x,h]=i.useState(0),[b,y]=i.useState(!1),[v,m]=i.useState(null);i.useEffect(()=>{const e=function(e){const t=new Map,r=[];return e.forEach(e=>{t.set(e.id,{...e,replies:[]})}),e.forEach(e=>{const i=t.get(e.id);if(e.parent_comment){const n=t.get(e.parent_comment);n?n.replies.push(i):r.push(i)}else r.push(i)}),r}(a),t=function(e){const t={general:[]};return e.forEach(e=>{if(e.section){const r=e.section.toString();t[r]||(t[r]=[]),t[r].push(e)}else t.general.push(e)}),t}(a);d(e),p(t),f(a.filter(e=>!e.resolved).length),h(a.length)},[a]);const j=i.useCallback(async()=>{y(!0),m(null);try{let e;e=r?await u.getComments(t,r):await u.getComments(t),n||(e=e.filter(e=>!e.resolved)),s(e)}catch(e){m(e)}finally{y(!1)}},[t,r,n]),S=i.useCallback(async(e,i,n,o,a)=>{const l={project:t,content:e,mentions:i,attachments:n,parent_comment:o,section:a||r};try{const e=await u.addComment(l);return s(t=>[...t,e]),e}catch(d){throw m(d),d}},[t,r]),k=i.useCallback(async(e,t)=>{try{const r=await u.updateComment(e,t);return s(t=>t.map(t=>t.id===e?r:t)),r}catch(r){throw m(r),r}},[]),w=i.useCallback(async e=>{try{s(t=>t.filter(t=>t.id!==e)),await u.deleteComment(e)}catch(t){throw m(t),await j(),t}},[j]),_=i.useCallback(async e=>{try{const t=await u.resolveComment(e);return s(r=>r.map(r=>r.id===e?t:r)),t}catch(t){throw m(t),t}},[]),z=i.useCallback(async e=>{try{const t=await u.unresolveComment(e);return s(r=>r.map(r=>r.id===e?t:r)),t}catch(t){throw m(t),t}},[]),C=i.useCallback(async(e,t)=>{try{const r=await u.addReaction(e,t);s(t=>t.map(t=>t.id===e?{...t,reactions:[...t.reactions||[],r]}:t))}catch(r){throw m(r),r}},[]),R=i.useCallback(async(e,t)=>{try{await u.removeReaction(e,t),s(r=>r.map(r=>r.id===e?{...r,reactions:(r.reactions||[]).filter(e=>e.id!==t)}:r))}catch(r){throw m(r),r}},[]),I=i.useCallback(e=>a.find(t=>t.id===e),[a]),T=i.useCallback(e=>a.filter(t=>t.parent_comment===e),[a]);return i.useEffect(()=>{j()},[j]),i.useEffect(()=>{if(o<=0)return;const e=setInterval(()=>{j()},o);return()=>clearInterval(e)},[o,j]),{comments:l,commentsBySection:c,unresolvedCount:g,totalCount:x,isLoading:b,error:v,refresh:j,addComment:S,updateComment:k,deleteComment:w,resolveComment:_,unresolveComment:z,addReaction:C,removeReaction:R,getCommentById:I,getReplies:T}}function le({activities:e,maxItems:t=20,showAvatar:i=!0,compact:n=!1}){const o=e.slice(0,t);return 0===o.length?r.jsxs("div",{style:{padding:n?16:32,textAlign:"center",color:"#64748b"},children:[r.jsx("div",{style:{fontSize:n?32:48,marginBottom:8},children:"ğŸ“‹"}),r.jsx("div",{style:{fontSize:n?12:14,fontWeight:600,marginBottom:4},children:"No activity yet"}),r.jsx("div",{style:{fontSize:n?11:12,color:"#64748b"},children:"Project activities will appear here"})]}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:n?6:8},children:o.map(e=>r.jsx(de,{activity:e,showAvatar:i,compact:n},e.id))})}function de({activity:e,showAvatar:t=!0,compact:i=!1}){const n=re(e.activity_type),o=ie(e.activity_type),a=ne(e.created_at);return r.jsxs("div",{style:{display:"flex",alignItems:i?"center":"flex-start",gap:i?8:12,padding:i?"8px 12px":"12px 16px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderLeft:`3px solid ${o}`,borderRadius:8,transition:"all 0.2s",cursor:"pointer"},onMouseEnter:e=>{e.currentTarget.style.background="var(--panel)",e.currentTarget.style.borderLeftColor=o},onMouseLeave:e=>{e.currentTarget.style.background="var(--bg)",e.currentTarget.style.borderLeftColor=o},children:[t?r.jsxs("div",{style:{position:"relative",width:i?28:36,height:i?28:36,borderRadius:"50%",background:e.avatar?`url(${e.avatar}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:i?12:14,fontWeight:700,flexShrink:0},children:[!e.avatar&&e.username.charAt(0).toUpperCase(),r.jsx("div",{style:{position:"absolute",bottom:-2,right:-2,width:i?14:16,height:i?14:16,borderRadius:"50%",background:`${o}`,border:"2px solid var(--bg)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:i?8:9},children:n})]}):r.jsx("div",{style:{width:i?24:32,height:i?24:32,borderRadius:8,background:`${o}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:i?14:16,flexShrink:0},children:n}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{fontSize:i?12:13,fontWeight:600,color:"var(--text)",marginBottom:i?2:4,lineHeight:1.4},children:e.description}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,fontSize:i?10:11,color:"#64748b"},children:[r.jsxs("span",{children:["@",e.username]}),e.section_title&&r.jsxs(r.Fragment,{children:[r.jsx("span",{children:"â€¢"}),r.jsx("span",{style:{color:"#94a3b8"},children:e.section_title})]}),r.jsx("span",{children:"â€¢"}),r.jsx("span",{children:a})]})]}),!t&&!i&&r.jsx("div",{style:{padding:"2px 8px",background:`${o}20`,color:o,fontSize:10,fontWeight:700,borderRadius:4,textTransform:"uppercase",flexShrink:0},children:e.activity_type.replace(/_/g," ")})]})}function ce({projectId:e,sectionId:t,parentCommentId:n,collaborators:o,placeholder:a="Add a comment...",autoFocus:s=!1,onSubmit:l,onCancel:d,initialValue:c="",submitButtonText:p="Comment",compact:u=!1}){const[g,f]=i.useState(c),[x,h]=i.useState([]),[b,y]=i.useState([]),[v,m]=i.useState(!1),[j,S]=i.useState(!1),[k,w]=i.useState(""),[_,z]=i.useState([]),[C,R]=i.useState(0),[I,T]=i.useState(null),W=i.useRef(null),A=i.useRef(null),B=o.filter(e=>"accepted"===e.status).map(e=>({userId:e.user,username:e.username,displayName:e.display_name||e.username,avatar:void 0})),P=e=>{var t;if(null===I)return;const r=g.slice(0,I),i=g.slice((null==(t=W.current)?void 0:t.selectionStart)||g.length),n=`${r}@${e.username} ${i}`;f(n),S(!1),x.includes(e.userId)||h([...x,e.userId]),setTimeout(()=>{var t,r;const i=I+e.username.length+2;null==(t=W.current)||t.setSelectionRange(i,i),null==(r=W.current)||r.focus()},0)},U=async()=>{if(g.trim()||0!==b.length){m(!0);try{await l(g,x,b.length>0?b:void 0),f(""),h([]),y([])}catch(e){}finally{m(!1)}}};return i.useEffect(()=>{s&&W.current&&W.current.focus()},[s]),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:u?8:12,padding:u?12:16,position:"relative"},children:[r.jsxs("div",{style:{position:"relative"},children:[r.jsx("textarea",{ref:W,value:g,onChange:e=>{const t=e.target.value;f(t);const r=e.target.selectionStart,i=t.slice(0,r),n=i.lastIndexOf("@");if(-1!==n){const e=i.slice(n+1);if(!e.includes(" ")&&!e.includes("\n")){const t=e.toLowerCase();w(t),T(n);const r=B.filter(e=>e.username.toLowerCase().includes(t)||e.displayName.toLowerCase().includes(t));return z(r),S(r.length>0),void R(0)}}S(!1)},onKeyDown:e=>{j?"ArrowDown"===e.key?(e.preventDefault(),R(e=>e<_.length-1?e+1:e)):"ArrowUp"===e.key?(e.preventDefault(),R(e=>e>0?e-1:e)):"Enter"===e.key||"Tab"===e.key?(e.preventDefault(),_[C]&&P(_[C])):"Escape"===e.key&&S(!1):"Enter"===e.key&&(e.metaKey||e.ctrlKey)&&(e.preventDefault(),U())},placeholder:a,style:{width:"100%",minHeight:u?60:80,maxHeight:200,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,padding:10,color:"var(--text)",fontSize:u?12:13,lineHeight:1.5,resize:"vertical",outline:"none",fontFamily:"inherit"}}),j&&r.jsx("div",{style:{position:"absolute",bottom:"100%",left:0,marginBottom:4,minWidth:200,maxWidth:300,background:"#1e293b",border:"1px solid #334155",borderRadius:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",maxHeight:200,overflowY:"auto",zIndex:1e3},children:_.map((e,t)=>r.jsxs("div",{onClick:()=>P(e),style:{padding:"8px 12px",cursor:"pointer",background:t===C?"#334155":"transparent",display:"flex",alignItems:"center",gap:8,transition:"background 0.2s"},onMouseEnter:()=>R(t),children:[r.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:11,fontWeight:700},children:e.username.charAt(0).toUpperCase()}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"#e5e7eb",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["@",e.username]}),e.displayName!==e.username&&r.jsx("div",{style:{fontSize:11,color:"#94a3b8",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.displayName})]})]},e.userId))})]}),b.length>0&&r.jsx("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:6},children:b.map((e,t)=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:6,fontSize:12},children:[r.jsx("span",{children:"ğŸ“"}),r.jsx("span",{style:{flex:1,color:"var(--text)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.name}),r.jsxs("span",{style:{color:"#64748b",fontSize:11},children:[(e.size/1024).toFixed(1)," KB"]}),r.jsx("button",{onClick:()=>(e=>{y(b.filter((t,r)=>r!==e))})(t),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",fontSize:16,padding:0,lineHeight:1},children:"Ã—"})]},`${e.name}-${e.size}`))}),r.jsxs("div",{style:{marginTop:12,display:"flex",justifyContent:"space-between",alignItems:"center",gap:8},children:[r.jsxs("div",{children:[r.jsx("input",{ref:A,type:"file",multiple:!0,style:{display:"none"},onChange:e=>{if(e.target.files){const t=Array.from(e.target.files);y([...b,...t])}}}),r.jsx("button",{onClick:()=>{var e;return null==(e=A.current)?void 0:e.click()},disabled:v,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:u?"4px 10px":"6px 12px",color:"#94a3b8",cursor:v?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:600,display:"flex",alignItems:"center",gap:6},children:"ğŸ“ Attach"})]}),r.jsxs("div",{style:{display:"flex",gap:8},children:[d&&r.jsx("button",{onClick:d,disabled:v,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:u?"4px 12px":"6px 16px",color:"#94a3b8",cursor:v?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:600},children:"Cancel"}),r.jsx("button",{onClick:U,disabled:v||!g.trim()&&0===b.length,style:{background:v||!g.trim()&&0===b.length?"#374151":"#3b82f6",border:"none",borderRadius:6,padding:u?"4px 12px":"6px 16px",color:"#fff",cursor:v||!g.trim()&&0===b.length?"not-allowed":"pointer",fontSize:u?11:12,fontWeight:700},children:v?"Posting...":p})]})]}),!u&&r.jsxs("div",{style:{marginTop:8,fontSize:10,color:"#64748b"},children:["Tip: Use @ to mention collaborators â€¢ ",navigator.platform.includes("Mac")?"Cmd":"Ctrl","+Enter to submit"]})]})}const pe=["ğŸ‘","ğŸ‘","â¤ï¸","ğŸ˜Š","ğŸ‰","ğŸ”¥","ğŸ‘€","ğŸ¤”"];function ue({comment:e,currentUserId:t,onReaction:n,onRemoveReaction:o}){const[a,s]=i.useState(!1),[l,d]=i.useState(!1),c=i.useRef(null),p={};e.reactions&&e.reactions.forEach(e=>{p[e.emoji]||(p[e.emoji]=[]),p[e.emoji].push(e)});const u=e=>{var r;return null==(r=p[e])?void 0:r.find(e=>e.user_id===t)},g=async e=>{const t=u(e);d(!0);try{t?await o(t.id):await n(e)}catch(r){}finally{d(!1),s(!1)}};return i.useEffect(()=>{if(!a)return;const e=e=>{c.current&&!c.current.contains(e.target)&&s(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[a]),r.jsxs("div",{style:{display:"flex",alignItems:"center",flexWrap:"wrap",gap:6,marginTop:8},children:[Object.entries(p).map(([e,t])=>{const i=!!u(e);return r.jsxs("button",{onClick:()=>g(e),disabled:l,title:t.map(e=>e.username).join(", "),style:{display:"flex",alignItems:"center",gap:4,padding:"4px 8px",background:i?"rgba(59, 130, 246, 0.2)":"rgba(100, 116, 139, 0.1)",border:"1px solid "+(i?"#3b82f6":"#334155"),borderRadius:12,cursor:l?"not-allowed":"pointer",fontSize:14,transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.transform="scale(1.05)")},onMouseLeave:e=>{e.currentTarget.style.transform="scale(1)"},children:[r.jsx("span",{children:e}),r.jsx("span",{style:{fontSize:11,fontWeight:600,color:i?"#3b82f6":"#94a3b8"},children:t.length})]},e)}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>s(!a),disabled:l,style:{padding:"4px 8px",background:"transparent",border:"1px solid #334155",borderRadius:12,cursor:l?"not-allowed":"pointer",fontSize:14,color:"#94a3b8",transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.borderColor="#3b82f6",e.currentTarget.style.color="#3b82f6")},onMouseLeave:e=>{e.currentTarget.style.borderColor="#334155",e.currentTarget.style.color="#94a3b8"},children:"+"}),a&&r.jsx("div",{ref:c,style:{position:"absolute",bottom:"100%",left:0,marginBottom:4,background:"#1e293b",border:"1px solid #334155",borderRadius:12,padding:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:4,zIndex:100},children:pe.map(e=>r.jsx("button",{onClick:()=>g(e),disabled:l,style:{width:40,height:40,padding:0,background:u(e)?"rgba(59, 130, 246, 0.2)":"transparent",border:u(e)?"1px solid #3b82f6":"1px solid transparent",borderRadius:8,cursor:l?"not-allowed":"pointer",fontSize:20,display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s"},onMouseEnter:e=>{l||(e.currentTarget.style.background="rgba(59, 130, 246, 0.1)",e.currentTarget.style.transform="scale(1.1)")},onMouseLeave:t=>{t.currentTarget.style.background=u(e)?"rgba(59, 130, 246, 0.2)":"transparent",t.currentTarget.style.transform="scale(1)"},children:e},e))})]})]})}function ge({comment:e,projectId:t,currentUserId:n,collaborators:o,depth:a=0,maxDepth:s=3,onReply:l,onEdit:d,onDelete:c,onResolve:p,onUnresolve:u,onReaction:g,onRemoveReaction:f}){const[x,h]=i.useState(!1),[b,y]=i.useState(!1),[v,m]=i.useState(!1),[j,S]=i.useState(!1),k=e.author===n,w=a<s;return r.jsxs("div",{style:{display:"flex",gap:12,opacity:e.resolved?.6:1,transition:"opacity 0.2s"},children:[a>0&&r.jsx("div",{style:{width:2,background:"#334155",flexShrink:0,marginLeft:16}}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsxs("div",{style:{background:"var(--bg)",border:"1px solid "+(e.resolved?"#10b981":"var(--panel-border)"),borderRadius:8,padding:12},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:28,height:28,borderRadius:"50%",background:e.author_avatar?`url(${e.author_avatar}) center/cover`:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:700},children:!e.author_avatar&&e.author_username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.author_username]}),e.edited&&r.jsx("span",{style:{marginLeft:6,fontSize:11,color:"#64748b",cursor:e.edit_history?"pointer":"default"},onClick:()=>e.edit_history&&S(!j),title:e.edit_history?"Click to see edit history":void 0,children:"(edited)"})]}),r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:"â€¢"}),r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:ne(e.created_at)}),e.section_title&&r.jsxs(r.Fragment,{children:[r.jsx("span",{style:{fontSize:11,color:"#64748b"},children:"â€¢"}),r.jsx("span",{style:{fontSize:10,color:"#94a3b8",background:"rgba(59, 130, 246, 0.1)",padding:"2px 6px",borderRadius:4},children:e.section_title})]}),e.resolved&&r.jsx("span",{style:{fontSize:10,color:"#10b981",background:"rgba(16, 185, 129, 0.1)",padding:"2px 6px",borderRadius:4,fontWeight:600},title:e.resolved_by_username?`Resolved by @${e.resolved_by_username}`:"Resolved",children:"âœ“ Resolved"})]}),r.jsxs("div",{style:{position:"relative"},children:[r.jsx("button",{onClick:()=>m(!v),style:{background:"transparent",border:"none",color:"#94a3b8",cursor:"pointer",fontSize:18,padding:"2px 6px",lineHeight:1},children:"â‹®"}),v&&r.jsxs("div",{style:{position:"absolute",top:"100%",right:0,marginTop:4,background:"#1e293b",border:"1px solid #334155",borderRadius:8,boxShadow:"0 10px 40px rgba(0, 0, 0, 0.5)",minWidth:150,zIndex:100},children:[k&&r.jsxs(r.Fragment,{children:[r.jsx("button",{onClick:()=>{y(!0),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:"#e5e7eb",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"âœï¸ Edit"}),r.jsx("button",{onClick:async()=>{confirm("Are you sure you want to delete this comment?")&&await c(e.id),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:"#ef4444",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"ğŸ—‘ï¸ Delete"})]}),r.jsx("button",{onClick:async()=>{e.resolved?await u(e.id):await p(e.id),m(!1)},style:{width:"100%",background:"transparent",border:"none",color:e.resolved?"#94a3b8":"#10b981",padding:"8px 12px",textAlign:"left",cursor:"pointer",fontSize:13},onMouseEnter:e=>{e.currentTarget.style.background="#334155"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:e.resolved?"â†©ï¸ Unresolve":"âœ“ Resolve"})]})]})]}),j&&e.edit_history&&e.edit_history.length>0&&r.jsxs("div",{style:{marginBottom:8,padding:8,background:"rgba(100, 116, 139, 0.1)",border:"1px solid #334155",borderRadius:6,fontSize:11,color:"#94a3b8"},children:[r.jsx("div",{style:{fontWeight:600,marginBottom:4},children:"Edit History:"}),e.edit_history.map(e=>r.jsxs("div",{style:{marginBottom:4},children:[r.jsxs("span",{style:{color:"#64748b"},children:[new Date(e.edited_at).toLocaleString(),":"]})," ",e.content]},e.edited_at))]}),b?r.jsx(ce,{projectId:t,collaborators:o,onSubmit:async t=>{await(async t=>{await d(e.id,t),y(!1)})(t)},onCancel:()=>y(!1),initialValue:e.content,submitButtonText:"Save",compact:!0}):r.jsx("div",{style:{fontSize:13,color:"#cbd5e1",lineHeight:1.6,marginBottom:8,whiteSpace:"pre-wrap"},children:e.content}),e.attachments&&e.attachments.length>0&&r.jsx("div",{style:{marginTop:8,marginBottom:8,display:"flex",flexDirection:"column",gap:6},children:e.attachments.map(e=>r.jsxs("a",{href:e.file_url,target:"_blank",rel:"noopener noreferrer",style:{display:"flex",alignItems:"center",gap:8,padding:"6px 10px",background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:6,fontSize:12,color:"#3b82f6",textDecoration:"none",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.2)"},onMouseLeave:e=>{e.currentTarget.style.background="rgba(59, 130, 246, 0.1)"},children:[r.jsx("span",{children:"ğŸ“"}),r.jsx("span",{style:{flex:1},children:e.filename}),r.jsxs("span",{style:{fontSize:11,color:"#94a3b8"},children:[(e.file_size/1024).toFixed(1)," KB"]})]},e.id))}),r.jsx(ue,{comment:e,currentUserId:n,onReaction:t=>g(e.id,t),onRemoveReaction:t=>f(e.id,t)}),!b&&r.jsx("div",{style:{marginTop:8,display:"flex",gap:12,fontSize:12},children:w&&r.jsx("button",{onClick:()=>h(!x),style:{background:"transparent",border:"none",color:"#3b82f6",cursor:"pointer",fontSize:12,fontWeight:600,padding:0},children:"Reply"})})]}),x&&r.jsx("div",{style:{marginTop:12},children:r.jsx(ce,{projectId:t,parentCommentId:e.id,collaborators:o,placeholder:`Reply to @${e.author_username}...`,onSubmit:async(t,r,i)=>{await l(e.id,t,r,i),h(!1)},onCancel:()=>h(!1),submitButtonText:"Reply",compact:!0,autoFocus:!0})}),e.replies&&e.replies.length>0&&r.jsx("div",{style:{marginTop:12,display:"flex",flexDirection:"column",gap:12},children:e.replies.map(e=>r.jsx(ge,{comment:e,projectId:t,currentUserId:n,collaborators:o,depth:a+1,maxDepth:s,onReply:l,onEdit:d,onDelete:c,onResolve:p,onUnresolve:u,onReaction:g,onRemoveReaction:f},e.id))})]})]})}function fe({project:e,currentUser:t}){const[n,o]=i.useState("activity"),[a,s]=i.useState(!1),{activities:l,onlineUsers:d,isPolling:c}=ae({projectId:e.id,autoStart:!0}),{comments:p,unresolvedCount:u,totalCount:g,isLoading:f,addComment:x,updateComment:h,deleteComment:b,resolveComment:y,unresolveComment:v,addReaction:m,removeReaction:j}=se({projectId:e.id,includeResolved:a,pollingInterval:3e4});return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("div",{style:{display:"flex",gap:4,background:"var(--panel)",padding:4,borderRadius:8,border:"1px solid var(--panel-border)"},children:[r.jsx("button",{onClick:()=>o("activity"),style:{padding:"8px 16px",background:"activity"===n?"var(--bg)":"transparent",border:"activity"===n?"1px solid var(--panel-border)":"1px solid transparent",borderRadius:6,color:"activity"===n?"var(--text)":"#94a3b8",cursor:"pointer",fontSize:13,fontWeight:"activity"===n?600:500},children:"Activity Feed"}),r.jsxs("button",{onClick:()=>o("comments"),style:{padding:"8px 16px",background:"comments"===n?"var(--bg)":"transparent",border:"comments"===n?"1px solid var(--panel-border)":"1px solid transparent",borderRadius:6,color:"comments"===n?"var(--text)":"#94a3b8",cursor:"pointer",fontSize:13,fontWeight:"comments"===n?600:500,display:"flex",alignItems:"center",gap:8},children:["Comments",u>0&&r.jsx("span",{style:{background:"#ef4444",color:"#fff",fontSize:10,fontWeight:700,padding:"2px 6px",borderRadius:10},children:u})]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:8,height:8,borderRadius:"50%",background:c?"#10b981":"#64748b"}}),r.jsxs("span",{style:{fontSize:12,color:"#94a3b8"},children:[d.length," online"]})]})]}),"activity"===n&&r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:16},children:"Recent Activity"}),l.length>0?r.jsx(le,{activities:l,maxItems:50}):r.jsx("div",{style:{textAlign:"center",padding:40,color:"#64748b",fontSize:14},children:"No activity yet. Activity will appear here as collaborators work on the project."})]}),"comments"===n&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:20},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Add Comment"}),r.jsx(ce,{projectId:e.id,onSubmit:async(e,t)=>{try{await x(e,t)}catch(r){}},collaborators:e.collaborators||[],placeholder:"Share your thoughts with the team..."})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:20},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16},children:["Comments (",g,")"]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,fontSize:12,color:"#94a3b8",cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:a,onChange:e=>s(e.target.checked)}),"Show resolved"]})]}),f?r.jsx("div",{style:{textAlign:"center",padding:20,color:"#94a3b8"},children:"Loading comments..."}):p.length>0?r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:16},children:p.map(i=>r.jsx(ge,{comment:i,projectId:e.id,currentUserId:t.id,collaborators:e.collaborators||[],onReply:async(e,t,r)=>{await x(t,r,void 0,e)},onEdit:async(e,t)=>{await h(e,t)},onDelete:async e=>{await b(e)},onResolve:async e=>{await y(e)},onUnresolve:async e=>{await v(e)},onReaction:async(e,t)=>{await m(e,t)},onRemoveReaction:async(e,t)=>{await j(e,t)}},i.id))}):r.jsx("div",{style:{textAlign:"center",padding:40,color:"#64748b",fontSize:14},children:"No comments yet. Start the conversation!"})]})]})]})}function xe({project:e,currentUser:t,onProjectUpdate:n}){const[o,a]=i.useState("customize"),[s,l]=i.useState(!1),[d,c]=i.useState(""),[p,g]=i.useState(!1),[f,x]=i.useState(e.teaser_percent||10),[h,b]=i.useState(e.watermark_preview||!1),[y,v]=i.useState(parseFloat(String(e.price_usd))||1),[m,j]=i.useState(e.editions||1),[S,k]=i.useState(e.authors_note||""),w=e.collaborators||[],_=w.filter(e=>"accepted"===e.status),z=e.sections||[],C=w.find(e=>e.user===t.id),R=e.created_by===t.id,I=Boolean(e.title&&e.title.trim().length>=3&&!e.title.startsWith("Collaboration Invite")),T=z.length>0,W=z.filter(e=>"text"===e.section_type),A="book"!==e.content_type||W.some(e=>(e.content_html||""||"").replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").trim().length>=50),B=z.filter(e=>"text"!==e.section_type),P=!["art","music","video"].includes(e.content_type)||B.some(e=>e.media_file),U=y>0,F=m>=1,$=_.filter(e=>(e.tasks_total||0)>0),D=0===$.length||$.every(e=>e.all_tasks_complete),E=$.reduce((e,t)=>e+((t.tasks_total||0)-(t.tasks_signed_off||0)),0),M=[{id:"title",label:"Valid project title",checked:I,hint:I?void 0:"Set a title (min 3 characters, not a placeholder)"},{id:"content",label:"book"===e.content_type?"Book has text content (min 50 characters)":`${e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)} has media files`,checked:T&&("book"===e.content_type?A:P),hint:T?"book"!==e.content_type||A?void 0:"Add at least 50 characters of text":"Add at least one section"},{id:"price",label:"Price set (greater than $0)",checked:U,hint:U?void 0:"Set a price for your NFT"},{id:"editions",label:"Edition count set",checked:F,hint:F?void 0:"Set at least 1 edition"},{id:"splits",label:"Revenue splits total 100%",checked:Math.abs(w.reduce((e,t)=>e+parseFloat(String(t.revenue_percentage)),0)-100)<.01},{id:"tasks",label:"All contract tasks signed off",checked:D,hint:D?void 0:`${E} task${1===E?"":"s"} still need sign-off`},{id:"invited",label:"All collaborators responded",checked:w.every(e=>"accepted"===e.status||"declined"===e.status)},{id:"approved",label:"All collaborators approved",checked:e.is_fully_approved}],N=M.every(e=>e.checked);i.useEffect(()=>{"minted"===e.status?a("share"):e.is_fully_approved&&a("mint")},[e.status,e.is_fully_approved]);const L=[{id:"customize",label:"Customize"},{id:"approve",label:"Approve"},{id:"mint",label:"Mint"},{id:"share",label:"Share"}],O=L.findIndex(e=>e.id===o),H=.9*y*m*((null==C?void 0:C.revenue_percentage)||0)/100;return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsx("div",{style:{display:"grid",gridTemplateColumns:`repeat(${L.length}, 1fr)`,gap:8,alignItems:"end"},children:L.map((t,i)=>{const n=t.id===o,s=i<O||"minted"===e.status,l=i<=O||"minted"===e.status;return r.jsxs("div",{onClick:()=>l&&a(t.id),style:{cursor:l?"pointer":"default"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx("div",{style:{width:24,height:24,borderRadius:999,border:"1px solid var(--panel-border)",background:n?"var(--accent)":s?"#10b981":"var(--panel)",color:n||s?"#111":"var(--text-dim)",display:"grid",placeItems:"center",fontSize:12,fontWeight:700},children:s?"âœ“":i+1}),r.jsx("div",{style:{fontSize:13,color:n?"var(--text)":"var(--text-dim)",fontWeight:n?700:600},children:t.label})]}),r.jsx("div",{style:{height:3,marginTop:6,borderRadius:999,background:n?"radial-gradient(60% 100% at 50% 100%, rgba(245,158,11,0.9), rgba(245,158,11,0.2))":s?"#10b981":"transparent",boxShadow:n?"0 0 8px rgba(245,158,11,0.7)":"none"}})]},t.id)})}),O>0&&"share"!==o&&r.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:r.jsx("button",{onClick:()=>a(L[O-1].id),style:{background:"transparent",border:"1px solid var(--panel-border)",color:"var(--text-dim)",borderRadius:8,padding:"6px 12px",cursor:"pointer",fontSize:13},children:"Back"})}),d&&r.jsx("div",{style:{padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13},children:d}),"customize"===o&&r.jsx(he,{isProjectLead:R,teaserPercent:f,setTeaserPercent:x,watermark:h,setWatermark:b,price:y,setPrice:v,editions:m,setEditions:j,authorsNote:S,setAuthorsNote:k,onNext:R?async()=>{if(R){g(!0),c("");try{const t=await u.updateCustomization(e.id,{price_usd:y,editions:m,teaser_percent:f,watermark_preview:h,authors_note:S});null==n||n(t),a("approve")}catch(t){c(t.message||"Failed to save customization")}finally{g(!1)}}}:()=>a("approve"),saving:p,authorName:e.created_by_username||"Creator"}),"approve"===o&&r.jsx(be,{project:e,currentUser:t,currentUserRole:C,acceptedCollaborators:_,checklistItems:M,price:y,editions:m,userEstimatedEarnings:H,onApproveVersion:async()=>{try{const t=await u.approveCurrentVersion(e.id);null==n||n(t)}catch(t){c(t.message||"Failed to approve")}},onApproveRevenue:async()=>{try{const t=await u.approveProject(e.id,{approve_content:(null==C?void 0:C.approved_current_version)||!1,approve_revenue:!0});null==n||n(t)}catch(t){c(t.message||"Failed to approve revenue split")}},onNext:()=>a("mint")}),"mint"===o&&r.jsx(ye,{project:e,isProjectLead:R,allChecked:N,checklistItems:M,price:y,editions:m,minting:s,onMint:async()=>{if(N&&R){l(!0),c("");try{await u.mintProject(e.id);const t=await u.getCollaborativeProject(e.id);null==n||n(t),a("share")}catch(t){c(t.message||"Failed to mint project")}finally{l(!1)}}}}),"share"===o&&r.jsx(ve,{project:e})]})}function he({isProjectLead:e,teaserPercent:t,setTeaserPercent:i,watermark:n,setWatermark:o,price:a,setPrice:s,editions:l,setEditions:d,authorsNote:c,setAuthorsNote:p,onNext:u,saving:g,authorName:f}){const x=c.trim().split(/\s+/).filter(e=>e.length>0).length;const h=x>100;return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:18},children:"Customize Your NFT"}),!e&&r.jsx("div",{style:{padding:16,background:"rgba(245, 158, 11, 0.1)",borderRadius:8,marginBottom:20,color:"#f59e0b",fontSize:13},children:"Only the project owner can modify these settings."}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{children:[r.jsxs("label",{style:{fontSize:13,color:"#94a3b8",display:"block",marginBottom:8},children:["Teaser shown to public: ",t,"%"]}),r.jsx("input",{type:"range",min:0,max:100,value:t,onChange:e=>i(parseInt(e.target.value)),disabled:!e,style:{width:"100%"}})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,cursor:e?"pointer":"not-allowed"},children:[r.jsx("input",{type:"checkbox",checked:n,onChange:e=>o(e.target.checked),disabled:!e}),r.jsx("span",{style:{fontSize:13,color:"var(--text)"},children:"Show watermark on teaser"})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16},children:[r.jsxs("div",{children:[r.jsx("label",{style:{fontSize:12,color:"#94a3b8",display:"block",marginBottom:8},children:"Price per edition (USD)"}),r.jsx("input",{type:"number",min:.01,step:.01,value:a,onChange:e=>s(parseFloat(e.target.value)||0),disabled:!e,style:{width:"100%",padding:"10px 14px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:16}})]}),r.jsxs("div",{children:[r.jsx("label",{style:{fontSize:12,color:"#94a3b8",display:"block",marginBottom:8},children:"Number of editions"}),r.jsx("input",{type:"number",min:1,value:l,onChange:e=>d(parseInt(e.target.value)||1),disabled:!e,style:{width:"100%",padding:"10px 14px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:16}})]})]}),r.jsxs("div",{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("label",{style:{fontSize:13,color:"#94a3b8"},children:"Author's Note (optional)"}),r.jsxs("span",{style:{fontSize:11,color:h?"#ef4444":"#64748b"},children:[x,"/",100," words"]})]}),r.jsx("textarea",{value:c,onChange:e=>p(e.target.value),placeholder:"Share a brief note about this work with your audience...",disabled:!e,style:{width:"100%",minHeight:80,padding:"10px 14px",background:"var(--bg)",border:"1px solid "+(h?"#ef4444":"var(--panel-border)"),borderRadius:8,color:"var(--text)",fontSize:14,resize:"vertical",fontFamily:"inherit",cursor:e?"text":"not-allowed",opacity:e?1:.6}}),h&&r.jsxs("div",{style:{fontSize:11,color:"#ef4444",marginTop:4},children:["Please keep your note under ",100," words."]})]}),r.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Platform fee applies per terms. Changing price or editions will reset all revenue split approvals."}),r.jsx(y,{authorName:f})]}),r.jsx("div",{style:{marginTop:24,display:"flex",justifyContent:"flex-end"},children:r.jsx("button",{onClick:u,disabled:e&&g,style:{padding:"12px 32px",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,color:"#111",fontWeight:700,fontSize:14,cursor:e&&g?"not-allowed":"pointer",opacity:e&&g?.7:1},children:e?g?"Saving...":"Save & Continue":"Continue to Approve"})})]})}function be({project:e,currentUser:t,currentUserRole:i,acceptedCollaborators:n,checklistItems:o,price:a,editions:s,userEstimatedEarnings:l,onApproveVersion:d,onApproveRevenue:c,onNext:p}){const u=(null==i?void 0:i.approved_current_version)&&(null==i?void 0:i.approved_revenue_split);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:20},children:[r.jsxs("div",{style:{background:e.is_fully_approved?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",border:"1px solid "+(e.is_fully_approved?"#10b981":"#f59e0b"),borderRadius:12,padding:20,display:"flex",alignItems:"center",gap:16},children:[r.jsx("div",{style:{width:48,height:48,borderRadius:"50%",background:e.is_fully_approved?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:24},children:e.is_fully_approved?"âœ“":"..."}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:18,fontWeight:700,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:e.is_fully_approved?"All Approved!":"Awaiting Approvals"}),r.jsx("div",{style:{fontSize:14,color:"#94a3b8",marginTop:4},children:e.is_fully_approved?"All collaborators have approved. Proceed to mint.":"Waiting for all collaborators to approve content and revenue split."})]})]}),r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:20},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Your Approval"}),u?r.jsxs("div",{style:{textAlign:"center",padding:24,background:"rgba(16, 185, 129, 0.1)",borderRadius:8},children:[r.jsx("div",{style:{fontSize:48,marginBottom:12},children:"âœ“"}),r.jsx("div",{style:{fontSize:16,fontWeight:600,color:"#10b981"},children:"You've approved this project"})]}):r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Content Approval"}),r.jsx("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:12},children:"Confirm you're happy with all content in this project."}),r.jsx("button",{onClick:d,disabled:null==i?void 0:i.approved_current_version,style:{width:"100%",padding:"10px 16px",background:(null==i?void 0:i.approved_current_version)?"#374151":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:(null==i?void 0:i.approved_current_version)?"not-allowed":"pointer",fontSize:13},children:(null==i?void 0:i.approved_current_version)?"âœ“ Content Approved":"Approve Content"})]}),r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Revenue Split Approval"}),r.jsxs("div",{style:{fontSize:12,color:"#94a3b8",marginBottom:12},children:["$",a.toFixed(2)," x ",s," editions = $",(a*s).toFixed(2)," gross. Your share: ",(null==i?void 0:i.revenue_percentage)||0,"% = $",l.toFixed(2)," (after 10% platform fee)"]}),r.jsx("button",{onClick:c,disabled:null==i?void 0:i.approved_revenue_split,style:{width:"100%",padding:"10px 16px",background:(null==i?void 0:i.approved_revenue_split)?"#374151":"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:(null==i?void 0:i.approved_revenue_split)?"not-allowed":"pointer",fontSize:13},children:(null==i?void 0:i.approved_revenue_split)?"âœ“ Revenue Approved":"Approve Revenue Split"})]})]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 16px",color:"var(--text)",fontSize:16},children:"Team Approval Status"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:n.map(e=>{const t=e.approved_current_version&&e.approved_revenue_split;return r.jsxs("div",{style:{padding:12,background:t?"rgba(16, 185, 129, 0.1)":"var(--bg)",border:"1px solid "+(t?"#10b981":"var(--panel-border)"),borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:32,height:32,borderRadius:"50%",background:t?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"linear-gradient(135deg, #64748b 0%, #475569 100%)",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:600},children:t?"âœ“":e.username.charAt(0).toUpperCase()}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[e.role," - ",e.revenue_percentage,"%"]})]})]}),r.jsxs("div",{style:{display:"flex",gap:6},children:[r.jsxs("span",{style:{fontSize:10,padding:"3px 6px",borderRadius:4,background:e.approved_current_version?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",color:e.approved_current_version?"#10b981":"#64748b"},children:[e.approved_current_version?"âœ“":"â—‹"," Content"]}),r.jsxs("span",{style:{fontSize:10,padding:"3px 6px",borderRadius:4,background:e.approved_revenue_split?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",color:e.approved_revenue_split?"#10b981":"#64748b"},children:[e.approved_revenue_split?"âœ“":"â—‹"," Revenue"]})]})]},e.id)})})]})]}),e.is_fully_approved&&r.jsx("div",{style:{display:"flex",justifyContent:"flex-end"},children:r.jsx("button",{onClick:p,style:{padding:"12px 32px",background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,color:"#111",fontWeight:700,fontSize:14,cursor:"pointer"},children:"Next"})})]})}function ye({project:e,isProjectLead:t,allChecked:n,checklistItems:o,price:a,editions:s,minting:l,onMint:d}){const[c,p]=i.useState(!1),u=a*s,g=.1*u,f=u-g;return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsx("h3",{style:{margin:"0 0 20px",color:"var(--text)",fontSize:18},children:"Review & Mint"}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("h4",{style:{margin:"0 0 12px",color:"var(--text)",fontSize:14},children:"Pre-mint Checklist"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:o.map(e=>r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:4,padding:10,background:e.checked?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.05)",borderRadius:6,border:e.checked?"none":"1px solid rgba(239, 68, 68, 0.2)"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:10},children:[r.jsx("div",{style:{width:20,height:20,borderRadius:"50%",background:e.checked?"#10b981":"#ef4444",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:10},children:e.checked?"âœ“":"!"}),r.jsx("span",{style:{fontSize:13,color:e.checked?"#10b981":"var(--text)"},children:e.label})]}),!e.checked&&e.hint&&r.jsx("span",{style:{fontSize:11,color:"#ef4444",marginLeft:30},children:e.hint})]},e.id))})]}),r.jsxs("div",{style:{padding:16,background:"var(--bg)",borderRadius:8,marginBottom:24},children:[r.jsx("h4",{style:{margin:"0 0 12px",color:"var(--text)",fontSize:14},children:"Financial Summary"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8,fontSize:13,color:"#94a3b8"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Price per edition:"}),r.jsxs("span",{style:{color:"var(--text)"},children:["$",a.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Editions:"}),r.jsx("span",{style:{color:"var(--text)"},children:s})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Gross Revenue (if all sold):"}),r.jsxs("span",{style:{color:"var(--text)"},children:["$",u.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[r.jsx("span",{children:"Platform Fee (10%):"}),r.jsxs("span",{style:{color:"#ef4444"},children:["-$",g.toFixed(2)]})]}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",borderTop:"1px solid var(--panel-border)",paddingTop:8},children:[r.jsx("span",{style:{fontWeight:600},children:"Creator Pool:"}),r.jsxs("span",{style:{color:"#10b981",fontWeight:600},children:["$",f.toFixed(2)]})]})]})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12},children:[r.jsx("a",{href:"/legal/terms",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Terms of Service"}),r.jsx("a",{href:"/legal/creator-agreement",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Creator Agreement"}),r.jsx("a",{href:"/legal/content-policy",target:"_blank",rel:"noreferrer",style:{fontSize:12,color:"var(--accent)"},children:"Content Policy"})]}),r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8,marginTop:12,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:c,onChange:e=>p(e.target.checked)}),r.jsx("span",{style:{fontSize:13,color:"var(--text)"},children:"I agree to the Terms and understand fees"})]})]}),t?r.jsx("button",{onClick:d,disabled:!n||!c||l,style:{width:"100%",padding:"14px 24px",background:n&&c?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"#374151",border:"none",borderRadius:8,color:"#fff",fontWeight:700,fontSize:16,cursor:n&&c&&!l?"pointer":"not-allowed",opacity:n&&c?1:.5},children:l?"Minting...":"Mint & Publish NFT"}):r.jsx("div",{style:{textAlign:"center",padding:16,background:"rgba(245, 158, 11, 0.1)",borderRadius:8,color:"#f59e0b",fontSize:14},children:"Waiting for project owner to mint the NFT."}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:12,textAlign:"center"},children:"Once minted, content cannot be changed."})]})}function ve({project:e}){const t=`${window.location.origin}/collaborations/${e.id}`,[n,o]=i.useState(!1);return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,textAlign:"center"},children:[r.jsx("div",{style:{fontSize:64,marginBottom:16},children:"ğŸ‰"}),r.jsx("h3",{style:{margin:"0 0 8px",color:"var(--text)",fontSize:24},children:"Successfully Minted!"}),r.jsx("p",{style:{fontSize:14,color:"#94a3b8",marginBottom:24},children:"Your collaborative NFT is now live. Share it with the world!"}),r.jsxs("div",{style:{display:"flex",gap:8,maxWidth:500,margin:"0 auto 24px"},children:[r.jsx("input",{value:t,readOnly:!0,style:{flex:1,padding:"10px 14px",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13}}),r.jsx("button",{onClick:()=>{navigator.clipboard.writeText(t),o(!0),setTimeout(()=>o(!1),2e3)},style:{padding:"10px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13},children:n?"Copied!":"Copy Link"})]}),r.jsx("div",{style:{display:"flex",justifyContent:"center",gap:16},children:r.jsx("a",{href:`https://twitter.com/intent/tweet?text=Check out our collaborative NFT!&url=${encodeURIComponent(t)}`,target:"_blank",rel:"noreferrer",style:{padding:"10px 20px",background:"#1DA1F2",borderRadius:8,color:"#fff",fontWeight:600,textDecoration:"none",fontSize:13},children:"Share on X"})})]})}function me({userId:e,onlineUsers:t,size:i="medium",showLabel:n=!1,showLastSeen:o=!1}){const a=t.find(t=>t.user_id===e),s=(null==a?void 0:a.is_online)??!1,l=null==a?void 0:a.last_seen,d={small:6,medium:8,large:10}[i];return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:6},title:s?"Online":l?`Last seen ${ne(l)}`:"Offline",children:[r.jsx("div",{"aria-label":s?"Online":"Offline",style:{width:d,height:d,borderRadius:"50%",background:s?"#10b981":"#64748b",boxShadow:s?"0 0 8px rgba(16, 185, 129, 0.5)":"none",transition:"all 0.3s"}}),n&&r.jsx("span",{style:{fontSize:"small"===i?10:"medium"===i?11:12,color:s?"#10b981":"#64748b",fontWeight:600},children:s?"Online":"Offline"}),!s&&o&&l&&r.jsx("span",{style:{fontSize:"small"===i?9:"medium"===i?10:11,color:"#64748b"},children:ne(l)})]})}function je({sectionId:e,currentlyEditing:t,currentUserId:i}){const n=t.filter(t=>t.section_id===e&&t.user_id!==i);if(0===n.length)return null;const o=n[0],a=n.length-1;return r.jsxs("div",{style:{display:"inline-flex",alignItems:"center",gap:8,padding:"6px 12px",background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",fontWeight:600},role:"status","aria-live":"polite",children:[r.jsx("span",{style:{display:"inline-block",animation:"pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite"},children:"â³"}),r.jsxs("span",{children:["@",o.username," is editing",a>0&&` +${a} other${a>1?"s":""}`]}),r.jsx("style",{children:"\n        @keyframes pulse {\n          0%, 100% { opacity: 1; }\n          50% { opacity: 0.5; }\n        }\n      "})]})}function Se({project:e,pendingCollaborators:t,onClose:n,onSubmit:o}){const[a,s]=i.useState(new Set(t.map(e=>e.user))),[l,d]=i.useState(""),[c,p]=i.useState(7);return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:n,children:r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,maxWidth:500,width:"90%",maxHeight:"80vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{style:{margin:0,marginBottom:20,fontSize:20,fontWeight:700,color:"var(--text)"},children:"Request Approval from Team"}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsx("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:12},children:"Send approval request to:"}),0===t.length?r.jsx("div",{style:{padding:16,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8,fontSize:13,color:"#10b981",textAlign:"center"},children:"All collaborators have already approved!"}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:t.map(e=>r.jsxs("label",{style:{display:"flex",alignItems:"center",gap:10,padding:12,background:a.has(e.user)?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid "+(a.has(e.user)?"#3b82f6":"var(--panel-border)"),borderRadius:8,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:t=>{a.has(e.user)||(t.currentTarget.style.background="rgba(59, 130, 246, 0.05)")},onMouseLeave:t=>{a.has(e.user)||(t.currentTarget.style.background="var(--bg)")},children:[r.jsx("input",{type:"checkbox",checked:a.has(e.user),onChange:()=>(e=>{const t=new Set(a);t.has(e)?t.delete(e):t.add(e),s(t)})(e.user),style:{cursor:"pointer"}}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]})]},e.user))})]}),r.jsxs("div",{style:{marginBottom:20},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Message (optional):"}),r.jsx("textarea",{value:l,onChange:e=>d(e.target.value),placeholder:"Hi team! I think we're ready to mint this. Please review and approve if you're satisfied.",style:{width:"100%",minHeight:100,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"}})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Approval deadline:"}),r.jsxs("select",{value:c,onChange:e=>p(Number(e.target.value)),style:{width:"100%",padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,cursor:"pointer",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"},children:[r.jsx("option",{value:1,children:"1 day"}),r.jsx("option",{value:3,children:"3 days"}),r.jsx("option",{value:7,children:"7 days"}),r.jsx("option",{value:14,children:"14 days"}),r.jsx("option",{value:30,children:"30 days"})]})]}),r.jsx("div",{style:{marginBottom:20,padding:12,background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:8,fontSize:12,color:"#94a3b8",lineHeight:1.5},children:"Selected collaborators will receive a notification and email with your message. They can approve anytime before the deadline."}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:n,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"Cancel"}),r.jsx("button",{onClick:()=>{0!==a.size?o(Array.from(a),l,c):alert("Please select at least one collaborator to request approval from.")},disabled:0===t.length||0===a.size,style:{flex:1,padding:"12px 20px",background:0===t.length||0===a.size?"#374151":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:0===t.length||0===a.size?"not-allowed":"pointer",boxShadow:0===t.length||0===a.size?"none":"0 4px 12px rgba(59, 130, 246, 0.3)",transition:"all 0.2s"},onMouseEnter:e=>{t.length>0&&a.size>0&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(59, 130, 246, 0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=0===t.length||0===a.size?"none":"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"Send Approval Request"})]})]})})}function ke({project:e,currentUserId:t,onClose:n,onApprove:o}){var a,s,l,d,c,p;const[u,g]=i.useState(!1),[f,x]=i.useState(!1),[h,b]=i.useState(""),y=null==(a=e.collaborators)?void 0:a.find(e=>e.user===t),v=(null==y?void 0:y.approved_current_version)&&(null==y?void 0:y.approved_revenue_split),m=u&&f,j=(null==(s=e.sections)?void 0:s.length)||0,S=(null==(l=e.sections)?void 0:l.filter(e=>"text"===e.section_type?e.content_html&&""!==e.content_html.trim():!!e.media_file).length)||0,k=(null==(d=e.collaborators)?void 0:d.reduce((e,t)=>e+t.revenue_percentage,0))||0,w=Math.abs(k-100)<.01;return r.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999,padding:20},onClick:n,children:r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24,maxWidth:600,width:"100%",maxHeight:"90vh",overflow:"auto"},onClick:e=>e.stopPropagation(),children:[r.jsx("h2",{style:{margin:0,marginBottom:8,fontSize:22,fontWeight:700,color:"var(--text)"},children:v?"Review Your Approval":"Approve Project"}),r.jsx("p",{style:{margin:0,marginBottom:24,fontSize:14,color:"#94a3b8"},children:v?"You've already approved this project. Review the details below.":"Review the project details and approve if everything looks good."}),r.jsxs("div",{style:{marginBottom:24,padding:16,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:16,fontWeight:700,color:"var(--text)"},children:e.title}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Type:"})," ",e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)]}),r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Sections:"})," ",S," / ",j," completed",S===j&&j>0&&r.jsx("span",{style:{color:"#10b981",marginLeft:8},children:"âœ“"})]}),r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:[r.jsx("span",{style:{fontWeight:600},children:"Collaborators:"})," ",(null==(c=e.collaborators)?void 0:c.filter(e=>"accepted"===e.status).length)||0]})]})]}),r.jsxs("div",{style:{marginBottom:24,padding:16,background:w?"rgba(16, 185, 129, 0.1)":"rgba(239, 68, 68, 0.1)",border:"1px solid "+(w?"#10b981":"#ef4444"),borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Revenue Split"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:null==(p=e.collaborators)?void 0:p.filter(e=>"accepted"===e.status).map(e=>{const i=e.user===t;return r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:10,background:i?"rgba(59, 130, 246, 0.1)":"transparent",border:i?"1px solid #3b82f6":"none",borderRadius:6},children:[r.jsxs("div",{children:[r.jsxs("span",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,i&&" (you)"]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),r.jsxs("div",{style:{fontSize:16,fontWeight:700,color:i?"#3b82f6":"#10b981"},children:[e.revenue_percentage,"%"]})]},e.id)})}),r.jsxs("div",{style:{marginTop:12,paddingTop:12,borderTop:"1px solid var(--panel-border)",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsx("span",{style:{fontSize:13,fontWeight:700,color:"var(--text)"},children:"Total:"}),r.jsxs("span",{style:{fontSize:16,fontWeight:700,color:w?"#10b981":"#ef4444"},children:[k.toFixed(1),"%"]})]}),!w&&r.jsx("div",{style:{marginTop:12,fontSize:12,color:"#ef4444",fontWeight:600},children:"Revenue splits must total 100%"})]}),!v&&r.jsxs("div",{style:{marginBottom:24,padding:16,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Approval Checklist"}),r.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,marginBottom:12,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:u,onChange:e=>g(e.target.checked),style:{marginTop:2,cursor:"pointer"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:4},children:"I approve the current version of the content"}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:"I have reviewed all sections and am satisfied with the quality and content."})]})]}),r.jsxs("label",{style:{display:"flex",alignItems:"flex-start",gap:10,cursor:"pointer"},children:[r.jsx("input",{type:"checkbox",checked:f,onChange:e=>x(e.target.checked),style:{marginTop:2,cursor:"pointer"}}),r.jsxs("div",{children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:4},children:"I approve the revenue split"}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:["I agree to the revenue distribution shown above (",null==y?void 0:y.revenue_percentage,"% for me)."]})]})]})]}),!v&&r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("label",{style:{display:"block",fontSize:14,fontWeight:600,color:"var(--text)",marginBottom:8},children:"Feedback (optional):"}),r.jsx("textarea",{value:h,onChange:e=>b(e.target.value),placeholder:"Any comments or suggestions for the team...",style:{width:"100%",minHeight:80,padding:12,background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:13,fontFamily:"inherit",resize:"vertical",outline:"none"},onFocus:e=>{e.currentTarget.style.borderColor="#3b82f6"},onBlur:e=>{e.currentTarget.style.borderColor="var(--panel-border)"}})]}),!v&&r.jsx("div",{style:{marginBottom:20,padding:12,background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",lineHeight:1.5},children:"By approving, you confirm that you're ready for this project to be minted as an NFT. This approval cannot be undone."}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:n,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:v?"Close":"Cancel"}),!v&&r.jsx("button",{onClick:()=>{m?o(h.trim()||void 0):alert("Please check both approval boxes before proceeding.")},disabled:!m||!w,style:{flex:1,padding:"12px 20px",background:m&&w?"linear-gradient(135deg, #10b981 0%, #059669 100%)":"#374151",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:m&&w?"pointer":"not-allowed",boxShadow:m&&w?"0 4px 12px rgba(16, 185, 129, 0.3)":"none",transition:"all 0.2s"},onMouseEnter:e=>{m&&w&&(e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(16, 185, 129, 0.4)")},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow=m&&w?"0 4px 12px rgba(16, 185, 129, 0.3)":"none"},children:"Approve Project"})]}),v&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8,fontSize:13,color:"#10b981",textAlign:"center",fontWeight:600},children:"You have already approved this project"})]})})}const we={validating:{label:"Validating Project",description:"Checking project data and approvals...",icon:"ğŸ”"},uploading:{label:"Uploading to IPFS",description:"Storing content on decentralized storage...",icon:"â˜ï¸"},creating_contract:{label:"Creating Smart Contract",description:"Deploying NFT contract on blockchain...",icon:"ğŸ“œ"},minting:{label:"Minting NFT",description:"Creating your unique NFT token...",icon:"âœ¨"},finalizing:{label:"Finalizing",description:"Completing the process and updating records...",icon:"ğŸ¯"},completed:{label:"Minting Complete!",description:"Your NFT has been successfully created.",icon:"ğŸ‰"},error:{label:"Minting Failed",description:"An error occurred during the minting process.",icon:"âŒ"}};function _e({project:e,onClose:t,onComplete:n}){const[o,a]=i.useState("validating"),[s,l]=i.useState(null),[d,c]=i.useState(null),p=["validating","uploading","creating_contract","minting","finalizing"],u=p.indexOf(o),g="completed"===o?100:(u+1)/p.length*100;i.useEffect(()=>{if("error"===o||"completed"===o)return;const t=setTimeout(()=>{const t=p.indexOf(o);t<p.length-1?a(p[t+1]):(a("completed"),c({id:`nft-${e.id}`,tokenId:`${Math.floor(1e4*Math.random())}`,contractAddress:"0x"+Array(40).fill(0).map(()=>Math.floor(16*Math.random()).toString(16)).join(""),ipfsHash:"Qm"+Array(44).fill(0).map(()=>"abcdefghijklmnopqrstuvwxyz0123456789"[Math.floor(36*Math.random())]).join("")}),n&&n(`nft-${e.id}`))},2e3+1e3*Math.random());return()=>clearTimeout(t)},[o]);return r.jsxs("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.8)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:9999},onClick:e=>{e.target===e.currentTarget&&(()=>{if("completed"!==o&&"error"!==o&&!confirm("Minting is still in progress. Are you sure you want to close this window?"))return;t()})()},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:32,maxWidth:500,width:"90%"},onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{style:{textAlign:"center",marginBottom:32},children:[r.jsx("div",{style:{fontSize:48,marginBottom:16},children:we[o].icon}),r.jsx("h2",{style:{margin:0,marginBottom:8,fontSize:24,fontWeight:700,color:"var(--text)"},children:we[o].label}),r.jsx("p",{style:{margin:0,fontSize:14,color:"#94a3b8"},children:we[o].description})]}),"completed"!==o&&"error"!==o&&r.jsxs("div",{style:{marginBottom:32},children:[r.jsx("div",{style:{height:8,background:"#1e293b",borderRadius:4,overflow:"hidden",marginBottom:8},children:r.jsx("div",{style:{height:"100%",width:`${g}%`,background:"linear-gradient(90deg, #3b82f6 0%, #2563eb 100%)",transition:"width 0.5s ease"}})}),r.jsxs("div",{style:{fontSize:12,color:"#94a3b8",textAlign:"center"},children:[Math.round(g),"% complete"]})]}),r.jsx("div",{style:{marginBottom:24},children:p.map((e,t)=>{const i=t<u,n=e===o,a=t>u;return r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,padding:12,marginBottom:8,background:n?"rgba(59, 130, 246, 0.1)":i?"rgba(16, 185, 129, 0.1)":"transparent",border:"1px solid "+(n?"#3b82f6":i?"#10b981":"var(--panel-border)"),borderRadius:8,opacity:a?.5:1,transition:"all 0.3s"},children:[r.jsx("div",{style:{width:24,height:24,borderRadius:"50%",background:i?"#10b981":n?"#3b82f6":"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:12,fontWeight:700,flexShrink:0},children:i?"âœ“":t+1}),r.jsx("div",{style:{flex:1},children:r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:we[e].label})}),n&&r.jsx("div",{style:{fontSize:16,animation:"spin 1s linear infinite"},children:"â³"})]},e)})}),"error"===o&&s&&r.jsx("div",{style:{marginBottom:24,padding:16,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,fontSize:13,color:"#ef4444",lineHeight:1.5},children:s}),"completed"===o&&d&&r.jsxs("div",{style:{marginBottom:24,padding:16,background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)",borderRadius:8},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"#10b981"},children:"NFT Details"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:8},children:[r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"Token ID:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontWeight:600},children:d.tokenId})]}),r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"Contract:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontSize:10,wordBreak:"break-all"},children:d.contractAddress})]}),r.jsxs("div",{style:{fontSize:12},children:[r.jsx("span",{style:{color:"#94a3b8"},children:"IPFS:"})," ",r.jsx("span",{style:{color:"var(--text)",fontFamily:"monospace",fontSize:10,wordBreak:"break-all"},children:d.ipfsHash})]})]})]}),"completed"===o&&r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[r.jsx("button",{onClick:()=>{alert("Navigate to NFT view")},style:{width:"100%",padding:"14px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.transform="translateY(-1px)",e.currentTarget.style.boxShadow="0 6px 16px rgba(16, 185, 129, 0.4)"},onMouseLeave:e=>{e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="0 4px 12px rgba(16, 185, 129, 0.3)"},children:"View NFT"}),r.jsx("button",{onClick:t,style:{width:"100%",padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer",transition:"all 0.2s"},onMouseEnter:e=>{e.currentTarget.style.background="var(--bg)"},onMouseLeave:e=>{e.currentTarget.style.background="transparent"},children:"Close"})]}),"error"===o&&r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:()=>{a("validating"),l(null)},style:{flex:1,padding:"12px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"Retry"}),r.jsx("button",{onClick:t,style:{flex:1,padding:"12px 20px",background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,color:"var(--text)",fontSize:14,fontWeight:600,cursor:"pointer"},children:"Close"})]}),"completed"!==o&&"error"!==o&&r.jsx("div",{style:{marginTop:16,padding:12,background:"rgba(59, 130, 246, 0.1)",border:"1px solid rgba(59, 130, 246, 0.3)",borderRadius:8,fontSize:12,color:"#94a3b8",textAlign:"center",lineHeight:1.5},children:"This process may take a few minutes. Please don't close this window."})]}),r.jsx("style",{children:"\n        @keyframes spin {\n          from { transform: rotate(0deg); }\n          to { transform: rotate(360deg); }\n        }\n      "})]})}function ze({project:e,currentUserId:t,onApprovalRequest:n,onApprove:o,onMint:a}){var s;const[l,d]=i.useState(!1),[c,p]=i.useState(!1),[u,g]=i.useState(!1),[f,x]=i.useState([]),h=e.created_by===t,b=(null==(s=e.collaborators)?void 0:s.filter(e=>"accepted"===e.status))||[],y=b.filter(e=>e.approved_current_version&&e.approved_revenue_split),v=b.filter(e=>!e.approved_current_version||!e.approved_revenue_split),m=b.find(e=>e.user===t),j=(null==m?void 0:m.approved_current_version)&&(null==m?void 0:m.approved_revenue_split),S=b.length>0?y.length/b.length:0;i.useEffect(()=>{var t,r,i;const n=[],o=e.sections&&e.sections.length>0,a=(null==(t=e.sections)?void 0:t.every(e=>"text"===e.section_type?e.content_html&&""!==e.content_html.trim():!!e.media_file))??!1;n.push({id:"sections",label:"All sections completed",checked:o&&a,required:!0});const s=(null==(r=e.collaborators)?void 0:r.reduce((e,t)=>e+t.revenue_percentage,0))||0,l=Math.abs(s-100)<.01;n.push({id:"revenue",label:"Revenue splits agreed (totals 100%)",checked:l,required:!0});const d=(null==(i=e.collaborators)?void 0:i.every(e=>"accepted"===e.status))??!0;n.push({id:"collaborators",label:"All collaborators invited/accepted",checked:d,required:!0});const c=e.is_fully_approved;n.push({id:"approvals",label:"Approval from all collaborators",checked:c,required:!0}),x(n)},[e]);const k=f.filter(e=>e.required).every(e=>e.checked),w=f.slice(0,3).every(e=>e.checked)&&!j,_=k&&e.is_fully_approved,z=h&&f.slice(0,3).every(e=>e.checked);return r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:24},children:[r.jsxs("div",{style:{padding:"12px 16px",backgroundColor:"#dbeafe",color:"#1e40af",borderRadius:"8px",fontSize:"13px",marginBottom:"20px",border:"1px solid #3b82f6"},children:["ğŸŒ ",r.jsx("strong",{children:"Devnet Mode:"})," This NFT will be minted on Solana devnet for testing. Not a real NFT."]}),r.jsx("h2",{style:{margin:0,marginBottom:20,fontSize:20,fontWeight:700,color:"var(--text)"},children:"Ready to Mint?"}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsx("h3",{style:{margin:0,marginBottom:12,fontSize:14,fontWeight:700,color:"var(--text)"},children:"Pre-mint Checklist:"}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:f.map(e=>r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,padding:10,background:e.checked?"rgba(16, 185, 129, 0.1)":"rgba(100, 116, 139, 0.1)",border:"1px solid "+(e.checked?"#10b981":"#334155"),borderRadius:8},children:[r.jsx("span",{style:{fontSize:16},children:e.checked?"âœ…":"â³"}),r.jsx("span",{style:{fontSize:13,color:e.checked?"#10b981":"#94a3b8",fontWeight:600},children:e.label})]},e.id))})]}),r.jsxs("div",{style:{marginBottom:24},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[r.jsx("span",{style:{fontSize:14,fontWeight:700,color:"var(--text)"},children:"Approval Progress:"}),r.jsxs("span",{style:{fontSize:14,fontWeight:700,color:e.is_fully_approved?"#10b981":"#f59e0b"},children:[y.length," / ",b.length]})]}),r.jsx("div",{style:{height:8,background:"#1e293b",borderRadius:4,overflow:"hidden",marginBottom:12},children:r.jsx("div",{style:{height:"100%",width:100*S+"%",background:e.is_fully_approved?"linear-gradient(90deg, #10b981 0%, #059669 100%)":"linear-gradient(90deg, #f59e0b 0%, #d97706 100%)",transition:"width 0.3s"}})}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:b.map(e=>{const i=e.approved_current_version&&e.approved_revenue_split,n=e.user===t;return r.jsxs("div",{style:{padding:10,background:i?"rgba(16, 185, 129, 0.1)":"rgba(251, 191, 36, 0.1)",border:"1px solid "+(i?"rgba(16, 185, 129, 0.3)":"rgba(251, 191, 36, 0.3)"),borderRadius:8,display:"flex",alignItems:"center",gap:10},children:[r.jsx("span",{style:{fontSize:16},children:i?"âœ…":"â³"}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,n&&" (you)"]}),r.jsx("div",{style:{fontSize:11,color:"#94a3b8"},children:e.role})]}),!i&&n&&r.jsx("button",{onClick:()=>p(!0),style:{padding:"4px 12px",background:"#3b82f6",border:"none",borderRadius:6,color:"#fff",fontSize:11,fontWeight:600,cursor:"pointer"},children:"Approve"})]},e.id)})})]}),r.jsxs("div",{style:{marginBottom:24,padding:12,background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:12,color:"#f59e0b",lineHeight:1.5},children:["âš ï¸ ",r.jsx("strong",{children:"Note:"})," Once minting starts, content cannot be changed. Make sure everything is perfect!"]}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[w&&r.jsx("button",{onClick:()=>d(!0),style:{width:"100%",padding:"12px 20px",background:"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(59, 130, 246, 0.3)"},children:"ğŸ“¨ Request Approval"}),!j&&f.slice(0,3).every(e=>e.checked)&&r.jsx("button",{onClick:()=>p(!0),style:{width:"100%",padding:"12px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:14,fontWeight:700,cursor:"pointer",boxShadow:"0 4px 12px rgba(16, 185, 129, 0.3)"},children:"âœ“ Approve Project"}),_&&r.jsx("button",{onClick:async()=>{if(!_)return;if(confirm("Are you sure you want to mint this project as an NFT? This action cannot be undone.")){g(!0);try{a&&await a()}catch(e){}}},style:{width:"100%",padding:"16px 20px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,color:"#fff",fontSize:16,fontWeight:700,cursor:"pointer",boxShadow:"0 6px 16px rgba(16, 185, 129, 0.4)"},children:"ğŸš€ Mint NFT"}),!_&&z&&h&&v.length>0&&r.jsx("button",{onClick:async()=>{if(!z)return;if(confirm(`WARNING: Force minting will proceed without approval from all collaborators.\n\n${v.length} collaborator(s) haven't approved yet.\n\nAre you sure you want to continue?`)){g(!0);try{a&&await a()}catch(e){}}},style:{width:"100%",padding:"12px 20px",background:"transparent",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13,fontWeight:600,cursor:"pointer"},children:"âš ï¸ Force Mint (Creator Override)"})]}),l&&r.jsx(Se,{project:e,pendingCollaborators:v,onClose:()=>d(!1),onSubmit:()=>{d(!1),n&&n()}}),c&&r.jsx(ke,{project:e,currentUserId:t,onClose:()=>p(!1),onApprove:()=>{p(!1),o&&o()}}),u&&r.jsx(_e,{project:e,onClose:()=>g(!1)})]})}function Ce({project:e,currentUser:t,onSectionUpdate:n,onCommentAdd:o,onProjectUpdate:a}){const[s,l]=i.useState(e.sections||[]),[d,c]=i.useState(e.collaborators||[]),[p,g]=i.useState(null),[f,x]=i.useState(!1),[h,b]=i.useState(null),[y,v]=i.useState(""),[m,j]=i.useState(!1),[S,k]=i.useState(!1),[w,_]=i.useState(!1),[z,C]=i.useState(!1),[R,I]=i.useState(!1),[T,W]=i.useState("comments"),{activities:A,onlineUsers:B,currentlyEditing:P,startEditing:U,stopEditing:F,logActivity:$}=ae({projectId:e.id,autoStart:!0}),{comments:D,unresolvedCount:E,totalCount:M,isLoading:N,addComment:L,updateComment:O,deleteComment:H,resolveComment:q,unresolveComment:Y,addReaction:V,removeReaction:X}=se({projectId:e.id,includeResolved:R,pollingInterval:3e4}),G=d.find(e=>e.user===t.id),J=i.useCallback(e=>{if(!G)return!1;return(G.can_edit||[]).includes(e)},[G]),K=i.useCallback(e=>e.owner===t.id,[t.id]);i.useEffect(()=>{Q()},[e.id]);const Q=async()=>{try{const t=await u.getProjectSections(e.id);l(t)}catch(t){v(t.message||"Failed to load sections")}},Z=async(e,t,r,i)=>{try{await L(t,r,i,e),await $("comment_added","Replied to a comment",{parent_comment_id:e})}catch(n){v(n.message||"Failed to reply to comment")}},ee=e=>{switch(e){case"text":return"#3b82f6";case"image":return"#8b5cf6";case"audio":return"#f59e0b";case"video":return"#ef4444";default:return"#64748b"}},te={total:d.filter(e=>"accepted"===e.status).length,approved:d.filter(e=>"accepted"===e.status&&e.approved_current_version&&e.approved_revenue_split).length},re=e.is_fully_approved,ie=(null==G?void 0:G.approved_current_version)&&(null==G?void 0:G.approved_revenue_split);return r.jsxs("div",{style:{width:"100%",height:"90vh",display:"flex",flexDirection:"column",gap:16},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"16px 0"},children:[r.jsxs("div",{style:{flex:1},children:[r.jsx("h2",{style:{margin:0,color:"var(--text)",fontSize:24,fontWeight:700},children:e.title}),r.jsxs("div",{style:{marginTop:4,fontSize:14,color:"#94a3b8"},children:[e.content_type.charAt(0).toUpperCase()+e.content_type.slice(1)," Project"," â€¢ ","Status: ",e.status.replace(/_/g," ")]})]}),r.jsxs("div",{style:{display:"flex",gap:12},children:[r.jsx("button",{onClick:async()=>{_(!0)},style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"8px 16px",color:"var(--text)",cursor:"pointer",fontSize:14,fontWeight:600},children:"ğŸ‘ï¸ Preview"}),G&&!ie&&r.jsx("button",{onClick:async()=>{try{const t=await u.approveCurrentVersion(e.id);null==a||a(t),alert("Version approved! ğŸ‰"),await $("approval_given","Approved current version",{project_status:t.status})}catch(t){v(t.message||"Failed to approve version")}},style:{background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",border:"none",borderRadius:8,padding:"8px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14},children:"âœ“ Approve Version"}),re&&"ready_for_mint"===e.status&&r.jsx("button",{style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:8,padding:"8px 20px",color:"#fff",fontWeight:700,cursor:"pointer",fontSize:14},children:"ğŸš€ Ready to Mint"})]})]}),y&&r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,padding:12,color:"#ef4444",fontSize:14},children:[y,r.jsx("button",{onClick:()=>v(""),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",float:"right",fontWeight:700,fontSize:18},children:"Ã—"})]}),r.jsxs("div",{style:{display:"flex",gap:16,flex:1,overflow:"hidden"},children:[r.jsxs("div",{style:{width:280,display:"flex",flexDirection:"column",gap:12,overflow:"auto"},children:[r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[r.jsxs("h3",{style:{margin:0,fontSize:14,fontWeight:700,color:"var(--text)"},children:["Collaborators (",d.length,")"]}),e.created_by===t.id&&r.jsx("button",{onClick:()=>k(!0),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"4px 8px",color:"#94a3b8",cursor:"pointer",fontSize:11},children:"+ Invite"})]}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:d.map(e=>r.jsxs("div",{style:{padding:10,background:e.user===t.id?"rgba(59, 130, 246, 0.1)":"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[r.jsx(me,{userId:e.user,onlineUsers:B,size:"small"}),r.jsxs("div",{style:{flex:1},children:[r.jsxs("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)"},children:["@",e.username,e.user===t.id&&" (you)"]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[e.role," â€¢ ",e.revenue_percentage,"%"]})]})]}),"accepted"===e.status&&r.jsx("div",{style:{marginTop:6,fontSize:10,color:"#94a3b8"},children:e.approved_current_version&&e.approved_revenue_split?r.jsx("span",{style:{color:"#10b981"},children:"âœ“ Approved"}):r.jsx("span",{children:"â³ Pending approval"})})]},e.id))})]}),r.jsxs("div",{style:{background:re?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",border:"1px solid "+(re?"#10b981":"#f59e0b"),borderRadius:12,padding:12},children:[r.jsx("div",{style:{fontSize:12,fontWeight:600,color:re?"#10b981":"#f59e0b",marginBottom:6},children:re?"âœ“ Fully Approved":"â³ Awaiting Approvals"}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:[te.approved," of ",te.total," collaborators approved"]})]}),r.jsxs("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,flex:1,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12,borderBottom:"1px solid var(--panel-border)",paddingBottom:8},children:[r.jsxs("button",{onClick:()=>W("comments"),style:{background:"comments"===T?"#3b82f6":"transparent",color:"comments"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:12,fontWeight:600,cursor:"pointer",flex:1},children:["Comments (",M,")",E>0&&r.jsx("span",{style:{marginLeft:4,fontSize:10,background:"#f59e0b",padding:"2px 5px",borderRadius:8},children:E})]}),r.jsxs("button",{onClick:()=>W("activity"),style:{background:"activity"===T?"#3b82f6":"transparent",color:"activity"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:12,fontWeight:600,cursor:"pointer",flex:1},children:["Activity (",A.length,")"]}),r.jsxs("button",{onClick:()=>W("minting"),style:{background:"minting"===T?"#10b981":"transparent",color:"minting"===T?"#fff":"#94a3b8",border:"none",borderRadius:6,padding:"6px 12px",fontSize:11,fontWeight:600,cursor:"pointer",flex:1},children:[re?"âœ“":"â³"," Mint"]})]}),"comments"===T&&r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12,gap:8},children:[r.jsx("button",{onClick:()=>j(!m),style:{background:"#3b82f6",border:"none",borderRadius:6,padding:"6px 12px",color:"#fff",cursor:"pointer",fontSize:11,fontWeight:600,flex:1},children:"+ Add Comment"}),r.jsxs("button",{onClick:()=>I(!R),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:6,padding:"6px 12px",color:"#94a3b8",cursor:"pointer",fontSize:10,fontWeight:600},children:[R?"Hide":"Show"," Resolved"]})]}),E>0&&r.jsxs("div",{style:{marginBottom:12,padding:"6px 10px",background:"rgba(251, 191, 36, 0.1)",border:"1px solid #f59e0b",borderRadius:6,fontSize:11,color:"#f59e0b",fontWeight:600,textAlign:"center"},children:[E," unresolved comment",1!==E?"s":""]}),m&&r.jsx("div",{style:{marginBottom:12},children:r.jsx(ce,{projectId:e.id,collaborators:d,onSubmit:async(e,t,r)=>{try{const i=await L(e,t,r);null==o||o(i),await $("comment_added",`Added a comment: ${e.substring(0,50)}${e.length>50?"...":""}`,{comment_id:i.id}),j(!1)}catch(i){v(i.message||"Failed to add comment")}},onCancel:()=>j(!1),compact:!0,autoFocus:!0})}),r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12,overflow:"auto",flex:1},children:N&&0===D.length?r.jsx("div",{style:{padding:20,textAlign:"center",color:"#94a3b8",fontSize:12},children:"Loading comments..."}):0===D.length?r.jsxs("div",{style:{padding:20,textAlign:"center",color:"#64748b",fontSize:12},children:[r.jsx("div",{style:{fontSize:32,marginBottom:8},children:"ğŸ’¬"}),r.jsx("div",{children:"No comments yet"}),r.jsx("div",{style:{fontSize:11,color:"#64748b",marginTop:4},children:"Be the first to comment!"})]}):D.map(i=>r.jsx(ge,{comment:i,projectId:e.id,currentUserId:t.id,collaborators:d,onReply:Z,onEdit:O,onDelete:H,onResolve:q,onUnresolve:Y,onReaction:V,onRemoveReaction:X},i.id))})]}),"activity"===T&&r.jsx("div",{style:{overflow:"auto",flex:1},children:r.jsx(le,{activities:A,maxItems:20,compact:!0})}),"minting"===T&&r.jsx("div",{style:{overflow:"auto",flex:1},children:r.jsx(ze,{project:e,currentUserId:t.id,onApprovalRequest:async()=>{try{const t=await u.getCollaborativeProject(e.id);null==a||a(t),await $("approval_requested","Requested approval from collaborators")}catch(t){v(t.message||"Failed to request approval")}},onApprove:async()=>{try{const t=await u.approveProject(e.id,{approve_content:!0,approve_revenue:!0});null==a||a(t),await $("approval_given","Approved project for minting")}catch(t){v(t.message||"Failed to approve project")}},onMint:async()=>{try{const t=await u.mintProject(e.id),r=await u.getCollaborativeProject(e.id);null==a||a(r),await $("project_minted",`Project minted as NFT (Token ID: ${t.token_id})`),alert(`Project successfully minted! NFT Token ID: ${t.token_id}`)}catch(t){v(t.message||"Failed to mint project")}}})})]})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:12,overflow:"auto"},children:[0===s.length?r.jsx("div",{style:{background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:32,textAlign:"center",color:"#94a3b8"},children:r.jsx("div",{style:{fontSize:16,marginBottom:16},children:"No sections yet. Add your first section to get started!"})}):s.map((i,o)=>r.jsx(Re,{section:i,sectionNumber:o+1,canEdit:K(i)||e.created_by===t.id,isOwner:K(i),isEditing:p===i.id,onStartEdit:async()=>{g(i.id),await U(i.id)},onStopEdit:async()=>{p===i.id&&(await F(i.id),g(null))},onUpdate:e=>(async(e,t)=>{x(!0);try{const r=await u.updateProjectSection(e,t);l(s.map(t=>t.id===e?r:t)),b(new Date),null==n||n(r),await $("section_updated",`Updated ${r.section_type} section: ${r.title}`,{section_id:e,section_type:r.section_type})}catch(r){v(r.message||"Failed to update section")}finally{x(!1)}})(i.id,e),onDelete:()=>(async e=>{if(confirm("Are you sure you want to delete this section?"))try{await u.deleteProjectSection(e),l(s.filter(t=>t.id!==e))}catch(t){v(t.message||"Failed to delete section")}})(i.id),onMediaUpload:e=>(async(e,t)=>{x(!0);try{const r=await u.updateProjectSection(e,{media_file:t});l(s.map(t=>t.id===e?r:t)),b(new Date),null==n||n(r)}catch(r){v(r.message||"Failed to upload media")}finally{x(!1)}})(i.id,e),saving:f,currentlyEditing:P,currentUserId:t.id},i.id)),r.jsxs("div",{style:{background:"var(--panel)",border:"1px dashed var(--panel-border)",borderRadius:12,padding:16},children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:"var(--text)",marginBottom:12},children:"Add Section"}),r.jsx("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:["text","image","audio","video"].map(t=>{const i=J(t);return r.jsxs("button",{onClick:()=>(async t=>{if(J(t))try{const r=await u.createProjectSection({project:e.id,section_type:t,title:`New ${t} section`,content_html:"text"===t?"":void 0,order:s.length});l([...s,r]),g(r.id),null==n||n(r)}catch(r){v(r.message||"Failed to create section")}else v(`You don't have permission to create ${t} sections`)})(t),disabled:!i,style:{background:i?ee(t):"#374151",border:"none",borderRadius:8,padding:"8px 16px",color:"#fff",cursor:i?"pointer":"not-allowed",fontSize:12,fontWeight:600,opacity:i?1:.5},children:["text"===t&&"ğŸ“","image"===t&&"ğŸ–¼ï¸","audio"===t&&"ğŸµ","video"===t&&"ğŸ¬"," ",t.charAt(0).toUpperCase()+t.slice(1)]},t)})})]}),f&&r.jsx("div",{style:{fontSize:12,color:"#f59e0b",textAlign:"right"},children:"Saving..."}),!f&&h&&r.jsxs("div",{style:{fontSize:12,color:"#10b981",textAlign:"right"},children:["Saved ",Ie(h)]})]})]})]})}function Re({section:e,sectionNumber:t,canEdit:n,isOwner:o,isEditing:a,onStartEdit:s,onStopEdit:l,onUpdate:d,onDelete:c,onMediaUpload:p,saving:u,currentlyEditing:g,currentUserId:f}){const[x,h]=i.useState(e.title),[b,y]=i.useState(e.content_html||""),j=g.filter(t=>t.section_id===e.id&&t.user_id!==f).length>0;i.useEffect(()=>{if(!n||"text"!==e.section_type)return;const t=setTimeout(()=>{x===e.title&&b===e.content_html||d({title:x,content_html:b})},3e3);return()=>clearTimeout(t)},[x,b,e.id]);const S=e=>{switch(e){case"text":return"#3b82f6";case"image":return"#8b5cf6";case"audio":return"#f59e0b";case"video":return"#ef4444";default:return"#64748b"}};return r.jsxs("div",{style:{background:"var(--panel)",border:`2px solid ${n?S(e.section_type):"var(--panel-border)"}`,borderRadius:12,padding:20,position:"relative"},onClick:()=>n&&!a&&s(),children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12,flexWrap:"wrap",gap:12},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,flex:1},children:[r.jsx("span",{style:{fontSize:20},children:(e=>{switch(e){case"text":return"ğŸ“";case"image":return"ğŸ–¼ï¸";case"audio":return"ğŸµ";case"video":return"ğŸ¬";default:return"ğŸ“„"}})(e.section_type)}),r.jsxs("div",{children:[r.jsxs("div",{style:{fontSize:14,fontWeight:600,color:"var(--text)"},children:["Section ",t,": ",e.section_type,!n&&r.jsxs("span",{style:{marginLeft:8,fontSize:11,color:"#ef4444"},children:["ğŸ”’ @",e.owner_username,"'s section"]})]}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8"},children:["Owner: @",e.owner_username]})]})]}),r.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},children:[j&&r.jsx(je,{sectionId:e.id,currentlyEditing:g,currentUserId:f}),n&&r.jsx("button",{onClick:e=>{e.stopPropagation(),l&&l(),c()},style:{background:"transparent",border:"1px solid #ef4444",borderRadius:6,padding:"4px 12px",color:"#ef4444",cursor:"pointer",fontSize:11},children:"Delete"})]})]}),n?r.jsxs(r.Fragment,{children:[r.jsx("input",{type:"text",value:x,onChange:e=>h(e.target.value),placeholder:"Section title",style:{width:"100%",background:"var(--bg)",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 12px",color:"var(--text)",fontSize:14,fontWeight:600,marginBottom:12,outline:"none"}}),"text"===e.section_type&&r.jsx("div",{style:{minHeight:200},children:r.jsx(v,{value:b,onChange:y,theme:"snow",style:{height:200,marginBottom:50},modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote","code-block"],["link"],["clean"]]}})}),"text"!==e.section_type&&r.jsxs("div",{children:[e.media_file?r.jsxs("div",{style:{marginBottom:12},children:["image"===e.section_type&&r.jsx("img",{src:e.media_file,alt:e.title,style:{maxWidth:"100%",borderRadius:8}}),"audio"===e.section_type&&r.jsx("audio",{controls:!0,style:{width:"100%"},children:r.jsx("source",{src:e.media_file})}),"video"===e.section_type&&r.jsx("video",{controls:!0,style:{maxWidth:"100%",borderRadius:8},children:r.jsx("source",{src:e.media_file})})]}):r.jsx("div",{style:{border:"2px dashed var(--panel-border)",borderRadius:8,padding:32,textAlign:"center",marginBottom:12},children:r.jsxs("div",{style:{fontSize:14,color:"#94a3b8",marginBottom:12},children:["No ",e.section_type," uploaded"]})}),r.jsxs("label",{style:{display:"block",background:S(e.section_type),border:"none",borderRadius:8,padding:"10px 16px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:13,textAlign:"center"},children:[e.media_file?"Replace":"Upload"," ",e.section_type,r.jsx("input",{type:"file",accept:"image"===e.section_type?"image/*":"audio"===e.section_type?"audio/*":"video"===e.section_type?"video/*":"*",style:{display:"none"},onChange:e=>{var t;const r=null==(t=e.target.files)?void 0:t[0];r&&p(r)}})]})]})]}):r.jsx("div",{style:{background:"rgba(100, 100, 100, 0.1)",borderRadius:8,padding:16,opacity:.6},children:r.jsxs("div",{style:{fontSize:13,color:"#94a3b8"},children:["text"===e.section_type&&r.jsx("div",{dangerouslySetInnerHTML:{__html:m(e.content_html)||"No content yet"}}),"image"===e.section_type&&e.media_file&&r.jsx("img",{src:e.media_file,alt:e.title,style:{maxWidth:"100%",borderRadius:8}}),"audio"===e.section_type&&e.media_file&&r.jsx("audio",{controls:!0,style:{width:"100%"},children:r.jsx("source",{src:e.media_file})}),"video"===e.section_type&&e.media_file&&r.jsx("video",{controls:!0,style:{maxWidth:"100%",borderRadius:8},children:r.jsx("source",{src:e.media_file})}),!e.media_file&&"text"!==e.section_type&&r.jsx("div",{style:{textAlign:"center",padding:20},children:"No media uploaded yet"})]})})]})}function Ie(e){const t=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;const i=Math.floor(r/60);return i<24?`${i}h ago`:`${Math.floor(i/24)}d ago`}function Te({project:e,currentUser:t,onProjectUpdate:n}){var o;const[a,s]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[g,f]=i.useState(null),[x,h]=i.useState(""),b=(e.collaborators||[]).find(e=>e.user===t.id),y=(null==(o=null==b?void 0:b.can_edit)?void 0:o.includes("text"))??(null==b?void 0:b.can_edit_text)??!1;i.useEffect(()=>{v()},[e.id]);const v=async()=>{try{const t=(await u.getProjectSections(e.id)).filter(e=>"text"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,content_html:e.content_html||"",synopsis:e.synopsis||"",order:e.order,owner:e.owner,owner_username:e.owner_username}));s(t),t.length>0&&!l&&d(t[0].id)}catch(t){h(t.message||"Failed to load chapters")}},m=a.find(e=>e.id===l),j=m&&(m.owner===t.id||y);return r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:280,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:16,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16},children:[r.jsxs("h3",{style:{margin:0,color:"var(--text)",fontSize:16},children:["Chapters (",a.length,")"]}),y&&r.jsx("button",{onClick:async()=>{if(y)try{const t=await u.createProjectSection({project:e.id,section_type:"text",title:`Chapter ${a.length+1}`,content_html:"",order:a.length}),r={id:t.id,title:t.title,content_html:t.content_html||"",synopsis:t.synopsis||"",order:t.order,owner:t.owner,owner_username:t.owner_username};s([...a,r]),d(r.id)}catch(t){h(t.message||"Failed to add chapter")}else h("You don't have permission to add chapters")},style:{background:"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)",border:"none",borderRadius:6,padding:"6px 12px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:12},children:"+ Add"})]}),r.jsx("div",{style:{flex:1,overflowY:"auto",display:"flex",flexDirection:"column",gap:8},children:0===a.length?r.jsxs("div",{style:{textAlign:"center",padding:24,color:"#64748b",fontSize:13},children:["No chapters yet.",y&&' Click "+ Add" to create one.']}):a.map((e,i)=>{const n=l===e.id,o=e.owner===t.id;return r.jsx("div",{onClick:()=>d(e.id),style:{padding:12,background:n?"rgba(245, 158, 11, 0.1)":"var(--bg)",border:n?"1px solid #f59e0b":"1px solid var(--panel-border)",borderRadius:8,cursor:"pointer",transition:"all 0.2s"},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:8},children:r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{fontSize:13,fontWeight:600,color:n?"#f59e0b":"var(--text)",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title||`Chapter ${i+1}`}),r.jsxs("div",{style:{fontSize:11,color:"#94a3b8",marginTop:2,display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{style:{width:14,height:14,borderRadius:"50%",background:o?"linear-gradient(135deg, #f59e0b 0%, #d97706 100%)":"linear-gradient(135deg, #3b82f6 0%, #2563eb 100%)",display:"inline-flex",alignItems:"center",justifyContent:"center",color:"#fff",fontSize:8,fontWeight:700},children:e.owner_username.charAt(0).toUpperCase()}),"@",e.owner_username,o&&r.jsx("span",{style:{color:"#f59e0b"},children:"(you)"})]})]})})},e.id)})})]}),r.jsxs("div",{style:{flex:1,background:"var(--panel)",border:"1px solid var(--panel-border)",borderRadius:12,padding:20,display:"flex",flexDirection:"column"},children:[x&&r.jsxs("div",{style:{padding:12,background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:8,color:"#ef4444",fontSize:13,marginBottom:16},children:[x,r.jsx("button",{onClick:()=>h(""),style:{background:"transparent",border:"none",color:"#ef4444",cursor:"pointer",float:"right",fontWeight:700},children:"x"})]}),m?r.jsx(We,{chapter:m,canEdit:j||!1,onUpdate:(e,t,r)=>(async(e,t,r,i)=>{p(!0);try{const n={title:t,content_html:r};void 0!==i&&(n.synopsis=i);const o=await u.updateProjectSection(e,n);s(a.map(t=>t.id===e?{...t,title:o.title,content_html:o.content_html||"",synopsis:o.synopsis||""}:t)),f(new Date)}catch(n){h(n.message||"Failed to save chapter")}finally{p(!1)}})(m.id,e,t,r),onDelete:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this chapter?"))try{await u.deleteProjectSection(e);const r=a.filter(t=>t.id!==e);s(r),l===e&&d((null==(t=r[0])?void 0:t.id)||null)}catch(r){h(r.message||"Failed to delete chapter")}})(m.id),saving:c,lastSaved:g}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:a.length>0?"Select a chapter to edit":"Add your first chapter to get started"})]})]})}function We({chapter:e,canEdit:t,onUpdate:n,onDelete:o,saving:a,lastSaved:s}){const[l,d]=i.useState(e.title),[c,p]=i.useState(e.content_html),[u,g]=i.useState(e.synopsis),[f,x]=i.useState(!1);i.useEffect(()=>{d(e.title),p(e.content_html),g(e.synopsis)},[e.id]),i.useEffect(()=>{if(!t)return;const r=setTimeout(()=>{l===e.title&&c===e.content_html&&u===e.synopsis||n(l,c,u)},2e3);return()=>clearTimeout(r)},[l,c,u]);return r.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"100%"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,gap:16},children:[r.jsx("input",{type:"text",value:l,onChange:e=>d(e.target.value),disabled:!t,placeholder:"Chapter Title",style:{flex:1,background:"transparent",border:"none",borderBottom:"2px solid var(--panel-border)",color:"var(--text)",fontSize:20,fontWeight:700,padding:"8px 0",outline:"none"}}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[a&&r.jsx("span",{style:{fontSize:12,color:"#f59e0b"},children:"Saving..."}),!a&&s&&r.jsxs("span",{style:{fontSize:12,color:"#10b981"},children:["Saved ",Ae(s)]}),t&&r.jsx("button",{onClick:o,style:{background:"transparent",border:"1px solid #ef4444",borderRadius:6,padding:"6px 12px",color:"#ef4444",cursor:"pointer",fontSize:12},children:"Delete"})]})]}),r.jsxs("div",{style:{marginBottom:12,fontSize:12,color:"#94a3b8"},children:["Written by @",e.owner_username,!t&&r.jsx("span",{style:{color:"#ef4444",marginLeft:8},children:"(Read-only - you can only edit your own chapters)"})]}),r.jsxs("div",{style:{marginBottom:12},children:[r.jsxs("button",{onClick:()=>x(!f),style:{background:"transparent",border:"none",color:"#94a3b8",fontSize:12,cursor:"pointer",padding:"4px 0",display:"flex",alignItems:"center",gap:4},children:[r.jsx("span",{style:{fontSize:10,transform:f?"rotate(90deg)":"rotate(0)",transition:"transform 0.2s"},children:"â–¶"}),"Synopsis ",u?`(${u.split(/\s+/).filter(e=>e).length} words)`:"(optional)"]}),f&&r.jsxs("div",{style:{marginTop:8},children:[r.jsx("textarea",{value:u,onChange:e=>t&&g(e.target.value),placeholder:"Brief summary of this chapter (optional, max 150 words)...",disabled:!t,maxLength:1e3,style:{width:"100%",minHeight:80,background:t?"var(--bg)":"rgba(100,100,100,0.05)",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 14px",color:t?"var(--text)":"#64748b",fontSize:13,resize:"vertical",cursor:t?"text":"not-allowed",outline:"none"}}),r.jsxs("div",{style:{fontSize:10,color:"#64748b",marginTop:4},children:[u.split(/\s+/).filter(e=>e).length,"/150 words recommended"]})]})]}),r.jsx("div",{style:{flex:1,display:"flex",flexDirection:"column",minHeight:300},children:r.jsx(v,{theme:"snow",value:c,onChange:p,readOnly:!t,modules:{toolbar:[[{header:[1,2,3,!1]}],["bold","italic","underline","strike"],[{list:"ordered"},{list:"bullet"}],["blockquote","code-block"],["link"],["clean"]]},style:{flex:1,display:"flex",flexDirection:"column"}})})]})}function Ae(e){const t=Math.floor(((new Date).getTime()-e.getTime())/1e3);if(t<60)return"just now";const r=Math.floor(t/60);if(r<60)return`${r}m ago`;return`${Math.floor(r/60)}h ago`}function Be({project:e,currentUser:t,onProjectUpdate:n}){var o;const[a,s]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[g,f]=i.useState(""),x=i.useRef(null),h=(e.collaborators||[]).find(e=>e.user===t.id),b=(null==(o=null==h?void 0:h.can_edit)?void 0:o.includes("image"))??(null==h?void 0:h.can_edit_images)??!1;i.useEffect(()=>{y()},[e.id]);const y=async()=>{try{const t=(await u.getProjectSections(e.id)).filter(e=>"image"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",order:e.order,owner:e.owner,owner_username:e.owner_username}));s(t),t.length>0&&!l&&d(t[0].id)}catch(t){f(t.message||"Failed to load art pieces")}},v=a.find(e=>e.id===l),m=v&&(v.owner===t.id||b);return r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:280,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Gallery (",a.length,")"]}),b&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add",r.jsx("input",{ref:x,type:"file",accept:"image/png,image/jpeg,image/webp,image/gif",onChange:async t=>{var r;if(!b)return void f("You don't have permission to upload images");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["image/png","image/jpeg","image/webp","image/gif"].includes(i.type))if(i.size>52428800)f("File size must be under 50MB");else{p(!0),f("");try{const t=await u.createProjectSection({project:e.id,section_type:"image",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Art",order:a.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",order:t.order,owner:t.owner,owner_username:t.owner_username};s([...a,r]),d(r.id)}catch(n){f(n.message||"Failed to upload art")}finally{p(!1),x.current&&(x.current.value="")}}else f("Please upload a PNG, JPG, WebP, or GIF image")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===a.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No art pieces yet.",b&&' Click "+ Add" to upload your first piece.']}):a.map(e=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:8,cursor:"pointer",display:"flex",gap:10,alignItems:"center"},children:[r.jsx("div",{style:{width:48,height:48,borderRadius:6,background:"#334155",backgroundImage:e.media_file?`url(${e.media_file})`:void 0,backgroundSize:"cover",backgroundPosition:"center",flexShrink:0}}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[g&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:g}),v?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[m?r.jsx("input",{type:"text",value:v.title,onChange:e=>(async(e,t)=>{try{await u.updateProjectSection(e,{title:t}),s(a.map(r=>r.id===e?{...r,title:t}:r))}catch(r){f(r.message||"Failed to update title")}})(v.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:18,fontWeight:600,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:18,fontWeight:600,margin:0},children:v.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Uploaded by @",v.owner_username]})]}),m&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this art piece?"))try{await u.deleteProjectSection(e);const r=a.filter(t=>t.id!==e);s(r),l===e&&d((null==(t=r[0])?void 0:t.id)||null)}catch(r){f(r.message||"Failed to delete art piece")}})(v.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",background:"#0f172a",borderRadius:8,overflow:"hidden"},children:v.media_file?r.jsx("img",{src:v.media_file,alt:v.title,style:{maxWidth:"100%",maxHeight:"100%",objectFit:"contain"}}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No image available"})})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===a.length?"Upload an image to get started":"Select an art piece to view"})]})]})}function Pe({project:e,currentUser:t,onProjectUpdate:n}){var o;const[a,s]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[g,f]=i.useState(!1),[x,h]=i.useState(0),[b,y]=i.useState(0),[v,m]=i.useState(""),j=i.useRef(null),S=i.useRef(null),k=(e.collaborators||[]).find(e=>e.user===t.id),w=(null==(o=null==k?void 0:k.can_edit)?void 0:o.includes("audio"))??(null==k?void 0:k.can_edit_audio)??!1;i.useEffect(()=>{_()},[e.id]);const _=async()=>{try{const t=(await u.getProjectSections(e.id)).filter(e=>"audio"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",duration:void 0,order:e.order,owner:e.owner,owner_username:e.owner_username}));s(t),t.length>0&&!l&&d(t[0].id)}catch(t){m(t.message||"Failed to load tracks")}},z=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,C=a.find(e=>e.id===l),R=C&&(C.owner===t.id||w);return i.useEffect(()=>{f(!1),h(0),y(0)},[l]),r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:320,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Tracks (",a.length,")"]}),w&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add Track",r.jsx("input",{ref:j,type:"file",accept:"audio/*,.mp3,.wav,.ogg,.m4a,.aac",onChange:async t=>{var r;if(!w)return void m("You don't have permission to upload audio");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["audio/mpeg","audio/mp3","audio/wav","audio/ogg","audio/m4a","audio/aac"].includes(i.type)||i.name.match(/\.(mp3|wav|ogg|m4a|aac)$/i))if(i.size>52428800)m("File size must be under 50MB");else{p(!0),m("");try{const t=await u.createProjectSection({project:e.id,section_type:"audio",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Track",order:a.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",duration:void 0,order:t.order,owner:t.owner,owner_username:t.owner_username};s([...a,r]),d(r.id)}catch(n){m(n.message||"Failed to upload track")}finally{p(!1),j.current&&(j.current.value="")}}else m("Please upload an MP3, WAV, OGG, M4A, or AAC audio file")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===a.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No tracks yet.",w&&' Click "+ Add Track" to upload your first track.']}):a.map((e,t)=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:12,cursor:"pointer",display:"flex",gap:12,alignItems:"center"},children:[r.jsx("div",{style:{width:32,height:32,borderRadius:6,background:l===e.id?"#f59e0b":"#334155",display:"flex",alignItems:"center",justifyContent:"center",color:l===e.id?"#000":"#94a3b8",fontSize:12,fontWeight:700,flexShrink:0},children:t+1}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username,e.duration&&` - ${z(e.duration)}`]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[v&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:v}),C?r.jsxs(r.Fragment,{children:[r.jsx("audio",{ref:S,src:C.media_file,onTimeUpdate:()=>{S.current&&h(S.current.currentTime)},onLoadedMetadata:()=>{S.current&&y(S.current.duration)},onEnded:()=>f(!1)}),r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:24,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[R?r.jsx("input",{type:"text",value:C.title,onChange:e=>(async(e,t)=>{try{await u.updateProjectSection(e,{title:t}),s(a.map(r=>r.id===e?{...r,title:t}:r))}catch(r){m(r.message||"Failed to update title")}})(C.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:24,fontWeight:700,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:24,fontWeight:700,margin:0},children:C.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:13,marginTop:4},children:["Uploaded by @",C.owner_username]})]}),R&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this track?"))try{await u.deleteProjectSection(e);const r=a.filter(t=>t.id!==e);s(r),l===e&&(d((null==(t=r[0])?void 0:t.id)||null),f(!1))}catch(r){m(r.message||"Failed to delete track")}})(C.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:32},children:[r.jsx("div",{style:{width:200,height:200,borderRadius:12,background:"linear-gradient(135deg, #334155 0%, #1e293b 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:64},children:"ğŸµ"}),r.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:16,width:"100%",maxWidth:400},children:[r.jsx("button",{onClick:()=>{S.current&&(g?S.current.pause():S.current.play(),f(!g))},disabled:!C.media_file,style:{width:64,height:64,borderRadius:"50%",background:C.media_file?"#f59e0b":"#334155",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:C.media_file?"pointer":"not-allowed",fontSize:24},children:g?"â¸ï¸":"â–¶ï¸"}),r.jsxs("div",{style:{width:"100%",display:"flex",alignItems:"center",gap:12},children:[r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:z(x)}),r.jsx("input",{type:"range",min:0,max:b||100,value:x,onChange:e=>{const t=parseFloat(e.target.value);S.current&&(S.current.currentTime=t,h(t))},style:{flex:1,accentColor:"#f59e0b"}}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40,textAlign:"right"},children:z(b)})]})]})]})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===a.length?"Upload an audio track to get started":"Select a track to play"})]})]})}function Ue({project:e,currentUser:t,onProjectUpdate:n}){var o;const[a,s]=i.useState([]),[l,d]=i.useState(null),[c,p]=i.useState(!1),[g,f]=i.useState(!1),[x,h]=i.useState(0),[b,y]=i.useState(0),[v,m]=i.useState(""),j=i.useRef(null),S=i.useRef(null),k=(e.collaborators||[]).find(e=>e.user===t.id),w=(null==(o=null==k?void 0:k.can_edit)?void 0:o.includes("video"))??(null==k?void 0:k.can_edit_video)??!1;i.useEffect(()=>{_()},[e.id]);const _=async()=>{try{const t=(await u.getProjectSections(e.id)).filter(e=>"video"===e.section_type).sort((e,t)=>e.order-t.order).map(e=>({id:e.id,title:e.title,media_file:e.media_file||"",duration:void 0,order:e.order,owner:e.owner,owner_username:e.owner_username}));s(t),t.length>0&&!l&&d(t[0].id)}catch(t){m(t.message||"Failed to load video clips")}},z=()=>{S.current&&(g?S.current.pause():S.current.play(),f(!g))},C=e=>`${Math.floor(e/60)}:${Math.floor(e%60).toString().padStart(2,"0")}`,R=a.find(e=>e.id===l),I=R&&(R.owner===t.id||w);return i.useEffect(()=>{f(!1),h(0),y(0)},[l]),r.jsxs("div",{style:{display:"flex",gap:20,height:"calc(100vh - 300px)",minHeight:500},children:[r.jsxs("div",{style:{width:320,background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column",gap:12,overflow:"hidden"},children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[r.jsxs("span",{style:{color:"#f8fafc",fontWeight:600,fontSize:14},children:["Video Clips (",a.length,")"]}),w&&r.jsxs("label",{style:{background:"#f59e0b",color:"#000",padding:"6px 12px",borderRadius:6,fontSize:12,fontWeight:600,cursor:c?"not-allowed":"pointer",opacity:c?.5:1},children:[c?"Uploading...":"+ Add Clip",r.jsx("input",{ref:j,type:"file",accept:"video/*,.mp4,.mov,.webm,.avi",onChange:async t=>{var r;if(!w)return void m("You don't have permission to upload videos");const i=null==(r=t.target.files)?void 0:r[0];if(!i)return;if(["video/mp4","video/quicktime","video/webm","video/x-msvideo"].includes(i.type)||i.name.match(/\.(mp4|mov|webm|avi)$/i))if(i.size>52428800)m("File size must be under 50MB");else{p(!0),m("");try{const t=await u.createProjectSection({project:e.id,section_type:"video",title:i.name.replace(/\.[^/.]+$/,"")||"Untitled Clip",order:a.length,media_file:i}),r={id:t.id,title:t.title,media_file:t.media_file||"",duration:void 0,order:t.order,owner:t.owner,owner_username:t.owner_username};s([...a,r]),d(r.id)}catch(n){m(n.message||"Failed to upload video")}finally{p(!1),j.current&&(j.current.value="")}}else m("Please upload an MP4, MOV, WebM, or AVI video file")},disabled:c,style:{display:"none"}})]})]}),r.jsx("div",{style:{flex:1,overflow:"auto",display:"flex",flexDirection:"column",gap:8},children:0===a.length?r.jsxs("div",{style:{padding:24,textAlign:"center",color:"#64748b",fontSize:13,border:"1px dashed #334155",borderRadius:8},children:["No video clips yet.",w&&' Click "+ Add Clip" to upload your first video.']}):a.map((e,t)=>r.jsxs("div",{onClick:()=>d(e.id),style:{background:l===e.id?"rgba(245, 158, 11, 0.15)":"#0f172a",border:"1px solid "+(l===e.id?"#f59e0b":"#334155"),borderRadius:8,padding:8,cursor:"pointer",display:"flex",gap:10,alignItems:"center"},children:[r.jsx("div",{style:{width:64,height:36,borderRadius:4,background:"#334155",flexShrink:0,display:"flex",alignItems:"center",justifyContent:"center"},children:r.jsx("span",{style:{fontSize:16},children:"ğŸ¬"})}),r.jsxs("div",{style:{flex:1,minWidth:0},children:[r.jsx("div",{style:{color:l===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["@",e.owner_username,e.duration&&` - ${C(e.duration)}`]})]})]},e.id))})]}),r.jsxs("div",{style:{flex:1,background:"#1e293b",borderRadius:12,padding:20,display:"flex",flexDirection:"column",overflow:"hidden"},children:[v&&r.jsx("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:12,borderRadius:8,marginBottom:16,fontSize:13},children:v}),R?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{style:{flex:1},children:[I?r.jsx("input",{type:"text",value:R.title,onChange:e=>(async(e,t)=>{try{await u.updateProjectSection(e,{title:t}),s(a.map(r=>r.id===e?{...r,title:t}:r))}catch(r){m(r.message||"Failed to update title")}})(R.id,e.target.value),style:{background:"transparent",border:"none",color:"#f8fafc",fontSize:18,fontWeight:600,width:"100%",outline:"none"},placeholder:"Untitled"}):r.jsx("h2",{style:{color:"#f8fafc",fontSize:18,fontWeight:600,margin:0},children:R.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Uploaded by @",R.owner_username]})]}),I&&r.jsx("button",{onClick:()=>(async e=>{var t;if(confirm("Are you sure you want to delete this video clip?"))try{await u.deleteProjectSection(e);const r=a.filter(t=>t.id!==e);s(r),l===e&&(d((null==(t=r[0])?void 0:t.id)||null),f(!1))}catch(r){m(r.message||"Failed to delete video clip")}})(R.id),style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",color:"#ef4444",padding:"8px 16px",borderRadius:6,fontSize:12,fontWeight:600,cursor:"pointer"},children:"Delete"})]}),r.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",gap:16},children:[r.jsx("div",{style:{flex:1,background:"#0f172a",borderRadius:8,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:R.media_file?r.jsx("video",{ref:S,src:R.media_file,onTimeUpdate:()=>{S.current&&h(S.current.currentTime)},onLoadedMetadata:()=>{S.current&&y(S.current.duration)},onEnded:()=>f(!1),onClick:z,style:{maxWidth:"100%",maxHeight:"100%",cursor:"pointer"}}):r.jsx("div",{style:{color:"#64748b",fontSize:14},children:"No video available"})}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:16,padding:"12px 16px",background:"#0f172a",borderRadius:8},children:[r.jsx("button",{onClick:z,disabled:!R.media_file,style:{width:40,height:40,borderRadius:"50%",background:R.media_file?"#f59e0b":"#334155",border:"none",display:"flex",alignItems:"center",justifyContent:"center",cursor:R.media_file?"pointer":"not-allowed",fontSize:16},children:g?"â¸ï¸":"â–¶ï¸"}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:C(x)}),r.jsx("input",{type:"range",min:0,max:b||100,value:x,onChange:e=>{const t=parseFloat(e.target.value);S.current&&(S.current.currentTime=t,h(t))},style:{flex:1,accentColor:"#f59e0b"}}),r.jsx("span",{style:{color:"#94a3b8",fontSize:12,minWidth:40},children:C(b)}),r.jsx("button",{onClick:()=>{S.current&&(document.fullscreenElement?document.exitFullscreen():S.current.requestFullscreen())},disabled:!R.media_file,style:{background:"transparent",border:"1px solid #334155",color:"#94a3b8",padding:"8px 12px",borderRadius:6,cursor:R.media_file?"pointer":"not-allowed",fontSize:12},children:"Fullscreen"})]})]})]}):r.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"#64748b",fontSize:14},children:0===a.length?"Upload a video clip to get started":"Select a clip to play"})]})]})}function Fe({project:e,currentUser:t,reviewableTypes:n,onCommentAdd:o}){const[a,s]=i.useState([]),[l,d]=i.useState([]),[p,b]=i.useState(null),[y,v]=i.useState(""),[w,_]=i.useState(!1),[z,C]=i.useState(!0);i.useEffect(()=>{R()},[e.id]);const R=async()=>{C(!0);try{const[t,r]=await Promise.all([u.getProjectSections(e.id),u.getComments(e.id)]),i=t.filter(e=>n.includes(e.section_type));s(i),d(r),i.length>0&&b(i[0].id)}catch(t){}finally{C(!1)}},I=a.find(e=>e.id===p),T=l.filter(e=>!e.parent_comment),W=e=>{switch(e){case"text":default:return r.jsx(h,{size:16});case"image":return r.jsx(x,{size:16});case"audio":return r.jsx(f,{size:16});case"video":return r.jsx(k,{size:16})}};return z?r.jsx("div",{style:{padding:40,textAlign:"center",color:"#94a3b8"},children:"Loading content..."}):r.jsxs("div",{style:{display:"grid",gridTemplateColumns:"250px 1fr 300px",gap:20,height:"100%"},children:[r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:16,overflow:"auto"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,color:"#f8fafc",fontWeight:600},children:[r.jsx(j,{size:18}),"Review Content"]}),r.jsxs("div",{style:{fontSize:11,color:"#64748b",marginBottom:12},children:["You have read-only access to review the following content types: ",n.join(", ")]}),0===a.length?r.jsx("div",{style:{color:"#64748b",fontSize:13,textAlign:"center",padding:20},children:"No content available for review yet."}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:8},children:a.map(e=>r.jsxs("button",{onClick:()=>b(e.id),style:{display:"flex",alignItems:"center",gap:10,padding:12,background:p===e.id?"rgba(245,158,11,0.15)":"#0f172a",border:"1px solid "+(p===e.id?"#f59e0b":"#334155"),borderRadius:8,cursor:"pointer",textAlign:"left"},children:[r.jsx("span",{style:{color:p===e.id?"#f59e0b":"#94a3b8"},children:W(e.section_type)}),r.jsxs("div",{style:{flex:1,overflow:"hidden"},children:[r.jsx("div",{style:{color:p===e.id?"#f59e0b":"#f8fafc",fontSize:13,fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:11},children:["by @",e.owner_username]})]})]},e.id))})]}),r.jsx("div",{style:{background:"#1e293b",borderRadius:12,padding:20,overflow:"auto"},children:I?r.jsxs(r.Fragment,{children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16,paddingBottom:16,borderBottom:"1px solid #334155"},children:[r.jsxs("div",{children:[r.jsx("h3",{style:{color:"#f8fafc",margin:0,fontSize:18},children:I.title}),r.jsxs("div",{style:{color:"#64748b",fontSize:12,marginTop:4},children:["Written by @",I.owner_username]})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:6,padding:"6px 12px",background:"rgba(16,185,129,0.15)",borderRadius:6,color:"#10b981",fontSize:11,fontWeight:600},children:[r.jsx(j,{size:14}),"Read Only"]})]}),"text"===I.section_type&&r.jsx("div",{style:{color:"#cbd5e1",fontSize:15,lineHeight:1.8},dangerouslySetInnerHTML:{__html:m(I.content_html)||"<em>No content yet</em>"}}),"image"===I.section_type&&I.media_file&&r.jsx("div",{style:{textAlign:"center"},children:r.jsx("img",{src:I.media_file,alt:I.title,style:{maxWidth:"100%",borderRadius:8}})}),"audio"===I.section_type&&I.media_file&&r.jsxs("audio",{controls:!0,style:{width:"100%"},children:[r.jsx("source",{src:I.media_file}),"Your browser does not support the audio element."]}),"video"===I.section_type&&I.media_file&&r.jsxs("video",{controls:!0,style:{width:"100%",borderRadius:8},children:[r.jsx("source",{src:I.media_file}),"Your browser does not support the video element."]})]}):r.jsx("div",{style:{color:"#64748b",textAlign:"center",padding:40},children:"Select a section to review"})}),r.jsxs("div",{style:{background:"#1e293b",borderRadius:12,padding:16,display:"flex",flexDirection:"column"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:16,color:"#f8fafc",fontWeight:600},children:[r.jsx(c,{size:18}),"Comments (",T.length,")"]}),r.jsx("div",{style:{flex:1,overflow:"auto",marginBottom:16},children:0===T.length?r.jsx("div",{style:{color:"#64748b",fontSize:13,textAlign:"center",padding:20},children:"No comments yet. Be the first to leave feedback!"}):r.jsx("div",{style:{display:"flex",flexDirection:"column",gap:12},children:T.map(e=>r.jsxs("div",{style:{padding:12,background:"#0f172a",borderRadius:8,borderLeft:e.resolved?"3px solid #10b981":"3px solid #334155"},children:[r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginBottom:6},children:[r.jsxs("span",{style:{color:"#f59e0b",fontWeight:600,fontSize:12},children:["@",e.author_username]}),e.resolved&&r.jsxs("span",{style:{display:"flex",alignItems:"center",gap:4,color:"#10b981",fontSize:10},children:[r.jsx(g,{size:12}),"Resolved"]})]}),r.jsx("div",{style:{color:"#cbd5e1",fontSize:13,lineHeight:1.5},children:e.content}),r.jsx("div",{style:{color:"#64748b",fontSize:10,marginTop:6},children:new Date(e.created_at).toLocaleString()})]},e.id))})}),r.jsxs("div",{style:{borderTop:"1px solid #334155",paddingTop:16},children:[r.jsx("textarea",{value:y,onChange:e=>v(e.target.value),placeholder:"Leave feedback or suggestions...",style:{width:"100%",background:"#0f172a",border:"1px solid #334155",borderRadius:8,padding:12,color:"#f8fafc",fontSize:13,fontFamily:"inherit",resize:"none",minHeight:80}}),r.jsxs("button",{onClick:async()=>{if(y.trim()){_(!0);try{const t=await u.addComment({project:e.id,content:y});d([...l,t]),v(""),o&&o(t)}catch(t){}finally{_(!1)}}},disabled:w||!y.trim(),style:{width:"100%",marginTop:8,display:"flex",alignItems:"center",justifyContent:"center",gap:8,padding:"10px 16px",background:w||!y.trim()?"#334155":"#f59e0b",border:"none",borderRadius:8,color:w||!y.trim()?"#64748b":"#000",fontWeight:600,fontSize:13,cursor:w||!y.trim()?"not-allowed":"pointer"},children:[r.jsx(S,{size:14}),w?"Submitting...":"Submit Comment"]})]})]})]})}function $e({project:e,currentUser:t,onSectionUpdate:i,onCommentAdd:n,onProjectUpdate:o}){var a,s,l,d;const c=(e.collaborators||[]).find(e=>e.user===t.id),p=function(e,t){return e.created_by===t}(e,t.id);if(p)return function(e,t,i,n,o){switch(e.content_type){case"book":return r.jsx(Te,{project:e,currentUser:t,onProjectUpdate:o});case"art":return r.jsx(Be,{project:e,currentUser:t,onProjectUpdate:o});case"music":return r.jsx(Pe,{project:e,currentUser:t,onProjectUpdate:o});case"video":return r.jsx(Ue,{project:e,currentUser:t,onProjectUpdate:o});default:return r.jsx(Ce,{project:e,currentUser:t,onSectionUpdate:i,onCommentAdd:n,onProjectUpdate:o})}}(e,t,i,n,o);const u=function(e){if(!e)return null;const t=e.effective_permissions||e.permissions;if(t&&"object"==typeof t&&Object.keys(t).length>0)return{create:t.create||[],edit:t.edit||{scope:"none",types:[]},review:t.review||[],ui_components:e.ui_components||[]};const r=[],i=[];return e.can_edit_text&&(r.push("text"),i.push("text")),e.can_edit_images&&(r.push("image"),i.push("image")),e.can_edit_audio&&(r.push("audio"),i.push("audio")),e.can_edit_video&&(r.push("video"),i.push("video")),{create:r,edit:{scope:"own",types:i},review:[],ui_components:e.ui_components||[]}}(c),g=function(e){if(!e)return"none";const t=e.create.length>0||e.edit.types&&e.edit.types.length>0,r=e.review.length>0&&!t;return t?"creator":r?"reviewer":"none"}(u);if("none"===g||!u)return r.jsxs("div",{style:{padding:40,textAlign:"center",color:"#94a3b8"},children:[r.jsx(w,{size:48,style:{marginBottom:16,color:"#f59e0b"}}),r.jsx("h3",{style:{color:"#f8fafc",marginBottom:8},children:"No Content Access"}),r.jsxs("p",{style:{fontSize:14},children:["You don't have permission to view or edit content in this project yet.",r.jsx("br",{}),"Contact the project owner to update your permissions."]})]});if("reviewer"===g)return r.jsx(Fe,{project:e,currentUser:t,reviewableTypes:u.review,onCommentAdd:n});const f=u.ui_components||[],x=f.includes("chapter_editor")||u.create.includes("text")||(null==(a=u.edit.types)?void 0:a.includes("text")),h=f.includes("image_uploader")||u.create.includes("image")||(null==(s=u.edit.types)?void 0:s.includes("image")),b=f.includes("audio_uploader")||u.create.includes("audio")||(null==(l=u.edit.types)?void 0:l.includes("audio")),y=f.includes("video_uploader")||u.create.includes("video")||(null==(d=u.edit.types)?void 0:d.includes("video"));return"book"===e.content_type&&x?r.jsx(Te,{project:e,currentUser:t,onProjectUpdate:o}):!h||x||b||y?!b||x||h||y?!y||x||h||b?r.jsx(De,{project:e,currentUser:t,permissions:u,onProjectUpdate:o}):r.jsx(Ue,{project:e,currentUser:t,onProjectUpdate:o}):r.jsx(Pe,{project:e,currentUser:t,onProjectUpdate:o}):r.jsx(Be,{project:e,currentUser:t,onProjectUpdate:o})}function De({project:e,currentUser:t,permissions:i,onProjectUpdate:o}){var a,s,l,d;const[c,p]=n.useState("text"),u=(null==i?void 0:i.create.includes("text"))||(null==(a=null==i?void 0:i.edit.types)?void 0:a.includes("text")),g=(null==i?void 0:i.create.includes("image"))||(null==(s=null==i?void 0:i.edit.types)?void 0:s.includes("image")),x=(null==i?void 0:i.create.includes("audio"))||(null==(l=null==i?void 0:i.edit.types)?void 0:l.includes("audio")),b=(null==i?void 0:i.create.includes("video"))||(null==(d=null==i?void 0:i.edit.types)?void 0:d.includes("video"));n.useEffect(()=>{u?p("text"):g?p("image"):x?p("audio"):b&&p("video")},[u,g,x,b]);const y=[{key:"text",label:"Text",icon:r.jsx(h,{size:16}),available:u},{key:"image",label:"Images",icon:r.jsx(_,{size:16}),available:g},{key:"audio",label:"Audio",icon:r.jsx(f,{size:16}),available:x},{key:"video",label:"Video",icon:r.jsx(k,{size:16}),available:b}].filter(e=>e.available);return r.jsxs("div",{children:[y.length>1&&r.jsx("div",{style:{display:"flex",gap:8,marginBottom:16,borderBottom:"1px solid #334155",paddingBottom:12},children:y.map(e=>r.jsxs("button",{onClick:()=>p(e.key),style:{display:"flex",alignItems:"center",gap:6,padding:"8px 16px",background:c===e.key?"rgba(245,158,11,0.15)":"transparent",border:"1px solid "+(c===e.key?"#f59e0b":"#334155"),borderRadius:8,color:c===e.key?"#f59e0b":"#94a3b8",fontSize:13,fontWeight:600,cursor:"pointer"},children:[e.icon,e.label]},e.key))}),"text"===c&&u&&r.jsx(Te,{project:e,currentUser:t,onProjectUpdate:o}),"image"===c&&g&&r.jsx(Be,{project:e,currentUser:t,onProjectUpdate:o}),"audio"===c&&x&&r.jsx(Pe,{project:e,currentUser:t,onProjectUpdate:o}),"video"===c&&b&&r.jsx(Ue,{project:e,currentUser:t,onProjectUpdate:o})]})}function Ee(){var e,t,n;const{projectId:l}=o(),d=a(),[c,g]=s(),[f,x]=i.useState(null),[h,b]=i.useState(null),[y,v]=i.useState(!0),[m,j]=i.useState(""),[S,k]=i.useState(!1),[w,_]=i.useState(""),[z,C]=i.useState(!1),I=c.get("tab")||"overview";i.useEffect(()=>{T()},[l]);const T=async()=>{if(!l)return j("Invalid project ID"),void v(!1);v(!0),j("");try{const e=await u.getCollaborativeProject(parseInt(l,10));x(e);const t=await fetch(`${p}/api/auth/status/`,{credentials:"include"}),r=await t.json();r.authenticated&&r.user?b({id:r.user.id,username:r.user.username,display_name:r.user.display_name}):j("You must be logged in to access this project")}catch(e){j(e.message||"Failed to load project")}finally{v(!1)}},A=e=>{x(e)},B=async()=>{if(f&&w.trim()&&w.trim()!==f.title){C(!0);try{const e=await fetch(`${p}/api/auth/csrf/`,{credentials:"include"}),t=await e.json(),r=(null==t?void 0:t.csrfToken)||"",i=await fetch(`${p}/api/collaborative-projects/${f.id}/`,{method:"PATCH",headers:{"Content-Type":"application/json","X-CSRFToken":r,"X-Requested-With":"XMLHttpRequest"},credentials:"include",body:JSON.stringify({title:w.trim()})});if(i.ok){const e=await i.json();x(e),k(!1)}else{await i.json()}}catch(e){}finally{C(!1)}}else k(!1)},P=()=>{k(!1),_("")},U=null==(e=null==f?void 0:f.title)?void 0:e.startsWith("Collaboration Invite");if(y)return r.jsx("div",{className:"page",style:{maxWidth:1400,margin:"0 auto",padding:24},children:r.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"60vh",color:"#94a3b8",fontSize:16},children:"Loading project..."})});if(m)return r.jsx("div",{className:"page",style:{maxWidth:1400,margin:"0 auto",padding:24},children:r.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid #ef4444",borderRadius:12,padding:24,color:"#ef4444",textAlign:"center"},children:[r.jsx("div",{style:{fontSize:48,marginBottom:16},children:"âš ï¸"}),r.jsx("div",{style:{fontSize:18,fontWeight:600,marginBottom:8},children:"Error Loading Project"}),r.jsx("div",{style:{fontSize:14,marginBottom:24},children:m}),r.jsx("button",{onClick:()=>d("/collaborations"),style:{background:"#ef4444",border:"none",borderRadius:8,padding:"10px 20px",color:"#fff",fontWeight:600,cursor:"pointer",fontSize:14},children:"Back to Dashboard"})]})});if(!f||!h)return null;const F=(null==(t=f.recent_comments)?void 0:t.filter(e=>!e.resolved).length)||0,D=(null==(n=f.collaborators)?void 0:n.filter(e=>!("accepted"!==e.status||e.approved_current_version&&e.approved_revenue_split)).length)||0;return r.jsxs("div",{className:"page",style:{maxWidth:1400,margin:"0 auto",padding:24},children:[r.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:20},children:r.jsxs("div",{children:[r.jsx("button",{onClick:()=>d("/collaborations"),style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"8px 16px",color:"var(--text)",cursor:"pointer",fontSize:14,marginBottom:12},children:"â† Back to Dashboard"}),S?r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[r.jsx("input",{type:"text",value:w,onChange:e=>_(e.target.value),placeholder:"Enter project title...",autoFocus:!0,onKeyDown:e=>{"Enter"===e.key&&B(),"Escape"===e.key&&P()},style:{fontSize:28,fontWeight:700,background:"var(--panel)",border:"2px solid #f59e0b",borderRadius:8,padding:"8px 16px",color:"var(--text)",minWidth:400}}),r.jsx("button",{onClick:B,disabled:z||!w.trim(),style:{background:"#10b981",border:"none",borderRadius:8,padding:"10px 20px",color:"#fff",fontWeight:600,cursor:z?"not-allowed":"pointer",opacity:z?.6:1},children:z?"Saving...":"Save"}),r.jsx("button",{onClick:P,style:{background:"transparent",border:"1px solid var(--panel-border)",borderRadius:8,padding:"10px 20px",color:"#94a3b8",cursor:"pointer"},children:"Cancel"})]}):r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12},children:[r.jsx("h1",{style:{margin:0,fontSize:28,fontWeight:700,color:U?"#f59e0b":"var(--text)"},children:f.title}),f.created_by===h.id&&r.jsx("button",{onClick:()=>{_((null==f?void 0:f.title)||""),k(!0)},title:"Edit project title",style:{background:"transparent",border:"none",padding:4,cursor:"pointer",fontSize:18,color:"#94a3b8"},children:"âœï¸"})]}),U&&!S&&r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8,marginTop:8,padding:"8px 12px",background:"rgba(245, 158, 11, 0.1)",border:"1px solid #f59e0b",borderRadius:8,fontSize:13,color:"#f59e0b"},children:[r.jsx("span",{children:"âš ï¸"}),r.jsx("span",{children:f.created_by===h.id?"This project has a placeholder title. Click the edit button to set a proper title before publishing.":"This project has a placeholder title. Only the owner can change the title."})]}),r.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginTop:8},children:[r.jsxs("span",{style:{background:"rgba(139, 92, 246, 0.1)",color:"#8b5cf6",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600},children:[f.content_type.charAt(0).toUpperCase()+f.content_type.slice(1)," Project"]}),r.jsx("span",{style:{background:"ready_for_mint"===f.status?"rgba(16, 185, 129, 0.1)":"rgba(245, 158, 11, 0.1)",color:"ready_for_mint"===f.status?"#10b981":"#f59e0b",padding:"4px 10px",borderRadius:6,fontSize:12,fontWeight:600},children:f.status.replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase())})]})]})}),r.jsx("div",{style:{marginBottom:20},children:r.jsx(R,{activeTab:I,onTabChange:e=>{g({tab:e})},badges:{activity:F,team:D},isFullyApproved:f.is_fully_approved})}),r.jsxs("div",{style:{minHeight:"60vh"},children:["overview"===I&&r.jsx(W,{project:f,currentUser:h,onProjectUpdate:A}),"content"===I&&r.jsx($e,{project:f,currentUser:h,onSectionUpdate:e=>{},onCommentAdd:e=>{},onProjectUpdate:A}),"team"===I&&r.jsx($,{project:f,currentUser:h,onProjectUpdate:A}),"activity"===I&&r.jsx(fe,{project:f,currentUser:h}),"publish"===I&&r.jsx(xe,{project:f,currentUser:h,onProjectUpdate:A})]})]})}export{Ee as default};
//# sourceMappingURL=CollaborativeProjectPage-BiVNAJ3v.js.map
